<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="一个年轻人奔向梦想的足迹" href="https://kotori_suki.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="一个年轻人奔向梦想的足迹" href="https://kotori_suki.github.io/atom.xml"><link rel="alternate" type="application/json" title="一个年轻人奔向梦想的足迹" href="https://kotori_suki.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="https://kotori_suki.github.io/2021/12/01/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20%E6%80%BB%E8%A7%88%20&%20UEngine%20&%20UGameInstance/"><title>Gameplay —— 总览 & UEngine & UGameInstance - Gameplay - UE4_C++ - UE4 | Afei's Blog = 一个年轻人奔向梦想的足迹 = Welcome to my blog !</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Gameplay —— 总览 & UEngine & UGameInstance</h1><div class="meta"><span class="item" title="创建时间：2021-12-01 13:23:45"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-12-01T13:23:45+08:00">2021-12-01</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Afei's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicm0fdw5cj20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicitht3xtj20zk0m8k5v.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipew28b65j20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicliierfjj20zk0m8npd.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giciukx8a7j20zk0m8aio.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclxxcb6rj20zk0m8b29.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/UE4/" itemprop="item" rel="index" title="分类于 UE4"><span itemprop="name">UE4</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/UE4/UE4CPP/" itemprop="item" rel="index" title="分类于 UE4_C++"><span itemprop="name">UE4_C++</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/UE4/UE4CPP/Gameplay/" itemprop="item" rel="index" title="分类于 Gameplay"><span itemprop="name">Gameplay</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://kotori_suki.github.io/2021/12/01/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20%E6%80%BB%E8%A7%88%20&%20UEngine%20&%20UGameInstance/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="-YIFEI-"><meta itemprop="description" content="Welcome to my blog !, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="一个年轻人奔向梦想的足迹"></span><div class="body md" itemprop="articleBody"><h2 id="gameplay-总览-uengine-ugameinstance"><a class="anchor" href="#gameplay-总览-uengine-ugameinstance">#</a> Gameplay —— 总览 &amp; UEngine &amp; UGameInstance</h2><p>简介：虚幻的 &quot;Gameplay&quot; 框架相比于其他底层框架来说，跟我们客户端的开发可以说是交集最多的了。无论是有实体的 &quot;World&quot; , &quot;Level&quot; , &quot;Actor&quot;，还是没有实体的 &quot;Controller&quot; , &quot;NetWork&quot; , &quot;GameMode&quot; , 这些种种都归属于 &quot;Gameplay&quot; 框架。他控制世界的生成，物品的生成，角色的控制，还指定世界规则，记录世界数据。然而在源码中并没有关于 &quot;Gameplay&quot; 的任何介绍，他是一个概念化名词，是多个类相互协作进行游戏的结果。</p><p>以下我们将对构成 &quot;Gameplay&quot; 框架的类逐一进行源码层的分析。本篇默认读者已经对 &quot;Gameplay&quot; 的使用有一定的了解。<strong>我们不讲使用，不讲使用，不讲使用</strong>。好的，那咱开始吧 😃</p><h3 id="gameplay-总览"><a class="anchor" href="#gameplay-总览">#</a> Gameplay 总览</h3><p>先贴一张框架图 (引自 <span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8yNDE3MDY5Nw==">InsideUE4</span> )</p><p><img data-src="%E6%A1%86%E6%9E%B6%E5%9B%BE.png" alt="框架图"></p><p>上图展示了 &quot;Gameplay&quot; 系统的整个基本框架，相信上面的类对读者来说也都不陌生了 (游戏开发中基本都会用到)。不过在开始源码解析之前，我们不妨先复习一下他们各自的作用，这样我们后面理解起来也会比较有条理，也算是照顾一下新手玩家吧～～～</p><table><thead><tr><th>类名</th><th>作用</th></tr></thead><tbody><tr><td>UEngine</td><td>引擎类，每个终端只会生成一个，并作为全局变量存在 &quot;GEngine&quot; 里。在 编辑器模式下，&quot;GEngine&quot; 是 &quot;UEditorEngine&quot; 的实例，在 Standalone Game 模式下则是 &quot;UGameEngine&quot;</td></tr><tr><td>UGameInstance</td><td>游戏实例类，每个终端只会生成一个，存在 &quot;FWorldContext&quot; 中。该类持有所有本地玩家的指针，指向当前世界的 &quot;WorldContext&quot; 的指针，当前所有有效的 UObject 等等</td></tr><tr><td>FWorldContext</td><td>世界上下文类，存在 UEngine 的 WorldList 中，可以有多个实例，但每个 GameInstance 只能使用一个。也就是说，每个终端同时只能使用同一个世界上下文实例</td></tr><tr><td>UWorld</td><td>与 FWorldContext 一一对应，同时只能存在一个世界。其持有所有关卡 ULevel，游戏规则 AGameMode，游戏状态 AGameState 等。世界类随着世界的切换而生成或销毁</td></tr><tr><td>ULevel</td><td>关卡类，持有所有的演员 AActor，关卡脚本 ALevelScriptActor，世界设定 AWorldSettings 等</td></tr><tr><td>AActor</td><td>演员类，可以是存在世界中的实体，如：Pawn 等，也可以是存在世界的灵体，如：Controller，GameMode 等</td></tr><tr><td>UActorComponent</td><td>组件类，用于实现 Actor 的某一特定功能的组件，如：UMeshComponent (网格体组件，赋予 Actor 网格体模型)，UMovementComponent (赋予 Character 移动的能力) 等</td></tr><tr><td>APawn</td><td>所有可被 Controller 控制的类的基类。拥有 SceneComponent，可被放置在 Level 中</td></tr><tr><td>AController</td><td>控制 Pawn 的行为的控制类，APlayerController 是提供给玩家操控的控制器类，AAIController 则由 AI 控制。非实体类，不可放置在 Level 中。控制器实例可以更换控制的 Pawn 对象</td></tr><tr><td>AGameMode</td><td>游戏规则类，用于制定世界规则 (如：游戏胜利规则等)，Level 切换，多人游戏的同步等，<strong>仅存在服务器端</strong>。</td></tr><tr><td>AGameState</td><td>游戏状态类，用于记录当前游戏的全局状态数据 (如：服务器运行时间等)，由 GameMode 生成更新，并同步到所有客户端中。</td></tr><tr><td>APlayerState</td><td>玩家状态类，用于记录只跟某个玩家有关的网络游戏相关数据 (如：玩家姓名，段位等)。服务器为每个玩家生成一个对象，并将所有对象复制到所有客户端</td></tr><tr><td>USaveGame</td><td>保存游戏永久数据，写进磁盘中自由读写。</td></tr><tr><td>UPlayer</td><td>玩家类，与 PlayerController 一一对应。其子类 &quot;ULocalPlayer&quot; 只存在于本地，表示本地玩家，另一个子类 &quot;UNetConnection&quot; 同样表示玩家，用于网络传输</td></tr></tbody></table><p>上表对 &quot;Gameplay&quot; 框架的总结肯定是不全的，只能算是写者认为的 比较基础而重要的知识点。想要更全面地了解 &quot;Gameplay&quot; (又或者其他模块)，读源码肯定是最直接而有效的办法。话不多说，正片开始（￣︶￣）↗</p><h3 id="深入源码"><a class="anchor" href="#深入源码">#</a> 深入源码</h3><p>我们分析源码的顺序跟上文表格中的顺序一致，底层的先分析，上层的后分析 (对新手可能不太友好)。那么... 首先是我们的 UEngine ( 头疼 😦 )</p><h3 id="uengine"><a class="anchor" href="#uengine">#</a> UEngine</h3><p>UEngine 类的代码定义和实现长达 2w 行，<strong>处理的事情很多很杂，而且很多函数牵扯到的往往是另外一个很大的模块 (例如：GC)，所以我们只对其 &quot;Engine.h&quot; 文件中变量声明和函数声明做一个简单的介绍</strong>，具体的函数实现在 &quot;UnrealEngine.cpp&quot; 中。有兴趣的同学请自行研究</p><p></p><figure class="highlight c++"><figcaption><span>UEngine</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Engine.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// UEngine 是抽象类，只有其子类可以初始化全局变量 GEngine</span></span><br><span class="line"><span class="built_in">UCLASS</span>(abstract, config=Engine, defaultconfig, transient)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ENGINE_API</span> <span class="title">UEngine</span></span></span><br><span class="line"><span class="class">	:</span> <span class="keyword">public</span> UObject</span><br><span class="line">	, <span class="keyword">public</span> FExec</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_UCLASS_BODY</span>()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UFont</span>* <span class="title">TinyFont</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/** 设置最小的引擎文本的字体 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(globalconfig, EditAnywhere, Category=Fonts, meta=(AllowedClasses=<span class="string">&quot;Font&quot;</span>, DisplayName=<span class="string">&quot;Tiny Font&quot;</span>))</span><br><span class="line">	FSoftObjectPath TinyFontName;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// ....... 省略其他文本字体的设置(656行)</span></span><br><span class="line">        </span><br><span class="line">    <span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TSubclassOf&lt;<span class="class"><span class="keyword">class</span> <span class="title">UConsole</span>&gt;</span>  ConsoleClass;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 设置 UConsole 类 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(globalconfig, noclear, EditAnywhere, Category=DefaultClasses, meta=(MetaClass=<span class="string">&quot;Console&quot;</span>, DisplayName=<span class="string">&quot;Console Class&quot;</span>))</span><br><span class="line">	FSoftClassPath ConsoleClassName;</span><br><span class="line">        </span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TSubclassOf&lt;<span class="class"><span class="keyword">class</span> <span class="title">UGameViewportClient</span>&gt;</span>  GameViewportClientClass;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 设置 UGameViewportClient 类，重写以改变游戏特定的输入和显示行为 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(globalconfig, noclear, EditAnywhere, Category=DefaultClasses, meta=(MetaClass=<span class="string">&quot;GameViewportClient&quot;</span>, DisplayName=<span class="string">&quot;Game Viewport Client Class&quot;</span>))</span><br><span class="line">	FSoftClassPath GameViewportClientClassName;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TSubclassOf&lt;<span class="class"><span class="keyword">class</span> <span class="title">ULocalPlayer</span>&gt;</span>  LocalPlayerClass;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 设置 ULocalPlayer 类，重写以存储游戏特定的本地玩家数据 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(globalconfig, noclear, EditAnywhere, Category=DefaultClasses, meta=(MetaClass=<span class="string">&quot;LocalPlayer&quot;</span>, DisplayName=<span class="string">&quot;Local Player Class&quot;</span>))</span><br><span class="line">	FSoftClassPath LocalPlayerClassName;</span><br><span class="line">        </span><br><span class="line">    <span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TSubclassOf&lt;<span class="class"><span class="keyword">class</span> <span class="title">AWorldSettings</span>&gt;</span>  WorldSettingsClass;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 设置 WorldSettings 类，重写以存储游戏特定的世界信息 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(globalconfig, noclear, EditAnywhere, Category=DefaultClasses, meta=(MetaClass=<span class="string">&quot;WorldSettings&quot;</span>, DisplayName=<span class="string">&quot;World Settings Class&quot;</span>))</span><br><span class="line">	FSoftClassPath WorldSettingsClassName;</span><br><span class="line">        </span><br><span class="line">    <span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TSubclassOf&lt;<span class="class"><span class="keyword">class</span> <span class="title">UNavigationSystemBase</span>&gt;</span>  NavigationSystemClass;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 设置 UNavigationSystem 类，重写以改变游戏特定的 导航/AI 行为 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(globalconfig, noclear, meta=(MetaClass=<span class="string">&quot;NavigationSystem&quot;</span>, DisplayName=<span class="string">&quot;Navigation System Class&quot;</span>))</span><br><span class="line">	FSoftClassPath NavigationSystemClassName;</span><br><span class="line">        </span><br><span class="line">    <span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TSubclassOf&lt;<span class="class"><span class="keyword">class</span> <span class="title">UNavigationSystemConfig</span>&gt;</span>  NavigationSystemConfigClass;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 设置 UNavigationSystemConfig 类，重写以改变游戏特定的 导航/AI 行为 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(globalconfig, noclear, meta = (MetaClass = <span class="string">&quot;NavigationSystem&quot;</span>, DisplayName = <span class="string">&quot;Navigation System Config Class&quot;</span>))</span><br><span class="line">	FSoftClassPath NavigationSystemConfigClassName;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* </span></span><br><span class="line"><span class="comment">	 * 诸如上述的 &quot;FSoftClassPath&quot; 设置还有: </span></span><br><span class="line"><span class="comment">	 * UAvoidanceManager	</span></span><br><span class="line"><span class="comment">     * AAIController</span></span><br><span class="line"><span class="comment">	 * UPhysicsCollisionHandler	</span></span><br><span class="line"><span class="comment">	 * UGameUserSettings</span></span><br><span class="line"><span class="comment">	 * ALevelScriptActor</span></span><br><span class="line"><span class="comment">	 * DefaultBlueprintBaseClass</span></span><br><span class="line"><span class="comment">	 * GameSingletonClass</span></span><br><span class="line"><span class="comment">	 * AssetManagerClass</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment">/** 在初始化时生成的UObject，用于处理运行时资产加载和管理 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UAssetManager</span> *<span class="title">AssetManager</span>;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...... 省略各种全局的 Texture 对象 和 Material 对象 (应用于编辑器中的各种默认物体)(797行)</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">// ...... 省略各种颜色数组 (用于LOD着色的颜色，渲染shader复杂度的颜色等)(1069行)</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">// ...... 省略各种复杂度视图模式组合的复杂度限制参数 (如: MinLightMapDensity)(1104行)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Variables</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 引擎循环，用于从引擎模组回调到启动. */</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">IEngineLoop</span>* <span class="title">EngineLoop</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 表示当前游戏实例的视口。可以为0，使用前请验证是否存在 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UGameViewportClient</span>* <span class="title">GameViewport</span>;</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 在帧末执行的延迟命令字符串 的数组 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TArray&lt;FString&gt; DeferredCommands;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 脚本最大循环迭代的次数，用作警告用户脚本执行失控的阈值 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, config, Category=Blueprints)</span><br><span class="line">	int32 MaximumLoopIterationCount;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** actors 或 components 的蓝图子类的 tick 是否默认开启*/</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere, config, Category=Blueprints)</span><br><span class="line">	uint32 bCanBlueprintsTickByDefault:<span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 优化动画蓝图成员变量访问。</span></span><br><span class="line"><span class="comment">     * 是否使用优化路径来访问其类的成员变量以避免与蓝图虚拟机的冲突</span></span><br><span class="line"><span class="comment">     * 这将强制重新编译所有动画蓝图</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere, config, Category=<span class="string">&quot;Anim Blueprints&quot;</span>)</span><br><span class="line">	uint32 bOptimizeAnimBlueprintMemberVariableAccess:<span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 是否允许动画蓝图表默认使用多线程更新</span></span><br><span class="line"><span class="comment">     * 这将在anim blueprint编译器中启用一些额外检查，以便在尝试不安全操作时发出警告。</span></span><br><span class="line"><span class="comment">     * 这将强制重新编译所有动画蓝图</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere, config, Category=<span class="string">&quot;Anim Blueprints&quot;</span>)</span><br><span class="line">	uint32 bAllowMultiThreadedAnimationUpdate:<span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 控制是实时更新级联粒子系统LOD，还是使用设定值 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(config)</span><br><span class="line">	uint32 bEnableEditorPSysRealtimeLOD:<span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 强制禁用帧速率平滑 */</span></span><br><span class="line">    uint32 bForceDisableFrameRateSmoothing : <span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 是否启用帧速率平滑 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(config, EditAnywhere, Category=Framerate, meta=(EditCondition=<span class="string">&quot;!bUseFixedFrameRate&quot;</span>))</span><br><span class="line">	uint32 bSmoothFrameRate:<span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 是否启用固定帧速率 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(config, EditAnywhere, Category=Framerate)</span><br><span class="line">	uint32 bUseFixedFrameRate : <span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 使用的固定帧速率大小 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(config, EditAnywhere, Category=Framerate, meta=(EditCondition=<span class="string">&quot;bUseFixedFrameRate&quot;</span>, ClampMin = <span class="string">&quot;15.0&quot;</span>))</span><br><span class="line">	<span class="keyword">float</span> FixedFrameRate;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 因平滑牺牲掉的帧数的可接受范围 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(config, EditAnywhere, Category=Framerate, meta=(UIMin=<span class="number">0</span>, UIMax=<span class="number">200</span>, EditCondition=<span class="string">&quot;!bUseFixedFrameRate&quot;</span>))</span><br><span class="line">	FFloatRange SmoothedFrameRateRange;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">/** 控制引擎如何处理 帧数率/步长 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(transient)</span><br><span class="line">	UEngineCustomTimeStep* CustomTimeStep;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 自定义的时间步长改变时调用的多播代理 */</span></span><br><span class="line">	FSimpleMulticastDelegate CustomTimeStepChangedEvent;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当前自定义时间步长是否被正确初始化，是否应该将其关闭 */</span></span><br><span class="line">	<span class="keyword">bool</span> bIsCurrentCustomTimeStepInitialized;</span><br><span class="line">        </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 重载引擎应如何处理帧速率/步长</span></span><br><span class="line"><span class="comment">	 * 该类负责更新应用时间和增量时间</span></span><br><span class="line"><span class="comment">	 * 可用于使引擎和另一进程同步(gen-lock)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(AdvancedDisplay, config, EditAnywhere, Category=Framerate, meta=(MetaClass=<span class="string">&quot;EngineCustomTimeStep&quot;</span>, DisplayName=<span class="string">&quot;Custom TimeStep&quot;</span>))</span><br><span class="line">	FSoftClassPath CustomTimeStepClassName;</span><br><span class="line">        </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 我们是否应该检查一帧中生成的 pawns 的数量</span></span><br><span class="line"><span class="comment">	 * 基本上，生成 pawns 和 所有附件可以很慢，在控制台甚至更慢</span></span><br><span class="line"><span class="comment">	 **/</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(config)</span><br><span class="line">	uint32 bCheckForMultiplePawnsSpawnedInAFrame:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 如果 bCheckForMultiplePawnsSpawnedInAFrame==true, </span></span><br><span class="line"><span class="comment">     * 我们将检查每一帧spawn的pawns 是否超过这个数字 </span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(config)</span><br><span class="line">	int32 NumPawnsAllowedToBeSpawnedInAFrame;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 省略 debug 相关的颜色设置(1360行)</span></span><br><span class="line">        </span><br><span class="line">   	<span class="comment">// ........</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 流暂停开始时的代理句柄，在 FStreamingPauseRenderingModule::StartupModule() 调用时被初次设置，后续可以在游戏中重写 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RegisterBeginStreamingPauseRenderingDelegate</span><span class="params">( FBeginStreamingPauseDelegate* InDelegate )</span></span>;</span><br><span class="line">	FBeginStreamingPauseDelegate* BeginStreamingPauseDelegate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 流暂停结束时的代理句柄，在 FStreamingPauseRenderingModule::StartupModule() 调用时被初次设置，后续可以在游戏中重写 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RegisterEndStreamingPauseRenderingDelegate</span><span class="params">( FEndStreamingPauseDelegate* InDelegate )</span></span>;</span><br><span class="line">	FEndStreamingPauseDelegate* EndStreamingPauseDelegate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 预渲染代理 */</span></span><br><span class="line">	FPreRenderDelegate PreRenderDelegate;</span><br><span class="line">	<span class="function">FPreRenderDelegate&amp; <span class="title">GetPreRenderDelegate</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> PreRenderDelegate; &#125;</span><br><span class="line">	<span class="comment">/** 渲染后处理代理 */</span></span><br><span class="line">	FPostRenderDelegate PostRenderDelegate;</span><br><span class="line">	<span class="function">FPostRenderDelegate&amp; <span class="title">GetPostRenderDelegate</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> PostRenderDelegate; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 与 server travel 相关的错误信息事件</span></span><br><span class="line">    <span class="built_in">DECLARE_EVENT_ThreeParams</span>(UEngine, FOnTravelFailure, UWorld*, ETravelFailure::Type, <span class="keyword">const</span> FString&amp;);</span><br><span class="line">	FOnTravelFailure TravelFailureEvent;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 与网络相关的错误信息事件</span></span><br><span class="line">    <span class="built_in">DECLARE_EVENT_FourParams</span>(UEngine, FOnNetworkFailure, UWorld*, UNetDriver*, ENetworkFailure::Type, <span class="keyword">const</span> FString&amp;);</span><br><span class="line">	FOnNetworkFailure NetworkFailureEvent;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 网络延迟回调，对于服务端意味着所有客户端都延迟，对于客户端则单独延迟 */</span></span><br><span class="line">	<span class="built_in">DECLARE_EVENT_ThreeParams</span>(UEngine, FOnNetworkLagStateChanged, UWorld*, UNetDriver*, ENetworkLagState::Type);</span><br><span class="line">	FOnNetworkLagStateChanged NetworkLagStateChangedEvent;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 检测到网络突发或DDoS。主要用于触发分析 */</span></span><br><span class="line">	<span class="built_in">DECLARE_EVENT_ThreeParams</span>(UEngine, FOnNetworkDDoSEscalation, UWorld*, UNetDriver*, FString <span class="comment">/*SeverityCategory*/</span>);</span><br><span class="line">	FOnNetworkDDoSEscalation NetworkDDoSEscalationEvent;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">bool</span> bIsInitialized;</span><br><span class="line">        </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">/** 最后一次调用 &quot;ConditionalCollectGarbage&quot; 的GC帧，避免在一帧中进行多次GC */</span></span><br><span class="line">	uint64 LastGCFrame;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 距离上次清除 pending kill object 后过去的时间(秒) */</span></span><br><span class="line">	<span class="keyword">float</span> TimeSinceLastPendingKillPurge;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 全量清除是否被激活，如果激活，下次垃圾收集将进行一次全量清除 */</span></span><br><span class="line">	<span class="keyword">bool</span> bFullPurgeTriggered;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 我们是否应该延迟GC到下一帧，以便完成一些挂起操作 */</span></span><br><span class="line">	<span class="keyword">bool</span> bShouldDelayGarbageCollect; </span><br><span class="line">        </span><br><span class="line">    <span class="comment">// ........ 省略一些 SelectedMaterialColor 的函数操作(Set, Override等)(1617行)</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 查询当前动态分辨率的信息</span></span><br><span class="line">   	<span class="function"><span class="keyword">void</span> <span class="title">GetDynamicResolutionCurrentStateInfos</span><span class="params">(FDynamicResolutionStateInfos&amp; OutInfos)</span> <span class="keyword">const</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 停止动态分辨率调整</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">PauseDynamicResolution</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 继续开启动态分辨率调整</span></span><br><span class="line">    <span class="function">FORCEINLINE <span class="keyword">void</span> <span class="title">ResumeDynamicResolution</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 激活动态分辨率事件</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">EmitDynamicResolutionEvent</span><span class="params">(EDynamicResolutionStateEvent Event)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 在下一帧改变动态分辨率的状态</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ChangeDynamicResolutionStateAtNextFrame</span><span class="params">(TSharedPtr&lt; class IDynamicResolutionState &gt; NewState)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...... 省略更多关于动态分辨率的函数(1685行)</span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 音频设备管理器 */</span></span><br><span class="line">	FAudioDeviceManager* AudioDeviceManager;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 主音频设备的音频设备句柄 */</span></span><br><span class="line">	FAudioDeviceHandle MainAudioDeviceHandle;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// ...... 省略 DebugMessage 的相关函数(1736行)</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 添加一个世界时被激活</span></span><br><span class="line">    <span class="built_in">DECLARE_EVENT_OneParam</span>( UEngine, FWorldAddedEvent, UWorld* );</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 返回添加世界的事件</span></span><br><span class="line">    <span class="function">FWorldAddedEvent&amp; <span class="title">OnWorldAdded</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> WorldAddedEvent; &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 销毁一个世界时被激活 */</span>	</span><br><span class="line">	<span class="built_in">DECLARE_EVENT_OneParam</span>( UEngine, FWorldDestroyedEvent , UWorld* );</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 返回销毁世界的代理 */</span>	</span><br><span class="line">	<span class="function">FWorldDestroyedEvent&amp;	<span class="title">OnWorldDestroyed</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> WorldDestroyedEvent; &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 在一个世界被添加时需要被调用以广播该信息 */</span>	</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span>			<span class="title">WorldAdded</span><span class="params">( UWorld* World )</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 在一个世界被销毁时需要被调用以广播该信息 */</span>	</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span>			<span class="title">WorldDestroyed</span><span class="params">( UWorld* InWorld )</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">IsInitialized</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> bIsInitialized; &#125;</span><br><span class="line">        </span><br><span class="line">	<span class="comment">// ....... 省略一段编辑器模式下的代码(1796行)</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 服务器连接失败时激活该事件 */</span></span><br><span class="line">    <span class="function">FOnTravelFailure&amp; <span class="title">OnTravelFailure</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> TravelFailureEvent; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 当服务器连接失败时，引擎系统内部将调用该函数 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">BroadcastTravelFailure</span><span class="params">(UWorld* InWorld, ETravelFailure::Type FailureType, <span class="keyword">const</span> FString&amp; ErrorString = TEXT(<span class="string">&quot;&quot;</span>))</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		TravelFailureEvent.<span class="built_in">Broadcast</span>(InWorld, FailureType, ErrorString);</span><br><span class="line">	&#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 发生网络错误时触发该事件 */</span></span><br><span class="line">	<span class="function">FOnNetworkFailure&amp; <span class="title">OnNetworkFailure</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> NetworkFailureEvent; &#125;</span><br><span class="line">	<span class="comment">/** 发生网络错误时，引擎系统内部将调用该函数 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">BroadcastNetworkFailure</span><span class="params">(UWorld * World, UNetDriver *NetDriver, ENetworkFailure::Type FailureType, <span class="keyword">const</span> FString&amp; ErrorString = TEXT(<span class="string">&quot;&quot;</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 发生网络延迟或延迟结束时调用的事件 */</span></span><br><span class="line">	<span class="function">FOnNetworkLagStateChanged&amp; <span class="title">OnNetworkLagStateChanged</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> NetworkLagStateChangedEvent; &#125;</span><br><span class="line">	<span class="comment">/** 发生网络延迟或延迟结束时，引擎系统内部将调用该函数 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">BroadcastNetworkLagStateChanged</span><span class="params">(UWorld * World, UNetDriver *NetDriver, ENetworkLagState::Type LagType)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		NetworkLagStateChangedEvent.<span class="built_in">Broadcast</span>(World, NetDriver, LagType);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 检测到网络突发异常和 DDos 时触发该事件 */</span></span><br><span class="line">	<span class="function">FOnNetworkDDoSEscalation&amp; <span class="title">OnNetworkDDoSEscalation</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> NetworkDDoSEscalationEvent; &#125;</span><br><span class="line">	<span class="comment">/** 检测到网络突发异常和 DDos 时，引擎系统内部将调用该函数 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">BroadcastNetworkDDosSEscalation</span><span class="params">(UWorld* World, UNetDriver* NetDriver, FString SeverityCategory)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		NetworkDDoSEscalationEvent.<span class="built_in">Broadcast</span>(World, NetDriver, SeverityCategory);</span><br><span class="line">	&#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// UObject 的接口函数</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">FinishDestroy</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Serialize</span><span class="params">(FArchive&amp; Ar)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddReferencedObjects</span><span class="params">(UObject* InThis, FReferenceCollector&amp; Collector)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WITH_EDITOR</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PostEditChangeProperty</span><span class="params">(struct FPropertyChangedEvent&amp; PropertyChangedEvent)</span> <span class="keyword">override</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 初始化游戏引擎 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Init</span><span class="params">(IEngineLoop* InEngineLoop)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 启动游戏，与初始化调用分开，以允许在游戏开始前进行初始化后配置 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Start</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 在关闭时调用，就在退出清除之前 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PreExit</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ReleaseAudioDeviceManager</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ShutdownHMD</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 启动时调用，在 &quot;FEngineLoop:Init&quot; 的中间 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ParseCommandline</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// FExec 的接口，执行命令</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">Exec</span><span class="params">( UWorld* InWorld, <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Out=*GLog )</span> <span class="keyword">override</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** Exec 命令处理程序 */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">HandleFlushLogCommand</span><span class="params">( <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar )</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">HandleGameVerCommand</span><span class="params">( <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar )</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">HandleStatCommand</span><span class="params">( UWorld* World, FCommonViewportClient* ViewportClient, <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar )</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">HandleStopMovieCaptureCommand</span><span class="params">( <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar )</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">HandleCrackURLCommand</span><span class="params">( <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar )</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">HandleDeferCommand</span><span class="params">( <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">HandleCeCommand</span><span class="params">( UWorld* InWorld, <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar )</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">HandleDumpTicksCommand</span><span class="params">( UWorld* InWorld, <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar )</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">HandleGammaCommand</span><span class="params">( <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">HandleShowLogCommand</span><span class="params">( <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar )</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// ....... 省略各种 command handler 函数(1983行)</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Tick</span><span class="params">(<span class="keyword">float</span> DeltaSeconds, <span class="keyword">bool</span> bIdleMode)</span> <span class="title">PURE_VIRTUAL</span><span class="params">(UEngine::Tick,)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 更新 FApp::CurrentTime / FApp::DeltaTime，同时考虑最大Tick速率 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">UpdateTimeAndHandleMaxTickRate</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开启 / 关闭游戏线程延迟</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetGameLatencyMarkerStart</span><span class="params">(uint64 FrameNumber)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetGameLatencyMarkerEnd</span><span class="params">(uint64 FrameNumber)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开启 / 关闭渲染线程延迟</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetRenderLatencyMarkerStart</span><span class="params">(uint64 FrameNumber)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetRenderLatencyMarkerEnd</span><span class="params">(uint64 FrameNumber)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 允许游戏更正增量时间(delta time) */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">double</span> <span class="title">CorrectNegativeTimeDelta</span><span class="params">(<span class="keyword">double</span> DeltaRealTime)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 关闭当前自定义时间步长，并重新初始化 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ReinitializeCustomTimeStep</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">	<span class="comment">/** 设置自定义时间步长 */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">SetCustomTimeStep</span><span class="params">(UEngineCustomTimeStep* InCustomTimeStep)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// ....... 省略部分跟 时间步长, Tick率, FPS相关 的函数(2088行)</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 是否允许平滑帧速率 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">IsAllowedFramerateSmoothing</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 更新 FApp::Timecode</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">UpdateTimecode</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 关闭当前 timecode provider，并重新初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ReinitializeTimecodeProvider</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// ...... 省略部分关于 TimecodeProvider 的函数(2124行)</span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 当游戏窗口失去 / 获得焦点时，是否停止 / 开始游戏</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnLostFocusPause</span><span class="params">( <span class="keyword">bool</span> EnablePause )</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 返回自上次调用此函数以来的平均游戏/渲染/gpu/总时间</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetAverageUnitTimes</span><span class="params">( TArray&lt;<span class="keyword">float</span>&gt;&amp; AverageTimes )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新用于统计 平均游戏/渲染/gpu/总时间 的值</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetAverageUnitTimes</span><span class="params">(<span class="keyword">float</span> FrameTime, <span class="keyword">float</span> RenderThreadTime, <span class="keyword">float</span> GameThreadTime, <span class="keyword">float</span> GPUFrameTime, <span class="keyword">float</span> RHITFrameTime)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 放回给定帧时间的显示颜色(如: 30FPS 为绿色)</span></span><br><span class="line">    <span class="function">FColor <span class="title">GetFrameTimeDisplayColor</span><span class="params">(<span class="keyword">float</span> FrameTimeMS)</span> <span class="keyword">const</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 如果根据当前状态限制 CPU 的使用 则返回 true</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">ShouldThrottleCPUUsage</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">        </span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 返回游戏玩家的引用数组 </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	TArray&lt;<span class="class"><span class="keyword">class</span> <span class="title">ULocalPlayer</span>*&gt;</span>::<span class="function">TConstIterator	<span class="title">GetLocalPlayerIterator</span><span class="params">(UWorld *World)</span></span>;</span><br><span class="line">	TArray&lt;<span class="class"><span class="keyword">class</span> <span class="title">ULocalPlayer</span>*&gt;</span>::<span class="function">TConstIterator <span class="title">GetLocalPlayerIterator</span><span class="params">(<span class="keyword">const</span> UGameViewportClient *Viewport)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">const</span> TArray&lt;class ULocalPlayer*&gt;&amp; <span class="title">GetGamePlayers</span><span class="params">(UWorld *World)</span> <span class="keyword">const</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">const</span> TArray&lt;class ULocalPlayer*&gt;&amp; <span class="title">GetGamePlayers</span><span class="params">(<span class="keyword">const</span> UGameViewportClient *Viewport)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回与给定 ControllerId 相匹配的第一个本地玩家 */</span></span><br><span class="line">    <span class="function">class ULocalPlayer* <span class="title">FindFirstLocalPlayerFromControllerId</span><span class="params">(int32 ControllerId)</span> <span class="keyword">const</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 返回 GamePlayers 数组中的玩家个数 */</span></span><br><span class="line">    <span class="function">int32 <span class="title">GetNumGamePlayers</span><span class="params">(UWorld* InWorld)</span>；</span></span><br><span class="line"><span class="function">    int32 <span class="title">GetNumGamePlayers</span><span class="params">(<span class="keyword">const</span> UGameViewportClient *InViewport)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 返回给定下标的本地玩家 */</span></span><br><span class="line">    <span class="function">ULocalPlayer* <span class="title">GetGamePlayer</span><span class="params">( UWorld * InWorld, int32 InPlayer )</span></span>;</span><br><span class="line">	<span class="function">ULocalPlayer* <span class="title">GetGamePlayer</span><span class="params">( <span class="keyword">const</span> UGameViewportClient* InViewport, int32 InPlayer )</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 返回 GamePlayer 数组中的第一个本地玩家 */</span></span><br><span class="line">    <span class="function">ULocalPlayer* <span class="title">GetFirstGamePlayer</span><span class="params">( UWorld *InWorld )</span></span>;</span><br><span class="line">	<span class="function">ULocalPlayer* <span class="title">GetFirstGamePlayer</span><span class="params">(<span class="keyword">const</span> UGameViewportClient *InViewport )</span></span>;</span><br><span class="line">	<span class="function">ULocalPlayer* <span class="title">GetFirstGamePlayer</span><span class="params">( UPendingNetGame *PendingNetGame )</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 返回第一个本地玩家，只应该用于 debug 目的。</span></span><br><span class="line"><span class="comment">     * 只在应在没有 &quot;UWorld*&quot; 可使用的情况下调用该接口！</span></span><br><span class="line"><span class="comment">     * 在多人游戏中使用该函数将不起作用</span></span><br><span class="line"><span class="comment">     * 我们更愿意使用 GetFirstGamePlayer(), 更好的可以使用 FLocalPlayerIterator</span></span><br><span class="line"><span class="comment">     */</span> </span><br><span class="line">    <span class="function">ULocalPlayer* <span class="title">GetDebugLocalPlayer</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 清空游戏视口 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">CleanupGameViewport</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 允许编辑器根据模式和工具接受或拒绝绘制线框笔刷形状 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">ShouldDrawBrushWireframe</span><span class="params">( class AActor* InActor )</span> </span>&#123; <span class="keyword">return</span> <span class="literal">true</span>; &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 返回用户是否取消了正在进行的地图生成 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">GetMapBuildCancelled</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 设置状态标志，正在进行的地图生成是否被取消 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">SetMapBuildCancelled</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 计算用于给定对象的属性着色的颜色 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">GetPropertyColorationColor</span><span class="params">(class UObject* Object, FColor&amp; OutColor)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 使用 StatColorMapping 俄日某个 Stat值 寻找颜色 */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">GetStatValueColoration</span><span class="params">(<span class="keyword">const</span> FString&amp; StatName, <span class="keyword">float</span> Value, FColor&amp; OutColor)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 是否允许在透视窗口选取半透明物体*/</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">AllowSelectTranslucent</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">        <span class="comment">// 编辑器模式可能会根据用户是否需要禁止半透明物体的选择来重载这个返回值</span></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 是否只有编辑器可见的关卡应该被加载到 PIE 会话中 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">OnlyLoadEditorVisibleLevelsInPIE</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 编辑器可能会根据用户的意愿来重载该返回值</span></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 流关卡是否应该从磁盘中读取关卡而不是从编辑器世界中复制 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">PreferToStreamLevelsInPIE</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 使用 / 禁用 ScreenSaver */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">EnableScreenSaver</span><span class="params">( <span class="keyword">bool</span> bEnable )</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 通过提供的分类信息来获取索引 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> int32 <span class="title">GetSpriteCategoryIndex</span><span class="params">( <span class="keyword">const</span> FName&amp; InSpriteCategory )</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 编辑器可能会根据用户的意愿来重载该返回值</span></span><br><span class="line">		<span class="keyword">return</span> INDEX_NONE;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 在磁盘中查找包的 GUID，包不能再自动下载缓存中。</span></span><br><span class="line"><span class="comment">     * 这可能需要加载相关包头，因此速度较慢</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> FGuid <span class="title">GetPackageGuid</span><span class="params">(FName PackageName, <span class="keyword">bool</span> bForPIE)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">PreGarbageCollect</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 通过 World Tick 来每帧调用进行垃圾收集 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ConditionalCollectGarbage</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 允许WorldSettings请求立即垃圾回收的接口 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">PerformGarbageCollectionAndCleanupActors</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 更新用于GC的计时器，以便在下一个合适的时机进行垃圾回收 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ForceGarbageCollection</span><span class="params">(<span class="keyword">bool</span> bFullPurge = <span class="literal">false</span>)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 请求将GC延迟到下一帧 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DelayGarbageCollection</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// ..... 省略部分关于 GC 的函数(2319行)</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !UE_BUILD_SHIPPING</span></span><br><span class="line">    <span class="comment">/** 捕获屏幕截图和性能指标 */</span></span><br><span class="line">    <span class="function"><span class="keyword">float</span> <span class="title">PerformanceCapture</span><span class="params">(UWorld* World, <span class="keyword">const</span> FString&amp; MapName, <span class="keyword">const</span> FString&amp; MatineeName, <span class="keyword">float</span> EventTime)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 记录性能捕获以用于自动化分析 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">LogPerformanceCapture</span><span class="params">(UWorld* World, <span class="keyword">const</span> FString&amp; MapName, <span class="keyword">const</span> FString&amp; MatineeName, <span class="keyword">float</span> EventTime)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 启动 FPS 图表数据捕获 (如果另一个运行已处于活动状态，则忽略此命令，除非更改活动标签) */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">StartFPSChart</span><span class="params">(<span class="keyword">const</span> FString&amp; Label, <span class="keyword">bool</span> bRecordPerFrameTimes)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 停止 FPS 图表数据捕获 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">StopFPSChart</span><span class="params">(<span class="keyword">const</span> FString&amp; MapName)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 释放内存</span></span><br><span class="line"><span class="comment">     * 尝试通过执行垃圾收集和广播FCoreDelegates:：OnMemoryTrim来回收任何空闲内存</span></span><br><span class="line"><span class="comment">     * 先刷新挂起的渲染命令。这是在级别负载之间调用的，也可以在其他时间调用，</span></span><br><span class="line"><span class="comment">     * 但成本很高，应该节约使用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">TrimMemory</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 计算有关前一帧性能，并将其传递给所有性能数据使用者 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="keyword">void</span> <span class="title">TickPerformanceMonitoring</span><span class="params">(<span class="keyword">float</span> DeltaSeconds)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 向引擎注册一个性能数据使用者，它将在每一帧中传递性能信息 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">AddPerformanceDataConsumer</span><span class="params">(TSharedPtr&lt;IPerformanceDataConsumer&gt; Consumer)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 移除一个性能数据使用者 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">RemovePerformanceDateConsumer</span><span class="params">(TSharedPtr&lt;IPerformanceDataConsumer&gt; Consumer)</span></span>;</span><br><span class="line">        </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/** FPS 图表检测到故障时调用的委托(如果没有性能数据使用者则不触发该委托) */</span></span><br><span class="line">    FEngineHitchDetectedDelegate OnHitchDetectedDelegate;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 正在打开外部 UI 的回调 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnExternalUIChange</span><span class="params">(<span class="keyword">bool</span> bInIsOpening)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 冻结/解冻 渲染的句柄 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ProcessToggleFreezeCommand</span><span class="params">( UWorld* InWorld )</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 冻结/解冻 流的句柄 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ProcessToggleFreezeStreamingCommand</span><span class="params">(UWorld* InWorld)</span> </span>&#123; &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 请求引擎故意执行无效操作。用于测试错误处理和外部崩溃报告程序 */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">PerformError</span><span class="params">(<span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Out = *GLog)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/** 返回 GIsEditor 标记是否已被设置 */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">IsEditor</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// ...... 省略音频设备的获取等函数(2416行)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 返回我们当前是否处于分屏模式(多个本地玩家) */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">IsSplitScreen</span><span class="params">(UWorld* InWorld)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 返回我们当前是否为指定视口启用立体3D，如果启用了却没指定视口，则默认为全局 */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">IsSterescopic3D</span><span class="params">(FViewport* InViewport = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 为纹理流添加一个世界位置作为辅助视图位置。</span></span><br><span class="line"><span class="comment">	 * 持续一帧或指定的秒数(仅适用于覆盖位置)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">AddTextureStreamingSlaveLoc</span><span class="params">(FVector InLoc, <span class="keyword">float</span> BoostFactor, <span class="keyword">bool</span> bOverrideLocation, <span class="keyword">float</span> OverrideDuration)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 从世界上下文中获取世界 */</span></span><br><span class="line">    <span class="function">UWorld* <span class="title">GetWorldFromContextObject</span><span class="params">(<span class="keyword">const</span> UObject* Object, EGetWorldErrorMode ErrorMode)</span> <span class="keyword">const</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 从世界上下文中获取世界 */</span></span><br><span class="line">    <span class="function">UWorld* <span class="title">GetWorldFromContextObjectChecked</span><span class="params">(<span class="keyword">const</span> UObject* Object)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">GetWorldFromContextObject</span>(Object, EGetWorldErrorMode::Assert);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 检查 PIE 是否被设置，GWorld将被改变，将不再是 _the_G_World */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">IsSettingUpPlayWorld</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 通过特定的 ControllerId 检索玩家的 LocalPlayer */</span></span><br><span class="line">	<span class="function">ULocalPlayer* <span class="title">GetLocalPlayerFromControllerId</span><span class="params">( <span class="keyword">const</span> UGameViewportClient* InViewport, <span class="keyword">const</span> int32 ControllerId )</span> <span class="keyword">const</span></span>;</span><br><span class="line">	<span class="function">ULocalPlayer* <span class="title">GetLocalPlayerFromControllerId</span><span class="params">( UWorld * InWorld, <span class="keyword">const</span> int32 ControllerId )</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SwapControllerId</span><span class="params">(ULocalPlayer *NewPlayer, <span class="keyword">const</span> int32 CurrentControllerId, <span class="keyword">const</span> int32 NewControllerID)</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 获取本地玩家控制器，服务器端中则不存在</span></span><br><span class="line"><span class="comment">     * 返回第一个找到的本地玩家控制器。单人游戏没问题，分屏游戏则选其中一个*/</span></span><br><span class="line">    <span class="function">class APlayerController* <span class="title">GetFirstLocalPlayerController</span><span class="params">(<span class="keyword">const</span> UWorld* InWorld)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 获取与引擎关联的所有本地玩家 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetAllLocalPlayerControllers</span><span class="params">(TArray&lt;APlayerController*&gt;&amp; PlayerList)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 返回游戏视口 Widget */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> TSharedPtr&lt;class SViewport&gt; <span class="title">GetGameViewportWidget</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> <span class="literal">nullptr</span>; &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 返回当前显示的 gamma 值 */</span></span><br><span class="line">    <span class="function"><span class="keyword">float</span> <span class="title">GetDisplayGamma</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> DisplayGamma; &#125;</span><br><span class="line">        </span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">FocusNextPIEWorld</span><span class="params">(UWorld *CurrentPieWorld, <span class="keyword">bool</span> previous=<span class="literal">false</span>)</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ResetPIEAudioSetting</span><span class="params">(UWorld *CurrentPieWorld)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> class UGameViewportClient* <span class="title">GetNextPIEViewport</span><span class="params">(UGameViewportClient * CurrentViewport)</span> </span>&#123; <span class="keyword">return</span> <span class="literal">nullptr</span>; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">RemapGamepadControllerIdForPIE</span><span class="params">(class UGameViewportClient* InGameViewport, int32 &amp;ControllerId)</span> </span>&#123; &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 获取服务器站点定位器 (持有已注册的服务器实例) */</span></span><br><span class="line">    <span class="function">TSharedRef&lt;IPortalServiceLocator&gt; <span class="title">GetServiceLocator</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> ServiceLocator.<span class="built_in">ToSharedRef</span>(); &#125;</span><br><span class="line">        </span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** RPC客户端站点 */</span></span><br><span class="line">	TSharedPtr&lt;IMessageRpcClient&gt; PortalRpcClient;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** RPC服务端站点定位器 */</span></span><br><span class="line">	TSharedPtr&lt;IPortalRpcLocator&gt; PortalRpcLocator;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 持有服务器依赖的类型容器 */</span></span><br><span class="line">	TSharedPtr&lt;FTypeContainer&gt; ServiceDependencies;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 持有已注册的服务器实例 */</span></span><br><span class="line">	TSharedPtr&lt;IPortalServiceLocator&gt; ServiceLocator;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 使用中的 FPS 图表 (通过 startfpschart 初始化, stopfpschart 停用) */</span></span><br><span class="line">	TSharedPtr&lt;FPerformanceTrackingChart&gt; ActivePerformanceChart;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> ALLOW_DEBUG_FILES</span></span><br><span class="line">	<span class="comment">/** 使用中的细粒度每帧图表 (通过 startfpschart 初始化, stopfpschart 停用) */</span></span><br><span class="line">	TSharedPtr&lt;FFineGrainedPerformanceTracker&gt; ActiveFrameTimesChart;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 使用中的性能数据消费者 */</span></span><br><span class="line">	TArray&lt;TSharedPtr&lt;IPerformanceDataConsumer&gt;&gt; ActivePerformanceDataConsumers;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ....... 省略获取字体的函数(2563行)</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 将所有可能有用的内容从旧对象复制到另一个类的新对象，用于blueprint(在重新编译后)更新内容 */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">FCopyPropertiesForUnrelatedObjectsParams</span></span></span><br><span class="line"><span class="class">	&#123;</span></span><br><span class="line">		<span class="keyword">bool</span> bAggressiveDefaultSubobjectReplacement;</span><br><span class="line">		<span class="keyword">bool</span> bDoDelta;</span><br><span class="line">		<span class="keyword">bool</span> bReplaceObjectClassReferences;</span><br><span class="line">		<span class="keyword">bool</span> bCopyDeprecatedProperties;</span><br><span class="line">		<span class="keyword">bool</span> bPreserveRootComponent;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/** 跳过使用 BlueprintCompilerGeneratedDefaults 元数据拷贝属性 */</span></span><br><span class="line">		<span class="keyword">bool</span> bSkipCompilerGeneratedDefaults;</span><br><span class="line">		<span class="keyword">bool</span> bNotifyObjectReplacement;</span><br><span class="line">		<span class="keyword">bool</span> bClearReferences;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">FCopyPropertiesForUnrelatedObjectsParams</span>()</span><br><span class="line">			: <span class="built_in">bAggressiveDefaultSubobjectReplacement</span>(<span class="literal">false</span>)</span><br><span class="line">			, <span class="built_in">bDoDelta</span>(<span class="literal">true</span>)</span><br><span class="line">			, <span class="built_in">bReplaceObjectClassReferences</span>(<span class="literal">true</span>)</span><br><span class="line">			, <span class="built_in">bCopyDeprecatedProperties</span>(<span class="literal">false</span>)</span><br><span class="line">			, <span class="built_in">bPreserveRootComponent</span>(<span class="literal">true</span>)</span><br><span class="line">			, <span class="built_in">bSkipCompilerGeneratedDefaults</span>(<span class="literal">false</span>)</span><br><span class="line">			, <span class="built_in">bNotifyObjectReplacement</span>(<span class="literal">false</span>)</span><br><span class="line">			, <span class="built_in">bClearReferences</span>(<span class="literal">true</span>)</span><br><span class="line">		&#123;&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">CopyPropertiesForUnrelatedObjects</span><span class="params">(UObject* OldObject, UObject* NewObject, FCopyPropertiesForUnrelatedObjectsParams Params = FCopyPropertiesForUnrelatedObjectsParams())</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">NotifyToolsOfObjectReplacement</span><span class="params">(<span class="keyword">const</span> TMap&lt;UObject*, UObject*&gt;&amp; OldToNewInstanceMap)</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">UseSound</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 此函数只因在编辑器引擎中被调用</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> UWorld* <span class="title">CreatePIEWorldByDuplication</span><span class="params">(FWorldContext &amp;Context, UWorld* InWorld, FString &amp;PlayWorldMapName)</span> </span>&#123; <span class="built_in">check</span>(<span class="literal">false</span>); <span class="keyword">return</span> <span class="literal">nullptr</span>; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 *	If this function returns true, the DynamicSourceLevels collection will be duplicated for the given map.</span></span><br><span class="line"><span class="comment">	 * 如果此函数返回帧，动态资源关卡收集将拷贝复制给定地图</span></span><br><span class="line"><span class="comment">	 * 当我们没有原始的编辑器世界时，这是必须在编辑器之外执行的，</span></span><br><span class="line"><span class="comment">	 * 并且在动态关卡完全初始化后复制它们是不安全的，所以我们在最初创建原始关卡时预先复制它们。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">Experimental_ShouldPreDuplicateMap</span><span class="params">(<span class="keyword">const</span> FName MapName)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line">        </span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="comment">/** 初始化音频设备管理器 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">InitializeAudioDeviceManager</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 检测并初始化任何连接的HMD设备 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">InitializeHMDDevice</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 检测并初始化任何连接的眼球追踪设备 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">InitializeEyeTrackingDevice</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**	为连接的 HMD 设备记录引擎分析(EngineAnalytics)信息 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">RecordHMDAnalytics</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 从相应的配置条目加载所有引擎对象引用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">InitializeObjectReferences</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 初始化服务器站点 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">InitializePortalServices</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 将 RunningAverageDeltaTime(运行平均增量时间) 初始化为某个较好的帧率 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">InitializeRunningAverageDeltaTime</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">float</span> RunningAverageDeltaTime;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 添加世界时广播 */</span></span><br><span class="line">    FWorldAddedEvent			WorldAddedEvent;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 销毁世界时广播 */</span></span><br><span class="line">	FWorldDestroyedEvent		WorldDestroyedEvent;</span><br><span class="line">        </span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WITH_EDITOR</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在世界Actor列表发生改变时(非LevelActor_Event引起)广播 */</span></span><br><span class="line">	FLevelActorListChangedEvent LevelActorListChangedEvent;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 添加 Actor 时广播 */</span></span><br><span class="line">	FLevelActorAddedEvent LevelActorAddedEvent;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ....... 省略其他关于 Actor 的代理(2691行)</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">/** 防止屏幕保护程序启动的线程。大部分时间暂停。 */</span></span><br><span class="line">	FRunnableThread*		ScreenSaverInhibitor;</span><br><span class="line">	FScreenSaverInhibitor*  ScreenSaverInhibitorRunnable;</span><br><span class="line">        </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/** 已命名的 UNetDriver(网络驱动) 的定义 的数组*/</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(Config, transient)</span><br><span class="line">	TArray&lt;FNetDriverDefinition&gt; NetDriverDefinitions;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Actor 的可配置列表，在服务器启动时自动生成(在 InitGame 之前) */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(config)</span><br><span class="line">	TArray&lt;FString&gt; ServerActors;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 实时更改的服务器 actors 列表，允许插件在不特地添加 actors 到配置文件的情况下，使用服务器 Actors */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TArray&lt;FString&gt; RuntimeServerActors;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 网络错误记录之间的间隔时间(秒) */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(globalconfig)</span><br><span class="line">	<span class="keyword">float</span> NetErrorLogInterval;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 生成所有已注册的服务器 actors */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SpawnServerActors</span><span class="params">(UWorld *World)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 网络错误消息的通知，允许引擎处理错误 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleNetworkFailure</span><span class="params">(UWorld *World, UNetDriver *NetDriver, ENetworkFailure::Type FailureType, <span class="keyword">const</span> FString&amp; ErrorString)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 连接服务器错误消息的通知，通常与网络连接相关（包验证、客户端-服务器握手等） */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleTravelFailure</span><span class="params">(UWorld* InWorld, ETravelFailure::Type FailureType, <span class="keyword">const</span> FString&amp; ErrorString)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 网络延迟状态改变时的通知 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleNetworkLagStateChanged</span><span class="params">(UWorld* World, UNetDriver* NetDriver, ENetworkLagState::Type LagType)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 关闭任何相关的网络驱动程序 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ShutdownWorldNetDriver</span><span class="params">(UWorld*)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ShutdownAllNetDrivers</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 通过名称寻找 UNetDriver */</span></span><br><span class="line">    <span class="function">UNetDriver* <span class="title">FindNamedNetDriver</span><span class="params">(<span class="keyword">const</span> UWorld* InWorld, FName NetDriverName)</span></span>;</span><br><span class="line">	<span class="function">UNetDriver* <span class="title">FindNamedNetDriver</span><span class="params">(<span class="keyword">const</span> UPendingNetGame* InPendingNetGame, FName NetDriverName)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 返回当前网络模式 */</span></span><br><span class="line">    <span class="function">ENetMode <span class="title">GetNetMode</span><span class="params">(<span class="keyword">const</span> UWorld* World)</span> <span class="keyword">const</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 使用引擎指定的名称 创建一个网络驱动 */</span></span><br><span class="line">    <span class="function">UNetDriver* <span class="title">CreateNetDriver</span><span class="params">(UWorld *InWorld, FName NetDriverDefinition)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 创建一个网络驱动，并将其与一个名字关联 */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">CreateNamedNetDriver</span><span class="params">(UWorld *InWorld, FName NetDriverName, FName NetDriverDefinition)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">CreateNamedNetDriver</span><span class="params">(UPendingNetGame *PendingNetGame, FName NetDriverName, FName NetDriverDefinition)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 销毁一个网络驱动 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DestroyNamedNetDriver</span><span class="params">(UWorld *InWorld, FName NetDriverName)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">DestroyNamedNetDriver</span><span class="params">(UPendingNetGame *PendingNetGame, FName NetDriverName)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 为网络重新匹配路径 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">NetworkRemapPath</span><span class="params">(UNetDriver* Driver, FString &amp;Str, <span class="keyword">bool</span> bReading=<span class="literal">true</span>)</span> </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">NetworkRemapPath</span><span class="params">(UNetConnection* Connection, FString&amp; Str, <span class="keyword">bool</span> bReading=<span class="literal">true</span>)</span> </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">NetworkRemapPath</span><span class="params">(UPendingNetGame *PendingNetGame, FString &amp;Str, <span class="keyword">bool</span> bReading=<span class="literal">true</span>)</span> </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HandleOpenCommand</span><span class="params">( <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar, UWorld * InWorld )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HandleTravelCommand</span><span class="params">( <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar, UWorld* InWorld )</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HandleStreamMapCommand</span><span class="params">( <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar, UWorld *InWorld )</span></span>;</span><br><span class="line">        	</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HandleDisconnectCommand</span><span class="params">( <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar, UWorld *InWorld )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HandleReconnectCommand</span><span class="params">( <span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar, UWorld *InWorld )</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 断开世界与网络驱动的连接 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">HandleDisconnect</span><span class="params">( UWorld *InWorld, UNetDriver *NetDriver )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 确保地图名称是长包名</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param InOutMapName 地图名称，如果输入短包名，将自动转换为长包名</span></span><br><span class="line"><span class="comment">	 * @param 如果包名存在，则返回 true</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">MakeSureMapNameIsValid</span><span class="params">(FString&amp; InOutMapName)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetClientTravel</span><span class="params">( UWorld *InWorld, <span class="keyword">const</span> TCHAR* NextURL, ETravelType InTravelType )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetClientTravel</span><span class="params">( UPendingNetGame *PendingNetGame, <span class="keyword">const</span> TCHAR* NextURL, ETravelType InTravelType )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetClientTravelFromPendingGameNetDriver</span><span class="params">( UNetDriver *PendingGameNetDriverGame, <span class="keyword">const</span> TCHAR* NextURL, ETravelType InTravelType )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 浏览与当前的URL相对应的URL */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> EBrowseReturnVal::Type <span class="title">Browse</span><span class="params">( FWorldContext&amp; WorldContext, FURL URL, FString&amp; Error )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">TickWorldTravel</span><span class="params">(FWorldContext&amp; WorldContext, <span class="keyword">float</span> DeltaSeconds)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">BrowseToDefaultMap</span><span class="params">( FWorldContext&amp; WorldContext )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">LoadMap</span><span class="params">( FWorldContext&amp; WorldContext, FURL URL, class UPendingNetGame* Pending, FString&amp; Error )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">RedrawViewports</span><span class="params">( <span class="keyword">bool</span> bShouldPresent = <span class="literal">true</span> )</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">TriggerStreamingDataRebuild</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 使用游戏中的玩家视图和块更新关卡流状态，直到所有子关卡都加载/可见/隐藏，</span></span><br><span class="line"><span class="comment">	 * 因此除非状态更改，否则对 UpdateLevelStreaming 的进一步调用不会起任何作用。 </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">BlockTillLevelStreamingCompleted</span><span class="params">(UWorld* InWorld)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 是否在 LoadMap() 期间播放读取影像 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(transient)</span><br><span class="line">	uint32 bStartedLoadMapMovie:<span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 从根集中移除 PerMapPackages(每个地图的包) */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CleanupPackagesToFullyLoad</span><span class="params">(FWorldContext &amp;Context, EFullyLoadPackageType FullyLoadType, <span class="keyword">const</span> FString&amp; Tag)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 调用以允许子引擎重载 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">LoadMapRedrawViewports</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">RedrawViewports</span>(<span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ClearDebugDisplayProperties</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 从给定的地图中读取 PerMapPackages，并添加他们到根集中 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">LoadPackagesFully</span><span class="params">(UWorld* InWorld, EFullyLoadPackageType FullyLoadType, <span class="keyword">const</span> FString&amp; Tag)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">UpdateTransitionType</span><span class="params">(UWorld *CurrentWorld)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">UPendingNetGame* <span class="title">PendingNetGameFromWorld</span><span class="params">( UWorld* InWorld )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 取消挂起关卡 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">CancelAllPending</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">CancelPending</span><span class="params">(UWorld *InWorld, UPendingNetGame *NewPendingNetGame=<span class="literal">nullptr</span> )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">WorldIsPIEInNewViewport</span><span class="params">(UWorld *InWorld)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="function">FWorldContext* <span class="title">GetWorldContextFromWorld</span><span class="params">(<span class="keyword">const</span> UWorld* InWorld)</span></span>;</span><br><span class="line">    <span class="comment">// ...... 省略各种获取 WorldContext 的方法。(2964行)</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 尝试寻找当前运行的主游戏世界或PIE世界，如果不明确则返回nullptr</span></span><br><span class="line"><span class="comment">     * 只应在你没有可靠的世界上下文可用的时候，调用该函数。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">UWorld* <span class="title">GetCurrentPlayWorld</span><span class="params">(UWorld* PossiblePlayWorld = <span class="literal">nullptr</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 在调用 ::LoadMap 销毁一个世界时，调用该函数来验证所有其他世界是否仍有效 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">VerifyLoadMapWorldCleanup</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="function">FWorldContext&amp; <span class="title">CreateNewWorldContext</span><span class="params">(EWorldType::Type WorldType)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">DestroyWorldContext</span><span class="params">(UWorld * InWorld)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WITH_EDITOR</span></span><br><span class="line">	<span class="comment">/** 当一个世界上下文被销毁时触发该代理 */</span></span><br><span class="line">	<span class="built_in">DECLARE_EVENT_OneParam</span>(UEngine, FWorldContextDestroyedEvent, FWorldContext&amp;);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回世界上下文销毁事件 */</span></span><br><span class="line">	<span class="function">FWorldContextDestroyedEvent&amp;	<span class="title">OnWorldContextDestroyed</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> WorldContextDestroyedEvent; &#125;</span><br><span class="line">        </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">/** 世界上下文销毁广播事件 */</span></span><br><span class="line">	FWorldContextDestroyedEvent WorldContextDestroyedEvent;</span><br><span class="line">        </span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// #if WITH_EDITOR</span></span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 从特定对象的 GetFunctionCallspace 函数中调用，</span></span><br><span class="line"><span class="comment">     * 以检查 权限/外观 函数标记(通过全局状态) </span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param Function 需要检测网络模式标签(如:AuthorityOnly，不能为null)的函数</span></span><br><span class="line"><span class="comment">     * @param FunctionTarget 调用该函数的对象</span></span><br><span class="line"><span class="comment">     * @param Stack 运行该函数时使用的函数调用栈</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">int32 <span class="title">GetGlobalFunctionCallspace</span><span class="params">(UFunction* Function, UObject* FunctionTarget, FFrame* Stack)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 全局上下文是 client-only 和 authority only 的事件应被忽略。</span></span><br><span class="line"><span class="comment">     * 如果不明确则返回 false，如果有一个可能的世界，则使用 GetCurrentPlayWorld</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ShouldAbsorbAuthorityOnlyEvent</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 全局上下文是 dedicated server and cosmetic only 的事件应被忽略。</span></span><br><span class="line"><span class="comment">     * 如果不明确则返回 false，如果有一个可能的世界，则使用 GetCurrentPlayWorld</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ShouldAbsorbCosmeticOnlyEvent</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 引擎是否自动保存包 */</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">ShouldDoAsyncEndOfFrameTasks</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsVanillaProduct</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> bIsVanillaProduct; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetIsVanillaProduct</span><span class="params">(<span class="keyword">bool</span> bInIsVanillaProduct)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">bool</span> bIsVanillaProduct;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 世界上下文列表，可以同时存有多个世界，但实际只能运行一个世界</span></span><br><span class="line">	TIndirectArray&lt;FWorldContext&gt;	WorldList;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	int32	NextWorldContextHandle;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 取消挂起的世界上下文 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">CancelPending</span><span class="params">(FWorldContext&amp; WorldContext)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 取消挂起的网络驱动 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">CancelPending</span><span class="params">(UNetDriver* PendingNetGameDriver)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">MovePendingLevel</span><span class="params">(FWorldContext &amp;Context)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 浏览 URL 是否需要关闭当前的网络驱动 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">ShouldShutdownWorldNetDriver</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="literal">true</span>; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">WorldHasValidContext</span><span class="params">(UWorld *InWorld)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 尝试优雅地处理无法连接到默认地图的错误</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param Error 调用 LoadMap 尝试读取默认地图时返回的错误字符串(如果有)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleBrowseToDefaultMapFailure</span><span class="params">(FWorldContext&amp; Context, <span class="keyword">const</span> FString&amp; TextURL, <span class="keyword">const</span> FString&amp; Error)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 辅助函数。如果 InWorld 是 DynamicDuplicatedLevels(动态复制关卡)中的一个关卡的 outer，则返回真。</span></span><br><span class="line"><span class="comment">	 * 引擎内部使用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsWorldDuplicate</span><span class="params">(<span class="keyword">const</span> UWorld* <span class="keyword">const</span> InWorld)</span></span>;</span><br><span class="line">        </span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">// 异步地图改变 / 主关卡转换代码</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 完成由 PrepareMapChange 启动的挂起的地图更改 */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">CommitMapChange</span><span class="params">( FWorldContext &amp;Context)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回是否已准备好调用 CommitMapChange */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsReadyForMapChange</span><span class="params">(FWorldContext &amp;Context)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回我们当前是否正在准备地图更改 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsPreparingMapChange</span><span class="params">(FWorldContext &amp;Context)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 通过在后台预加载关卡包，使引擎为地图更改做好准备。 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">PrepareMapChange</span><span class="params">(FWorldContext &amp;WorldContext, <span class="keyword">const</span> TArray&lt;FName&gt;&amp; LevelNames)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** *返回地图更改请求失败时的失败描述 */</span></span><br><span class="line">	<span class="function">FString <span class="title">GetMapChangeFailureDescription</span><span class="params">(FWorldContext &amp;Context)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 每帧调用。如果请求，提交映射更改，且映射更改处于挂起状态 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ConditionalCommitMapChange</span><span class="params">(FWorldContext &amp;WorldContext)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 取消挂起的地图更改	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">CancelPendingMapChange</span><span class="params">(FWorldContext &amp;Context)</span></span>;</span><br><span class="line">       </span><br><span class="line">        </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">// 为异步地图更改函数 定义 public 接口</span></span><br><span class="line">        </span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">CommitMapChange</span><span class="params">(UWorld* InWorld)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">CommitMapChange</span>(<span class="built_in">GetWorldContextFromWorldChecked</span>(InWorld)); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsReadyForMapChange</span><span class="params">(UWorld* InWorld)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">IsReadyForMapChange</span>(<span class="built_in">GetWorldContextFromWorldChecked</span>(InWorld)); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsPreparingMapChange</span><span class="params">(UWorld* InWorld)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">IsPreparingMapChange</span>(<span class="built_in">GetWorldContextFromWorldChecked</span>(InWorld)); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">PrepareMapChange</span><span class="params">(UWorld* InWorld, <span class="keyword">const</span> TArray&lt;FName&gt;&amp; LevelNames)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">PrepareMapChange</span>(<span class="built_in">GetWorldContextFromWorldChecked</span>(InWorld), LevelNames); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ConditionalCommitMapChange</span><span class="params">(UWorld* InWorld)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">ConditionalCommitMapChange</span>(<span class="built_in">GetWorldContextFromWorldChecked</span>(InWorld)); &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">FString <span class="title">GetMapChangeFailureDescription</span><span class="params">(UWorld *InWorld)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">GetMapChangeFailureDescription</span>(<span class="built_in">GetWorldContextFromWorldChecked</span>(InWorld)); &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 取消挂起地图更改	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">CancelPendingMapChange</span><span class="params">(UWorld *InWorld)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">CancelPendingMapChange</span>(<span class="built_in">GetWorldContextFromWorldChecked</span>(InWorld)); &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddNewPendingStreamingLevel</span><span class="params">(UWorld *InWorld, FName PackageName, <span class="keyword">bool</span> bNewShouldBeLoaded, <span class="keyword">bool</span> bNewShouldBeVisible, int32 LODIndex)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ShouldCommitPendingMapChange</span><span class="params">(<span class="keyword">const</span> UWorld *InWorld)</span> <span class="keyword">const</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetShouldCommitPendingMapChange</span><span class="params">(UWorld *InWorld, <span class="keyword">bool</span> NewShouldCommitPendingMapChange)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">FSeamlessTravelHandler&amp;	<span class="title">SeamlessTravelHandlerForWorld</span><span class="params">(UWorld *World)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">FURL &amp; <span class="title">LastURLFromWorld</span><span class="params">(UWorld *World)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回游戏用户设置类(UGameUserSettings)的全局实例 */</span></span><br><span class="line">	<span class="function"><span class="keyword">const</span> UGameUserSettings* <span class="title">GetGameUserSettings</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">	<span class="function">UGameUserSettings* <span class="title">GetGameUserSettings</span><span class="params">()</span></span>;</span><br><span class="line">        </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CreateGameUserSettings</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WITH_EDITOR</span></span><br><span class="line">	<span class="comment">//~ Begin Transaction Interfaces.</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> int32 <span class="title">BeginTransaction</span><span class="params">(<span class="keyword">const</span> TCHAR* TransactionContext, <span class="keyword">const</span> FText&amp; Description, UObject* PrimaryObject)</span> </span>&#123; <span class="keyword">return</span> INDEX_NONE; &#125;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> int32 <span class="title">EndTransaction</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> INDEX_NONE; &#125;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">CancelTransaction</span><span class="params">(int32 Index)</span> </span>&#123; &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">/** 获取特定类型的引擎子系统 */</span></span><br><span class="line">	<span class="function">UEngineSubsystem* <span class="title">GetEngineSubsystemBase</span><span class="params">(TSubclassOf&lt;UEngineSubsystem&gt; SubsystemClass)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">checkSlow</span>(<span class="keyword">this</span> != <span class="literal">nullptr</span>);</span><br><span class="line">		<span class="keyword">return</span> EngineSubsystemCollection.GetSubsystem&lt;UEngineSubsystem&gt;(SubsystemClass);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 获取特定类型的引擎子系统 */</span></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TSubsystemClass&gt;</span><br><span class="line">	<span class="function">TSubsystemClass* <span class="title">GetEngineSubsystem</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">checkSlow</span>(<span class="keyword">this</span> != <span class="literal">nullptr</span>);</span><br><span class="line">		<span class="keyword">return</span> EngineSubsystemCollection.GetSubsystem&lt;TSubsystemClass&gt;(TSubsystemClass::<span class="built_in">StaticClass</span>());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 获取指定类型的所有引擎子系统，这仅对于一次可以实例化多个实现的接口是必需的 */</span></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TSubsystemClass&gt;</span><br><span class="line">	<span class="function"><span class="keyword">const</span> TArray&lt;TSubsystemClass*&gt;&amp; <span class="title">GetEngineSubsystemArray</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> EngineSubsystemCollection.GetSubsystemArray&lt;TSubsystemClass&gt;(TSubsystemClass::<span class="built_in">StaticClass</span>());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 引擎子系统收集器</span></span><br><span class="line">	FSubsystemCollection&lt;UEngineSubsystem&gt; EngineSubsystemCollection;</span><br><span class="line">       </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/** 新 stat(用于监测游戏运行时的各项数据) 被注册是激活的代理 */</span></span><br><span class="line">	<span class="built_in">DECLARE_EVENT_ThreeParams</span>(UEngine, FOnNewStatRegistered, <span class="keyword">const</span> FName&amp;, <span class="keyword">const</span> FName&amp;, <span class="keyword">const</span> FText&amp;);</span><br><span class="line">	<span class="keyword">static</span> FOnNewStatRegistered NewStatDelegate;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** 用于启动简单 stat exec 的包装器 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ExecEngineStat</span><span class="params">(UWorld* World, FCommonViewportClient* ViewportClient, <span class="keyword">const</span> TCHAR* InName)</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// ..... 省略 EngineStat 的相关代码 (3261行)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>&quot;UEngine&quot; 中声明的变量和函数比较多，但其实我们实际开发中能用到的其实并不多。但为了更全面地了解 &quot;UEngine&quot;，这个 &quot;Gameplay&quot; 的 &quot;女娲&quot;。我认为有必要把 Engine.h 的源码看一遍，弄清楚里面都实现了什么函数，这些函数又用于哪写地方。这样也方便我们更好地使用 &quot;GEngine&quot; 这个神一样的全局变量。以下是 &quot;UEngine&quot; 中各部分函数的总结。</p><ul><li>选中对象的颜色相关 (材质颜色，轮廓颜色等) (不常用)</li><li>动态分辨率相关 (不常用)</li><li><strong>Debug 消息相关 (开发常用)</strong></li><li>UObject 接口 (不常用)</li><li>命令行相关 (不常用)</li><li>设置游戏 / 渲染延迟 (不常用)</li><li>时间步长相关 (不常用)</li><li>Tick 率，FPS 相关 (不常用)</li><li>Timecode 相关 (不常用)</li><li>引擎显示信息 (如: FrameTime) 相关 (不常用)</li><li><strong>LocalPlayers 相关 (常用)</strong></li><li>GameViewport 相关 (不常用)</li><li><strong>GC 相关 (常用)</strong></li><li>性能数据检测相关 (不常用)</li><li>音频设备，HMD 设备相关 (不常用)</li><li><strong>PlayerController 相关 (需要了解)</strong></li><li>PIE 相关 (不常用)</li><li><strong>网络相关 (需要了解)</strong></li><li><strong>服务端 客户端 RPC 相关 (需要了解)</strong></li><li><strong>地图相关 (需要了解)</strong></li><li><strong>世界上下文相关 (需要了解)</strong></li><li>游戏用户设置相关 (不常用)</li><li><strong>引擎子系统相关 (需要了解)</strong></li><li>Stat 相关 (不常用)</li><li>其他函数</li></ul><p>以上是 &quot;GEngine&quot; 为我们提供的函数总结，比较杂，而且肯定不止这些，因为这只是 &quot;UEngine&quot; 的，还有子类 &quot;UGameEngine&quot; 或 &quot;UEditorEngine&quot; 的。我们这里就先略过了（篇幅过长）</p><h3 id="ugameinstance"><a class="anchor" href="#ugameinstance">#</a> UGameInstance</h3><p>&quot;UGameInstance&quot; 比 &quot;UEngine&quot; 好理解不少。以下是 &quot;UGameInstance&quot; 的源码分析</p><p></p><figure class="highlight c++"><figcaption><span>UGameInstance</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameInstance.h</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">UCLASS</span>(config=Game, transient, BlueprintType, Blueprintable)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ENGINE_API</span> <span class="title">UGameInstance</span> :</span> <span class="keyword">public</span> UObject, <span class="keyword">public</span> FExec</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_UCLASS_BODY</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">// 当前运行的世界上下文</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">FWorldContext</span>* <span class="title">WorldContext</span>;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理开启，断开连接，重新连接，服务器连接的命令</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HandleOpenCommand</span><span class="params">(<span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar, UWorld* InWorld)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HandleDisconnectCommand</span><span class="params">(<span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar, UWorld* InWorld)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HandleReconnectCommand</span><span class="params">(<span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar, UWorld* InWorld)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HandleTravelCommand</span><span class="params">(<span class="keyword">const</span> TCHAR* Cmd, FOutputDevice&amp; Ar, UWorld* InWorld)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 处理额外的控制台命令的代理 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnConsoleInput</span><span class="params">(<span class="keyword">const</span> FString&amp; Command)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 此游戏实例的本地参与玩家列表 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TArray&lt;ULocalPlayer*&gt; LocalPlayers;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 管理在线服务的类 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UOnlineSession</span>* <span class="title">OnlineSession</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 仍存在于此游戏实例的对象列表，存在数组里是为了更快的遍历，不应每帧修改 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TArray&lt;UObject*&gt; ReferencedObjects;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** PreClientTravel(客户端预连接)函数调用的监听代理 */</span></span><br><span class="line">	FOnPreClientTravel NotifyPreClientTravelDelegates;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 在 pawn 的控制器被设置时调用，大多数情况下它会发出控制器已更改的信号。</span></span><br><span class="line"><span class="comment">     * 但在边缘情况下(复制期间)，可能会多次广播相同的一对 pawn-controller</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintAssignable, DisplayName=OnPawnControllerChanged)</span><br><span class="line">	FOnPawnControllerChanged OnPawnControllerChangedDelegates;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// UObject 的接口函数</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> class UWorld* <span class="title">GetWorld</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">final</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">FinishDestroy</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 虚函数以允许自定义的 GameInstances 设置所需内容 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 提供给蓝图 添加游戏实例初始化时要执行的逻辑 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintImplementableEvent, meta=(DisplayName = <span class="string">&quot;Init&quot;</span>))</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ReceiveInit</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 虚函数以允许自定义的 GameInstances 在关闭时执行自定义的清除 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Shutdown</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 提供给蓝图 添加游戏实例关闭时要执行的逻辑 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintImplementableEvent, meta=(DisplayName = <span class="string">&quot;Shutdown&quot;</span>))</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ReceiveShutdown</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 提供给蓝图 添加处理网络错误的逻辑 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintImplementableEvent, meta=(DisplayName = <span class="string">&quot;NetworkError&quot;</span>))</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">HandleNetworkError</span><span class="params">(ENetworkFailure::Type FailureType, <span class="keyword">bool</span> bIsServer)</span></span>;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/** 提供给蓝图 添加服务器连接错误时执行的逻辑 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintImplementableEvent, meta=(DisplayName = <span class="string">&quot;TravelError&quot;</span>))</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">HandleTravelError</span><span class="params">(ETravelFailure::Type FailureType)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 为 standalong 游戏初始化 GameInstance */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">InitializeStandalone</span><span class="params">(<span class="keyword">const</span> FName InWorldName = NAME_None, UPackage* InWorldPackage = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 使用 适用于基本网络RPC的最小世界 来初始化GameInstace */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">InitializeForMinimalNetRPC</span><span class="params">(<span class="keyword">const</span> FName InPackageName)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 被 &quot;InitializeForMinimalNetRPC&quot; 和 &quot;LoadMap&quot;，以创建一个适用于基本网络RPC的最小世界 */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">CreateMinimalNetRPCWorld</span><span class="params">(<span class="keyword">const</span> FName InPackageName, UPackage*&amp; OutWorldPackage, UWorld*&amp; OutWorld)</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WITH_EDITOR</span></span><br><span class="line">	<span class="comment">/* 为游戏的PIE实例初始化 GameInstance */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> FGameInstancePIEResult <span class="title">InitializeForPlayInEditor</span><span class="params">(int32 PIEInstanceIndex, <span class="keyword">const</span> FGameInstancePIEParameters&amp; Params)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 在 Play/Simulate InEditor 时调用，以开始游戏*/</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> FGameInstancePIEResult <span class="title">StartPlayInEditorGameInstance</span><span class="params">(ULocalPlayer* LocalPlayer, <span class="keyword">const</span> FGameInstancePIEParameters&amp; Params)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在 GameMode 生成时调用，以在本地玩家创建之前允许额外的PIE设置验证(也在纯客户端中调用) */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> FGameInstancePIEResult <span class="title">PostCreateGameModeForPIE</span><span class="params">(<span class="keyword">const</span> FGameInstancePIEParameters&amp; Params, AGameModeBase* GameMode)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.15</span>, <span class="string">&quot;Please override InitializeForPIE instead&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">InitializePIE</span><span class="params">(<span class="keyword">bool</span> bAnyBlueprintErrors, int32 PIEInstance, <span class="keyword">bool</span> bRunAsDedicated)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.15</span>, <span class="string">&quot;Please override StartPlayInEditorGameInstance instead&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">StartPIEGameInstance</span><span class="params">(ULocalPlayer* LocalPlayer, <span class="keyword">bool</span> bInSimulateInEditor, <span class="keyword">bool</span> bAnyBlueprintErrors, <span class="keyword">bool</span> bStartInSpectatorMode)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    </span><br><span class="line">    <span class="function">class UEngine* <span class="title">GetEngine</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">struct FWorldContext* <span class="title">GetWorldContext</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> WorldContext; &#125;;</span><br><span class="line">	<span class="function">class UGameViewportClient* <span class="title">GetGameViewportClient</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在世界改变时，从世界上下文中回调 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnWorldChanged</span><span class="params">(UWorld* OldWorld, UWorld* NewWorld)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 启动正在运行的 GameInstance 状态机 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">StartGameInstance</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">JoinSession</span><span class="params">(ULocalPlayer* LocalPlayer, int32 SessionIndexInSearchResults)</span> </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">JoinSession</span><span class="params">(ULocalPlayer* LocalPlayer, <span class="keyword">const</span> FOnlineSessionSearchResult&amp; SearchResult)</span> </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">LoadComplete</span><span class="params">(<span class="keyword">const</span> <span class="keyword">float</span> LoadTime, <span class="keyword">const</span> FString&amp; MapName)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 本地玩家访问 */</span></span><br><span class="line"></span><br><span class="line">	FOnLocalPlayerEvent OnLocalPlayerAddedEvent;</span><br><span class="line">	FOnLocalPlayerEvent OnLocalPlayerRemovedEvent;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** debug 控制台命令，以创建一个player */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(exec)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">DebugCreatePlayer</span><span class="params">(int32 ControllerId)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** debug 控制台命令，以移除一个player */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(exec)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">DebugRemovePlayer</span><span class="params">(int32 ControllerId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ULocalPlayer* <span class="title">CreateInitialPlayer</span><span class="params">(FString&amp; OutError)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 添加一个新player */</span></span><br><span class="line">    <span class="function">ULocalPlayer* <span class="title">CreateLocalPlayer</span><span class="params">(int32 COntrollerId, FString&amp; OutError, <span class="keyword">bool</span> bSpawnPlayerController)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 添加一个本地玩家到本地和全局的玩家列表 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> int32 <span class="title">AddLocalPlayer</span><span class="params">(ULocalPlayer* NewPlayer, int32 ControllerId)</span></span>;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/** 移除一个玩家 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">RemoveLocalPlayer</span><span class="params">(ULocalPlayer * ExistingPlayer)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">int32					<span class="title">GetNumLocalPlayers</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">	<span class="function">ULocalPlayer*			<span class="title">GetLocalPlayerByIndex</span><span class="params">(<span class="keyword">const</span> int32 Index)</span> <span class="keyword">const</span></span>;</span><br><span class="line">	<span class="function">APlayerController*		<span class="title">GetFirstLocalPlayerController</span><span class="params">(<span class="keyword">const</span> UWorld* World = <span class="literal">nullptr</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line">	<span class="function">ULocalPlayer*			<span class="title">FindLocalPlayerFromControllerId</span><span class="params">(<span class="keyword">const</span> int32 ControllerId)</span> <span class="keyword">const</span></span>;</span><br><span class="line">	<span class="function">ULocalPlayer*			<span class="title">FindLocalPlayerFromUniqueNetId</span><span class="params">(TSharedPtr&lt;<span class="keyword">const</span> FUniqueNetId&gt; UniqueNetId)</span> <span class="keyword">const</span></span>;</span><br><span class="line">	<span class="function">ULocalPlayer*			<span class="title">FindLocalPlayerFromUniqueNetId</span><span class="params">(<span class="keyword">const</span> FUniqueNetId&amp; UniqueNetId)</span> <span class="keyword">const</span></span>;</span><br><span class="line">	<span class="function">ULocalPlayer*			<span class="title">GetFirstGamePlayer</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	TArray&lt;ULocalPlayer*&gt;::<span class="function">TConstIterator	<span class="title">GetLocalPlayerIterator</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">const</span> TArray&lt;ULocalPlayer*&gt; &amp;			<span class="title">GetLocalPlayers</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 从该机器中获取主要玩家控制器 (其他为分屏子机) (必须存在有效的player state) */</span></span><br><span class="line">	<span class="function">APlayerController* <span class="title">GetPrimaryPlayerController</span><span class="params">(<span class="keyword">bool</span> bRequiresValidUniqueId = <span class="literal">true</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 从该机器中获取主要玩家的唯一id (其他为分屏子机) */</span></span><br><span class="line">    <span class="function">TSharedPtr&lt;<span class="keyword">const</span> FUniqueNetId&gt; <span class="title">GetPrimaryPlayerUniqueId</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CleanupGameViewport</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 演示录像播放失败时调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleDemoPlaybackFailure</span><span class="params">( EDemoPlayFailure::Type FailureType, <span class="keyword">const</span> FString&amp; ErrorString = TEXT(<span class="string">&quot;&quot;</span>) )</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当玩家在重播时将 scrubs 切换到不同的关卡时调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnSeamlessTravelDuringReplay</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> FTimerManager&amp; <span class="title">GetTimerManager</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> *TimerManager; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> FLatentActionManager&amp; <span class="title">GetLatentActionManager</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> *LatentActionManager;  &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 获取特定类型的子系统 */</span></span><br><span class="line">	<span class="function">UGameInstanceSubsystem* <span class="title">GetSubsystemBase</span><span class="params">(TSubclassOf&lt;UGameInstanceSubsystem&gt; SubsystemClass)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> SubsystemCollection.GetSubsystem&lt;UGameInstanceSubsystem&gt;(SubsystemClass);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 获取特定类型的子系统 */</span></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TSubsystemClass&gt;</span><br><span class="line">	<span class="function">TSubsystemClass* <span class="title">GetSubsystem</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> SubsystemCollection.GetSubsystem&lt;TSubsystemClass&gt;(TSubsystemClass::<span class="built_in">StaticClass</span>());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 从提供的游戏实例中获取特定类型的子系统 */</span></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TSubsystemClass&gt;</span><br><span class="line">	<span class="function"><span class="keyword">static</span> FORCEINLINE TSubsystemClass* <span class="title">GetSubsystem</span><span class="params">(<span class="keyword">const</span> UGameInstance* GameInstance)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (GameInstance)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> GameInstance-&gt;GetSubsystem&lt;TSubsystemClass&gt;();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 获取特定类型的所有子系统，这仅适用于一次可以实例化多个实现的接口。*/</span></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TSubsystemClass&gt;</span><br><span class="line">	<span class="function"><span class="keyword">const</span> TArray&lt;TSubsystemClass*&gt;&amp; <span class="title">GetSubsystemArray</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> SubsystemCollection.GetSubsystemArray&lt;TSubsystemClass&gt;(TSubsystemClass::<span class="built_in">StaticClass</span>());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 用给定的自定义的名称和友好名称来录制重播 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">StartRecordingReplay</span><span class="params">(<span class="keyword">const</span> FString&amp; InName, <span class="keyword">const</span> FString&amp; FriendlyName, <span class="keyword">const</span> TArray&lt;FString&gt;&amp; AdditionalOptions = TArray&lt;FString&gt;(), TSharedPtr&lt;IAnalyticsProvider&gt; AnalyticsProvider = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 停止录制重播(如果当前正在录制) */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">StopRecordingReplay</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 播放重播 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">PlayReplay</span><span class="params">(<span class="keyword">const</span> FString&amp; InName, UWorld* WorldOverride = <span class="literal">nullptr</span>, <span class="keyword">const</span> TArray&lt;FString&gt;&amp; AdditionalOptions = TArray&lt;FString&gt;())</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 播放列表的所有重播 */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">PlayReplayPlaylist</span><span class="params">(<span class="keyword">const</span> struct FReplayPlaylistParams&amp; PlaylistParams)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 添加一个用户到与当前录制重播(如果有)关联的用户集中 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">AddUserToReplay</span><span class="params">(<span class="keyword">const</span> FString&amp; UserString)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理游戏特定的网络控制信息</span></span><br><span class="line"><span class="comment">     * 这允许游戏加入他们自己的逻辑到控制管道(网络通信管道的其中一种)中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleGameNetControlMessage</span><span class="params">(class UNetConnection* Connection, uint8 MessageByte, <span class="keyword">const</span> FString&amp; MessageStr)</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 处理设置加密密钥。覆盖此选项的游戏必须在自己的（可能是异步）处理完成时调用代理 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ReceivedNetworkEncryptionToken</span><span class="params">(<span class="keyword">const</span> FString&amp; EncryptionToken, <span class="keyword">const</span> FOnEncryptionKeyResponse&amp; Delegate)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当客户端从服务端接收到密钥控制信息时调用，通常会启用密钥 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ReceivedNetworkEncryptionAck</span><span class="params">(<span class="keyword">const</span> FOnEncryptionKeyResponse&amp; Delegate)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在读取地图URL之前调用以预加载所有内容，在流关卡和地图切换的时候使用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PreloadContentForURL</span><span class="params">(FURL InURL)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 为给定的地图URL生成GameMode */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> class AGameModeBase* <span class="title">CreateGameModeForURL</span><span class="params">(FURL InURL, UWorld* InWorld)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 返回用于给定地图，选择，站点的 GameMode 的子类 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> TSubclassOf&lt;AGameModeBase&gt; <span class="title">OverrideGameModeClass</span><span class="params">(TSubclassOf&lt;AGameModeBase&gt; GameModeClass, <span class="keyword">const</span> FString&amp; MapName, <span class="keyword">const</span> FString&amp; Options, <span class="keyword">const</span> FString&amp; Portal)</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 是否延迟挂起网络游戏连接，以执行 LoadMap() 和等待内容加载 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">DelayPendingNetGameTravel</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line"></span><br><span class="line">    FTimerManager* TimerManager;</span><br><span class="line">	FLatentActionManager* LatentActionManager;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回与GameInstance关联的在线会话控制物体 */</span></span><br><span class="line">	<span class="function">class UOnlineSession* <span class="title">GetOnlineSession</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> OnlineSession; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回该GameInstance使用的在线会话的类  */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> TSubclassOf&lt;UOnlineSession&gt; <span class="title">GetOnlineSessionClass</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 该实例是否用于独立服务器世界 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsDedicatedServerInstance</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 检索此实例使用的平台的在线子系统的名称</span></span><br><span class="line"><span class="comment">     * 这将被用于初始化 NMT_Login 中的 PlayerOnlinePlatformName (在此客户端连接到服务器时)</span></span><br><span class="line"><span class="comment">     * 通常这和 DefaultPlatformService 配置值一样，但游戏可能会按需重载它(例如: 同时使用多个在线子系统)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> FName <span class="title">GetOnlinePlatformName</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 用于连接(已通过在线平台加入的)会话的辅助函数，从会话信息中获取URL并发送 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">ClientTravelToSession</span><span class="params">(int32 ControllerId, FName InSessionName)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 广播一个(发起连接的)通知 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">NotifyPreClientTravel</span><span class="params">(<span class="keyword">const</span> FString&amp; PendingURL, ETravelType TravelType, <span class="keyword">bool</span> bIsSeamlessTravel)</span></span>;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/** 返回 当客户端连接发起时激活的代理 */</span></span><br><span class="line">	<span class="function">FOnPreClientTravel&amp; <span class="title">OnNotifyPreClientTravel</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> NotifyPreClientTravelDelegates; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回 在pawn的控制器被设定后广播的代理 */</span></span><br><span class="line">	<span class="function">FOnPawnControllerChanged&amp; <span class="title">GetOnPawnControllerChanged</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> OnPawnControllerChangedDelegates; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 在联机会话（如果存在）或引擎上调用 HandleDisconnect 时，返回默认地图。实例必须有一个世界 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ReturnToMainMenu</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 注册生命周期和该GameInstance一样的对象 */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">RegisterReferencedObject</span><span class="params">(UObject* ObjectToReference)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 移除一个引用对象，这将允许它退出GC */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">UnregisterReferencedObject</span><span class="params">(UObject* ObjectToReference)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="comment">/** 在游戏实例开始时调用(无论是普通游戏还是PIE) */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">// 子系统收集器</span></span><br><span class="line">	FSubsystemCollection&lt;UGameInstanceSubsystem&gt; SubsystemCollection;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>GameInstance 的函数主要用于<strong>处理网络连接 (包括在线子系统)<strong> 和</strong>处理本地玩家相关</strong>的逻辑，其他还有<strong>游戏视口的处理</strong>，<strong>定时器管理器的获取</strong>，<strong>子系统相关</strong>，<strong>网络重播相关</strong>等逻辑，理解起来还算简单。</p><hr><p>下一篇：Gameplay —— FWorldContext &amp; UWorld &amp; ULevel</p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-01-02 15:37:26" itemprop="dateModified" datetime="2022-01-02T15:37:26+08:00">2022-01-02</time> </span><span id="2021/12/01/UE4/UE4CPP/Gameplay —— 总览 & UEngine & UGameInstance/" class="item leancloud_visitors" data-flag-title="Gameplay —— 总览 & UEngine & UGameInstance" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>-YIFEI- <i class="ic i-at"><em>@</em></i>一个年轻人奔向梦想的足迹</li><li class="link"><strong>本文链接：</strong> <a href="https://kotori_suki.github.io/2021/12/01/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20%E6%80%BB%E8%A7%88%20&%20UEngine%20&%20UGameInstance/" title="Gameplay —— 总览 &amp; UEngine &amp; UGameInstance">https://kotori_suki.github.io/2021/12/01/UE4/UE4CPP/Gameplay —— 总览 & UEngine & UGameInstance/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/11/26/UE4/UE4CPP/Unreal%20Slate/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclwuom7cj20zk0m8dvn.jpg" title="Unreal Slate"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> UE4_C++</span><h3>Unreal Slate</h3></a></div><div class="item right"><a href="/2021/12/03/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20FWorldContext%20&%20UWorld%20&%20ULevel/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclgi503lj20zk0m8hdt.jpg" title="Gameplay —— FWorldContext &amp; UWorld &amp; ULevel"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Gameplay</span><h3>Gameplay —— FWorldContext & UWorld & ULevel</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#gameplay-%E6%80%BB%E8%A7%88-uengine-ugameinstance"><span class="toc-number">1.</span> <span class="toc-text">Gameplay —— 总览 &amp; UEngine &amp; UGameInstance</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gameplay-%E6%80%BB%E8%A7%88"><span class="toc-number">1.1.</span> <span class="toc-text">Gameplay 总览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E6%BA%90%E7%A0%81"><span class="toc-number">1.2.</span> <span class="toc-text">深入源码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uengine"><span class="toc-number">1.3.</span> <span class="toc-text">UEngine</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ugameinstance"><span class="toc-number">1.4.</span> <span class="toc-text">UGameInstance</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/2021/12/01/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20%E6%80%BB%E8%A7%88%20&%20UEngine%20&%20UGameInstance/" rel="bookmark" title="Gameplay —— 总览 & UEngine & UGameInstance">Gameplay —— 总览 & UEngine & UGameInstance</a></li><li><a href="/2021/12/03/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20FWorldContext%20&%20UWorld%20&%20ULevel/" rel="bookmark" title="Gameplay —— FWorldContext & UWorld & ULevel">Gameplay —— FWorldContext & UWorld & ULevel</a></li><li><a href="/2021/12/06/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AActor%20&%20UActorComponent/" rel="bookmark" title="Gameplay —— AActor & UActorComponent">Gameplay —— AActor & UActorComponent</a></li><li><a href="/2021/12/09/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20APawn%20&%20AController%20&%20APlayerController/" rel="bookmark" title="Gameplay —— APawn & AController & APlayerController">Gameplay —— APawn & AController & APlayerController</a></li><li><a href="/2021/12/12/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AGameMode%20&%20AGameState%20&%20APlayerState/" rel="bookmark" title="Gameplay —— AGameMode & AGameState & APlayerState">Gameplay —— AGameMode & AGameState & APlayerState</a></li><li><a href="/2021/12/15/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20USavegame%20&%20UPlayer/" rel="bookmark" title="Gameplay —— USavegame & UPlayer">Gameplay —— USavegame & UPlayer</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="-YIFEI-" data-src="/images/avatar.jpg"><p class="name" itemprop="name">-YIFEI-</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">57</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">15</span> <span class="name">分类</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0tvdG9yaS1TdWtp" title="https:&#x2F;&#x2F;github.com&#x2F;Kotori-Suki"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS90dnQtNjA=" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;tvt-60"><i class="ic i-zhihu"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li></ul></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/11/26/UE4/UE4CPP/Unreal%20Slate/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/12/03/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20FWorldContext%20&%20UWorld%20&%20ULevel/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="分类于 UE4_C++">UE4_C++</a></div><span><a href="/2022/01/08/UE4/UE4CPP/Unreal%20%E8%93%9D%E5%9B%BE%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6/" title="Unreal 蓝图底层实现机制">Unreal 蓝图底层实现机制</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="分类于 C++基础">C++基础</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="分类于 设计模式">设计模式</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/" title="分类于 行为型模式">行为型模式</a></div><span><a href="/2021/08/19/CPPBase/DesignPattern/Observe/" title="观察者模式">观察者模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="分类于 C++基础">C++基础</a></div><span><a href="/2021/08/16/CPPBase/map%E4%B8%8Eunordered_map%E7%9A%84%E5%8C%BA%E5%88%AB/" title="map与unordered_map">map与unordered_map</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/%E6%8F%92%E4%BB%B6%E5%88%B6%E4%BD%9C/" title="分类于 插件制作">插件制作</a></div><span><a href="/2021/08/05/UE4/UE4Plugin/UE4_Plugin/" title="UE4 Plugin">UE4 Plugin</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="分类于 UE4_C++">UE4_C++</a></div><span><a href="/2021/11/02/UE4/UE4CPP/Unreal%20%E5%BA%8F%E5%88%97%E5%8C%96/" title="Unreal 序列化~~~">Unreal 序列化~~~</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="分类于 UE4_C++">UE4_C++</a></div><span><a href="/2021/11/11/UE4/UE4CPP/UE4%E4%BB%A3%E7%90%86%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E7%94%A8%E6%B3%95/" title="UE4代理的实现与用法">UE4代理的实现与用法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="分类于 C++基础">C++基础</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="分类于 设计模式">设计模式</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/" title="分类于 行为型模式">行为型模式</a></div><span><a href="/2021/08/21/CPPBase/DesignPattern/State/" title="状态模式">状态模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="分类于 C++基础">C++基础</a></div><span><a href="/2021/08/16/CPPBase/C++%E6%8C%87%E9%92%88/" title="C++指针">C++指针</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="分类于 UE4_C++">UE4_C++</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/Gameplay/" title="分类于 Gameplay">Gameplay</a></div><span><a href="/2021/12/09/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20APawn%20&%20AController%20&%20APlayerController/" title="Gameplay —— APawn &amp; AController &amp; APlayerController">Gameplay —— APawn & AController & APlayerController</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="分类于 UE4_C++">UE4_C++</a></div><span><a href="/2021/11/15/UE4/UE4CPP/FProperty%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E6%80%BB%E7%BB%93/" title="FProperty的分析与总结">FProperty的分析与总结</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2021 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">-YIFEI- @ Afei's Blog</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/12/01/UE4/UE4CPP/Gameplay —— 总览 & UEngine & UGameInstance/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>