<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="ä¸€ä¸ªå¹´è½»äººå¥”å‘æ¢¦æƒ³çš„è¶³è¿¹" href="https://kotori_suki.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="ä¸€ä¸ªå¹´è½»äººå¥”å‘æ¢¦æƒ³çš„è¶³è¿¹" href="https://kotori_suki.github.io/atom.xml"><link rel="alternate" type="application/json" title="ä¸€ä¸ªå¹´è½»äººå¥”å‘æ¢¦æƒ³çš„è¶³è¿¹" href="https://kotori_suki.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="https://kotori_suki.github.io/2021/12/17/UE4/UE4CPP/Unreal%20GAS%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"><title>Unreal GAS æºç è§£æ - UE4_C++ - UE4 | Afei's Blog = ä¸€ä¸ªå¹´è½»äººå¥”å‘æ¢¦æƒ³çš„è¶³è¿¹ = Welcome to my blog !</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Unreal GAS æºç è§£æ</h1><div class="meta"><span class="item" title="åˆ›å»ºæ—¶é—´ï¼š2021-12-17 11:26:45"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">å‘è¡¨äº</span> <time itemprop="dateCreated datePublished" datetime="2021-12-17T11:26:45+08:00">2021-12-17</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="åˆ‡æ¢å¯¼èˆªæ "><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Afei's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipevarprfj20zk0m8npd.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipexoj0moj20zk0m8kgu.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giph4wqtg4j20zk0m8x6p.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipewkhf1zj20zk0m81kx.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclxp31goj20zk0m8qv5.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclh0m9pdj20zk0m8hdt.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">é¦–é¡µ</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/UE4/" itemprop="item" rel="index" title="åˆ†ç±»äº UE4"><span itemprop="name">UE4</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/UE4/UE4CPP/" itemprop="item" rel="index" title="åˆ†ç±»äº UE4_C++"><span itemprop="name">UE4_C++</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://kotori_suki.github.io/2021/12/17/UE4/UE4CPP/Unreal%20GAS%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="-YIFEI-"><meta itemprop="description" content="Welcome to my blog !, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ä¸€ä¸ªå¹´è½»äººå¥”å‘æ¢¦æƒ³çš„è¶³è¿¹"></span><div class="body md" itemprop="articleBody"><h1 id="unreal-gas-æºç è§£æ"><a class="anchor" href="#unreal-gas-æºç è§£æ">#</a> Unreal GAS æºç è§£æ</h1><p>ç®€ä»‹ï¼šGASï¼Œå…¨ç§°ï¼šGameplay Ability Systemï¼Œæ˜¯è™šå¹»å¼•æ“å†…ç½®çš„ä¸€æ¬¾æŠ€èƒ½ç³»ç»Ÿæ’ä»¶ã€‚æ­¤æ’ä»¶ä¸ºæˆ‘ä»¬æä¾›äº†è§’è‰²å±æ€§é›†ï¼ŒæŠ€èƒ½å®ä¾‹ï¼ŒæŠ€èƒ½æ•ˆæœï¼ŒæŠ€èƒ½ç‰¹æ•ˆç­‰ï¼ŒåŒæ—¶æ”¯æŒç½‘ç»œåŒæ­¥ï¼Œæœ¬åœ°é¢„æµ‹ç­‰ã€‚ä½¿ç”¨æ­¤æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ›´ä¸“å¿ƒåœ°è®¾è®¡æŠ€èƒ½çš„è¡¨ç°ä¸æ•ˆæœï¼Œè€Œä¸éœ€è¦å…³å¿ƒæŠ€èƒ½ç³»ç»Ÿçš„åº•å±‚å®ç°ã€‚ä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå› ä¸ºé›†æˆçš„åŠŸèƒ½è¾ƒå¤šï¼Œå¢åŠ äº†æˆ‘ä»¬å­¦ä¹  / æ”¹é€ ä½¿ç”¨æ­¤æ’ä»¶çš„éš¾åº¦å’Œæˆæœ¬ã€‚æœ¬ç¯‡åšå®¢å°†ä»æºç å±‚é¢å¯¹ GAS çš„åº•å±‚å®ç°ä¸€æ¢ç©¶ç«Ÿï¼Œå¸Œæœ›èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï½ï½ï½</p><p>æ³¨ï¼šæœ¬æ–‡ä¸è®² GAS çš„ä½¿ç”¨ã€‚å¦‚æœ‰éœ€è¦ï¼Œè¯·åœ¨ä¸‹æ–¹ç•™è¨€ (ä¸ç„¶å°±ä¸æ›´äº†ï¼Œå› ä¸ºä¸æ˜¯å¾ˆéš¾...)</p><h2 id="gas-æ€»è§ˆ"><a class="anchor" href="#gas-æ€»è§ˆ">#</a> GAS æ€»è§ˆ</h2><p>ä»¥ä¸‹æ˜¯ &quot;GAS&quot; ç®€åŒ–åçš„ä½¿ç”¨åŸºæœ¬æµç¨‹ï¼Œå¼€å‘ä¸­å½“ç„¶ä¸ä¼šè¿™ä¹ˆç®€å•ï¼Œå¦‚ï¼šç¯å¢ƒåˆ¤æ–­å½±å“æŠ€èƒ½é‡Šæ”¾åŠ¨ä½œï¼ŒåŒæ—¶å½±å“æ•ˆæœç­‰å¤æ‚æƒ…å†µä¼šéå¸¸å¤šã€‚æˆ‘ä»¬åªåˆ†ææºç ï¼Œä¸Šå±‚å¼€å‘å…ˆæä¸€æ ğŸ˜ƒ</p><p><img data-src="GAS%E6%80%BB%E8%A7%88.png" alt="GASæ€»è§ˆ"></p><h2 id="attributesçš„å®ç°"><a class="anchor" href="#attributesçš„å®ç°">#</a> Attributes çš„å®ç°</h2><p>Attributes å³ è§’è‰²çš„å±æ€§ï¼Œå¦‚ï¼šè¡€é‡ï¼Œè€åŠ›ç­‰ã€‚æŠ€èƒ½ç³»ç»Ÿé¦–å…ˆå¾—æœ‰å¯ä»¥å’ŒæŠ€èƒ½å‘ç”Ÿäº¤äº’çš„è§’è‰²å±æ€§ã€‚è€Œåœ¨ GAS ç³»ç»Ÿä¸­ï¼Œè§’è‰²å±æ€§å°±å®šä¹‰åœ¨ &quot;AttributeSystemConponent&quot; çš„ &quot;DefaultStartingData&quot; ä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><p><code>UPROPERTY(EditAnywhere, Category=&quot;AttributeTest&quot;)</code><br><code>TArray&lt;FAttributeDefaults&gt;	DefaultStartingData;</code></p><p>å¯ä»¥çœ‹å‡ºï¼Œæ­¤æ•°ç»„æ˜¯å¼€æ”¾ç»™è“å›¾ç¼–è¾‘çš„ï¼Œ&quot;FAttributeDefaults&quot; åˆ™æ˜¯æˆ‘ä»¬éœ€è¦é…ç½®çš„å±æ€§ï¼Œæºç å¦‚ä¸‹ï¼š</p><p></p><figure class="highlight c++"><figcaption><span>FAttributeDefaults</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameplayAbilityTypes.h</span></span><br><span class="line"><span class="built_in">USTRUCT</span>()</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GAMEPLAYABILITIES_API</span> <span class="title">FAttributeDefaults</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="built_in">GENERATED_USTRUCT_BODY</span>()</span><br><span class="line"></span><br><span class="line">	<span class="built_in">FAttributeDefaults</span>()</span><br><span class="line">		: <span class="built_in">DefaultStartingTable</span>(<span class="literal">nullptr</span>)</span><br><span class="line">	&#123; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, Category = <span class="string">&quot;AttributeTest&quot;</span>)</span><br><span class="line">	TSubclassOf&lt;UAttributeSet&gt; Attributes;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, Category = <span class="string">&quot;AttributeTest&quot;</span>)</span><br><span class="line">	UDataTable* DefaultStartingTable;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>&quot;Attributes&quot; æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ &quot;UAttributeSet&quot; çš„å­ç±»ï¼Œ&quot;DefaultStartingTable&quot; åˆ™æ˜¯ç”¨æ¥è·å–è¯¥ &quot;Attribute&quot; çš„åˆå§‹å€¼çš„ï¼Œè·å–æ–¹æ³•éœ€è¦åœ¨è‡ªå®šä¹‰çš„ &quot;UAttributeSet&quot; ä¸­å®šä¹‰ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹åœ¨è“å›¾ä¸­ç¼–è¾‘çš„ &quot;Attribute&quot; æ˜¯æ€ä¹ˆåº”ç”¨åˆ° &quot;AbilitySystemComponent&quot; ä¸­çš„ã€‚</p><p></p><figure class="highlight c++"><figcaption><span>UAbilitySystemComponent.OnRegister</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AbilitySystemComponent.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UAbilitySystemComponent::OnRegister</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Super::<span class="built_in">OnRegister</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Cached off netrole to avoid constant checking on owning actor</span></span><br><span class="line">	<span class="built_in">CacheIsNetSimulated</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Init starting data</span></span><br><span class="line">	<span class="keyword">for</span> (int32 i=<span class="number">0</span>; i &lt; DefaultStartingData.<span class="built_in">Num</span>(); ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (DefaultStartingData[i].Attributes &amp;&amp; DefaultStartingData[i].DefaultStartingTable)</span><br><span class="line">		&#123;</span><br><span class="line">			UAttributeSet* Attributes = <span class="keyword">const_cast</span>&lt;UAttributeSet*&gt;(<span class="built_in">GetOrCreateAttributeSubobject</span>(DefaultStartingData[i].Attributes));</span><br><span class="line">			Attributes-&gt;<span class="built_in">InitFromMetaDataTable</span>(DefaultStartingData[i].DefaultStartingTable);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ........</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>&quot;AbilitySystemComponent&quot; ç»„ä»¶ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆå§‹åŒ–æ‰€æœ‰çš„é»˜è®¤å±æ€§ (è“å›¾ä¸­å®šä¹‰çš„)ï¼Œæˆ‘ä»¬åªéœ€è¦é‡å†™ &quot;UAttributeSet&quot; çš„ <code>InitFromMetaDataTable()</code> ï¼Œå¹¶æä¾›æ•°å€¼å…ƒæ•°æ®è¡¨å³å¯ã€‚å¦å¤–ï¼Œ&quot;DefaultStartingData&quot; æ˜¯ä¸æ”¯æŒç½‘ç»œå¤åˆ¶çš„ï¼Œå¦‚æœéœ€è¦ç½‘ç»œå¤åˆ¶ï¼Œåˆ™éœ€è¦è®¾ç½® &quot;SpawnedAttributes&quot; å±æ€§ã€‚æºç å¦‚ä¸‹ï¼š</p><p><code>/** List of attribute sets */ UPROPERTY(Replicated) TArray&lt;UAttributeSet*&gt;	SpawnedAttributes;</code></p><p>&quot;SpawnedAttributes&quot; æ˜¯ä¸æ”¯æŒè“å›¾ç¼–è¾‘çš„ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è§’è‰²çš„ &quot;PostInitializeComponents ()&quot; ä¸­ä¸ºå…¶è®¾ç½®ã€‚å¦‚ï¼š</p><p></p><figure class="highlight c++"><figcaption><span>PostInitializeComponent</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AbilitySystemTestPawn.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">AAbilitySystemTestPawn::PostInitializeComponents</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;	</span><br><span class="line">    <span class="comment">// è·å–ç§æœ‰å˜é‡çš„æ–¹å¼</span></span><br><span class="line">	<span class="keyword">static</span> FProperty *DamageProperty = FindFieldChecked&lt;FProperty&gt;(UAbilitySystemTestAttributeSet::<span class="built_in">StaticClass</span>(), <span class="built_in">GET_MEMBER_NAME_CHECKED</span>(UAbilitySystemTestAttributeSet, Damage));</span><br><span class="line"></span><br><span class="line">	Super::<span class="built_in">PostInitializeComponents</span>();</span><br><span class="line">	AbilitySystemComponent-&gt;<span class="built_in">InitStats</span>(UAbilitySystemTestAttributeSet::<span class="built_in">StaticClass</span>(), <span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">// ...... å…¶ä»– TestAttributeSet ä¹Ÿéœ€è¦é€ä¸ªåˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* åˆå§‹åŒ– Ability</span></span><br><span class="line"><span class="comment">	if (DefaultAbilitySet != NULL)</span></span><br><span class="line"><span class="comment">	&#123;</span></span><br><span class="line"><span class="comment">		AbilitySystemComponent-&gt;InitializeAbilities(DefaultAbilitySet);</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AbilitySystemComponent.cpp</span></span><br><span class="line"><span class="function"><span class="keyword">const</span> UAttributeSet* <span class="title">UAbilitySystemComponent::InitStats</span><span class="params">(TSubclassOf&lt;class UAttributeSet&gt; Attributes, <span class="keyword">const</span> UDataTable* DataTable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">const</span> UAttributeSet* AttributeObj = <span class="literal">nullptr</span>;</span><br><span class="line">	<span class="keyword">if</span> (Attributes)</span><br><span class="line">	&#123;</span><br><span class="line">		AttributeObj = <span class="built_in">GetOrCreateAttributeSubobject</span>(Attributes);</span><br><span class="line">		<span class="keyword">if</span> (AttributeObj &amp;&amp; DataTable)</span><br><span class="line">		&#123;</span><br><span class="line">            <span class="comment">// è¿™é‡Œå¯ä»¥ç”¨ const_cast - è¿™æ˜¯æˆ‘ä»¬ä¸ºæ•°ä¸å¤šçš„ï¼Œä¸é€šè¿‡ gameplay effect è€Œç›´æ¥ä¿®æ”¹ AttributeSet çš„åœ°æ–¹ä¹‹ä¸€</span></span><br><span class="line">			<span class="keyword">const_cast</span>&lt;UAttributeSet*&gt;(AttributeObj)-&gt;<span class="built_in">InitFromMetaDataTable</span>(DataTable);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> AttributeObj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">const</span> UAttributeSet* <span class="title">UAbilitySystemComponent::GetOrCreateAttributeSubobject</span><span class="params">(TSubclassOf&lt;UAttributeSet&gt; AttributeClass)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	AActor* OwningActor = <span class="built_in">GetOwner</span>();</span><br><span class="line">	<span class="keyword">const</span> UAttributeSet* MyAttributes = <span class="literal">nullptr</span>;</span><br><span class="line">	<span class="keyword">if</span> (OwningActor &amp;&amp; AttributeClass)</span><br><span class="line">	&#123;</span><br><span class="line">		MyAttributes = <span class="built_in">GetAttributeSubobject</span>(AttributeClass);</span><br><span class="line">		<span class="keyword">if</span> (!MyAttributes)</span><br><span class="line">		&#123;</span><br><span class="line">			UAttributeSet* Attributes = NewObject&lt;UAttributeSet&gt;(OwningActor, AttributeClass);</span><br><span class="line">			<span class="built_in">GetSpawnedAttributes_Mutable</span>().<span class="built_in">AddUnique</span>(Attributes);</span><br><span class="line">			MyAttributes = Attributes;</span><br><span class="line">			bIsNetDirty = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> MyAttributes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>è¿™æ ·ä¸€æ¥ï¼Œ&quot;AbilitySystemComponent&quot; ä¸­çš„ &quot;Attributes&quot; å°±åˆå§‹åŒ–å¥½äº†ã€‚æœ€åå’±å†çœ‹çœ‹ &quot;SpawnedAttributes&quot; çš„ç½‘ç»œå¤åˆ¶ï¼š</p><p></p><figure class="highlight c++"><figcaption><span>GetLifetimeRelicateProps</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AbilitySystemComponent.cpp</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UAbilitySystemComponent::GetLifetimeReplicatedProps</span><span class="params">(TArray&lt; FLifetimeProperty &gt; &amp; OutLifetimeProps)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function"></span>&#123;	</span><br><span class="line">	FDoRepLifetimeParams Params;</span><br><span class="line">	Params.bIsPushBased = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">DOREPLIFETIME_WITH_PARAMS_FAST</span>(UAbilitySystemComponent, SpawnedAttributes, Params);</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è€ƒè™‘åˆ° &quot;Attributes&quot; æœ‰å¯èƒ½å¾ˆå¤šï¼Œä¸”å¤§å¤šæ•°ä¸æˆ˜æ–—çš„æ—¶å€™æ˜¯ä¸éœ€è¦æ£€æŸ¥æ˜¯å¦éœ€è¦å¤åˆ¶çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨æ¨é€æ¨¡å‹æ¥å¯¹å…¶è¿›è¡Œç½‘ç»œå¤åˆ¶ (æ‰‹åŠ¨æ ‡è®°ä¸ºè„åè¿›è¡Œç½‘ç»œå¤åˆ¶)ã€‚</p><p>okï¼Œè§’è‰²çš„å±æ€§å’±çŸ¥é“æ˜¯æ€ä¹ˆæ¥çš„äº†ã€‚æ¥ä¸‹æ¥çœ‹çœ‹æŠ€èƒ½æ˜¯æ€ä¹ˆæ”¾å‡ºæ¥çš„ ğŸ˜ƒ</p><hr><h2 id="gameplayability"><a class="anchor" href="#gameplayability">#</a> GameplayAbility</h2><p>&quot;GameplayAbility&quot; å³æ˜¯ æ¸¸æˆä¸­çš„æŠ€èƒ½ï¼ŒæŠ€èƒ½å¯èƒ½éœ€è¦å†·å´ï¼Œä¹Ÿå¯èƒ½éœ€è¦æ¶ˆè€—æ³•åŠ›å€¼ç­‰ã€‚åœ¨ GAS ä¸­ï¼Œä»¥ä¸Šå†…å®¹éƒ½å·²å†…ç½®ï¼Œå¦å¤–è¿˜æ”¯æŒå®¢æˆ·ç«¯æœ¬åœ°é¢„æµ‹ï¼ŒæœåŠ¡ç«¯çŸ«æ­£æŠ€èƒ½é‡Šæ”¾ã€‚å¯¹äºæŠ€èƒ½å®ä½“ (ç«çƒç­‰)ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ CDOï¼Œä¹Ÿå¯ä»¥æŒ‰æ‰§è¡Œæ¬¡æ•°å®ä¾‹åŒ–ï¼Œæˆ–æ˜¯æŒ‰æ‰€æœ‰è€…å®ä¾‹åŒ– (æ¯ä¸ªæ‰€æœ‰è€…åªæœ‰ä¸€ä¸ªæŠ€èƒ½å®ä½“)ã€‚æœ€åæˆ‘ä»¬è¦æŠŠè¿™ä¸ªæŠ€èƒ½çš„é‡Šæ”¾ç»‘å®šåˆ°ä¸€ä¸ªæŒ‰é”®ä¸Šï¼Œå¦‚é¼ æ ‡å³é”®ç­‰ã€‚</p><p>ç°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬å·²ç»æŒ‰ä¸‹æŸä¸ªé‡Šæ”¾æŠ€èƒ½çš„æŒ‰é”®ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å¼•æ“æ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚</p><h3 id="æŒ‰é”®å¤„ç†"><a class="anchor" href="#æŒ‰é”®å¤„ç†">#</a> æŒ‰é”®å¤„ç†</h3><p></p><figure class="highlight c++"><figcaption><span>AbilityLocalInputPressed</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AbilitySystemComponent_Abilities.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UAbilitySystemComponent::AbilityLocalInputPressed</span><span class="params">(int32 InputID)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// Consume the input if this InputID is overloaded with GenericConfirm/Cancel and the GenericConfim/Cancel callback is bound</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">IsGenericConfirmInputBound</span>(InputID))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">LocalInputConfirm</span>();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">IsGenericCancelInputBound</span>(InputID))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">LocalInputCancel</span>();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ---------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">ABILITYLIST_SCOPE_LOCK</span>();</span><br><span class="line">	<span class="keyword">for</span> (FGameplayAbilitySpec&amp; Spec : ActivatableAbilities.Items)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (Spec.InputID == InputID)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (Spec.Ability)</span><br><span class="line">			&#123;</span><br><span class="line">				Spec.InputPressed = <span class="literal">true</span>;</span><br><span class="line">				<span class="keyword">if</span> (Spec.<span class="built_in">IsActive</span>())</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> (Spec.Ability-&gt;bReplicateInputDirectly &amp;&amp; <span class="built_in">IsOwnerActorAuthoritative</span>() == <span class="literal">false</span>)</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="built_in">ServerSetInputPressed</span>(Spec.Handle);</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					<span class="built_in">AbilitySpecInputPressed</span>(Spec);</span><br><span class="line"></span><br><span class="line">					<span class="comment">// Invoke the InputPressed event. This is not replicated here. If someone is listening, they may replicate the InputPressed event to the server.</span></span><br><span class="line">					<span class="built_in">InvokeReplicatedEvent</span>(EAbilityGenericReplicatedEvent::InputPressed, Spec.Handle, Spec.ActivationInfo.<span class="built_in">GetActivationPredictionKey</span>());					</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					<span class="comment">// Ability is not active, so try to activate it</span></span><br><span class="line">					<span class="built_in">TryActivateAbility</span>(Spec.Handle);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>é¦–å…ˆï¼Œå¼•æ“è°ƒç”¨ä¹‹å‰ç»‘å®šåˆ° &quot;InputComponent&quot; çš„ &quot;AbilityLocalInputPressed&quot; å‡½æ•°ï¼Œå¹¶å°†æŒ‰é”®ä½œä¸ºå‚æ•°ä¼ è¿›å»ã€‚æ­¤å‡½æ•°ä¼šå…ˆåˆ¤æ–­æœ¬æ¬¡è¾“å…¥æ˜¯å¦è¢«æ¶ˆè´¹ (ç»‘å®šäº† GenericConfirm / Cancel å›è°ƒ)ï¼Œå¦‚æœè¢«æ¶ˆè´¹åˆ™è°ƒç”¨å¯¹åº”å›è°ƒå¹¶è¿”å›ã€‚æœªè¢«æ¶ˆè´¹åˆ™å…ˆå¯¹ &quot;AbilityList&quot; ä¸Šé”ï¼Œå¦‚æœæ­¤æŠ€èƒ½å½“å‰æœªå¤„äºæ´»è·ƒçŠ¶æ€åˆ™æ¿€æ´»è¯¥æŠ€èƒ½ï¼Œå¦åˆ™é€šçŸ¥æœåŠ¡ç«¯æ‰§è¡Œæ­¤æŠ€èƒ½çš„æŒ‰ä¸‹é€»è¾‘ (å¦‚é‡Šæ”¾å‡ºå»çš„æŠ€èƒ½å†æ¬¡æŒ‰ä¸‹åçˆ†ç‚¸ç­‰)ï¼ŒåŒæ—¶ä¹Ÿåœ¨æœ¬åœ°æ‰§è¡Œï¼Œæœ€åè°ƒç”¨ <code>InvokeReplicatedEvent</code> , åœ¨å®¢æˆ·ç«¯æ‰§è¡Œ InputPressed é€šç”¨å¤åˆ¶æ—¶é—´ï¼Œå¹¶è§¦å‘æŒ‰ä¸‹äº‹ä»¶çš„ä»£ç†å³å¯ã€‚</p><p>æ¾å¼€æŒ‰é”®çš„å‡½æ•° &quot;AbilityLocalInputReleased&quot; åŒç†ï¼Œä¸åšèµ˜è¿°ã€‚</p><p>æ¥ä¸‹æ¥çœ‹çœ‹ &quot;TryActivateAbility&quot; æ˜¯å¦‚ä½•æ¿€æ´»æŠ€èƒ½çš„ã€‚</p><h3 id="tryactivateability"><a class="anchor" href="#tryactivateability">#</a> TryActivateAbility</h3><p></p><figure class="highlight c++"><figcaption><span>TryActivateAbility</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AbilitySystemComponent_Abilities.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">UAbilitySystemComponent::TryActivateAbility</span><span class="params">(FGameplayAbilitySpecHandle AbilityToActivate, <span class="keyword">bool</span> bAllowRemoteActivation)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	FGameplayTagContainer FailureTags;</span><br><span class="line">	FGameplayAbilitySpec* Spec = <span class="built_in">FindAbilitySpecFromHandle</span>(AbilityToActivate);</span><br><span class="line">	<span class="keyword">if</span> (!Spec)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">ABILITY_LOG</span>(Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;TryActivateAbility called with invalid Handle&quot;</span>));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¦‚æœæ­¤æŠ€èƒ½æ­£åœ¨è¢«ç§»é™¤ï¼Œåˆ™ä¸æ¿€æ´»æ­¤æŠ€èƒ½ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">	<span class="keyword">if</span> (Spec-&gt;PendingRemove || Spec-&gt;RemoveAfterActivation)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UGameplayAbility* Ability = Spec-&gt;Ability;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!Ability)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">ABILITY_LOG</span>(Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;TryActivateAbility called with invalid Ability&quot;</span>));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> FGameplayAbilityActorInfo* ActorInfo = AbilityActorInfo.<span class="built_in">Get</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç¡®ä¿ ActorInfo å­˜åœ¨ä¸” ActorInfo çš„ Actor æœ‰æ•ˆï¼Œå¦åˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">	<span class="keyword">if</span> (ActorInfo == <span class="literal">nullptr</span> || !ActorInfo-&gt;OwnerActor.<span class="built_in">IsValid</span>() || !ActorInfo-&gt;AvatarActor.<span class="built_in">IsValid</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">	<span class="keyword">const</span> ENetRole NetMode = ActorInfo-&gt;AvatarActor-&gt;<span class="built_in">GetLocalRole</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ¿€æ´»æ­¤æŠ€èƒ½åªèƒ½æ˜¯ æœ¬åœ°æŒ‰é’®è¢«æŒ‰ä¸‹/æœ¬åœ°ç…½åŠ¨(å¦‚: AIå¯¹äºç©å®¶çš„æŸç§è¡Œä¸ºè‡ªåŠ¨é‡Šæ”¾æŠ€èƒ½ç­‰)</span></span><br><span class="line">	<span class="keyword">if</span> (NetMode == ROLE_SimulatedProxy)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span> bIsLocal = AbilityActorInfo-&gt;<span class="built_in">IsLocallyControlled</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºä»…é™æœ¬åœ°æˆ–ä»…é™æœåŠ¡å™¨çš„æŠ€èƒ½ï¼Œå¦‚æœæ˜¯åˆ™åœ¨è¿œç«¯æ‰§è¡Œæˆ–æŠ¥é”™ </span></span><br><span class="line">	<span class="keyword">if</span> (!bIsLocal &amp;&amp; (Ability-&gt;<span class="built_in">GetNetExecutionPolicy</span>() == EGameplayAbilityNetExecutionPolicy::LocalOnly || Ability-&gt;<span class="built_in">GetNetExecutionPolicy</span>() == EGameplayAbilityNetExecutionPolicy::LocalPredicted))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (bAllowRemoteActivation)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">ClientTryActivateAbility</span>(AbilityToActivate);</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">ABILITY_LOG</span>(Log, <span class="built_in">TEXT</span>(<span class="string">&quot;Can&#x27;t activate LocalOnly or LocalPredicted ability %s when not local.&quot;</span>), *Ability-&gt;<span class="built_in">GetName</span>());</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (NetMode != ROLE_Authority &amp;&amp; (Ability-&gt;<span class="built_in">GetNetExecutionPolicy</span>() == EGameplayAbilityNetExecutionPolicy::ServerOnly || Ability-&gt;<span class="built_in">GetNetExecutionPolicy</span>() == EGameplayAbilityNetExecutionPolicy::ServerInitiated))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (bAllowRemoteActivation)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (Ability-&gt;<span class="built_in">CanActivateAbility</span>(AbilityToActivate, ActorInfo, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>, &amp;FailureTags))</span><br><span class="line">			&#123;</span><br><span class="line">                <span class="comment">// æ²¡æœ‰é¢„æµ‹å¯†é’¥ï¼ŒæœåŠ¡å™¨å°†åˆ†é… server-generated å¯†é’¥</span></span><br><span class="line">				<span class="built_in">CallServerTryActivateAbility</span>(AbilityToActivate, Spec-&gt;InputPressed, <span class="built_in">FPredictionKey</span>());</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">NotifyAbilityFailed</span>(AbilityToActivate, Ability, FailureTags);</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">ABILITY_LOG</span>(Log, <span class="built_in">TEXT</span>(<span class="string">&quot;Can&#x27;t activate ServerOnly or ServerInitiated ability %s when not the server.&quot;</span>), *Ability-&gt;<span class="built_in">GetName</span>());</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">InternalTryActivateAbility</span>(AbilityToActivate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>&quot;TryActivateAbility&quot; é¦–å…ˆæ£€æŸ¥æ­¤æŠ€èƒ½æ˜¯å¦å¯æ¿€æ´»ï¼Œæ£€æŸ¥æ­¤æŠ€èƒ½æ˜¯å¦å°†è¢«ç§»é™¤ï¼Œæ£€æŸ¥æ­¤æŠ€èƒ½çš„é‡Šæ”¾è€…æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœéƒ½æ»¡è¶³ï¼Œ<strong>åˆ¤æ–­æ˜¯å¦ä¸ºä»…é™æœ¬åœ°æˆ–ä»…é™æœåŠ¡å™¨çš„æŠ€èƒ½ï¼Œå¦‚æœæ˜¯åˆ™åœ¨è¿œç«¯æ‰§è¡Œæˆ–æŠ¥é”™</strong> (å¦‚ï¼šæœåŠ¡å™¨ Controller æ¿€æ´»äº†æœ¬åœ°æŠ€èƒ½ï¼Œåˆ™å…ˆåˆ¤æ–­æ­¤æŠ€èƒ½æ˜¯å¦å¯ä»¥è¿œç«¯æ¿€æ´»ï¼Œå¯ä»¥åˆ™è°ƒç”¨å¯¹åº”è¿œç«¯æ‰§è¡ŒæŠ€èƒ½çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ &quot;ClientTryActivateAbility&quot; , ä¸å¯è¿œç«¯æ¿€æ´»åˆ™æŠ¥é”™)ã€‚<strong>å¦‚æœä¸æ˜¯ (å³ åŒç«¯éƒ½å¯ä»¥æ¿€æ´»æŠ€èƒ½) åˆ™ç›´æ¥æ‰§è¡Œ &quot;InternalTryActivateAbility&quot;</strong></p><h3 id="internaltryactivateability"><a class="anchor" href="#internaltryactivateability">#</a> InternalTryActivateAbility</h3><p>å°è¯•æ¿€æ´»æŠ€èƒ½çš„å‡½æ•°ï¼Œ<strong>æ­¤å‡½æ•°å°†è°ƒç”¨ &quot;CanActivateAbility&quot; ç¡®è®¤æ˜¯å¦å¯ä»¥æ¿€æ´»æ­¤æŠ€èƒ½åï¼Œå¯ä»¥åˆ™å¤„ç†æŠ€èƒ½å®ä½“ï¼Œæœ€åå¤„ç†ç½‘ç»œå’Œæœ¬åœ°é¢„æµ‹</strong>ã€‚ä¸‹é¢æ˜¯å¯¹å‡½æ•°çš„è§£æï¼Œå‡½æ•°ä½“è¾ƒé•¿ï¼Œä¸æƒ³çœ‹å¯ä»¥ç›´æ¥çœ‹ä»£ç æ®µåé¢çš„å‡½æ•°æ€»ç»“ã€‚</p><p></p><figure class="highlight c++"><figcaption><span>InternalTryActivateAbility</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AbilitySystemComponent_Abilities.cpp</span></span><br><span class="line"><span class="comment">// note: GameplayAbilitySpec åŒ…å«æŠ€èƒ½çš„ç­‰çº§ï¼Œå¥æŸ„ï¼Œç»‘å®šè¾“å…¥IDç­‰ï¼Œä¸‹æ–‡ç§°ä¹‹ä¸º &quot;æŠ€èƒ½æè¿°&quot;</span></span><br><span class="line"><span class="comment">// note: GameplayAbilitySpecHandle åˆ™ç§°ä¸º &quot;æŠ€èƒ½æè¿°å¥æŸ„&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">UAbilitySystemComponent::InternalTryActivateAbility</span><span class="params">(FGameplayAbilitySpecHandle Handle, FPredictionKey InPredictionKey, UGameplayAbility** OutInstancedAbility, FOnGameplayAbilityEnded::FDelegate* OnGameplayAbilityEndedDelegate, <span class="keyword">const</span> FGameplayEventData* TriggerEventData)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">const</span> FGameplayTag&amp; NetworkFailTag = UAbilitySystemGlobals::<span class="built_in">Get</span>().ActivateFailNetworkingTag;</span><br><span class="line">	</span><br><span class="line">	InternalTryActivateAbilityFailureTags.<span class="built_in">Reset</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (Handle.<span class="built_in">IsValid</span>() == <span class="literal">false</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">ABILITY_LOG</span>(Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;InternalTryActivateAbility called with invalid Handle! ASC: %s. AvatarActor: %s&quot;</span>), *<span class="built_in">GetPathName</span>(), *<span class="built_in">GetNameSafe</span>(<span class="built_in">GetAvatarActor_Direct</span>()));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	FGameplayAbilitySpec* Spec = <span class="built_in">FindAbilitySpecFromHandle</span>(Handle);</span><br><span class="line">	<span class="keyword">if</span> (!Spec)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">ABILITY_LOG</span>(Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;InternalTryActivateAbility called with a valid handle but no matching ability was found. Handle: %s ASC: %s. AvatarActor: %s&quot;</span>), *Handle.<span class="built_in">ToString</span>(), *<span class="built_in">GetPathName</span>(), *<span class="built_in">GetNameSafe</span>(<span class="built_in">GetAvatarActor_Direct</span>()));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// é”å®š AbilityListï¼Œä»¥ä¿è¯æ¿€æ´»æ—¶ Spec ä¸ä¼šè¢«é”€æ¯</span></span><br><span class="line">	<span class="built_in">ABILITYLIST_SCOPE_LOCK</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> FGameplayAbilityActorInfo* ActorInfo = AbilityActorInfo.<span class="built_in">Get</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç¡®ä¿ ActorInfo å­˜åœ¨ï¼Œä¸” ActorInfo çš„ Actor å­˜åœ¨</span></span><br><span class="line">	<span class="keyword">if</span> (ActorInfo == <span class="literal">nullptr</span> || !ActorInfo-&gt;OwnerActor.<span class="built_in">IsValid</span>() || !ActorInfo-&gt;AvatarActor.<span class="built_in">IsValid</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ­¤æ¿€æ´»åº”æ¥è‡ªäºæŒ‰é’®æŒ‰ä¸‹/æœ¬åœ°ç…½åŠ¨(AIç­‰)</span></span><br><span class="line">	ENetRole NetMode = ROLE_SimulatedProxy;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¦‚æœå­˜åœ¨ PCï¼Œåˆ™ä½¿ç”¨ PC çš„ç½‘ç»œæ¨¡å¼</span></span><br><span class="line">	<span class="keyword">if</span> (APlayerController* PC = ActorInfo-&gt;PlayerController.<span class="built_in">Get</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		NetMode = PC-&gt;<span class="built_in">GetLocalRole</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// å¦åˆ™ä½¿ç”¨ AvatarActor (è§’è‰²çš„ç‰©ç†ä½“)</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (AActor* LocalAvatarActor = <span class="built_in">GetAvatarActor_Direct</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		NetMode = LocalAvatarActor-&gt;<span class="built_in">GetLocalRole</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (NetMode == ROLE_SimulatedProxy)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span> bIsLocal = AbilityActorInfo-&gt;<span class="built_in">IsLocallyControlled</span>();</span><br><span class="line"></span><br><span class="line">	UGameplayAbility* Ability = Spec-&gt;Ability;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!Ability)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">ABILITY_LOG</span>(Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;InternalTryActivateAbility called with invalid Ability&quot;</span>));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¦‚æœæ˜¯ä»…é™æœ¬åœ°æˆ–ä»…é™æœåŠ¡å™¨çš„æŠ€èƒ½ï¼Œåˆ™ä¸æ‰§è¡Œ</span></span><br><span class="line">	<span class="keyword">if</span> (!bIsLocal)</span><br><span class="line">	&#123;</span><br><span class="line">        </span><br><span class="line">		<span class="comment">// å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„é¢„æµ‹å¯†é’¥ï¼Œè¯´æ˜æ­¤æŠ€èƒ½å·²ç»åœ¨æœ¬åœ°å®¢æˆ·ç«¯çš„å¼€å§‹é‡Šæ”¾ï¼Œæ‰€ä»¥æ˜¯æ²¡æœ‰é—®é¢˜çš„</span></span><br><span class="line">		<span class="keyword">if</span> (Ability-&gt;<span class="built_in">GetNetExecutionPolicy</span>() == EGameplayAbilityNetExecutionPolicy::LocalOnly || (Ability-&gt;<span class="built_in">GetNetExecutionPolicy</span>() == EGameplayAbilityNetExecutionPolicy::LocalPredicted &amp;&amp; !InPredictionKey.<span class="built_in">IsValidKey</span>()))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">ABILITY_LOG</span>(Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;Can&#x27;t activate LocalOnly or LocalPredicted ability %s when not local! Net Execution Policy is %d.&quot;</span>), *Ability-&gt;<span class="built_in">GetName</span>(), (int32)Ability-&gt;<span class="built_in">GetNetExecutionPolicy</span>());</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (NetworkFailTag.<span class="built_in">IsValid</span>())</span><br><span class="line">			&#123;</span><br><span class="line">				InternalTryActivateAbilityFailureTags.<span class="built_in">AddTag</span>(NetworkFailTag);</span><br><span class="line">				<span class="built_in">NotifyAbilityFailed</span>(Handle, Ability, InternalTryActivateAbilityFailureTags);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (NetMode != ROLE_Authority &amp;&amp; (Ability-&gt;<span class="built_in">GetNetExecutionPolicy</span>() == EGameplayAbilityNetExecutionPolicy::ServerOnly || Ability-&gt;<span class="built_in">GetNetExecutionPolicy</span>() == EGameplayAbilityNetExecutionPolicy::ServerInitiated))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">ABILITY_LOG</span>(Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;Can&#x27;t activate ServerOnly or ServerInitiated ability %s when not the server! Net Execution Policy is %d.&quot;</span>), *Ability-&gt;<span class="built_in">GetName</span>(), (int32)Ability-&gt;<span class="built_in">GetNetExecutionPolicy</span>());</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (NetworkFailTag.<span class="built_in">IsValid</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			InternalTryActivateAbilityFailureTags.<span class="built_in">AddTag</span>(NetworkFailTag);</span><br><span class="line">			<span class="built_in">NotifyAbilityFailed</span>(Handle, Ability, InternalTryActivateAbilityFailureTags);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¦‚æœæ­¤æŠ€èƒ½è¢«å®ä¾‹åŒ–è¿‡ï¼Œåˆ™ç”¨ç¬¬ä¸€æ¬¡å®ä¾‹åŒ–çš„å€¼åˆå§‹åŒ–æ­¤å˜é‡ã€‚å¦åˆ™ä¸ºç©º( PerActor æŠ€èƒ½ä¼šåœ¨ GiveAbility çš„æ—¶å€™åˆå§‹åŒ–å…¶å€¼ï¼ŒPerExecution æŠ€èƒ½åˆ™ä¼šåœ¨é‡Šæ”¾ä¸€æ¬¡æŠ€èƒ½åè®¾ç½®å…¶å€¼)</span></span><br><span class="line">	UGameplayAbility* InstancedAbility = Spec-&gt;<span class="built_in">GetPrimaryInstance</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> FGameplayTagContainer* SourceTags = <span class="literal">nullptr</span>;</span><br><span class="line">	<span class="keyword">const</span> FGameplayTagContainer* TargetTags = <span class="literal">nullptr</span>;</span><br><span class="line">	<span class="keyword">if</span> (TriggerEventData != <span class="literal">nullptr</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		SourceTags = &amp;TriggerEventData-&gt;InstigatorTags;</span><br><span class="line">		TargetTags = &amp;TriggerEventData-&gt;TargetTags;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæœ‰å®ä¾‹åŒ–çš„æŠ€èƒ½ï¼Œåˆ™è°ƒç”¨å…¶ &quot;CallActivateAbility&quot; å‡½æ•°</span></span><br><span class="line">        <span class="comment">// å¦åˆ™æˆ‘ä»¬ä½¿ç”¨æ­¤æŠ€èƒ½çš„ CDO è°ƒç”¨ &quot;CallActivateAbility&quot; å‡½æ•°</span></span><br><span class="line">		UGameplayAbility* <span class="keyword">const</span> CanActivateAbilitySource = InstancedAbility ? InstancedAbility : Ability;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!CanActivateAbilitySource-&gt;<span class="built_in">CanActivateAbility</span>(Handle, ActorInfo, SourceTags, TargetTags, &amp;InternalTryActivateAbilityFailureTags))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">NotifyAbilityFailed</span>(Handle, CanActivateAbilitySource, InternalTryActivateAbilityFailureTags);</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¦‚æœæ­¤æŠ€èƒ½ä¸º PerActor çš„ï¼Œä¸”å·²ç»è¢«æ¿€æ´»ï¼Œåˆ™ä¸ä¼šè¢«äºŒæ¬¡æ¿€æ´»ä»¥å…ç ´åå›¾è¡¨</span></span><br><span class="line">	<span class="keyword">if</span> (Ability-&gt;<span class="built_in">GetInstancingPolicy</span>() == EGameplayAbilityInstancingPolicy::InstancedPerActor)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (Spec-&gt;<span class="built_in">IsActive</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (Ability-&gt;bRetriggerInstancedAbility &amp;&amp; InstancedAbility)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">bool</span> bReplicateEndAbility = <span class="literal">true</span>;</span><br><span class="line">				<span class="keyword">bool</span> bWasCancelled = <span class="literal">false</span>;</span><br><span class="line">				InstancedAbility-&gt;<span class="built_in">EndAbility</span>(Handle, ActorInfo, Spec-&gt;ActivationInfo, bReplicateEndAbility, bWasCancelled);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">ABILITY_LOG</span>(Verbose, <span class="built_in">TEXT</span>(<span class="string">&quot;Can&#x27;t activate instanced per actor ability %s when their is already a currently active instance for this actor.&quot;</span>), *Ability-&gt;<span class="built_in">GetName</span>());</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// PerActor ç±»å‹çš„æŠ€èƒ½ï¼Œå¿…é¡»ç¡®ä¿æœ‰ InstancedAbility (å³å·²è°ƒç”¨ GiveAbility )</span></span><br><span class="line">	<span class="keyword">if</span> (Ability-&gt;<span class="built_in">GetInstancingPolicy</span>() == EGameplayAbilityInstancingPolicy::InstancedPerActor &amp;&amp; !InstancedAbility)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">ABILITY_LOG</span>(Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;InternalTryActivateAbility called but instanced ability is missing! NetMode: %d. Ability: %s&quot;</span>), (int32)NetMode, *Ability-&gt;<span class="built_in">GetName</span>());</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç¡®ä¿è¶…å‡º uint8 çš„æœ€å¤§å€¼æ—¶ä¸ä¼šç¿»æ»šï¼Œå¦‚æœ var å¤§å°å‘ç”Ÿå˜åŒ–åˆ™éœ€è¦æ›´æ–°è¯¥å€¼</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">LIKELY</span>(Spec-&gt;ActiveCount &lt; UINT8_MAX))</span><br><span class="line">	&#123;</span><br><span class="line">		Spec-&gt;ActiveCount++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">ABILITY_LOG</span>(Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;TryActivateAbility %s called when the Spec-&gt;ActiveCount (%d) &gt;= UINT8_MAX&quot;</span>), *Ability-&gt;<span class="built_in">GetName</span>(), (int32)Spec-&gt;ActiveCount)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸ºæ­¤ AbilitySpec è®¾ç½®ä¸€ä¸ªæ–°çš„ ActivationInfo</span></span><br><span class="line"><span class="comment">     * ActivationInfo ä¸­å¯å¾—çŸ¥æ¿€æ´»çš„ Actor æ˜¯å¦ä¸º authorityï¼Œæ˜¯å¦æ­£åœ¨é¢„æµ‹ï¼Œæ˜¯å¦å·²è¢«éªŒè¯ç­‰</span></span><br><span class="line"><span class="comment">     * ActivationInfo æŒæœ‰ current å’Œ previous é¢„æµ‹å¯†é’¥ï¼Œç”¨äºæœåŠ¡å™¨å¯¹æœ¬åœ°é¢„æµ‹è¿›è¡Œçº æ­£</span></span><br><span class="line"><span class="comment">     * æ­¤ç»“æ„ä½“è¾ƒå°ï¼Œæ‰€ä»¥é€šå¸¸æ˜¯å€¼ä¼ é€’</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">	Spec-&gt;ActivationInfo = <span class="built_in">FGameplayAbilityActivationInfo</span>(ActorInfo-&gt;OwnerActor.<span class="built_in">Get</span>());</span><br><span class="line">	FGameplayAbilityActivationInfo &amp;ActivationInfo = Spec-&gt;ActivationInfo;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¦‚æœå½“å‰æ˜¯æœåŠ¡ç«¯æ‰§è¡Œæ­¤å‡½æ•°ï¼Œæˆ–ä»…æœ¬åœ°æ‰§è¡Œçš„æŠ€èƒ½ï¼Œæ‰§è¡Œä»¥ä¸‹é€»è¾‘</span></span><br><span class="line">	<span class="keyword">if</span> (Ability-&gt;<span class="built_in">GetNetExecutionPolicy</span>() == EGameplayAbilityNetExecutionPolicy::LocalOnly || (NetMode == ROLE_Authority))</span><br><span class="line">	&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä¸ºæœåŠ¡å™¨æ‰§è¡Œï¼Œä¸”æ²¡æœ‰æœ‰æ•ˆçš„é¢„æµ‹å¯†é’¥ æˆ–æ­¤æŠ€èƒ½åº”ç”±æœåŠ¡ç«¯å…ˆæ¿€æ´»ï¼Œåˆ™åˆ›å»ºæ–°çš„çš„å¯†é’¥</span></span><br><span class="line">		<span class="keyword">bool</span> bCreateNewServerKey = NetMode == ROLE_Authority &amp;&amp;</span><br><span class="line">			(!InPredictionKey.<span class="built_in">IsValidKey</span>() ||</span><br><span class="line">			 (Ability-&gt;<span class="built_in">GetNetExecutionPolicy</span>() == EGameplayAbilityNetExecutionPolicy::ServerInitiated ||</span><br><span class="line">			  Ability-&gt;<span class="built_in">GetNetExecutionPolicy</span>() == EGameplayAbilityNetExecutionPolicy::ServerOnly));</span><br><span class="line">		<span class="keyword">if</span> (bCreateNewServerKey)</span><br><span class="line">		&#123;</span><br><span class="line">			ActivationInfo.<span class="built_in">ServerSetActivationPredictionKey</span>(FPredictionKey::<span class="built_in">CreateNewServerInitiatedKey</span>(<span class="keyword">this</span>));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (InPredictionKey.<span class="built_in">IsValidKey</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// å¦åˆ™ï¼Œå¦‚æœå¯ç”¨ï¼Œå°†é¢„æµ‹å¯†é’¥è®¾ç½®ä¸ºä¼ å…¥å¯†é’¥</span></span><br><span class="line">			ActivationInfo.<span class="built_in">ServerSetActivationPredictionKey</span>(InPredictionKey);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ­¤æ—¶é¢„æµ‹å¯†é’¥çš„å€¼å¯èƒ½å·²ç»æ”¹å˜ï¼Œæ‰€ä»¥éœ€è¦æ›´æ–°æ­¤ç»„ä»¶çš„ &quot;ScopedPredictionKey&quot; ä»¥åŒ¹é…åˆšè®¾ç½®çš„</span></span><br><span class="line">		<span class="function">FScopedPredictionWindow <span class="title">ScopedPredictionWindow</span><span class="params">(<span class="keyword">this</span>, ActivationInfo.GetActivationPredictionKey())</span></span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// ----------------------------------------------</span></span><br><span class="line">		<span class="comment">// é€šçŸ¥å®¢æˆ·ç«¯ æ­¤æŠ€èƒ½å·²æ¿€æ´»(å¦‚æœæ­¤å‡½æ•°è°ƒç”¨éæœ¬åœ° ä¸” æŠ€èƒ½éä»…é™æœåŠ¡å™¨)</span></span><br><span class="line">		<span class="comment">// ----------------------------------------------</span></span><br><span class="line">		<span class="keyword">if</span> (!bIsLocal &amp;&amp; Ability-&gt;<span class="built_in">GetNetExecutionPolicy</span>() != EGameplayAbilityNetExecutionPolicy::ServerOnly)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (TriggerEventData)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">ClientActivateAbilitySucceedWithEventData</span>(Handle, ActivationInfo.<span class="built_in">GetActivationPredictionKey</span>(), *TriggerEventData);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">ClientActivateAbilitySucceed</span>(Handle, ActivationInfo.<span class="built_in">GetActivationPredictionKey</span>());</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// æ­¤æŠ€èƒ½å®ä¾‹å°†è¢«æ‹·è´åˆ° InstancedAbilities</span></span><br><span class="line">			ActivationInfo.bCanBeEndedByOtherInstance = Ability-&gt;bServerRespectsRemoteAbilityCancellation;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// ----------------------------------------------</span></span><br><span class="line">		<span class="comment">//	è°ƒç”¨ ActivateAbility (æ³¨æ„è¿™ä¹Ÿå°†ç»“æŸæŠ€èƒ½)</span></span><br><span class="line">		<span class="comment">// ----------------------------------------------</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// åˆ›å»ºæ­¤æŠ€èƒ½çš„å®ä¾‹(å¦‚æœéœ€è¦)</span></span><br><span class="line">		<span class="keyword">if</span> (Ability-&gt;<span class="built_in">GetInstancingPolicy</span>() == EGameplayAbilityInstancingPolicy::InstancedPerExecution)</span><br><span class="line">		&#123;</span><br><span class="line">            <span class="comment">// PerExecution å‹æŠ€èƒ½å¤„ç†æ–¹æ³•</span></span><br><span class="line">			InstancedAbility = <span class="built_in">CreateNewInstanceOfAbility</span>(*Spec, Ability);</span><br><span class="line">			InstancedAbility-&gt;<span class="built_in">CallActivateAbility</span>(Handle, ActorInfo, ActivationInfo, OnGameplayAbilityEndedDelegate, TriggerEventData);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (InstancedAbility)</span><br><span class="line">		&#123;</span><br><span class="line">            <span class="comment">// PerActor å‹æŠ€èƒ½å¤„ç†æ–¹æ³•</span></span><br><span class="line">			InstancedAbility-&gt;<span class="built_in">CallActivateAbility</span>(Handle, ActorInfo, ActivationInfo, OnGameplayAbilityEndedDelegate, TriggerEventData);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">            <span class="comment">// Non-Instanced å‹æŠ€èƒ½å¤„ç†æ–¹æ³•</span></span><br><span class="line">			Ability-&gt;<span class="built_in">CallActivateAbility</span>(Handle, ActorInfo, ActivationInfo, OnGameplayAbilityEndedDelegate, TriggerEventData);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (Ability-&gt;<span class="built_in">GetNetExecutionPolicy</span>() == EGameplayAbilityNetExecutionPolicy::LocalPredicted)</span><br><span class="line">	&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰éæœåŠ¡å™¨æ‰§è¡Œæ­¤å‡½æ•°ï¼Œä¸”æ­¤æŠ€èƒ½æ”¯æŒæœ¬åœ°é¢„æµ‹ã€‚</span></span><br><span class="line">		<span class="comment">// åˆ·æ–°æ­¤æŠ€èƒ½æ¿€æ´»ä¹‹å‰å‘ç”Ÿçš„æœåŠ¡å™¨ç§»åŠ¨ï¼Œä»¥ä¾¿æœåŠ¡å™¨ä»¥æ­£ç¡®çš„é¡ºåºæ¥æ”¶ RPCs </span></span><br><span class="line">		<span class="comment">// è¿™å¯¹äº é˜²æ­¢è§¦å‘åŠ¨ç”»æ ¹ç§»åŠ¨æˆ–å½±å“ç§»åŠ¨çš„æŠ€èƒ½è¢«ç½‘ç»œçº æ­£ æ˜¯å¿…è¦çš„</span></span><br><span class="line">		<span class="keyword">if</span> (!ActorInfo-&gt;<span class="built_in">IsNetAuthority</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			ACharacter* AvatarCharacter = Cast&lt;ACharacter&gt;(ActorInfo-&gt;AvatarActor.<span class="built_in">Get</span>());</span><br><span class="line">			<span class="keyword">if</span> (AvatarCharacter)</span><br><span class="line">			&#123;</span><br><span class="line">				UCharacterMovementComponent* AvatarCharMoveComp = Cast&lt;UCharacterMovementComponent&gt;(AvatarCharacter-&gt;<span class="built_in">GetMovementComponent</span>());</span><br><span class="line">				<span class="keyword">if</span> (AvatarCharMoveComp)</span><br><span class="line">				&#123;</span><br><span class="line">					AvatarCharMoveComp-&gt;<span class="built_in">FlushServerMoves</span>();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ­¤æ‰§è¡Œå°†æ­£å¼è¿›å…¥ &quot;EGameplayAbilityActivationMode:Predicting&quot; çŠ¶æ€ï¼Œä¸”æ‹¥æœ‰ä¸€ä¸ª &quot;PredictionKey&quot;ã€‚</span></span><br><span class="line"><span class="comment">         * åˆ›å»ºé¢„æµ‹å¯†é’¥çš„ç»†èŠ‚: è°ƒç”¨ &quot;GenerateDependentPredictionKey&quot; åˆ†åˆ«ä¸º &quot;Base&quot;ï¼Œ&quot;Previous&quot;ï¼Œ&quot;Current&quot; é¢„æµ‹å¯†é’¥èµ‹å€¼ï¼Œ</span></span><br><span class="line"><span class="comment">         * å¹¶è°ƒç”¨ &quot;AddDependency&quot; å°† &quot;Current&quot; å¯†é’¥çš„ &quot;RejectedDelagate&quot;(æŠ€èƒ½é‡Šæ”¾è¢«æœåŠ¡å™¨æ‹’ç») å’Œ &quot;CaughtUpDelegate&quot;(æŠ€èƒ½é‡Šæ”¾è¢«æœåŠ¡å™¨æ•è·ï¼Œæœªæ‰¿è®¤ä¹Ÿæœªæ‹’ç») æ·»åŠ åˆ° &quot;Previous&quot; ä¸­ï¼Œå³ &quot;Current&quot; ä¾èµ–äº &quot;Previous&quot;</span></span><br><span class="line"><span class="comment">         * å½“ &quot;Previous&quot; å¯†é’¥è¢«æœåŠ¡å™¨ &quot;Rejected&quot; æ—¶ï¼Œå°†è°ƒç”¨ &quot;Previous&quot; å’Œ &quot;Current&quot; çš„ &quot;Rejected&quot; å›è°ƒï¼Œç„¶åæ¸…é™¤æ‰ä¸¤ä¸ªå¯†é’¥ã€‚&quot;CaughtUp&quot; ä¹ŸåŒç†</span></span><br><span class="line"><span class="comment">         * æ‰€æœ‰å¯†é’¥å­˜åœ¨ &quot;DelegateMap&quot; TMap ä¸­ï¼Œä»¥ &quot;FPredictionKey&quot; ä½œä¸ºé”®ï¼Œ&quot;Delegates&quot; ä½œä¸ºå€¼ï¼Œå¯ä»¥æŸ¥æ‰¾åˆ°æ­¤ PredictionKey ä¸‹çš„æ‰€æœ‰ &quot;Rejected&quot; å’Œ &quot;CaughtUp&quot; å›è°ƒ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">		<span class="function">FScopedPredictionWindow <span class="title">ScopedPredictionWindow</span><span class="params">(<span class="keyword">this</span>, <span class="literal">true</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">		ActivationInfo.<span class="built_in">SetPredicting</span>(ScopedPredictionKey);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// æ­¤å‡½æ•°å¿…é¡»åœ¨ &quot;GeneratePredictionKey&quot; åç«‹å³è°ƒç”¨ï¼Œä»¥é¿å…é€’å½’æ¿€æ´»æŠ€èƒ½çš„é—®é¢˜</span></span><br><span class="line">		<span class="keyword">if</span> (TriggerEventData)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">ServerTryActivateAbilityWithEventData</span>(Handle, Spec-&gt;InputPressed, ScopedPredictionKey, *TriggerEventData);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">CallServerTryActivateAbility</span>(Handle, Spec-&gt;InputPressed, ScopedPredictionKey);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å½“æ­¤é¢„æµ‹å¯†é’¥è¢«æ•è·æ—¶ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ­¤æŠ€èƒ½æ—¶è¢«æ‰¿è®¤äº†è¿˜æ˜¯è¢«æ‹’ç»äº†</span></span><br><span class="line">		ScopedPredictionKey.<span class="built_in">NewCaughtUpDelegate</span>().<span class="built_in">BindUObject</span>(<span class="keyword">this</span>, &amp;UAbilitySystemComponent::OnClientActivateAbilityCaughtUp, Handle, ScopedPredictionKey.Current);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (Ability-&gt;<span class="built_in">GetInstancingPolicy</span>() == EGameplayAbilityInstancingPolicy::InstancedPerExecution)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// ç°åœ¨ï¼Œåªæœ‰ NonReplicated + InstancedPerExecution æŠ€èƒ½å¯ä»¥è¢«é¢„æµ‹</span></span><br><span class="line">			<span class="comment">// æˆ‘ä»¬ç¼ºå°‘ä»£ç ï¼Œæ¥é¢„æµ‹ç”Ÿæˆçš„ Execution å®ä¾‹å’Œä¹‹ååœ¨æœåŠ¡å™¨ä¸­ç”Ÿæˆçš„ç‰ˆæœ¬åˆå¹¶</span></span><br><span class="line">			<span class="keyword">if</span> (Ability-&gt;<span class="built_in">GetReplicationPolicy</span>() == EGameplayAbilityReplicationPolicy::ReplicateNo)</span><br><span class="line">			&#123;</span><br><span class="line">				InstancedAbility = <span class="built_in">CreateNewInstanceOfAbility</span>(*Spec, Ability);</span><br><span class="line">				InstancedAbility-&gt;<span class="built_in">CallActivateAbility</span>(Handle, ActorInfo, ActivationInfo, OnGameplayAbilityEndedDelegate, TriggerEventData);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">ABILITY_LOG</span>(Error, <span class="built_in">TEXT</span>(<span class="string">&quot;InternalTryActivateAbility called on ability %s that is InstancePerExecution and Replicated. This is an invalid configuration.&quot;</span>), *Ability-&gt;<span class="built_in">GetName</span>() );</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (InstancedAbility)</span><br><span class="line">		&#123;</span><br><span class="line">            <span class="comment">// PerActor æŠ€èƒ½ç›´æ¥è°ƒç”¨ &quot;CallActivateAbility&quot; è¿›è¡Œé¢„æµ‹</span></span><br><span class="line">			InstancedAbility-&gt;<span class="built_in">CallActivateAbility</span>(Handle, ActorInfo, ActivationInfo, OnGameplayAbilityEndedDelegate, TriggerEventData);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> </span><br><span class="line">		&#123;</span><br><span class="line">            <span class="comment">// Non-Instanced</span></span><br><span class="line">			Ability-&gt;<span class="built_in">CallActivateAbility</span>(Handle, ActorInfo, ActivationInfo, OnGameplayAbilityEndedDelegate, TriggerEventData);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (InstancedAbility)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (OutInstancedAbility)</span><br><span class="line">		&#123;</span><br><span class="line">			*OutInstancedAbility = InstancedAbility;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		InstancedAbility-&gt;<span class="built_in">SetCurrentActivationInfo</span>(ActivationInfo);	<span class="comment">// éœ€è¦å°†æ­¤ ActivationInfo æ”¾å…¥ Ability ä¸­ï¼Œå¦‚æœå…¶å·²è¢«åˆå§‹åŒ–</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ‡ç­¾ä¸ºè„ï¼Œä»¥æ›´æ–°æ¨é€æ¨¡å‹ ActivatableAbilities å®¹å™¨çš„ç½‘ç»œå¤åˆ¶</span></span><br><span class="line">	<span class="built_in">MarkAbilitySpecDirty</span>(*Spec);</span><br><span class="line"></span><br><span class="line">	AbilityLastActivatedTime = <span class="built_in">GetWorld</span>()-&gt;<span class="built_in">GetTimeSeconds</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å› ä¸º UE æ˜¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å…±ç”¨ä¸€å¥—ä»£ç çš„ï¼Œæ‰€ä»¥åœ¨ç½‘ç»œæ¸¸æˆç¼–ç¨‹æ—¶å¸¸å¸¸æŠŠåŒç«¯çš„ä»£ç éƒ½å†™åˆ°åŒä¸€ä¸ªå‡½æ•°ä¸­ï¼Œè™½ç„¶ä»£ç é‡å‡å°‘äº†å¾ˆå¤šï¼Œä½†åŒæ—¶ä¹Ÿå¢åŠ äº†ç†è§£çš„æˆæœ¬ã€‚æ‰€ä»¥å¦‚æœä½ ç›´æ¥è¯»æºç æœ‰ç‚¹äº‘é‡Œé›¾é‡Œä¹Ÿæ˜¯å¾ˆæ­£å¸¸çš„ï¼Œæ€»ä¹‹çœ‹çœ‹ <strong>ä»æŒ‰ä¸‹é‡Šæ”¾æŠ€èƒ½æŒ‰é’®åˆ°æœåŠ¡å™¨ç¡®å®šæŠ€èƒ½æ˜¯å¦æ­£å¸¸é‡Šæ”¾</strong> çš„æµç¨‹å›¾å§ï½ï½ï½</p><p><img data-src="ActiveAbility%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="ActiveAbilityæµç¨‹å›¾"></p><p>é¦–å…ˆï¼Œåœ¨ GAS ä¸­ï¼ŒæŠ€èƒ½çš„ç½‘ç»œæ‰§è¡Œä»£ç† (EGameplayAbilityNetExecutionPolicy) åˆ†ä¸ºå››ç§ï¼šæœ¬åœ°é¢„æµ‹ï¼Œä»…é™æœ¬åœ°ï¼Œä»…é™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åˆå§‹åŒ–</p><ul><li>æœ¬åœ°é¢„æµ‹ï¼Œå³ é‡Šæ”¾æŠ€èƒ½æ—¶ï¼Œæœ¬åœ°å…ˆæ¿€æ´»æŠ€èƒ½ (ä¸éœ€è¦ç­‰æœåŠ¡å™¨å¯¹æ­¤æŠ€èƒ½æ˜¯å¦é‡Šæ”¾æˆåŠŸçš„å›åº”ï¼Œä»¥å‡å°‘å»¶è¿Ÿ)ï¼Œå¦‚æœè¯¥æŠ€èƒ½æœªè¢«æœåŠ¡å™¨æ‰¿è®¤ï¼Œåˆ™è°ƒç”¨é¢„ç½®çš„å›è°ƒå‡½æ•°å›æ»šæ­¤æ“ä½œï¼Œæ¯”å¦‚é‡ç½®æŠ€èƒ½å†·å´ï¼Œå›åˆ°æŠ€èƒ½é‡Šæ”¾å‰çš„ä½ç½®ç­‰)ï¼ŒæŠ€èƒ½è¢«æ‰¿è®¤åˆ™å°† ActivationMode è®¾ç½®ä¸º Confirmedï¼Œé¢„æµ‹å¯†é’¥åˆ™åœ¨ä¸‹ä¸€ä¸ªéœ€è¦é¢„æµ‹çš„æŠ€èƒ½é‡Šæ”¾æ—¶è¢«é‡ç½®</li><li>ä»…é™æœ¬åœ°ï¼Œåªåœ¨æ‹¥æœ‰ LocalController çš„å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯æ¿€æ´»æŠ€èƒ½</li><li>ä»…é™æœåŠ¡å™¨ï¼Œåªåœ¨æœåŠ¡å™¨ä¸­æ¿€æ´»æŠ€èƒ½</li><li>æœåŠ¡å™¨åˆå§‹åŒ–ï¼Œåœ¨æœåŠ¡å™¨ä¸­åˆå§‹åŒ–ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸­å­˜åœ¨æ­¤æŠ€èƒ½åˆ™ä¹Ÿä¼šè¢«æ¿€æ´»</li></ul><p>ä»æµç¨‹å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œ&quot;TryActivateAbility&quot; å¯ä»¥å¤„ç†æœ¬åœ°è¿œç«¯è°ƒç”¨ä»…é™æœåŠ¡å™¨æŠ€èƒ½å’ŒæœåŠ¡å™¨åˆå§‹åŒ–æŠ€èƒ½ (å¦‚æœæ”¯æŒè¿œç«¯è°ƒç”¨)ã€‚è€Œ &quot;InternalTryActivateAbility&quot; åˆ™å¤„ç†æœ¬åœ°é¢„æµ‹å’Œä»…é™æœ¬åœ°ã€‚æœ¬åœ°é¢„æµ‹æŠ€èƒ½è¢«æ¿€æ´»æ—¶å°†ç›´æ¥åœ¨æœ¬åœ°è°ƒç”¨ &quot;CallActivateAbility&quot;ï¼Œç„¶åç”Ÿæˆé¢„æµ‹å¯†é’¥å¹¶é€šçŸ¥æœåŠ¡å™¨æ¿€æ´»æ­¤æŠ€èƒ½ (åŒæ—¶ä¼ å…¥æ­¤å¯†é’¥)ï¼Œå¦‚æœæœåŠ¡å™¨æ¿€æ´»å¤±è´¥åˆ™ç”¨æ­¤å¯†é’¥æ‰§è¡Œç›¸åº”çš„å›æ»šæ“ä½œ (å›æ»šæ“ä½œéœ€è¦ä»¥ PredictionKey ä¸ºé”®æ·»åŠ åˆ° DelegateMap ä¸­ (è°ƒç”¨ FPredictionKeyDelegates::NewRejectedDelegate ååˆå§‹åŒ–è¿”å›çš„ KeyEvent ))ï¼Œæ‰§è¡ŒæˆåŠŸåˆ™å¤„ç†æ‰æ­¤å¯†é’¥çš„å›è°ƒå¹¶å°†å…¶ç½®ä¸º Confirmed çŠ¶æ€ã€‚è°ƒç”¨æœåŠ¡å™¨çš„æŠ€èƒ½åˆ™ç›´æ¥é€šçŸ¥æœåŠ¡å™¨æ‰§è¡Œåå°†ç»“æœè¿”å›ç»™å’±å°±å¥½ï¼Œæ‰§è¡ŒæˆåŠŸåå†åœ¨æœ¬åœ°æ‰§è¡Œæ­¤æŠ€èƒ½ã€‚æœ¬åœ°æŠ€èƒ½å°±å®Œå…¨è·ŸæœåŠ¡å™¨æ²¡æœ‰å…³ç³»äº†ã€‚</p><hr><h2 id="gameplayeffect"><a class="anchor" href="#gameplayeffect">#</a> GameplayEffect</h2><p>åœ¨åˆ†æ &quot;GameplayEffect&quot; çš„ç›¸å…³å‡½æ•°å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†æ¸…æ€è·¯ã€‚</p><ol><li>é¦–å…ˆï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨å®¢æˆ·ç«¯ &quot;ApplyEffect&quot;ï¼Œæ— è®ºæ˜¯åº”ç”¨åˆ°è‡ªå·±è¿˜æ˜¯åˆ«äººèº«ä¸Šï¼Œéƒ½ä¸è¡Œã€‚</li><li>å…¶æ¬¡ï¼Œæˆ‘ä»¬ä¸éœ€è¦å¯¹æ‰€æœ‰ Effect éƒ½è¿›è¡Œé¢„æµ‹ï¼Œä»¥é¿å…å®¢æˆ·ç«¯é¢„æµ‹è§’è‰²æ­»äº¡è€ŒæœåŠ¡å™¨åŒæ­¥åè¢«å¤æ´»ç­‰æƒ…å†µ</li><li>æœ€åï¼Œå¹¶ä¸åªæ˜¯ä¼¤å®³æ‰ç®— Effectã€‚å¦‚ Cooldown ç­‰ï¼ŒEffect å…¶å®æ˜¯å¯¹ Attribute çš„ Modifyã€‚</li></ol><h3 id="applygameplayeffecttotarget"><a class="anchor" href="#applygameplayeffecttotarget">#</a> ApplyGameplayEffectToTarget</h3><p></p><figure class="highlight c++"><figcaption><span>ApplyGameplayEffectToTarget</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AbilitySystemComponent.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function">FActiveGameplayEffectHandle <span class="title">UAbilitySystemComponent::ApplyGameplayEffectToTarget</span><span class="params">(UGameplayEffect *GameplayEffect, UAbilitySystemComponent *Target, <span class="keyword">float</span> Level, FGameplayEffectContextHandle Context, FPredictionKey PredictionKey)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">check</span>(GameplayEffect);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">HasNetworkAuthorityToApplyGameplayEffect</span>(PredictionKey))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!Context.<span class="built_in">IsValid</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			Context = <span class="built_in">MakeEffectContext</span>();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function">FGameplayEffectSpec	<span class="title">Spec</span><span class="params">(GameplayEffect, Context, Level)</span></span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">ApplyGameplayEffectSpecToTarget</span>(Spec, Target, PredictionKey);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">FActiveGameplayEffectHandle</span>(); <span class="comment">//å¤±è´¥è¿”å›ç©ºå¥æŸ„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥çœ‹å‡ºï¼Œæ­¤å‡½æ•°éœ€è¦å…ˆåˆ¤æ–­å½“å‰ç»ˆç«¯æ˜¯å¦æ‹¥æœ‰ç½‘ç»œæƒé™æ¥ ApplyEffect (å¯ä»¥æ˜¯æœ¬åœ°ä»£ç†ï¼Œä¹Ÿå¯ä»¥æ˜¯æœåŠ¡å™¨)ã€‚å¦‚æœæœ‰ï¼Œåˆ™è°ƒç”¨ &quot;ApplyGameplayEffectSpecToTarget&quot; å¹¶ä¼ å…¥ä¸€äº›å¿…è¦æ•°æ® (GameplayEffect, Target, Level, PredictionKey) , æ²¡æœ‰åˆ™è¿”å›ç©ºå¥æŸ„ã€‚</p><p></p><figure class="highlight c++"><figcaption><span>ApplyGameplayEffectSpecToTarget</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AbilitySystemComponent.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function">FActiveGameplayEffectHandle <span class="title">UAbilitySystemComponent::ApplyGameplayEffectSpecToTarget</span><span class="params">(<span class="keyword">const</span> FGameplayEffectSpec &amp;Spec, UAbilitySystemComponent *Target, FPredictionKey PredictionKey)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">SCOPE_CYCLE_COUNTER</span>(STAT_AbilitySystemComp_ApplyGameplayEffectSpecToTarget);</span><br><span class="line">	UAbilitySystemGlobals&amp; AbilitySystemGlobals = UAbilitySystemGlobals::<span class="built_in">Get</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!AbilitySystemGlobals.<span class="built_in">ShouldPredictTargetGameplayEffects</span>())</span><br><span class="line">	&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæˆ‘ä»¬ä¸éœ€è¦é¢„æµ‹ç›®æ ‡æ•ˆæœï¼Œæ¸…ç©ºé¢„æµ‹å¯†é’¥</span></span><br><span class="line">		PredictionKey = <span class="built_in">FPredictionKey</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	FActiveGameplayEffectHandle ReturnHandle;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (Target)</span><br><span class="line">	&#123;</span><br><span class="line">		ReturnHandle = Target-&gt;<span class="built_in">ApplyGameplayEffectSpecToSelf</span>(Spec, PredictionKey);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ReturnHandle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ˜¯çš„ï¼Œåªæ˜¯è°ƒç”¨äº† Target çš„ &quot;ApplyGameplayEffectSpecToSelf&quot; ...</p><p></p><figure class="highlight c++"><figcaption><span>ApplyGameplayEffectSpecToSelf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AbilitySystemComponent.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function">FActiveGameplayEffectHandle <span class="title">UAbilitySystemComponent::ApplyGameplayEffectSpecToSelf</span><span class="params">(<span class="keyword">const</span> FGameplayEffectSpec &amp;Spec, FPredictionKey PredictionKey)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// åœ¨æ·»åŠ å¼€å§‹åï¼Œé”å®šå®¹å™¨ä»¥é˜²æ­¢æ–°çš„ Effect åœ¨æ·»åŠ æ“ä½œæ—¶è¢«ç ´å</span></span><br><span class="line">	<span class="function">FScopedActiveGameplayEffectLock <span class="title">ScopeLock</span><span class="params">(ActiveGameplayEffects)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">FScopeCurrentGameplayEffectBeingApplied <span class="title">ScopedGEApplication</span><span class="params">(&amp;Spec, <span class="keyword">this</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">bool</span> bIsNetAuthority = <span class="built_in">IsOwnerActorAuthoritative</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç¡®è®¤ç½‘ç»œæƒé™</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">HasNetworkAuthorityToApplyGameplayEffect</span>(PredictionKey))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">FActiveGameplayEffectHandle</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä¸å…è®¸å‘¨æœŸæ€§æ•ˆæœçš„é¢„æµ‹</span></span><br><span class="line">	<span class="keyword">if</span>(PredictionKey.<span class="built_in">IsValidKey</span>() &amp;&amp; Spec.<span class="built_in">GetPeriod</span>() &gt; <span class="number">0.f</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">IsOwnerActorAuthoritative</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// æœåŠ¡å™¨æ¸…ç©ºé¢„æµ‹å¯†é’¥åç»§ç»­</span></span><br><span class="line">			PredictionKey = <span class="built_in">FPredictionKey</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// å®¢æˆ·ç«¯ç›´æ¥è¿”å›ç©ºå¥æŸ„</span></span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">FActiveGameplayEffectHandle</span>();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æˆ‘ä»¬å½“å‰æ˜¯å¦å¯¹æ­¤æ•ˆæœå…ç–«</span></span><br><span class="line">	<span class="keyword">const</span> FActiveGameplayEffect* ImmunityGE=<span class="literal">nullptr</span>;</span><br><span class="line">	<span class="keyword">if</span> (ActiveGameplayEffects.<span class="built_in">HasApplicationImmunityToSpec</span>(Spec, ImmunityGE))</span><br><span class="line">	&#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨å…ç–«é˜»æ–­æ•ˆæœå›è°ƒåï¼Œè¿”å›ç©ºå¥æŸ„</span></span><br><span class="line">		<span class="built_in">OnImmunityBlockGameplayEffect</span>(Spec, ImmunityGE);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">FActiveGameplayEffectHandle</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥å±æ€§é›†è¦æ±‚ï¼Œç¡®ä¿æ‰€æœ‰å±æ€§éƒ½æœ‰æ•ˆ</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å¯èƒ½å¸Œæœ›ä»¥æŸç§æ–¹å¼å°†å…¶ç¼“å­˜ä¸‹æ¥ä»¥ä¾¿åŠ å¿«è¿è¡Œæ—¶æ£€æŸ¥</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬è¿˜éœ€è¦å¤„ç†æ‰§è¡Œåˆ—è¡¨ä¸­çš„äº‹æƒ…</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> FGameplayModifierInfo&amp; Mod : Spec.Def-&gt;Modifiers)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!Mod.Attribute.<span class="built_in">IsValid</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">ABILITY_LOG</span>(Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s has a null modifier attribute.&quot;</span>), *Spec.Def-&gt;<span class="built_in">GetPathName</span>());</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">FActiveGameplayEffectHandle</span>();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ£€æŸ¥æ­¤æ•ˆæœæ˜¯å¦è¢« &quot;miss&quot; (ChangeToApply ä¸ºæ­¤æŠ€èƒ½çš„å‘½ä¸­ç‡)</span></span><br><span class="line">	<span class="keyword">float</span> ChanceToApply = Spec.<span class="built_in">GetChanceToApplyToTarget</span>();</span><br><span class="line">	<span class="keyword">if</span> ((ChanceToApply &lt; <span class="number">1.f</span> - SMALL_NUMBER) &amp;&amp; (FMath::<span class="built_in">FRand</span>() &gt; ChanceToApply))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">FActiveGameplayEffectHandle</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è·å– MyTags</span></span><br><span class="line">	<span class="comment">// æˆ‘ä»¬å¯èƒ½å¸Œæœ›ç¼“å­˜ GameplayTagContainer ä¸ºä¸æ˜¯æ¯æ¬¡éƒ½åˆ›å»ºå®ƒ</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// æ³¨æ„: è¿™æ˜¯ä½¿ç”¨é™æ€æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºèŒƒå›´éå¸¸æœ‰é™ï¼Œä½†æ›´å¹¿æ³›åœ°ä½¿ç”¨ MyTags æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºæ­¤å‡½æ•°å¯ä»¥è¢«é€’å½’è°ƒç”¨</span></span><br><span class="line">		<span class="keyword">static</span> FGameplayTagContainer MyTags;</span><br><span class="line">		MyTags.<span class="built_in">Reset</span>();</span><br><span class="line"></span><br><span class="line">		<span class="built_in">GetOwnedGameplayTags</span>(MyTags);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæ­¤ç»„ä»¶æ²¡æœ‰è¯¥æŠ€èƒ½çš„å…¨éƒ¨æ ‡ç­¾ï¼Œåˆ™è¿”å›</span></span><br><span class="line">		<span class="keyword">if</span> (Spec.Def-&gt;ApplicationTagRequirements.<span class="built_in">RequirementsMet</span>(MyTags) == <span class="literal">false</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">FActiveGameplayEffectHandle</span>();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæ­¤ç»„ä»¶æ‹¥æœ‰è¯¥æŠ€èƒ½çš„ç§»é™¤æ ‡ç­¾ï¼Œåˆ™è¿”å›</span></span><br><span class="line">		<span class="keyword">if</span> (!Spec.Def-&gt;RemovalTagRequirements.<span class="built_in">IsEmpty</span>() &amp;&amp; Spec.Def-&gt;RemovalTagRequirements.<span class="built_in">RequirementsMet</span>(MyTags) == <span class="literal">true</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">FActiveGameplayEffectHandle</span>();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è‡ªå®šä¹‰æ•ˆæœåº”ç”¨çš„éœ€æ±‚æ£€æŸ¥</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> TSubclassOf&lt;UGameplayEffectCustomApplicationRequirement&gt;&amp; AppReq : Spec.Def-&gt;ApplicationRequirements)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (*AppReq &amp;&amp; AppReq-&gt;GetDefaultObject&lt;UGameplayEffectCustomApplicationRequirement&gt;()-&gt;<span class="built_in">CanApplyGameplayEffect</span>(Spec.Def, Spec, <span class="keyword">this</span>) == <span class="literal">false</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">FActiveGameplayEffectHandle</span>();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	bIsNetDirty = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰æ˜¯å®¢æˆ·ç«¯ä¸”æœ‰æœ¬åœ°é¢„æµ‹å¯†é’¥ï¼Œåˆ™å°†ç¬æ—¶æ•ˆæœè§†ä¸ºæ°¸ä¹…æŒç»­æ•ˆæœï¼Œæ­¤æ•ˆæœå°†åœ¨åé¢ç§»é™¤</span></span><br><span class="line">	<span class="keyword">bool</span> bTreatAsInfiniteDuration = <span class="built_in">GetOwnerRole</span>() != ROLE_Authority &amp;&amp; PredictionKey.<span class="built_in">IsLocalClientKey</span>() &amp;&amp; Spec.Def-&gt;DurationPolicy == EGameplayEffectDurationType::Instant;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç¡®ä¿åœ¨æ­£ç¡®çš„åœ°æ–¹åˆ›å»ºspecçš„å¤åˆ¶</span></span><br><span class="line">	<span class="comment">// æˆ‘ä»¬åœ¨è¿™é‡Œç”¨ INDEX_NONE åˆå§‹åŒ– FActiveGameplayEffectHandleï¼Œä»¥å¤„ç†ç¬æ—¶æŠ€èƒ½æ•ˆæœ</span></span><br><span class="line">	<span class="comment">// å¦‚æ­¤åˆå§‹åŒ–ï¼Œå°†æŠŠ &quot;FActiveGameplayEffectHandle&quot; çš„ &quot;bPassedFiltersAndWasExecuted&quot; è®¾ä¸ºçœŸï¼Œå› æ­¤å¯ä»¥çŸ¥é“æˆ‘ä»¬åº”ç”¨äº† GE (gameplay effect)</span></span><br><span class="line">	<span class="function">FActiveGameplayEffectHandle	<span class="title">MyHandle</span><span class="params">(INDEX_NONE)</span></span>;</span><br><span class="line">	<span class="keyword">bool</span> bInvokeGameplayCueApplied = Spec.Def-&gt;DurationPolicy != EGameplayEffectDurationType::Instant; <span class="comment">// ç°åœ¨å°†å…¶ç¼“å­˜ï¼Œåœ¨å¯èƒ½å°† &quot;é¢„æµ‹ç¬æ—¶æ•ˆæœ&quot; ä¿®æ”¹ä¸º &quot;æ— é™æŒç»­æ•ˆæœ&quot; ä¹‹å‰</span></span><br><span class="line">	<span class="keyword">bool</span> bFoundExistingStackableGE = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	FActiveGameplayEffect* AppliedEffect = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">	FGameplayEffectSpec* OurCopyOfSpec = <span class="literal">nullptr</span>;</span><br><span class="line">	TSharedPtr&lt;FGameplayEffectSpec&gt; StackSpec;</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (Spec.Def-&gt;DurationPolicy != EGameplayEffectDurationType::Instant || bTreatAsInfiniteDuration)</span><br><span class="line">		&#123;</span><br><span class="line">            <span class="comment">// è·å–å¹¶åˆå§‹åŒ– &quot;ActiveGameplayEffect&quot;ï¼Œä¸»è¦åŒ…å« GameplayEffectï¼Œå¼€å§‹æ—¶é—´ï¼Œä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ï¼Œå¤åˆ¶å›è°ƒç­‰</span></span><br><span class="line">			AppliedEffect = ActiveGameplayEffects.<span class="built_in">ApplyGameplayEffectSpec</span>(Spec, PredictionKey, bFoundExistingStackableGE);</span><br><span class="line">			<span class="keyword">if</span> (!AppliedEffect)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="built_in">FActiveGameplayEffectHandle</span>();</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆå§‹åŒ– &quot;MyHandle&quot; å’Œ &quot;OurCopyOfSpec&quot;</span></span><br><span class="line">			MyHandle = AppliedEffect-&gt;Handle;</span><br><span class="line">			OurCopyOfSpec = &amp;(AppliedEffect-&gt;Spec);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// ....... çœç•¥ Debug ä»£ç </span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰åˆå§‹åŒ–ï¼Œåˆ™ç›´æ¥ç”¨ä¼ è¿›æ¥çš„ Spec æ¥è·å–å¹¶ä»¥è‡ªå·±ä½œä¸ºç›®æ ‡æ•è·ç›¸å…³å±æ€§æ•°æ®</span></span><br><span class="line">		<span class="keyword">if</span> (!OurCopyOfSpec)</span><br><span class="line">		&#123;</span><br><span class="line">			StackSpec = TSharedPtr&lt;FGameplayEffectSpec&gt;(<span class="keyword">new</span> <span class="built_in">FGameplayEffectSpec</span>(Spec));</span><br><span class="line">			OurCopyOfSpec = StackSpec.<span class="built_in">Get</span>();</span><br><span class="line">			UAbilitySystemGlobals::<span class="built_in">Get</span>().<span class="built_in">GlobalPreGameplayEffectSpecApply</span>(*OurCopyOfSpec, <span class="keyword">this</span>);</span><br><span class="line">			OurCopyOfSpec-&gt;<span class="built_in">CaptureAttributeDataFromTarget</span>(<span class="keyword">this</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¦‚æœæœ‰å¿…è¦ï¼Œæ·»åŠ ä¸€ä¸ª &quot;OurCopyOfSpec&quot; çš„ç¼–è¾‘å™¨ï¼Œä»¥å¼ºåˆ¶å…¶å…·æœ‰æ— é™æœŸçš„æŒç»­æ—¶é—´</span></span><br><span class="line">		<span class="keyword">if</span> (bTreatAsInfiniteDuration)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// ç›´æ¥è®¾ç½®æŒç»­æ—¶é—´ä¸ºæ— é™æœŸ</span></span><br><span class="line">			OurCopyOfSpec-&gt;<span class="built_in">SetDuration</span>(UGameplayEffect::INFINITE_DURATION, <span class="literal">true</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (OurCopyOfSpec)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// æ›´æ–°æ­£åœ¨è¢«åº”ç”¨çš„å…¨å±€ spec ä¸º &quot;OurCopyOfSpec&quot;</span></span><br><span class="line">		UAbilitySystemGlobals::<span class="built_in">Get</span>().<span class="built_in">SetCurrentAppliedGE</span>(OurCopyOfSpec);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å³ä½¿æ˜¯ç¬æ—¶æ•ˆæœï¼Œæˆ‘ä»¬ä¾ç„¶å¯èƒ½å¸Œæœ›ä½¿ç”¨ tags å’Œ stuff</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ­¤ GameplayEffect çš„ bSuppressStackingCues è¢«è®¾ç½®ä¸ºçœŸï¼Œåˆ™ä»…åœ¨æ­¤ GameplayEffect çš„ç¬¬ä¸€ä¸ªå®ä¾‹æ·»åŠ  GameplayCue(æŠ€èƒ½è¡¨ç°)</span></span><br><span class="line">	<span class="keyword">if</span> (!bSuppressGameplayCues &amp;&amp; bInvokeGameplayCueApplied &amp;&amp; AppliedEffect &amp;&amp; !AppliedEffect-&gt;bIsInhibited &amp;&amp; </span><br><span class="line">		(!bFoundExistingStackableGE || !Spec.Def-&gt;bSuppressStackingCues))</span><br><span class="line">	&#123;</span><br><span class="line">        <span class="comment">// æˆ‘ä»¬åœ¨æ­¤æ·»åŠ å¹¶æ¿€æ´» GameplayCue</span></span><br><span class="line">        <span class="comment">// åœ¨å°†ä» OnRep ä¸­è°ƒç”¨ gameplay cue çš„å®¢æˆ·ç«¯ä¸­ï¼Œéœ€è¦æŸ¥çœ‹å¼€å§‹æ—¶é—´ä»¥ç¡®è®¤æ­¤ Cue æ˜¯è¢«æ·»åŠ å¹¶æ¿€æ´»äº†ï¼Œè¿˜æ˜¯åªæ˜¯åˆšæ·»åŠ (å› ä¸ºç½‘ç»œç›¸å…³æ€§)</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (OurCopyOfSpec-&gt;StackCount &gt; Spec.StackCount)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// å› ä¸º PostReplicatedChange å°†åœ¨ä¿®æ”¹ stack çš„æ•°é‡æ—¶(ä¸”é PostReplicateAdd æ—¶)è¢«è°ƒç”¨ï¼Œæˆ‘ä»¬ä¸çŸ¥é“å“ªä¸ª GE è¢«ä¿®æ”¹</span></span><br><span class="line">            <span class="comment">// å› æ­¤æˆ‘ä»¬éœ€è¦æ˜¾å¼ RPC å®¢æˆ·ç«¯ä»¥ä¾¿å…¶çŸ¥é“éœ€è¦æ›´æ–° GC</span></span><br><span class="line">			UAbilitySystemGlobals::<span class="built_in">Get</span>().<span class="built_in">GetGameplayCueManager</span>()-&gt;<span class="built_in">InvokeGameplayCueAddedAndWhileActive_FromSpec</span>(<span class="keyword">this</span>, *OurCopyOfSpec, PredictionKey);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// å¦åˆ™è¿™äº› Cue å°†åœ¨ GE è¢«æ·»åŠ åˆ°å¤åˆ¶æ•°ç»„æ—¶ï¼Œè¢«å¤åˆ¶åˆ°å®¢æˆ·ç«¯ä¸­</span></span><br><span class="line">			<span class="built_in">InvokeGameplayCueEvent</span>(*OurCopyOfSpec, EGameplayCueEvent::OnActive);</span><br><span class="line">			<span class="built_in">InvokeGameplayCueEvent</span>(*OurCopyOfSpec, EGameplayCueEvent::WhileActive);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// è‡³å°‘æ‰§è¡Œä¸€æ¬¡ GE (å¦‚æœæ˜¯ç¬æ—¶æ•ˆæœå°†æ‰§è¡Œä¸€æ¬¡ï¼Œæ°¸ä¹…æ•ˆæœåˆ™æ·»åŠ åˆ° ActiveGameplayEffects ä¸­)</span></span><br><span class="line">	<span class="keyword">if</span> (bTreatAsInfiniteDuration)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// è¿™æ˜¯ç¬æ—¶æ•ˆæœï¼Œä½†æˆ‘ä»¬ä¸ºé¢„æµ‹ï¼Œå°†å…¶è§†ä¸ºæ°¸ä¹…æŒç»­ã€‚æ‰€ä»¥è¿™é‡Œåªéœ€è¦æ‰§è¡Œé¢„æµ‹çš„ gameplay cue(éé¢„æµ‹æƒ…å†µä¸‹ï¼Œè¿™å°†åœ¨ ::ExecuteGameplayEffect ä¸­æ‰§è¡Œ)</span></span><br><span class="line">		<span class="keyword">if</span> (!bSuppressGameplayCues)</span><br><span class="line">		&#123;</span><br><span class="line">			UAbilitySystemGlobals::<span class="built_in">Get</span>().<span class="built_in">GetGameplayCueManager</span>()-&gt;<span class="built_in">InvokeGameplayCueExecuted_FromSpec</span>(<span class="keyword">this</span>, *OurCopyOfSpec, PredictionKey);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// ç¬æ—¶ä¸”ä¸é¢„æµ‹æ•ˆæœï¼Œåˆ™è°ƒç”¨ ExecuteGameplayEffect (æ­¤å‡½æ•°è®¡ç®—ä¼¤å®³ï¼Œä¿®æ”¹å±æ€§å€¼ï¼Œæ‰§è¡Œè‡ªå®šä¹‰ä»£ç ï¼Œå¹¶è°ƒç”¨ GameplayCue äº‹ä»¶)</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (Spec.Def-&gt;DurationPolicy == EGameplayEffectDurationType::Instant)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (OurCopyOfSpec-&gt;Def-&gt;OngoingTagRequirements.<span class="built_in">IsEmpty</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">ExecuteGameplayEffect</span>(*OurCopyOfSpec, PredictionKey);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">ABILITY_LOG</span>(Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s is instant but has tag requirements. Tag requirements can only be used with gameplay effects that have a duration. This gameplay effect will be ignored.&quot;</span>), *Spec.Def-&gt;<span class="built_in">GetPathName</span>());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (Spec.<span class="built_in">GetPeriod</span>() != UGameplayEffect::NO_PERIOD &amp;&amp; Spec.TargetEffectSpecs.<span class="built_in">Num</span>() &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">ABILITY_LOG</span>(Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s is periodic but also applies GameplayEffects to its target. GameplayEffects will only be applied once, not every period.&quot;</span>), *Spec.Def-&gt;<span class="built_in">GetPathName</span>());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// å°è¯•ç§»é™¤æ­¤æ•ˆæœåº”ç”¨åéœ€è¦ç§»é™¤çš„æ•ˆæœ</span></span><br><span class="line">	<span class="keyword">if</span> (bIsNetAuthority)</span><br><span class="line">	&#123;</span><br><span class="line">		ActiveGameplayEffects.<span class="built_in">AttemptRemoveActiveEffectsOnEffectApplication</span>(Spec, MyHandle);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// ------------------------------------------------------</span></span><br><span class="line">	<span class="comment">// åº”ç”¨é“¾å¼æ•ˆæœï¼Œå³: æ­¤æ•ˆæœåº”ç”¨åä¼šç›´æ¥åº”ç”¨çš„æ•ˆæœ(TargetEffectSpecs)</span></span><br><span class="line">	<span class="comment">// ------------------------------------------------------</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> FGameplayEffectSpecHandle&amp; TargetSpec: Spec.TargetEffectSpecs)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (TargetSpec.<span class="built_in">IsValid</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">ApplyGameplayEffectSpecToSelf</span>(*TargetSpec.Data.<span class="built_in">Get</span>(), PredictionKey);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UAbilitySystemComponent* InstigatorASC = Spec.<span class="built_in">GetContext</span>().<span class="built_in">GetInstigatorAbilitySystemComponent</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç»™è‡ªèº«å‘é€ æ•ˆæœåº”ç”¨åˆ°è‡ªèº« çš„å›è°ƒ</span></span><br><span class="line">	<span class="built_in">OnGameplayEffectAppliedToSelf</span>(InstigatorASC, *OurCopyOfSpec, MyHandle);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç»™é‡Šæ”¾è€…å‘é€ æ•ˆæœåº”ç”¨åˆ°ç›®æ ‡ çš„å›è°ƒ</span></span><br><span class="line">	<span class="keyword">if</span> (InstigatorASC)</span><br><span class="line">	&#123;</span><br><span class="line">		InstigatorASC-&gt;<span class="built_in">OnGameplayEffectAppliedToTarget</span>(<span class="keyword">this</span>, *OurCopyOfSpec, MyHandle);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> MyHandle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>&quot;ApplyEffectToTarget&quot; å¹¶ä¸åƒ &quot;ActivateAbility&quot; ä¸€æ ·ç”±ç©å®¶æ§åˆ¶ã€‚æ­¤å‡½æ•°çš„è°ƒç”¨å®Œå…¨æ˜¯ç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨ç¨‹åºè¿è¡Œæ—¶è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦è°ƒç”¨çš„ (å®¢æˆ·ç«¯çš„è°ƒç”¨ä»…è¡¨ç°æŠ€èƒ½æ•ˆæœ (GameplayCue)ï¼Œæ”¹å˜çš„å±æ€§å€¼æœ€ç»ˆä¼šè¢«æœåŠ¡å™¨é‡æ–°åŒæ­¥ï¼Œè€ŒæœåŠ¡å™¨ä¸­è°ƒç”¨å°†æ”¹å˜å±æ€§å€¼ï¼Œå¹¶é€šçŸ¥å®¢æˆ·ç«¯æ‰§è¡Œå¯¹åº”çš„æŠ€èƒ½è¡¨ç° (å¦‚æœæ²¡æœ‰æ‰§è¡Œè¿‡)ï¼Œä»¥ä¸‹æ˜¯ &quot;ApplyGameplayEffectToTarget&quot; çš„æµç¨‹å›¾ï¼š</p><p><img data-src="ApplyEffectToTarget.png" alt="ApplyEffectToTarget"></p><p>æ­¤å‡½æ•°ä¼šå…ˆè¿›è¡Œå„ç§ä¸èƒ½åº”ç”¨æŠ€èƒ½æ•ˆæœçš„æ£€æŸ¥ï¼Œå…¶ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„æ£€æŸ¥ç±»ï¼Œè®©è™šå¹»å¸®æˆ‘ä»¬åšæ£€æŸ¥ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><p><img data-src="CustomRequirement.png" alt="CustomRequirement"></p><p>æˆ‘ä»¬éœ€è¦å®šä¹‰ &quot;UGameplayEffectCustomApplicationRequirement&quot; çš„å­ç±»ï¼Œå¹¶é‡è½½å…¶ &quot;CanApplyGameplayEffect&quot; æ–¹æ³•å³å¯ã€‚</p><p>åé¢å°±æ˜¯å¯¹å„ç§ç±»å‹æ•ˆæœçš„åˆ†ç±»å¤„ç†ï¼Œç¬æ—¶æ•ˆæœæ”¯æŒæœ¬åœ°é¢„æµ‹ï¼Œæœ¬åœ°é¢„æµ‹ç¬æ—¶æ•ˆæœå°†åœ¨å®¢æˆ·ç«¯å…ˆæ‰§è¡Œç›¸å…³ GameplayCue (æŠ€èƒ½æ•ˆæœè¡¨ç°ï¼Œå¦‚å£°éŸ³ï¼Œç²’å­æ•ˆæœç­‰)ï¼Œç„¶åç­‰æœåŠ¡å™¨åŒæ­¥æ•°æ®ã€‚å¦åˆ™ç­‰å¾…æœåŠ¡å™¨ç¡®è®¤æ­¤æ•ˆæœæˆåŠŸåº”ç”¨åå¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯æ‰§è¡Œæ­¤æŠ€èƒ½æ•ˆæœçš„ç›¸å…³è¡¨ç°ã€‚æœ€åç§»é™¤æŸäº›ç›¸å…³çš„æŠ€èƒ½æ•ˆæœå’Œåº”ç”¨é“¾å¼æ•ˆæœï¼Œå¹¶é€šçŸ¥å›è°ƒã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤å‡½æ•°æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åˆ†å¼€æ‰§è¡Œçš„ï¼Œäº’ä¸ç›¸å¹²ã€‚ä½†æœåŠ¡å™¨æ‰§è¡Œåï¼Œå°†åŒæ­¥å®¢æˆ·ç«¯çš„æŸäº›å±æ€§å€¼ï¼Œå¹¶å…·æœ‰ RPC æ‰€æœ‰å®¢æˆ·ç«¯æ‰§è¡Œç›¸å…³æŠ€èƒ½è¡¨ç°çš„èƒ½åŠ›ã€‚å®¢æˆ·ç«¯æ‰§è¡Œåˆ™åªèƒ½è¿›è¡ŒæŠ€èƒ½è¡¨ç°çš„é¢„æµ‹ï¼Œå±æ€§çš„ä¿®æ”¹æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºå±æ€§æ•°æ®å¿…å®šä¼šåœ¨åé¢è¢«æœåŠ¡å™¨åŒæ­¥çº æ­£ã€‚</p><p>æœ€åçœ‹çœ‹å’±çš„ GameplayCue çš„æ‰§è¡Œå§ï½ï½ï½</p><hr><h2 id="gameplaycue"><a class="anchor" href="#gameplaycue">#</a> GameplayCue</h2><p>ä» &quot;ApplyGameplayEffectToTarget&quot; çš„æºç ä¸­ (åœ¨ &quot;ExecuteGameplayEffect&quot; ä¸­ï¼ŒæœåŠ¡å™¨å°†é€šè¿‡ RPC å¹¿æ’­ GameplayCue çš„åº”ç”¨)ï¼Œæˆ‘ä»¬çŸ¥é“ &quot;GameplayCue&quot; çš„åº”ç”¨å…¶å®å°±æ˜¯é€šè¿‡ &quot;InvokeGameplayCueEvent&quot; æ¥å®Œæˆçš„ï¼Œæ›´å…·ä½“æ¥è¯´æ˜¯ &quot;RouteGameplayCue&quot;ã€‚&quot;Invoke&quot; å¯ä»¥ä½¿ç”¨é¢„è®¾çš„ &quot;GameplayCueTag&quot; æ¥æ‰§è¡Œç›¸å…³çš„æŠ€èƒ½è¡¨ç°ã€‚è€Œ &quot;Invoke&quot; åˆ° &quot;Route&quot; çš„è°ƒç”¨é“¾å®é™…ä¸Šä¹Ÿåªæ˜¯åœ¨åšä¸€äº›å¿…è¦çš„æ¡ä»¶åˆ¤æ–­ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä» &quot;RouteGameplayCue&quot; å¼€å§‹åˆ†æã€‚</p><h3 id="routegameplaycue"><a class="anchor" href="#routegameplaycue">#</a> RouteGameplayCue</h3><p></p><figure class="highlight c++"><figcaption><span>RouteGameplayCue</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameplayCueManager.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UGameplayCueManager::RouteGameplayCue</span><span class="params">(AActor* TargetActor, FGameplayTag GameplayCueTag, EGameplayCueEvent::Type EventType, <span class="keyword">const</span> FGameplayCueParameters&amp; Parameters, EGameplayCueExecutionOptions Options)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WITH_SERVER_CODE</span></span><br><span class="line">	<span class="built_in">QUICK_SCOPE_CYCLE_COUNTER</span>(STAT_GameplayCueManager_RouteGameplayCue);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¦‚æœæˆ‘ä»¬å¸Œæœ›å¿½ç•¥æ¥å£ï¼Œå¯ä»¥å°†æŒ‡é’ˆè®¾ç½®ä¸ºç©º</span></span><br><span class="line">	IGameplayCueInterface* GameplayCueInterface = !(Options &amp; EGameplayCueExecutionOptions::IgnoreInterfaces) ? Cast&lt;IGameplayCueInterface&gt;(TargetActor) : <span class="literal">nullptr</span>;</span><br><span class="line">	<span class="keyword">bool</span> bAcceptsCue = <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">if</span> (GameplayCueInterface)</span><br><span class="line">	&#123;</span><br><span class="line">		bAcceptsCue = GameplayCueInterface-&gt;<span class="built_in">ShouldAcceptGameplayCue</span>(TargetActor, GameplayCueTag, EventType, Parameters);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// ...... çœç•¥ Debug ä»£ç </span></span><br><span class="line"></span><br><span class="line">	CurrentWorld = TargetActor-&gt;<span class="built_in">GetWorld</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å½“ä¸–ç•Œè¢«æ‹†é™¤æˆ–ä¸å­˜åœ¨æ—¶ï¼Œä¸å¤„ç† gameplay cues </span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">GetWorld</span>() || <span class="built_in">GetWorld</span>()-&gt;bIsTearingDown)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å…ˆå¤„ç†å…¨å±€çš„ CueSet ä¸­çš„æŠ€èƒ½æ•ˆæœè¡¨ç°(å¦‚æœæœ‰)</span></span><br><span class="line">	<span class="keyword">if</span> (bAcceptsCue &amp;&amp; !(Options &amp; EGameplayCueExecutionOptions::IgnoreNotifies))</span><br><span class="line">	&#123;</span><br><span class="line">		RuntimeGameplayCueObjectLibrary.CueSet-&gt;<span class="built_in">HandleGameplayCue</span>(TargetActor, GameplayCueTag, EventType, Parameters);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä½¿ç”¨æ¥å£ï¼Œå°½ç®¡å…¶å¯èƒ½ä¸å­˜åœ¨åœ°å›¾ä¸­</span></span><br><span class="line">	<span class="keyword">if</span> (GameplayCueInterface &amp;&amp; bAcceptsCue)</span><br><span class="line">	&#123;</span><br><span class="line">		GameplayCueInterface-&gt;<span class="built_in">HandleGameplayCue</span>(TargetActor, GameplayCueTag, EventType, Parameters);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™æ˜¯ä¸ºäº†å¼ºåˆ¶å®¢æˆ·ç«¯åœ¨ä¸‹ä¸€å¸§é‡æ’­ï¼Œä»¥è®°å½• GC(GameplayCue) çš„ç›®æ ‡ </span></span><br><span class="line">    <span class="comment">// (æ¥è‡ªæœåŠ¡å™¨çš„ ForceNetUpdates å°†ä¸ä¼šè½¬æ¢ä¸ºå®¢æˆ·ç«¯/é‡æ’­ä¸Šçš„ ForceNetUpdates)</span></span><br><span class="line">	TargetActor-&gt;<span class="built_in">ForceNetUpdate</span>();</span><br><span class="line"></span><br><span class="line">	CurrentWorld = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å‡½æ•°ä½“æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯å¤„ç†å…¨å±€ &quot;CueSet&quot; ä¸­ ä»¥åŠä¼ å…¥çš„ &quot;Cue&quot;ï¼Œè™½ç„¶è°ƒç”¨çš„å‡½æ•°åç§°éƒ½æ˜¯ &quot;HandleGameplayCue&quot;ï¼Œä½†å…¶å®å¹¶ä¸æ˜¯åŒä¸€æ¡å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨ä¸‹æ–‡åˆ†æã€‚æœ€åå¼ºåˆ¶ç½‘ç»œæ›´æ–°ã€‚</p><h4 id="cueinterfacehandlegameplaycue"><a class="anchor" href="#cueinterfacehandlegameplaycue">#</a> CueInterface.HandleGameplayCue</h4><p></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameplayCueInterface.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IGameplayCueInterface::HandleGameplayCue</span><span class="params">(UObject* Self, FGameplayTag GameplayCueTag, EGameplayCueEvent::Type EventType, <span class="keyword">const</span> FGameplayCueParameters&amp; Parameters)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">SCOPE_CYCLE_COUNTER</span>(STAT_GameplayCueInterface_HandleGameplayCue);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!Self)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŸ¥æ‰¾æ­¤æ¸¸æˆæ ‡ç­¾çš„è‡ªå®šä¹‰å‡½æ•°</span></span><br><span class="line">	UClass* Class = Self-&gt;<span class="built_in">GetClass</span>();</span><br><span class="line">	FGameplayTagContainer TagAndParentsContainer = GameplayCueTag.<span class="built_in">GetGameplayTagParents</span>();</span><br><span class="line"></span><br><span class="line">	Parameters.OriginalTag = GameplayCueTag;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¯»æ‰¾æ­¤ç±»ä½œä¸º GameplayTag å¯¹åº”çš„æ•ˆæœè¡¨ç°å‡½æ•°åˆ—è¡¨ &quot;FunctionList&quot;</span></span><br><span class="line">	<span class="function">FObjectKey <span class="title">ClassObjectKey</span><span class="params">(Class)</span></span>;</span><br><span class="line">	GameplayCueInterfacePrivate::FGameplayCueTagFunctionList&amp; GameplayTagFunctionList = GameplayCueInterfacePrivate::PerClassGameplayTagToFunctionMap.<span class="built_in">FindOrAdd</span>(ClassObjectKey);</span><br><span class="line">	TArray&lt;GameplayCueInterfacePrivate::FCueNameAndUFunction&gt;* FunctionList = GameplayTagFunctionList.<span class="built_in">Find</span>(GameplayCueTag);</span><br><span class="line">	<span class="keyword">if</span> (FunctionList == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// æ²¡æœ‰åˆ™ç”Ÿæˆæ–°çš„å‡½æ•°åˆ—è¡¨</span></span><br><span class="line">		FunctionList = &amp;GameplayTagFunctionList.<span class="built_in">Add</span>(GameplayCueTag);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†è¯¥å…¶çˆ¶å®¹å™¨ä¸­çš„æ‰€æœ‰ Tag å¯¹åº”çš„æ‰€æœ‰å‡½æ•°ï¼Œä»¥åŠçˆ¶å‡½æ•°æ·»åŠ åˆ°å‡½æ•°åˆ—è¡¨ä¸­</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> InnerTagIt = TagAndParentsContainer.<span class="built_in">CreateConstIterator</span>(); InnerTagIt; ++InnerTagIt)</span><br><span class="line">		&#123;</span><br><span class="line">			UFunction* Func = <span class="literal">NULL</span>;</span><br><span class="line">			FName CueName = InnerTagIt-&gt;<span class="built_in">GetTagName</span>();</span><br><span class="line"></span><br><span class="line">			Func = Class-&gt;<span class="built_in">FindFunctionByName</span>(CueName, EIncludeSuperFlag::IncludeSuper);</span><br><span class="line">			<span class="keyword">while</span> (Func)</span><br><span class="line">			&#123;</span><br><span class="line">				GameplayCueInterfacePrivate::FCueNameAndUFunction NewCueFunctionPair;</span><br><span class="line">				NewCueFunctionPair.Tag = *InnerTagIt;</span><br><span class="line">				NewCueFunctionPair.Func = Func;</span><br><span class="line">				FunctionList-&gt;<span class="built_in">Add</span>(NewCueFunctionPair);</span><br><span class="line"></span><br><span class="line">				Func = Func-&gt;<span class="built_in">GetSuperFunction</span>();</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// æœ¬åœ°å‡½æ•°ä¸èƒ½ç”¨ &quot;.&quot; å‘½åï¼Œæ‰€ä»¥æ”¹ç”¨ &quot;_&quot; æŸ¥æ‰¾</span></span><br><span class="line">			FName NativeCueFuncName = *CueName.<span class="built_in">ToString</span>().<span class="built_in">Replace</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;.&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;_&quot;</span>));</span><br><span class="line">			Func = Class-&gt;<span class="built_in">FindFunctionByName</span>(NativeCueFuncName, EIncludeSuperFlag::IncludeSuper);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">while</span> (Func)</span><br><span class="line">			&#123;</span><br><span class="line">				GameplayCueInterfacePrivate::FCueNameAndUFunction NewCueFunctionPair;</span><br><span class="line">				NewCueFunctionPair.Tag = *InnerTagIt;</span><br><span class="line">				NewCueFunctionPair.Func = Func;</span><br><span class="line">				FunctionList-&gt;<span class="built_in">Add</span>(NewCueFunctionPair);</span><br><span class="line"></span><br><span class="line">				Func = Func-&gt;<span class="built_in">GetSuperFunction</span>();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">check</span>(FunctionList);</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// è¿­ä»£æ‰§è¡Œæ‰€æœ‰å‡½æ•°</span></span><br><span class="line">	<span class="keyword">bool</span> bShouldContinue = <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">for</span> (int32 FunctionIndex = <span class="number">0</span>; bShouldContinue &amp;&amp; (FunctionIndex &lt; FunctionList-&gt;<span class="built_in">Num</span>()); ++FunctionIndex)</span><br><span class="line">	&#123;</span><br><span class="line">		GameplayCueInterfacePrivate::FCueNameAndUFunction&amp; CueFunctionPair = FunctionList-&gt;<span class="built_in">GetData</span>()[FunctionIndex];</span><br><span class="line">		UFunction* Func = CueFunctionPair.Func;</span><br><span class="line">		Parameters.MatchedTagName = CueFunctionPair.Tag;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// é‡ç½®è½¬å‘å‚æ•°ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨å‡½æ•°åè¿›è¡Œæ£€æŸ¥</span></span><br><span class="line">		bForwardToParent = <span class="literal">false</span>;</span><br><span class="line">		IGameplayCueInterface::<span class="built_in">DispatchBlueprintCustomHandler</span>(Self, Func, EventType, Parameters);</span><br><span class="line"></span><br><span class="line">		bShouldContinue = bForwardToParent;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡ç½®å¹¶ç»§ç»­å¤„ç† Sets ä¸­çš„å¸¦æœ‰ &quot;GameplayCueTag&quot; æ ‡ç­¾çš„é€šçŸ¥</span></span><br><span class="line">	<span class="keyword">if</span> (bShouldContinue)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (AActor* SelfActor = Cast&lt;AActor&gt;(Self))</span><br><span class="line">		&#123;</span><br><span class="line">			TArray&lt;UGameplayCueSet*&gt; Sets;</span><br><span class="line">			<span class="built_in">GetGameplayCueSets</span>(Sets);</span><br><span class="line">			<span class="keyword">for</span> (UGameplayCueSet* Set : Sets)</span><br><span class="line">			&#123;</span><br><span class="line">				bShouldContinue = Set-&gt;<span class="built_in">HandleGameplayCue</span>(SelfActor, GameplayCueTag, EventType, Parameters);</span><br><span class="line">				<span class="keyword">if</span> (!bShouldContinue)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»§ç»­å¤„ç†é»˜è®¤ç¨‹åºï¼ŒåŸºç±»ä¸­é»˜è®¤ä¸ºç©º</span></span><br><span class="line">	<span class="keyword">if</span> (bShouldContinue)</span><br><span class="line">	&#123;</span><br><span class="line">		Parameters.MatchedTagName = GameplayCueTag;</span><br><span class="line">		<span class="built_in">GameplayCueDefaultHandler</span>(EventType, Parameters);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>&quot;CueInterface.HandleGameplayCue&quot; çš„å·¥ä½œåœ¨äºç»´æŠ¤ &quot;PerClassGameplayTagFunctionMap&quot; (ä»¥ç±»ä½œä¸ºé”®ï¼Œå‡½æ•°åˆ—è¡¨ä½œä¸ºå€¼çš„ TMap)ï¼Œç„¶åè°ƒç”¨è¯¥åˆ—è¡¨çš„æ‰€æœ‰å‡½æ•°ï¼Œè°ƒç”¨æ­¤æ¥å£ä¸­ &quot;CueSet&quot; çš„æ‰€æœ‰å‡½æ•°ï¼Œæœ€åå¤„ç†é»˜è®¤ç¨‹åºã€‚å¦‚æœæ‰§è¡ŒæœŸé—´å‘ç”Ÿå¤±è´¥ï¼Œå°†åœæ­¢ç»§ç»­æ‰§è¡Œã€‚</p><p>å…¶ä¸­ï¼Œ&quot;DispatchBlueprintCustomHandler&quot; å‡½æ•°åªæ˜¯ç®€å•åˆå§‹åŒ–å‚æ•°åï¼Œè°ƒç”¨ &quot;ProcessEvent&quot; æ‰§è¡Œä¼ å…¥å‡½æ•°ã€‚è€Œç¬¬äºŒå— GameplayCue çš„å¤„ç†ï¼Œå…¶å®å°±æ˜¯åœ¨å¤„ç† &quot;UGameplayCueSet&quot; ä¸­çš„ Cueï¼Œè¿™ä¸ªå…¶å®åœ¨ &quot;RouteGameplayCue&quot; çš„å‡½æ•°è°ƒç”¨é‡Œé¢å’±å°±é‡åˆ°è¿‡äº†ã€‚å’±ç›´æ¥çœ‹çœ‹å‡½æ•°ä½“é‡Œæ˜¯æ€ä¹ˆå®šä¹‰çš„å§ ğŸ˜ƒ</p><h4 id="ugameplaycuesethandlegameplaycue"><a class="anchor" href="#ugameplaycuesethandlegameplaycue">#</a> UGameplayCueSet.HandleGameplayCue</h4><p></p><figure class="highlight c++"><figcaption><span>UGameplayCueSet.HandleGameplayCue</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameplayCueSet.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">UGameplayCueSet::HandleGameplayCue</span><span class="params">(AActor* TargetActor, FGameplayTag GameplayCueTag, EGameplayCueEvent::Type EventType, <span class="keyword">const</span> FGameplayCueParameters&amp; Parameters)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WITH_SERVER_CODE</span></span><br><span class="line">	<span class="built_in">QUICK_SCOPE_CYCLE_COUNTER</span>(STAT_GameplayCueSet_HandleGameplayCue);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// GameplayCueTags å¯ä»¥åœ¨å­—å…¸ä¸­è¢«ç§»é™¤ï¼Œä½†ä¸èƒ½åœ¨å†…å®¹ä¸­ç§»é™¤ã€‚å†…å®¹ä¼šåœ¨ä¸‹æ¬¡ä¿å­˜æ—¶æ¸…ç†æ—§çš„ Tag</span></span><br><span class="line">    <span class="comment">// ä½†å®ƒä»ç„¶å¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡è¿™é‡Œã€‚å› ä¸ºæˆ‘ä»¬ä»…ç”¨å­—å…¸çš„ GameplayCue æ ‡ç­¾æ¥å¡«å…… mapï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œæ‰¾ä¸åˆ°å®ƒ</span></span><br><span class="line">	int32* Ptr = GameplayCueDataMap.<span class="built_in">Find</span>(GameplayCueTag);</span><br><span class="line">	<span class="keyword">if</span> (Ptr &amp;&amp; *Ptr != INDEX_NONE)</span><br><span class="line">	&#123;</span><br><span class="line">		int32 DataIdx = *Ptr;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// TODO - è§£æä¿®æ”¹å‚æ•°çš„å†…éƒ¨å¤„ç†ç¨‹åºï¼Œç„¶åä½¿ç”¨æ–°çš„å¸¸é‡å¼•ç”¨å‚æ•°ä¼ é€’</span></span><br><span class="line">		FGameplayCueParameters writableParameters = Parameters;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">HandleGameplayCueNotify_Internal</span>(TargetActor, DataIdx, EventType, writableParameters);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨ Map ä¸­ï¼ŒæŠŠä¼ å…¥çš„ &quot;GameplayCueTag&quot; å¯¹åº”çš„æ•°æ®ç´¢å¼•æ‰¾åˆ°ï¼Œå¹¶è°ƒç”¨å†…éƒ¨å¤„ç† Cue çš„é€šçŸ¥</p><h4 id="handlegameplaycuenotify_internal"><a class="anchor" href="#handlegameplaycuenotify_internal">#</a> HandleGameplayCueNotify_Internal</h4><p></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameplayCueSet.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">UGameplayCueSet::HandleGameplayCueNotify_Internal</span><span class="params">(AActor* TargetActor, int32 DataIdx, EGameplayCueEvent::Type EventType, FGameplayCueParameters&amp; Parameters)</span></span></span><br><span class="line"><span class="function"></span>&#123;	</span><br><span class="line">	<span class="keyword">bool</span> bReturnVal = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	UGameplayCueManager* CueManager = UAbilitySystemGlobals::<span class="built_in">Get</span>().<span class="built_in">GetGameplayCueManager</span>();</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">ensure</span>(CueManager))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (DataIdx != INDEX_NONE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">check</span>(GameplayCueData.<span class="built_in">IsValidIndex</span>(DataIdx));</span><br><span class="line"></span><br><span class="line">		FGameplayCueNotifyData&amp; CueData = GameplayCueData[DataIdx];</span><br><span class="line"></span><br><span class="line">		Parameters.MatchedTagName = CueData.GameplayCueTag;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¦‚æœå¯¹è±¡æ²¡æœ‰è¢«åŠ è½½</span></span><br><span class="line">		<span class="keyword">if</span> (CueData.LoadedGameplayCueClass == <span class="literal">nullptr</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// ç¡®è®¤ Object æ˜¯å¦å·²åŠ è½½ï¼Œä½†æœªè¿æ¥åˆ°è¿™é‡Œ</span></span><br><span class="line">			CueData.LoadedGameplayCueClass = FindObject&lt;UClass&gt;(<span class="literal">nullptr</span>, *CueData.GameplayCueNotifyObj.<span class="built_in">ToString</span>());</span><br><span class="line">			<span class="keyword">if</span> (CueData.LoadedGameplayCueClass == <span class="literal">nullptr</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (!CueManager-&gt;<span class="built_in">HandleMissingGameplayCue</span>(<span class="keyword">this</span>, CueData, TargetActor, EventType, Parameters))</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">check</span>(CueData.LoadedGameplayCueClass);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¤„ç†æˆ‘ä»¬æ‰¾åˆ°çš„é€šçŸ¥ï¼Œåˆ†åˆ«ä¸º Static å’Œ Actor ç±»å‹</span></span><br><span class="line">        <span class="comment">// Staticç±»å‹é€šçŸ¥ä¸éœ€è¦å®ä¾‹åŒ– é€‚ç”¨äºä¸€æ¬¡æ€§ç¬é—´å‘ç”Ÿçš„æ•ˆæœ</span></span><br><span class="line">        <span class="comment">// Actorç±»å‹é€šçŸ¥éœ€è¦å®ä¾‹åŒ–ï¼Œå¯ä»¥åŒ…å«çŠ¶æ€ï¼Œå¦‚æœéœ€è¦è¿˜å¯ä»¥ tick/update</span></span><br><span class="line">		<span class="keyword">if</span> (UGameplayCueNotify_Static* NonInstancedCue = Cast&lt;UGameplayCueNotify_Static&gt;(CueData.LoadedGameplayCueClass-&gt;ClassDefaultObject))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (NonInstancedCue-&gt;<span class="built_in">HandlesEvent</span>(EventType))</span><br><span class="line">			&#123;</span><br><span class="line">                <span class="comment">// çœŸæ­£è°ƒç”¨æˆ‘ä»¬å®šä¹‰çš„ Cues äº‹ä»¶çš„å‡½æ•°ï¼Œæ ¹æ® EventType è¿›è¡Œé€‰æ‹©ï¼Œæºç çœ‹ä¸‹æ–‡</span></span><br><span class="line">				NonInstancedCue-&gt;<span class="built_in">HandleGameplayCue</span>(TargetActor, EventType, Parameters);</span><br><span class="line">				bReturnVal = <span class="literal">true</span>;</span><br><span class="line">                <span class="comment">// æ²¡æœ‰é‡å†™å…¶ä»– cuesï¼Œåˆ™å¤„ç†çˆ¶ç±»çš„ cue</span></span><br><span class="line">				<span class="keyword">if</span> (!NonInstancedCue-&gt;IsOverride)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">HandleGameplayCueNotify_Internal</span>(TargetActor, CueData.ParentDataIdx, EventType, Parameters);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">HandleGameplayCueNotify_Internal</span>(TargetActor, CueData.ParentDataIdx, EventType, Parameters);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (AGameplayCueNotify_Actor* InstancedCue = Cast&lt;AGameplayCueNotify_Actor&gt;(CueData.LoadedGameplayCueClass-&gt;ClassDefaultObject))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (InstancedCue-&gt;<span class="built_in">HandlesEvent</span>(EventType))</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (TargetActor)</span><br><span class="line">				&#123;</span><br><span class="line">                    <span class="comment">// è·å–å®ä¾‹ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡ç­¾æˆ–è€…å…¶ä»–æ¥å†³å®šæˆ‘ä»¬æ˜¯å¦é‡ç”¨æˆ–å †æ ˆå®ä¾‹</span></span><br><span class="line">                    <span class="comment">// è¿™æ„å‘³ç€éœ€è¦æ›´æ”¹æˆ‘ä»¬çš„æ˜ å°„ä»¥æ‹¥æœ‰ä¸€ä¸ªæ´»è·ƒçš„å®ä¾‹åˆ—è¡¨</span></span><br><span class="line">					AGameplayCueNotify_Actor* SpawnedInstancedCue = CueManager-&gt;<span class="built_in">GetInstancedCueActor</span>(TargetActor, CueData.LoadedGameplayCueClass, Parameters);</span><br><span class="line">					<span class="keyword">if</span> (<span class="built_in">ensure</span>(SpawnedInstancedCue))</span><br><span class="line">					&#123;</span><br><span class="line">                        <span class="comment">// æ­¤å‡½æ•°å’Œ &quot;NonInstanceCue&quot; çš„ç•¥æœ‰ä¸åŒï¼Œå®ä¾‹åŒ–çš„Cueå¯¹è±¡å…·æœ‰çŠ¶æ€</span></span><br><span class="line">                        <span class="comment">// å¦‚: bHasHandledOnActiveEvent, bHasHandledWhileActiveEventç­‰</span></span><br><span class="line">                        <span class="comment">// æˆ‘ä»¬åœ¨è°ƒç”¨æ—¶éœ€è¦åˆ¤æ–­å½“å‰çŠ¶æ€æ˜¯å¦å¯ä»¥æ‰§è¡Œæ­¤Cueï¼Œåœ¨æ‰§è¡ŒCueåè¿˜éœ€è¦è®¾ç½®å¯¹åº”çš„çŠ¶æ€</span></span><br><span class="line">                        <span class="comment">// å¦å¤–ï¼ŒCue çš„ Removed äº‹ä»¶éœ€è¦é”€æ¯æ­¤ Cue å¯¹è±¡å¯ä»¥æŒ‡å®šä¸ºå»¶è¿Ÿé”€æ¯</span></span><br><span class="line">						SpawnedInstancedCue-&gt;<span class="built_in">HandleGameplayCue</span>(TargetActor, EventType, Parameters);</span><br><span class="line">						bReturnVal = <span class="literal">true</span>;</span><br><span class="line">						<span class="keyword">if</span> (!SpawnedInstancedCue-&gt;IsOverride)</span><br><span class="line">						&#123;</span><br><span class="line">							<span class="built_in">HandleGameplayCueNotify_Internal</span>(TargetActor, CueData.ParentDataIdx, EventType, Parameters);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">                <span class="comment">// ç”¨æˆ·è‡ªå®šä¹‰çš„ UGameplayCueNotify</span></span><br><span class="line">				<span class="built_in">HandleGameplayCueNotify_Internal</span>(TargetActor, CueData.ParentDataIdx, EventType, Parameters);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> bReturnVal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä¸éš¾å‘ç°ï¼Œæ­¤å‡½æ•°ä¼šå…ˆè·å– CueManager ä»¥æ£€æŸ¥ object æ˜¯å¦æœªè¢«è¿æ¥è¿›æ¥ã€‚ä¹‹åè¿˜ä¼šç”¨æ­¤ CueManager è·å– CueNotify_Actor å®ä¾‹ï¼Œä»¥è°ƒç”¨å…¶ HandleGameplayCue å‡½æ•° (Actor ç±»å‹ Cue)ã€‚Static ç±»å‹å’Œ Actor ç±»å‹çš„ Cue åœ¨æ­¤å‡½æ•°ä¸­éƒ½æ˜¯è°ƒç”¨ HandleGameplayCue æ¥å¤„ç† Cue è¡¨ç°çš„ã€‚ä½†ä¸¤è€…å¤„ç† Cue çš„æ–¹å¼æ˜¯ä¸å¤ªä¸€æ ·çš„ã€‚Static ç±»å‹å› ä¸ºç”¨çš„æ˜¯ CDO å¯¹è±¡ï¼Œæ‰€ä»¥ä¸å¯ä»¥ Tick/Updateï¼ŒåŒæ—¶ä¹Ÿä¸éœ€è¦ Destroyï¼Œè¿™éœ€è¦è°ƒç”¨ CDO ä¸­é‡å†™çš„å¯¹åº”äº‹ä»¶å³å¯ã€‚è€Œ Actor ç±»å‹å¦‚æœä¸æ‰‹åŠ¨è°ƒç”¨ Remove äº‹ä»¶ï¼Œå…¶å¹¶ä¸ä¼šè‡ªåŠ¨é”€æ¯ï¼Œæ­£å› å¦‚æ­¤ï¼Œæˆ‘ä»¬çš„ CueNotify_Actor å…·æœ‰ CueNotify çš„å„ç§äº‹ä»¶çš„åŒæ—¶ï¼Œè¿˜èƒ½æ ¹æ®å½“å‰çŠ¶æ€åˆ¤æ–­æ˜¯å¦æ‰§è¡Œé€šçŸ¥ï¼Œä¹Ÿå¯ä»¥åº”ç”¨ Cue å¯¹è±¡çš„ Tick/Updateã€‚<strong>æ€»çš„æ¥è¯´ï¼Œå¯¹äºéœ€è¦é•¿æ—¶é—´å­˜åœ¨çš„æŠ€èƒ½æ•ˆæœè¡¨ç°ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶åšæˆ &quot;CueNotify_Actor&quot;ï¼Œè€Œç¬é—´è¡¨ç°åˆ™å¯ä»¥åœ¨éœ€è¦æ—¶ç”¨ CDO è§¦å‘ä¸€æ¬¡å³å¯ã€‚</strong></p><p>æœ€åçš„æœ€åï¼Œå’±å†è¡¥å……ä¸€ä¸‹ &quot;GameplayTag&quot; çš„ç›¸å…³ä»‹ç» (æ„Ÿè§‰è¿˜æ˜¯å¾ˆé‡è¦çš„ï½ï½ï½)</p><hr><h2 id="gameplaytag"><a class="anchor" href="#gameplaytag">#</a> GameplayTag</h2><p>ä¸¥æ ¼æ¥è¯´ï¼Œ&quot;GameplayTag&quot; å…¶å®å¹¶ä¸åªå±äº &quot;GAS&quot;ï¼Œä½†å…¶åœ¨ &quot;GAS&quot; ä¸­èµ·åˆ°çš„ä½œç”¨å¾ˆå¤§ã€‚ä»¥ä¸‹å†™è€…ä¼šå…ˆä»‹ç» &quot;GameplayTag&quot;ï¼Œç„¶åè§£æå…¶åœ¨ &quot;GAS&quot; ä¸­çš„ä½œç”¨ã€‚è¯ä¸å¤šè¯´ï¼Œå¼€å†²ï¼</p><h3 id="fgameplaytag"><a class="anchor" href="#fgameplaytag">#</a> FGameplayTag</h3><p>ç›´è¯‘ä¸º &quot;æ¸¸æˆæ ‡ç­¾&quot;ï¼Œå­˜åœ¨ &quot;FGameplayTagContainer&quot; ä¸­ï¼Œç”± &quot;UGameplayTagsManager&quot; ç»Ÿä¸€ç®¡ç†ã€‚è¿™å‡ ä¸ªç±»éƒ½æ¯”è¾ƒé‡è¦ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢ä¸€ä¸€ä»‹ç»ï¼Œè«æ€¥ã€‚</p><p></p><figure class="highlight c++"><figcaption><span>FGameplayTag</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameplayTagContainer.h</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">USTRUCT</span>(BlueprintType, meta = (HasNativeMake = <span class="string">&quot;GameplayTags.BlueprintGameplayTagLibrary.MakeLiteralGameplayTag&quot;</span>, HasNativeBreak = <span class="string">&quot;GameplayTags.BlueprintGameplayTagLibrary.GetTagName&quot;</span>, DisableSplitPin))</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GAMEPLAYTAGS_API</span> <span class="title">FGameplayTag</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="built_in">GENERATED_USTRUCT_BODY</span>()</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Constructors */</span></span><br><span class="line">	<span class="built_in">FGameplayTag</span>()</span><br><span class="line">	&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * è·å–æ­¤ TagName å¯¹åº”çš„ FGameplayTagï¼Œæœªæ‰¾åˆ°åˆ™è¿”å›ç©º Tag</span></span><br><span class="line"><span class="comment">	 * @param ErrorIfNotFound æœªæ‰¾åˆ°å¯¹åº” Tag æ˜¯å¦æŠ¥é”™</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> FGameplayTag <span class="title">RequestGameplayTag</span><span class="params">(<span class="keyword">const</span> FName&amp; TagName, <span class="keyword">bool</span> ErrorIfNotFound=<span class="literal">true</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * &quot;TagString&quot; æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ GameplayTag å­—ç¬¦ä¸²(å¦‚:foo.bar.baz)ï¼Œå¦‚æœå¯ä»¥è¢«åŠ å…¥ Tag å­—å…¸ä¸­åˆ™è¿”å›çœŸï¼Œå¦åˆ™è¿”å›å‡</span></span><br><span class="line"><span class="comment">	 * &quot;TagString&quot; å¦‚æœä¸ºæ— æ•ˆçš„å­—ç¬¦ä¸²ï¼Œæ­¤å‡½æ•°è¿”å›å‡çš„åŒæ—¶ï¼Œå°è¯•å°†éæ³•å­—ç¬¦ä¸²ä¿®æ”¹ä¸º &quot;_&quot;ï¼Œå¹¶é€šè¿‡ &quot;OutFixedString&quot; è¿”å›</span></span><br><span class="line"><span class="comment">	 * &quot;OutError&quot; ä¸ºå­—ç¬¦ä¸²æ— æ•ˆæ—¶ï¼Œè¾“å‡ºçš„é”™è¯¯æç¤ºä¿¡æ¯</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">IsValidGameplayTagString</span><span class="params">(<span class="keyword">const</span> FString&amp; TagString, FText* OutError = <span class="literal">nullptr</span>, FString* OutFixedString = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Operators */</span></span><br><span class="line">	FORCEINLINE <span class="keyword">bool</span> <span class="keyword">operator</span>==(FGameplayTag <span class="keyword">const</span>&amp; Other) <span class="keyword">const</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> TagName == Other.TagName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	FORCEINLINE <span class="keyword">bool</span> <span class="keyword">operator</span>!=(FGameplayTag <span class="keyword">const</span>&amp; Other) <span class="keyword">const</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> TagName != Other.TagName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	FORCEINLINE <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(FGameplayTag <span class="keyword">const</span>&amp; Other) <span class="keyword">const</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> TagName.<span class="built_in">LexicalLess</span>(Other.TagName);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * è¡¨æ˜æ­¤ Tag æ˜¯å¦ä¸ &quot;TagToCheck&quot; åŒ¹é…ï¼Œå¯ä»¥åªåŒ¹é…çˆ¶æ ‡ç­¾ï¼Œä½†ä¸èƒ½åŒ¹é…å­æ ‡ç­¾</span></span><br><span class="line"><span class="comment">	 * å¦‚ &quot;A.1&quot;.MatchesTag(&quot;A&quot;) è¿”å›çœŸï¼Œä½† &quot;A&quot;.MatchesTag(&quot;A.1&quot;) åˆ™è¿”å›å‡</span></span><br><span class="line"><span class="comment">	 * å¦‚æœ &quot;TagToCheck&quot; æ— æ•ˆä¹Ÿå°†è¿”å›å‡</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">MatchesTag</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; TagToCheck)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * è¡¨æ˜ &quot;TagToCheck&quot; æœ‰æ•ˆä¸”å®Œå…¨åŒ¹é…æ­¤ &quot;Tag&quot;ï¼Œä¸æ”¯æŒåªåŒ¹é…çˆ¶æ ‡ç­¾</span></span><br><span class="line"><span class="comment">	 * å¦‚ &quot;A.1&quot;.MatchesTag(&quot;A&quot;) è¿”å›å‡ï¼Œ&quot;A.1&quot;.MatchesTag(&quot;A.1&quot;) è¿”å›çœŸ</span></span><br><span class="line"><span class="comment">	 * å¦‚æœ &quot;TagToCheck&quot; æ— æ•ˆä¹Ÿå°†è¿”å›å‡</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">FORCEINLINE <span class="keyword">bool</span> <span class="title">MatchesTagExact</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; TagToCheck)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!TagToCheck.<span class="built_in">IsValid</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// Only check check explicit tag list</span></span><br><span class="line">		<span class="keyword">return</span> TagName == TagToCheck.TagName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * æ£€æŸ¥ä¸¤ä¸ª FGameplayTags åŒ¹é…åº¦å¦‚ä½•ï¼Œå€¼è¶Šå¤§åŒ¹é…åº¦è¶Šé«˜ </span></span><br><span class="line"><span class="comment">	 * (è¿”å›å€¼ä¸º ä¿©Tag çš„è‡ªèº«ä»¥åŠçˆ¶ç±»æ ‡ç­¾çš„å®Œå…¨åŒ¹é…æ•°é‡) </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">int32 <span class="title">MatchesTagDepth</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; TagToCheck)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æ£€æŸ¥æ­¤ Tag æ˜¯å¦åŒ¹é…ç‰¹å®šå®¹å™¨ä¸­çš„ä»»ä¸€ Tagï¼Œæˆ–è€…ä¸ºä»»ä¸€ Tag çš„å­æ ‡ç­¾</span></span><br><span class="line"><span class="comment">	 * å¦‚: &quot;A.1&quot;.MatchesAny(&#123;&quot;A&quot;,&quot;B&quot;&#125;) è¿”å›çœŸï¼Œ &quot;A&quot;.MatchesAny(&#123;&quot;A.1&quot;,&quot;B&quot;&#125;) è¿”å›å‡</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">MatchesAny</span><span class="params">(<span class="keyword">const</span> FGameplayTagContainer&amp; ContainerToCheck)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ£€æŸ¥æ­¤ Tag æ˜¯å¦å®Œå…¨åŒ¹é…ç‰¹å®šå®¹å™¨ä¸­çš„ä»»ä¸€ Tag */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">MatchesAnyExact</span><span class="params">(<span class="keyword">const</span> FGameplayTagContainer&amp; ContainerToCheck)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å›æ­¤ Tag æ˜¯å¦æœ‰æ•ˆ */</span></span><br><span class="line">	<span class="function">FORCEINLINE <span class="keyword">bool</span> <span class="title">IsValid</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (TagName != NAME_None);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å›æ­¤åŒ…å«æ­¤ Tag çš„ TagContainer çš„å¼•ç”¨ã€‚å®é™…ä¸Šæ˜¯è¿”å›æ­¤ Tag å¯¹åº”çš„ TagNode çš„å®¹å™¨ï¼ŒGameplayTags åªåŒ…å«è‡ªèº«ï¼ŒParentTags ä¹ŸåªåŒ…å«è‡ªèº«çš„çˆ¶æ ‡ç­¾ */</span></span><br><span class="line">	<span class="function"><span class="keyword">const</span> FGameplayTagContainer&amp; <span class="title">GetSingleTagContainer</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å›æ­¤ Tag ç›´æ¥çˆ¶æ ‡ç­¾ï¼Œå¦‚: x.y.z è¿”å› y */</span></span><br><span class="line">	<span class="function">FGameplayTag <span class="title">RequestDirectParent</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å›æ˜¾å¼åŒ…å«æ­¤ Tag çš„æ–°å®¹å™¨ */</span></span><br><span class="line">	<span class="function">FGameplayTagContainer <span class="title">GetGameplayTagParents</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æ„çš„ TMap */</span></span><br><span class="line">	<span class="function">FORCEINLINE <span class="keyword">friend</span> uint32 <span class="title">GetTypeHash</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; Tag)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> ::<span class="built_in">GetTypeHash</span>(Tag.TagName);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ä»¥å­—ç¬¦ä¸²çš„å½¢å¼æ˜¾ç¤º GameplayTagï¼Œç”¨äºè“å›¾ */</span></span><br><span class="line">	<span class="function">FORCEINLINE FString <span class="title">ToString</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> TagName.<span class="built_in">ToString</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è·å–ä»£è¡¨æ­¤ Tag çš„åç§°(é€šè¿‡æ­¤åç§°å¯ä»¥è·å– Tag ) */</span></span><br><span class="line">	<span class="function">FORCEINLINE FName <span class="title">GetTagName</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> TagName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">void</span> <span class="keyword">operator</span>&lt;&lt;(FStructuredArchive::FSlot Slot, FGameplayTag&amp; GameplayTag)</span><br><span class="line">	&#123;</span><br><span class="line">		Slot &lt;&lt; GameplayTag.TagName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** é‡å†™ä»¥è·å¾—æ›´å¿«åœ°åºåˆ—åŒ– */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">NetSerialize</span><span class="params">(FArchive&amp; Ar, class UPackageMap* Map, <span class="keyword">bool</span>&amp; bOutSuccess)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å¤„ç†ä¿®æ­£å’Œé”™è¯¯ã€‚åªåœ¨æ²¡æœ‰å®Œå…¨åºåˆ—åŒ– FGameplayTagContainer æ—¶è°ƒç”¨ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">PostSerialize</span><span class="params">(<span class="keyword">const</span> FArchive&amp; Ar)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">NetSerialize_Packed</span><span class="params">(FArchive&amp; Ar, class UPackageMap* Map, <span class="keyword">bool</span>&amp; bOutSuccess)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ç”¨äºå°†åç§°å±æ€§å‡çº§ GameplayTag ç»“æ„å±æ€§ */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">SerializeFromMismatchedTag</span><span class="params">(<span class="keyword">const</span> FPropertyTag&amp; Tag, FStructuredArchive::FSlot Slot)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ä½¿ç”¨ ImportText string(å¯¼å…¥å­—ç¬¦ä¸²) è®¾ç½®ï¼Œåœ¨æ³¨å†Œèµ„æºæ—¶ä½¿ç”¨ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">FromExportString</span><span class="params">(<span class="keyword">const</span> FString&amp; ExportString, int32 PortFlags = <span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å¤„ç†å¯¼å…¥æ ‡ç­¾å­—ç¬¦ä¸² */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ImportTextItem</span><span class="params">(<span class="keyword">const</span> TCHAR*&amp; Buffer, int32 PortFlags, UObject* Parent, FOutputDevice* ErrorText)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ç©ºæ ‡ç­¾ */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">const</span> FGameplayTag EmptyTag;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// DEPRECATED (å·²å¼ƒç”¨)</span></span><br><span class="line"></span><br><span class="line">PRAGMA_DISABLE_DEPRECATION_WARNINGS</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ£€æŸ¥ä¸¤ä¸ª FGameplayTags æ˜¯å¦ä¸æ˜¾å¼åŒ¹é…ç±»å‹åŒ¹é… */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.15</span>, <span class="string">&quot;Deprecated in favor of MatchesTag&quot;</span>)</span><br><span class="line">	<span class="function">FORCEINLINE_DEBUGGABLE <span class="keyword">bool</span> <span class="title">Matches</span><span class="params">(TEnumAsByte&lt;EGameplayTagMatchType::Type&gt; MatchTypeOne, <span class="keyword">const</span> FGameplayTag&amp; Other, TEnumAsByte&lt;EGameplayTagMatchType::Type&gt; MatchTypeTwo)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">bool</span> bResult = <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (MatchTypeOne == EGameplayTagMatchType::Explicit &amp;&amp; MatchTypeTwo == EGameplayTagMatchType::Explicit)</span><br><span class="line">		&#123;</span><br><span class="line">			bResult = TagName == Other.TagName;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			bResult = <span class="built_in">ComplexMatches</span>(MatchTypeOne, Other, MatchTypeTwo);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> bResult;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/** æ£€æŸ¥ä¸¤ä¸ª Tag æ˜¯å¦åŒ¹é… */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.15</span>, <span class="string">&quot;Deprecated in favor of MatchesTag&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ComplexMatches</span><span class="params">(TEnumAsByte&lt;EGameplayTagMatchType::Type&gt; MatchTypeOne, <span class="keyword">const</span> FGameplayTag&amp; Other, TEnumAsByte&lt;EGameplayTagMatchType::Type&gt; MatchTypeTwo)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">PRAGMA_ENABLE_DEPRECATION_WARNINGS</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ•…æ„ç§æœ‰ï¼Œä»¥ä¾¿åªæœ‰ TagManager å¯ä»¥ä½¿ç”¨ */</span></span><br><span class="line">	<span class="function"><span class="keyword">explicit</span> <span class="title">FGameplayTag</span><span class="params">(<span class="keyword">const</span> FName&amp; InTagName)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ­¤æ ‡ç­¾åç§° */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(VisibleAnywhere, Category = GameplayTags, SaveGame)</span><br><span class="line">	FName TagName;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">UGameplayTagsManager</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">FGameplayTagRedirectors</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">FNativeGameplayTag</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">struct</span> <span class="title">FGameplayTagContainer</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">struct</span> <span class="title">FGameplayTagNode</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œå®é™…ä¸Šåªæ˜¯æ‹¥æœ‰ &quot;TagName&quot; ä¸”æ”¯æŒåå°„ä»¥åŠå¯¹ &quot;TagName&quot; çš„å„ç§æŸ¥è¯¢ï¼Œæ¯”è¾ƒçš„ç»“æ„ä½“è€Œå·²ã€‚åº”è¯¥ä¸éš¾ç†è§£ï¼Œä¸è¿‡é¡ºä¾¿æä¸€ä¸‹ï¼Œ&quot;FGameplayTag&quot; ä¸­çš„å‡½æ•°åŸºæœ¬ä¸Šéƒ½æ˜¯ä½¿ç”¨ &quot;TagManager&quot; å®ç°çš„ (åºŸè¯)</p><h3 id="fgameplaytagcontainer"><a class="anchor" href="#fgameplaytagcontainer">#</a> FGameplayTagContainer</h3><p>ç±»å¦‚å…¶åï¼Œå®è´¨ä¸Šå°±æ˜¯è£…è½½ GameplayTag çš„å®¹å™¨ (å…¶ä¸­åŒ…å«æ˜¾å¼æ·»åŠ çš„æ ‡ç­¾ï¼Œä»¥åŠéšå¼æ·»åŠ çš„å­æ ‡ç­¾)ï¼Œä»¥åŠæ“ä½œæ­¤å®¹å™¨çš„æ–¹æ³•ï¼Œç›´æ¥ä¸Šç ã€‚</p><p></p><figure class="highlight c++"><figcaption><span>FGameplayTagContainer</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameplayTagContainer.h</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">USTRUCT</span>(BlueprintType, meta = (HasNativeMake = <span class="string">&quot;GameplayTags.BlueprintGameplayTagLibrary.MakeGameplayTagContainerFromArray&quot;</span>, HasNativeBreak = <span class="string">&quot;GameplayTags.BlueprintGameplayTagLibrary.BreakGameplayTagContainer&quot;</span>))</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GAMEPLAYTAGS_API</span> <span class="title">FGameplayTagContainer</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="built_in">GENERATED_USTRUCT_BODY</span>()</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Constructors */</span></span><br><span class="line">	<span class="built_in">FGameplayTagContainer</span>()</span><br><span class="line">	&#123;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** æ˜¾å¼è°ƒç”¨ï¼Œä»¥é¿å…æ„å¤–çš„é”™è¯¯ç±»å‹ */</span></span><br><span class="line">	<span class="function"><span class="keyword">explicit</span> <span class="title">FGameplayTagContainer</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; Tag)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">AddTag</span>(Tag);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ..... çœç•¥å¤åˆ¶æ„é€ å‡½æ•°ï¼Œç§»åŠ¨æ„é€ å‡½æ•°ï¼Œç©ºçš„ææ„å‡½æ•°</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** ä½¿ç”¨ &quot;FGameplayTag&quot; æ•°ç»„åˆ›å»º Tag å®¹å™¨ï¼Œåˆ™æ¯”åˆ†åˆ«ç‹¬è‡ªæ·»åŠ æ¯ä¸€é¡¹æ›´é«˜æ•ˆ */</span></span><br><span class="line">	<span class="function"><span class="keyword">template</span>&lt;class AllocatorType&gt;</span></span><br><span class="line"><span class="function">	<span class="keyword">static</span> FGameplayTagContainer <span class="title">CreateFromArray</span><span class="params">(<span class="keyword">const</span> TArray&lt;FGameplayTag, AllocatorType&gt;&amp; SourceTags)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** èµ‹å€¼/ç›¸ç­‰ ç¬¦å·é‡è½½ */</span></span><br><span class="line">	FGameplayTagContainer&amp; <span class="keyword">operator</span>=(FGameplayTagContainer <span class="keyword">const</span>&amp; Other);</span><br><span class="line">	FGameplayTagContainer&amp; <span class="keyword">operator</span>=(FGameplayTagContainer&amp;&amp; Other);</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span>==(FGameplayTagContainer <span class="keyword">const</span>&amp; Other) <span class="keyword">const</span>;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span>!=(FGameplayTagContainer <span class="keyword">const</span>&amp; Other) <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¡¨æ˜æ­¤å®¹å™¨æ˜¯å¦åŒ…å«æŸä¸ªæ ‡ç­¾ï¼ŒåªåŒ…å«è¯¥æ ‡ç­¾çš„çˆ¶æ ‡ç­¾äº¦å¯ */</span></span><br><span class="line">	<span class="function">FORCEINLINE_DEBUGGABLE <span class="keyword">bool</span> <span class="title">HasTag</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; TagToCheck)</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** è¡¨æ˜æ­¤å®¹å™¨æ˜¯å¦ç²¾ç¡®åŒ…å«æŸä¸ªæ ‡ç­¾ï¼Œä¸å¯åªåŒ…å«è¯¥æ ‡ç­¾çš„çˆ¶æ ‡ç­¾ */</span></span><br><span class="line">	<span class="function">FORCEINLINE_DEBUGGABLE <span class="keyword">bool</span> <span class="title">HasTagExact</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; TagToCheck)</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥ä¼ å…¥å®¹å™¨æ˜¯å¦æ‹¥æœ‰æ­¤å®¹å™¨çš„ä»»ä¸€æ ‡ç­¾æˆ–çˆ¶æ ‡ç­¾</span></span><br><span class="line"><span class="comment">     * å¦‚: &#123;&quot;A.1&quot;&#125;.HasAny(&#123;&quot;A&quot;,&quot;B&quot;&#125;) è¿”å›çœŸï¼Œ&#123;&quot;A&quot;&#125;.HasAny(&#123;&quot;A.1&quot;,&quot;B&quot;&#125;) è¿”å›å‡</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">FORCEINLINE_DEBUGGABLE <span class="keyword">bool</span> <span class="title">HasAny</span><span class="params">(<span class="keyword">const</span> FGameplayTagContainer&amp; ContainerToCheck)</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** æ£€æŸ¥ä¼ å…¥å®¹å™¨æ˜¯å¦ç¡®åˆ‡æ‹¥æœ‰æ­¤å®¹å™¨çš„ä»»ä¸€æ ‡ç­¾æˆ–çˆ¶æ ‡ç­¾ */</span></span><br><span class="line">	<span class="function">FORCEINLINE_DEBUGGABLE <span class="keyword">bool</span> <span class="title">HasAnyExact</span><span class="params">(<span class="keyword">const</span> FGameplayTagContainer&amp; ContainerToCheck)</span> <span class="keyword">const</span></span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/** æ£€æŸ¥ä¼ å…¥å®¹å™¨æ˜¯å¦æ‹¥æœ‰æ­¤å®¹å™¨çš„æ‰€æœ‰æ ‡ç­¾æˆ–çˆ¶æ ‡ç­¾ */</span></span><br><span class="line">	<span class="function">FORCEINLINE_DEBUGGABLE <span class="keyword">bool</span> <span class="title">HasAll</span><span class="params">(<span class="keyword">const</span> FGameplayTagContainer&amp; ContainerToCheck)</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** æ£€æŸ¥ä¼ å…¥å®¹å™¨æ˜¯å¦ç¡®åˆ‡æ‹¥æœ‰æ­¤å®¹å™¨çš„æ‰€æœ‰æ ‡ç­¾æˆ–çˆ¶æ ‡ç­¾ */</span></span><br><span class="line">	<span class="function">FORCEINLINE_DEBUGGABLE <span class="keyword">bool</span> <span class="title">HasAllExact</span><span class="params">(<span class="keyword">const</span> FGameplayTagContainer&amp; ContainerToCheck)</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** è¿”å›æ˜¾å¼æ·»åŠ çš„ Tags çš„æ•°é‡ */</span></span><br><span class="line">	<span class="function">FORCEINLINE int32 <span class="title">Num</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> GameplayTags.<span class="built_in">Num</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ­¤å®¹å™¨æ˜¯å¦æ‹¥æœ‰ä»»æ„æœ‰æ•ˆæ ‡ç­¾ */</span></span><br><span class="line">	<span class="function">FORCEINLINE <span class="keyword">bool</span> <span class="title">IsValid</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> GameplayTags.<span class="built_in">Num</span>() &gt; <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ­¤å®¹å™¨æ˜¯å¦ä¸ºç©º */</span></span><br><span class="line">	<span class="function">FORCEINLINE <span class="keyword">bool</span> <span class="title">IsEmpty</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> GameplayTags.<span class="built_in">Num</span>() == <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å›æ‹¥æœ‰æ­¤å®¹å™¨æ‰€æœ‰æ ‡ç­¾ä»¥åŠæ‰€æœ‰çˆ¶æ ‡ç­¾çš„æ–°å®¹å™¨ */</span></span><br><span class="line">	<span class="function">FGameplayTagContainer <span class="title">GetGameplayTagParents</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å›æ­¤å®¹å™¨çš„è¿‡æ»¤å™¨ç‰ˆæœ¬ï¼ŒåªåŒ…å«ä¼ å…¥å®¹å™¨ä¸­æ‹¥æœ‰çš„æ‰€æœ‰æ ‡ç­¾æˆ–å…¶å­æ ‡ç­¾ */</span></span><br><span class="line">	<span class="function">FGameplayTagContainer <span class="title">Filter</span><span class="params">(<span class="keyword">const</span> FGameplayTagContainer&amp; OtherContainer)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å›æ­¤å®¹å™¨çš„è¿‡æ»¤å™¨ç‰ˆæœ¬ï¼ŒåªåŒ…å«ä¼ å…¥å®¹å™¨ä¸­æ‹¥æœ‰çš„æ‰€æœ‰æ ‡ç­¾ */</span></span><br><span class="line">	<span class="function">FGameplayTagContainer <span class="title">FilterExact</span><span class="params">(<span class="keyword">const</span> FGameplayTagContainer&amp; OtherContainer)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ£€æŸ¥æ­¤å®¹å™¨æ˜¯å¦ä¸ç»™å®šæŸ¥è¯¢åŒ¹é…(å…¶ä¸­åŒ…å«ä»»æ„æ ‡ç­¾åŒ¹é…ï¼Œæ‰€æœ‰æ ‡ç­¾åŒ¹é…ï¼Œæ‰€æœ‰æ ‡ç­¾ä¸åŒ¹é…ï¼Œä»¥åŠå…¶ç²¾ç¡®ç‰ˆæœ¬) */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">MatchesQuery</span><span class="params">(<span class="keyword">const</span> struct FGameplayTagQuery&amp; Query)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å°†ä¼ å…¥æ ‡ç­¾å®¹å™¨çš„æ‰€æœ‰æ ‡ç­¾æ·»åŠ åˆ°æ­¤å®¹å™¨ä¸­ (ä¸æ·»åŠ é‡å¤çš„) */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AppendTags</span><span class="params">(FGameplayTagContainer <span class="keyword">const</span>&amp; Other)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * éå† A å®¹å™¨çš„æ˜¾å¼æ·»åŠ æ ‡ç­¾(GameplayTags)ï¼Œå¦‚æœè¯¥æ ‡ç­¾æˆ–å…¶çˆ¶æ ‡ç­¾ä¸ B ä¸­çš„ä»»æ„æ ‡ç­¾åŒ¹é…ï¼Œå°†è¯¥æ ‡ç­¾æ·»åŠ åˆ°æ­¤å®¹å™¨ä¸­</span></span><br><span class="line"><span class="comment">	 * å¦‚æœä½ æƒ³è¦ç²¾ç¡®åŒ¹é…ï¼Œéœ€è¦å…ˆè°ƒç”¨ A.FilterExact(B) è·å– A å’Œ B çš„äº¤é›†</span></span><br><span class="line"><span class="comment">	 * å¦‚æœä½ æƒ³è¦ A å’Œ B çš„è¡¥é›†ï¼Œå…ˆè°ƒç”¨ AppendTags åˆ›å»ºå¹¶é›† Unionï¼Œå†è°ƒç”¨ FilterExact åˆ›å»ºäº¤é›† Intersectionï¼Œç„¶åè°ƒç”¨ Union.RemoveTag(Intersection)å³å¯</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AppendMatchingTags</span><span class="params">(FGameplayTagContainer <span class="keyword">const</span>&amp; OtherA, FGameplayTagContainer <span class="keyword">const</span>&amp; OtherB)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å‘æ­¤å®¹å™¨ä¸­æ·»åŠ ç‰¹å®šçš„æ ‡ç­¾(ä¸é‡å¤æ·»åŠ ï¼Œä¸”éšå¼æ·»åŠ å…¶æ‰€æœ‰çˆ¶æ ‡ç­¾åˆ° ParentTags ä¸­) */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddTag</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; TagToAdd)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * å‘æ­¤å®¹å™¨ä¸­æ·»åŠ ç‰¹å®šçš„æ ‡ç­¾(éšå¼æ·»åŠ å…¶æ‰€æœ‰çˆ¶æ ‡ç­¾åˆ° ParentTags ä¸­)</span></span><br><span class="line"><span class="comment">	 * ä¸å¯¹ TagToAdd åšæœ‰æ•ˆæ€§æ£€æŸ¥ï¼Œä¸”å¯èƒ½æ·»åŠ é‡å¤çš„ Tagï¼Œ</span></span><br><span class="line"><span class="comment">	 * æ­¤å‡½æ•°å¿…é¡»åœ¨ç¡®ä¿æ— è¯¯çš„æƒ…å†µä¸‹è°ƒç”¨ï¼Œä»¥æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddTagFast</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; TagToAdd)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æ·»åŠ æ ‡ç­¾åˆ°æ­¤å®¹å™¨ä¸­ï¼Œå¹¶ç§»é™¤æ­¤å®¹å™¨ä¸­çš„è¯¥æ ‡ç­¾çš„æ‰€æœ‰çˆ¶æ ‡ç­¾ï¼Œ</span></span><br><span class="line"><span class="comment">	 * å¦‚æœæ­¤å®¹å™¨ä¸­å·²åŒ…å«ä¼ å…¥æ ‡ç­¾çš„å­æ ‡ç­¾ï¼Œåˆ™ä¸æ·»åŠ ä¸”è¿”å›å‡</span></span><br><span class="line"><span class="comment">	 * @return æ ‡ç­¾æˆåŠŸæ·»åŠ è¿”å›çœŸ</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">AddLeafTag</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; TagToAdd)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ä»æ­¤å®¹å™¨ä¸­ç§»é™¤æ ‡ç­¾</span></span><br><span class="line"><span class="comment">	 * @param TagToRemove		éœ€è¦ä»æ­¤å®¹å™¨ä¸­ç§»é™¤çš„æ ‡ç­¾</span></span><br><span class="line"><span class="comment">	 * @param bDeferParentTags	æ˜¯å¦è·³è¿‡è°ƒç”¨ FillParentTags (é‡æ–°è®¡ç®—ParentsTags)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">RemoveTag</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; TagToRemove, <span class="keyword">bool</span> bDeferParentTags=<span class="literal">false</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ç§»é™¤ TagsToRemove ä¸­çš„æ‰€æœ‰æ ‡ç­¾ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RemoveTags</span><span class="params">(<span class="keyword">const</span> FGameplayTagContainer&amp; TagsToRemove)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ç§»é™¤æ­¤å®¹å™¨ä¸­çš„æ‰€æœ‰æ ‡ç­¾*/</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Reset</span><span class="params">(int32 Slack = <span class="number">0</span>)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">Serialize</span><span class="params">(FStructuredArchive::FSlot Slot)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">NetSerialize</span><span class="params">(FArchive&amp; Ar, class UPackageMap* Map, <span class="keyword">bool</span>&amp; bOutSuccess)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ImportTextItem</span><span class="params">(<span class="keyword">const</span> TCHAR*&amp; Buffer, int32 PortFlags, UObject* Parent, FOutputDevice* ErrorText)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">PostScriptConstruct</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">FString <span class="title">ToString</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">FromExportString</span><span class="params">(<span class="keyword">const</span> FString&amp; ExportString, int32 PortFlags = <span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ä»¥å¯è¯»æ€§é«˜çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œè¿”å›æ­¤å®¹å™¨ä¸­çš„æ‰€æœ‰æ˜¾å¼æ·»åŠ çš„æ ‡ç­¾ */</span></span><br><span class="line">	<span class="function">FString <span class="title">ToStringSimple</span><span class="params">(<span class="keyword">bool</span> bQuoted = <span class="literal">false</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ¯ä¸ªæ ‡ç­¾çš„å­—ç¬¦ä¸²ç±»å‹ä½œä¸ºå…ƒç´ æ·»åŠ åˆ°æ•°ç»„ä¸­å¹¶è¿”å› */</span></span><br><span class="line">	<span class="function">TArray&lt;FString&gt; <span class="title">ToStringsMaxLen</span><span class="params">(int32 MaxLen)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ä»¥æ–‡æœ¬å½¢å¼è¿”å›ç‰¹å®šæŸ¥è¯¢ç±»å‹ä¸‹çš„æ‰€æœ‰ç¬¦åˆçš„æ ‡ç­¾ */</span></span><br><span class="line">	<span class="function">FText <span class="title">ToMatchingText</span><span class="params">(EGameplayContainerMatchType MatchType, <span class="keyword">bool</span> bInvertCondition)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è·å–æ˜¾å¼æ·»åŠ çš„ Tags */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">GetGameplayTagArray</span><span class="params">(TArray&lt;FGameplayTag&gt;&amp; InOutGameplayTags)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		InOutGameplayTags = GameplayTags;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ä¸ºæ­¤æ•°ç»„å†…å®¹åˆ›å»ºå¸¸é‡è¿­ä»£å™¨ */</span></span><br><span class="line">	TArray&lt;FGameplayTag&gt;::<span class="function">TConstIterator <span class="title">CreateConstIterator</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> GameplayTags.<span class="built_in">CreateConstIterator</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsValidIndex</span><span class="params">(int32 Index)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> GameplayTags.<span class="built_in">IsValidIndex</span>(Index);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">FGameplayTag <span class="title">GetByIndex</span><span class="params">(int32 Index)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">IsValidIndex</span>(Index))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> GameplayTags[Index];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">FGameplayTag</span>();</span><br><span class="line">	&#125;	</span><br><span class="line"></span><br><span class="line">	<span class="function">FGameplayTag <span class="title">First</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> GameplayTags.<span class="built_in">Num</span>() &gt; <span class="number">0</span> ? GameplayTags[<span class="number">0</span>] : <span class="built_in">FGameplayTag</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">FGameplayTag <span class="title">Last</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> GameplayTags.<span class="built_in">Num</span>() &gt; <span class="number">0</span> ? GameplayTags.<span class="built_in">Last</span>() : <span class="built_in">FGameplayTag</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ç”¨ GemeplayTags è®¡ç®—å¹¶å¡«å…… ParentTags */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">FillParentTags</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ç©º Tag å®¹å™¨ */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">const</span> FGameplayTagContainer EmptyContainer;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ...... çœç•¥å¼ƒç”¨å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å¦‚æœæ­¤å®¹å™¨ä»¥æŸç§åŒ¹é…æ–¹å¼ï¼ŒåŒ¹é…å¦ä¸€å®¹å™¨çš„æ ‡ç­¾ï¼Œåˆ™è¿”å›çœŸ</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param OtherContainer		éœ€è¦ç­›é€‰çš„å®¹å™¨</span></span><br><span class="line"><span class="comment">	 * @param TagMatchType			åº”ç”¨äºæ­¤å®¹å™¨ä¸­çš„åŒ¹é…æ–¹å¼(æ˜¯å¦åŒ…å«çˆ¶ç±»)</span></span><br><span class="line"><span class="comment">	 * @param OtherTagMatchType		åº”ç”¨äºå¦ä¸€å®¹å™¨ä¸­çš„åŒ¹é…æ–¹å¼(æ˜¯å¦åŒ…å«çˆ¶ç±»)</span></span><br><span class="line"><span class="comment">	 * @param ContainerMatchType	ç”¨äºç­›é€‰çš„æ–¹å¼(Any, All)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">DoesTagContainerMatchComplex</span><span class="params">(<span class="keyword">const</span> FGameplayTagContainer&amp; OtherContainer, TEnumAsByte&lt;EGameplayTagMatchType::Type&gt; TagMatchType, TEnumAsByte&lt;EGameplayTagMatchType::Type&gt; OtherTagMatchType, EGameplayContainerMatchType ContainerMatchType)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ç§»é™¤ GameplayTags ä¸­åç§°ç›¸åŒçš„ Tagï¼Œå¹¶æ›´æ–° ParentTags */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">RemoveTagByExplicitName</span><span class="params">(<span class="keyword">const</span> FName&amp; TagName)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å¾€ ParentTags ä¸­æ·»åŠ æ ‡ç­¾(ä¸é‡å¤æ·»åŠ ) */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddParentsForTag</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; Tag)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ˜¾å¼æ·»åŠ çš„æ ‡ç­¾çš„æ•°ç»„ */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(VisibleAnywhere, BlueprintReadWrite, Category=GameplayTags, SaveGame)</span><br><span class="line">	TArray&lt;FGameplayTag&gt; GameplayTags;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** åŒ…å« GameplayTags çš„æ‰€æœ‰çˆ¶æ ‡ç­¾ï¼Œç”¨äºåŠ é€Ÿçˆ¶çº§æœç´¢ã€‚åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½åŒ…å«é‡å¤é¡¹ */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	TArray&lt;FGameplayTag&gt; ParentTags;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">UGameplayTagsManager</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">FGameplayTagRedirectors</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">struct</span> <span class="title">FGameplayTagQuery</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">struct</span> <span class="title">FGameplayTagQueryExpression</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">struct</span> <span class="title">FGameplayTagNode</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">struct</span> <span class="title">FGameplayTag</span>;</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ä¸è¦ç›´æ¥ä½¿ç”¨</span></span><br><span class="line"><span class="comment">	 * ç±»ä¼¼ STL è¿­ä»£å™¨ï¼Œå¯ç”¨åŸºäºèŒƒå›´çš„å¾ªç¯æ”¯æŒ</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	</span><br><span class="line">	FORCEINLINE <span class="keyword">friend</span> TArray&lt;FGameplayTag&gt;::<span class="function">TConstIterator <span class="title">begin</span><span class="params">(<span class="keyword">const</span> FGameplayTagContainer&amp; Array)</span> </span>&#123; <span class="keyword">return</span> Array.<span class="built_in">CreateConstIterator</span>(); &#125;</span><br><span class="line">	FORCEINLINE <span class="keyword">friend</span> TArray&lt;FGameplayTag&gt;::<span class="function">TConstIterator <span class="title">end</span><span class="params">(<span class="keyword">const</span> FGameplayTagContainer&amp; Array)</span> </span>&#123; <span class="keyword">return</span> TArray&lt;FGameplayTag&gt;::<span class="built_in">TConstIterator</span>(Array.GameplayTags, Array.GameplayTags.<span class="built_in">Num</span>()); &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>&quot;GameplayTagContainer&quot; çš„æˆå‘˜å±æ€§å®é™…ä¸Šåªæœ‰ä¸¤ä¸ª &quot;GameplayTag&quot; æ•°ç»„ï¼Œä¸€ä¸ªè®°å½•æ˜¾å¼æ·»åŠ çš„ Tagï¼Œå¦ä¸€ä¸ªè®°å½•æ˜¾å¼æ·»åŠ çš„ Tag ä¸­çš„æ‰€æœ‰çˆ¶ Tag (éšå¼æ›´æ–°)ã€‚å¦å¤–è¿˜æ”¯æŒå¯¹å®¹å™¨çš„è¿­ä»£ (å®é™…ä¸Šæ˜¯è¿­ä»£ GameplayTags æ•°ç»„)ï¼Œé™¤æ­¤ä¹‹å¤–å°±æ˜¯å¤„ç†å®¹å™¨å’Œ Tag ï¼Œå®¹å™¨å’Œå®¹å™¨ä¹‹é—´çš„ä¸€äº› &quot;æ·»åŠ &quot; &quot;åŒ…å«&quot; ç­‰é€»è¾‘çš„å‡½æ•°ã€‚å…¨éƒ¨å‡½æ•°éƒ½è¯»ä¸€éå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬æ—¥åä½¿ç”¨ï¼Œä¹Ÿæœ‰åŠ©äºæˆ‘ä»¬å…¨é¢ç†è§£ UE è®¾è®¡ä»£ç çš„æ•´ä½“æ€è·¯ã€‚</p><p>æœ€åæ˜¯ &quot;UGameplayTagManager&quot;ï¼Œå…¶ä¸­æ¶‰åŠä¸ &quot;Tag&quot; ç›¸å…³çš„å…¶ä»–ç±»ï¼Œæˆ‘ä»¬ä¼šæä¸€ä¸‹ï¼Œä¸åšå’±å¼€ã€‚</p><h3 id="ugameplaytagmanager"><a class="anchor" href="#ugameplaytagmanager">#</a> UGameplayTagManager</h3><p>æŒæœ‰ Tag å­—å…¸æ•°æ®çš„å•ä¾‹ UObject</p><p></p><figure class="highlight c++"><figcaption><span>UGameplayTagManager</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UGameplayTagManager.h</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">UCLASS</span>(config=Engine)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GAMEPLAYTAGS_API</span> <span class="title">UGameplayTagsManager</span> :</span> <span class="keyword">public</span> UObject</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_UCLASS_BODY</span>()</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Destructor */</span></span><br><span class="line">	~<span class="built_in">UGameplayTagsManager</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å›å…¨å±€ UGameplayTagsManager ç®¡ç†å™¨ */</span></span><br><span class="line">	<span class="function">FORCEINLINE <span class="keyword">static</span> UGameplayTagsManager&amp; <span class="title">Get</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (SingletonManager == <span class="literal">nullptr</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">InitializeManager</span>();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> *SingletonManager;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å¯èƒ½è¿”å›ç®¡ç†å™¨çš„ç©ºæŒ‡é’ˆã€‚åœ¨éœ€è¦é¿å…é‡æ–°åˆ†é…å†…å­˜çš„æƒ…å†µä¸‹ä½¿ç”¨ */</span></span><br><span class="line">	<span class="function">FORCEINLINE <span class="keyword">static</span> UGameplayTagsManager* <span class="title">GetIfAllocated</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> SingletonManager; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ·»åŠ  TagStrings æ•°ç»„ä¸­æœ‰æ•ˆçš„ Tag åˆ° OutTagsContainer ä¸­ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RequestGameplayTagContainer</span><span class="params">(<span class="keyword">const</span> TArray&lt;FString&gt;&amp; TagStrings, FGameplayTagContainer&amp; OutTagsContainer, <span class="keyword">bool</span> bErrorIfNotFound=<span class="literal">true</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å› TagName çš„ Tagï¼Œå¦‚æœ &quot;GameplayTagNodeMap&quot; ä¸­æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿”å›ç©ºæ ‡ç­¾ */</span></span><br><span class="line">	<span class="function">FGameplayTag <span class="title">RequestGameplayTag</span><span class="params">(FName TagName, <span class="keyword">bool</span> ErrorIfNotFound=<span class="literal">true</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ GameplayTag å­—ç¬¦ä¸² (foo.bar.baz)ï¼Œ</span></span><br><span class="line"><span class="comment">	 * å¦‚æœä¸æ˜¯ï¼Œè¿”å›falseï¼Œå¹¶å°è¯•ä¿®æ”¹å¹¶å­˜åœ¨ &quot;OutFixedString&quot; ä¸­è¿”å› (ä¿®æ”¹å¤±è´¥è¿”å›ç©º) </span></span><br><span class="line"><span class="comment">	 * @param TagString ç¡®è®¤å…¶æœ‰æ•ˆæ€§çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">	 * @param OutError è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"><span class="comment">	 * @param OutFixedString è¿”å›å°è¯•ä¿®æ”¹åçš„å­—ç¬¦ä¸²ï¼Œä¿®æ”¹å¤±è´¥è¿”å›ç©º</span></span><br><span class="line"><span class="comment">	 * @return å¦‚æœå¯ä»¥è¢«æ·»åŠ åˆ° Tag å­—å…¸ä¸­ï¼Œåˆ™è¿”å›çœŸã€‚å¦‚æœåŒæ­¥å¤±è´¥åˆ™è¿”å›å‡</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsValidGameplayTagString</span><span class="params">(<span class="keyword">const</span> FString&amp; TagString, FText* OutError = <span class="literal">nullptr</span>, FString* OutFixedString = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ç»™å®šéƒ¨åˆ†å­—ç¬¦ä¸²ï¼ŒæŸ¥æ‰¾ Tagã€‚è¿™ä¼šæ¯”è¾ƒæ…¢ï¼Œä¸»è¦ç”¨äºæ§åˆ¶å°å‘½ä»¤å’Œå®ç”¨ç¨‹åºï¼Œä½¿å¼€å‘æ›´ç®€å•ã€‚</span></span><br><span class="line"><span class="comment">	 * æ­¤å‡½æ•°å°†å°è¯•åŒ¹é…æœ€å¥½çš„ç»“æœï¼Œå¦‚: ä¼ å…¥ &quot;A.b&quot; åˆ™ä¼˜å…ˆåŒ¹é… &quot;A.b.&quot; è€Œä¸æ˜¯ &quot;a.b.c&quot;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">FGameplayTag <span class="title">FindGameplayTagFromPartialString_Slow</span><span class="params">(FString PartialString)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å°†ç»™å®šåç§°æ³¨å†Œä¸ºæ¸¸æˆæ ‡ç­¾ï¼Œå¹¶è·Ÿè¸ªå®ƒæ˜¯å¦åœ¨ä»£ç ä¸­è¢«ç›´æ¥å¼•ç”¨</span></span><br><span class="line"><span class="comment">	 * è¿™åªèƒ½åœ¨å¼•æ“åˆå§‹åŒ–æœŸé—´è°ƒç”¨ï¼Œè¡¨æ ¼éœ€è¦åœ¨å¤åˆ¶å‰è¢«é”å®š</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param TagName éœ€è¦æ·»åŠ çš„ Tag çš„åç§°</span></span><br><span class="line"><span class="comment">	 * @param TagDevComment è§£é‡Šæ­¤ Tag ç”¨æ³•çš„å¼€å‘è€…å‘½ä»¤</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * @return è¿”å›ä¸ TagName ç›¸å…³çš„ Tag</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">FGameplayTag <span class="title">AddNativeGameplayTag</span><span class="params">(FName TagName, <span class="keyword">const</span> FString&amp; TagDevComment = TEXT(<span class="string">&quot;(Native)&quot;</span>))</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddNativeGameplayTag</span><span class="params">(FNativeGameplayTag* TagSource)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RemoveNativeGameplayTag</span><span class="params">(<span class="keyword">const</span> FNativeGameplayTag* TagSource)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">/** è°ƒç”¨ä»¥åˆ·æ–°æœ¬åœ°æ ‡ç­¾åˆ—è¡¨ï¼Œä¸€æ—¦è°ƒç”¨ï¼Œæ·»åŠ æ›´å¤šæ ‡ç­¾æ˜¯ä¸å®‰å…¨çš„ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">DoneAddingNativeTags</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">static</span> FSimpleMulticastDelegate&amp; <span class="title">OnLastChanceToAddNativeTags</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">CallOrRegister_OnDoneAddingNativeTagsDelegate</span><span class="params">(FSimpleMulticastDelegate::FDelegate Delegate)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è·å–ä¸€ä¸ª Tag Containerï¼Œè¯¥å®¹å™¨åŒ…å«ç»™å®š Tag åŠå…¶çˆ¶æ ‡ç­¾ä½œä¸ºæ˜¾å¼æ ‡ç­¾(GameplayTags æ•°ç»„) */</span></span><br><span class="line">	<span class="function">FGameplayTagContainer <span class="title">RequestGameplayTagParents</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; GameplayTag)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è·å–ä¸€ä¸ª Tag Containerï¼Œè¯¥å®¹å™¨åŒ…å«ä¼ å…¥æ ‡ç­¾çš„æ‰€æœ‰å­æ ‡ç­¾ã€‚ä¸è¿”å›åŸå§‹æ ‡ç­¾ */</span></span><br><span class="line">	<span class="function">FGameplayTagContainer <span class="title">RequestGameplayTagChildren</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; GameplayTag)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å›æ­¤æ ‡ç­¾çš„ç›´æ¥çˆ¶æ ‡ç­¾ï¼Œå¦‚: x.y.zï¼Œè¿”å› y */</span></span><br><span class="line">	<span class="function">FGameplayTag <span class="title">RequestGameplayTagDirectParent</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; GameplayTag)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¾…åŠ©å‡½æ•°ï¼Œç”¨ä»¥è·å–åªåŒ…å«ä¼ å…¥æ ‡ç­¾çš„ TagContainerï¼Œæ­¤å®¹å™¨æ‹¥æœ‰å¯æœç´¢çš„ ParentTags */</span></span><br><span class="line">	<span class="function">FORCEINLINE_DEBUGGABLE <span class="keyword">const</span> FGameplayTagContainer* <span class="title">GetSingleTagContainer</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; GameplayTag)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// ç”¨æŒ‡é’ˆä»¥é¿å…å…±äº«æŒ‡é’ˆå¼•ç”¨è®¡æ•°æ”¹å˜</span></span><br><span class="line">		<span class="keyword">const</span> TSharedPtr&lt;FGameplayTagNode&gt;* Node = GameplayTagNodeMap.<span class="built_in">Find</span>(GameplayTag);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (Node)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> &amp;(*Node)-&gt;<span class="built_in">GetSingleTagContainer</span>();</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ£€æŸ¥èŠ‚ç‚¹æ ‘æ˜¯å¦å­˜åœ¨ä¼ å…¥ Tag çš„ FGameplayTagNode */</span></span><br><span class="line">	<span class="function">FORCEINLINE_DEBUGGABLE TSharedPtr&lt;FGameplayTagNode&gt; <span class="title">FindTagNode</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; GameplayTag)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">const</span> TSharedPtr&lt;FGameplayTagNode&gt;* Node = GameplayTagNodeMap.<span class="built_in">Find</span>(GameplayTag);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (Node)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> *Node;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ä¸ä¸Šé¢å‡½æ•°ç›¸åŒ */</span></span><br><span class="line">	<span class="function">FORCEINLINE_DEBUGGABLE TSharedPtr&lt;FGameplayTagNode&gt; <span class="title">FindTagNode</span><span class="params">(FName TagName)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="function">FGameplayTag <span class="title">PossibleTag</span><span class="params">(TagName)</span></span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">FindTagNode</span>(PossibleTag);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** åŠ è½½ GameplayTagSettings å¯¹è±¡ä¸­å¼•ç”¨çš„æ ‡ç­¾è¡¨ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">LoadGameplayTagTables</span><span class="params">(<span class="keyword">bool</span> bAllowAsyncLoad = <span class="literal">false</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¯»å–åŒ…å«ç‰¹å®šè·¯å¾„çš„æ ‡ç­¾é…ç½®æ–‡ä»¶ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddTagIniSearchPath</span><span class="params">(<span class="keyword">const</span> FString&amp; RootDir)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è·å–æ‰€æœ‰å½“å‰ç”¨äºæŸ¥æ‰¾æ ‡ç­¾æºçš„å­—å…¸çš„è·¯å¾„ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">GetTagSourceSearchPaths</span><span class="params">(TArray&lt;FString&gt;&amp; OutPaths)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¾…åŠ©å‡½æ•°ï¼Œç”¨äºæ„é€ æ ‡ç­¾æ ‘ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ConstructGameplayTagTree</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¾…åŠ©å‡½æ•°ï¼Œç”¨äºé”€æ¯æ ‡ç­¾æ ‘ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">DestroyGameplayTagTree</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** åˆ†ç¦» Tagï¼Œå¦‚: x.y.z åˆ†ç¦»åˆ°æ•°ç»„åæ˜¯ &#123;x,y,z&#125; */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SplitGameplayTagFName</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; Tag, TArray&lt;FName&gt;&amp; OutNames)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è·å–å­—å…¸ä¸­æ‰€æœ‰æ ‡ç­¾çš„åˆ—è¡¨ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RequestAllGameplayTags</span><span class="params">(FGameplayTagContainer&amp; TagContainer, <span class="keyword">bool</span> OnlyIncludeDictionaryTags)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ä¼ å…¥åç§°æ˜¯å¦åœ¨æ ‡ç­¾å­—å…¸ä¸­ï¼Œä¸”å¯ä»¥è¢«åˆ›å»º */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ValidateTagCreation</span><span class="params">(FName TagName)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å›ç»™å®šæ ‡ç­¾åç§°çš„æ ‡ç­¾æºï¼Œæ²¡æ‰¾åˆ°è¿”å›ç©º */</span></span><br><span class="line">	<span class="function"><span class="keyword">const</span> FGameplayTagSource* <span class="title">FindTagSource</span><span class="params">(FName TagSourceName)</span> <span class="keyword">const</span></span>;</span><br><span class="line">	<span class="function">FGameplayTagSource* <span class="title">FindTagSource</span><span class="params">(FName TagSourceName)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å°†ç‰¹å®šç±»å‹çš„æ ‡ç­¾æºå¡«å……åˆ° OutArray æ•°ç»„ä¸­ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">FindTagSourcesWithType</span><span class="params">(EGameplayTagSourceType TagSourceType, TArray&lt;<span class="keyword">const</span> FGameplayTagSource*&gt;&amp; OutArray)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æŸ¥çœ‹ä¸¤ä¸ªæ ‡ç­¾çš„åŒ¹é…åº¦ï¼Œå€¼è¶Šå¤§åŒ¹é…åº¦è¶Šé«˜(å€¼ä¸ºå…¶è‡ªèº«ä¸çˆ¶æ ‡ç­¾çš„åŒ¹é…æ•°é‡) */</span></span><br><span class="line">	<span class="function">int32 <span class="title">GameplayTagsMatchDepth</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; GameplayTagOne, <span class="keyword">const</span> FGameplayTag&amp; GameplayTagTwo)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å›ä¼ å…¥æ ‡ç­¾æ‹¥æœ‰çš„èŠ‚ç‚¹æ•°ï¼Œå¦‚: &quot;TagA.SubTagA&quot; æœ‰ä¸¤ä¸ªæ ‡ç­¾èŠ‚ç‚¹ï¼Œ&quot;TagA.SubTagA.LeafTagA&quot; åˆ™æœ‰ä¸‰ä¸ª */</span> </span><br><span class="line">	<span class="function">int32 <span class="title">GetNumberOfTagNodes</span><span class="params">(<span class="keyword">const</span> FGameplayTag&amp; GameplayTag)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ˜¯å¦åº”ä» &quot;UGameplayTagsSettings&quot; å¯¹è±¡ä¸­å¯¼å‡º Tags (é€šè¿‡ INI æ–‡ä»¶é…ç½®) */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ShouldImportTagsFromINI</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å½“å°è¯•åŠ è½½æ— æ•ˆæ ‡ç­¾æ—¶ï¼Œæ˜¯å¦åº”æ‰“å°åŠ è½½é”™è¯¯ */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ShouldWarnOnInvalidTags</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> bShouldWarnOnInvalidTags;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ˜¯å¦åº”æ¸…é™¤å¯¹ç¼–è¾‘å™¨ä¸­åŠ è½½/ä¿å­˜çš„æ— æ•ˆæ ‡ç­¾çš„å¼•ç”¨ */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ShouldClearInvalidTags</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> bShouldClearInvalidTags;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ˜¯å¦åº”å®ç”¨å¿«é€Ÿå¤åˆ¶ */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ShouldUseFastReplication</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> bUseFastReplication;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å› NetworkGameplayTagNodeIndex çš„ Hash */</span></span><br><span class="line">	<span class="function">uint32 <span class="title">GetNetworkGameplayTagNodeIndexHash</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="built_in">VerifyNetworkIndex</span>(); <span class="keyword">return</span> NetworkGameplayTagNodeIndexHash; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å›åŒ…å«é™å®šæ ‡ç­¾çš„é…ç½®æ–‡ä»¶åˆ—è¡¨ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">GetRestrictedTagConfigFiles</span><span class="params">(TArray&lt;FString&gt;&amp; RestrictedConfigFiles)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å›åŒ…å«é™å®šæ ‡ç­¾çš„æºæ–‡ä»¶åˆ—è¡¨ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">GetRestrictedTagSources</span><span class="params">(TArray&lt;<span class="keyword">const</span> FGameplayTagSource*&gt;&amp; Sources)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å›ä¸€ä¸ªé™å®šæ ‡ç­¾é…ç½®æ–‡ä»¶çš„ Owner åˆ—è¡¨ï¼Œå¯èƒ½ä¸ºç©º */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">GetOwnersForTagSource</span><span class="params">(<span class="keyword">const</span> FString&amp; SourceName, TArray&lt;FString&gt;&amp; OutOwners)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** é€šè¿‡åºåˆ—åŒ–é€šçŸ¥æŸä¸ªæ ‡ç­¾å®¹å™¨è¢«åŠ è½½ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">GameplayTagContainerLoaded</span><span class="params">(FGameplayTagContainer&amp; Container, FProperty* SerializingProperty)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** é€šè¿‡ç³»åˆ—åŒ–é€šçŸ¥æŸä¸ªæ ‡ç­¾è¢«åŠ è½½ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SingleGameplayTagLoaded</span><span class="params">(FGameplayTag&amp; Tag, FProperty* SerializingProperty)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å¤„ç†æ•´ä¸ªå®¹å™¨çš„é‡å®šå‘ï¼Œé‡åˆ°æ— æ•ˆæ ‡ç­¾æ—¶æŠ¥é”™ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RedirectTagsForContainer</span><span class="params">(FGameplayTagContainer&amp; Container, FProperty* SerializingProperty)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å¤„ç†å•ä¸ªæ ‡ç­¾çš„é‡å®šå‘ï¼Œæ— æ•ˆæ ‡ç­¾å°†æŠ¥é”™ã€‚ä»…å½“å•ä¸ªæ ‡ç­¾å•ç‹¬åºåˆ—åŒ–æ—¶æ‰è°ƒç”¨æ­¤å‡½æ•° */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RedirectSingleGameplayTag</span><span class="params">(FGameplayTag&amp; Tag, FProperty* SerializingProperty)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å¤„ç†ä»å¯¼å…¥æ ‡ç­¾ååˆ°å•ä¸ªæ ‡ç­¾çš„å»ºç«‹(yä¹Ÿç”¨äºé‡å®šå‘)ï¼Œé€šè¿‡æ–‡æœ¬å¯¼å…¥æ ‡ç­¾æ—¶è°ƒç”¨ */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ImportSingleGameplayTag</span><span class="params">(FGameplayTag&amp; Tag, FName ImportedTagName, <span class="keyword">bool</span> bImportFromSerialize = <span class="literal">false</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ä»ç½‘ç»œç´¢å¼•è·å–æ ‡ç­¾åï¼Œåä¹‹äº¦ç„¶ï¼Œç”¨äºæé«˜å¤åˆ¶æ•ˆç‡ */</span></span><br><span class="line">	<span class="function">FName <span class="title">GetTagNameFromNetIndex</span><span class="params">(FGameplayTagNetIndex Index)</span> <span class="keyword">const</span></span>;</span><br><span class="line">	<span class="function">FGameplayTagNetIndex <span class="title">GetNetIndexFromTag</span><span class="params">(<span class="keyword">const</span> FGameplayTag &amp;InTag)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å¤åˆ¶æ ‡ç­¾æ‰€éœ€çš„ç¼“å­˜æ¯”ç‰¹æ•°ã€‚å³ Log2(æ ‡ç­¾æ•°é‡)ã€‚å°†å§‹ç»ˆå°äºç­‰äº 16 */</span></span><br><span class="line">	<span class="function">int32 <span class="title">GetNetIndexTrueBitNum</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="built_in">VerifyNetworkIndex</span>(); <span class="keyword">return</span> NetIndexTrueBitNum; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ç½‘ç»œåºåˆ—åŒ–æ ‡ç­¾æ—¶ç¬¬ä¸€æ®µçš„é•¿åº¦(ä½)*/</span></span><br><span class="line">	<span class="function">int32 <span class="title">GetNetIndexFirstBitSegment</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="built_in">VerifyNetworkIndex</span>(); <span class="keyword">return</span> NetIndexFirstBitSegment; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿™æ˜¯æ— æ•ˆ Tag &quot;None&quot; çš„çœŸå®å€¼ã€‚è¿™åœ¨è¿è¡Œæ—¶è®¡ç®—ä¸º(æ ‡ç­¾æ€»æ•° + 1)*/</span></span><br><span class="line">	<span class="function">FGameplayTagNetIndex <span class="title">GetInvalidTagNetIndex</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="built_in">VerifyNetworkIndex</span>(); <span class="keyword">return</span> InvalidTagNetIndex; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> TArray&lt;TSharedPtr&lt;FGameplayTagNode&gt;&gt;&amp; <span class="built_in">GetNetworkGameplayTagNodeIndex</span>() <span class="keyword">const</span> &#123; <span class="built_in">VerifyNetworkIndex</span>(); <span class="keyword">return</span> NetworkGameplayTagNodeIndex; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">DECLARE_MULTICAST_DELEGATE_OneParam</span>(FOnGameplayTagLoaded, <span class="keyword">const</span> FGameplayTag&amp; <span class="comment">/*Tag*/</span>)</span><br><span class="line">	FOnGameplayTagLoaded OnGameplayTagLoadedDelegate;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ç”¨äºå¤åˆ¶å®¹å™¨å¤§å°çš„æ¯”ç‰¹æ•°ã€‚é€šè¿‡é…ç½®è¿˜è®¾å®š */</span></span><br><span class="line">	int32 NumBitsForContainerSize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">/** å¤åˆ¶æ ‡ç­¾æ‰€éœ€çš„ç¼“å­˜æ¯”ç‰¹æ•°ï¼Œå³ Log2(æ ‡ç­¾æ•°é‡)ã€‚å°†å§‹ç»ˆå°äºç­‰äº 16 */</span></span><br><span class="line">	int32 NetIndexTrueBitNum;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ç½‘ç»œåºåˆ—åŒ–æ ‡ç­¾æ—¶ç¬¬ä¸€æ®µçš„é•¿åº¦(ä½)*/</span></span><br><span class="line">	int32 NetIndexFirstBitSegment;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿™æ˜¯æ— æ•ˆ Tag &quot;None&quot; çš„çœŸå®å€¼ã€‚è¿™åœ¨è¿è¡Œæ—¶è®¡ç®—ä¸º(æ ‡ç­¾æ€»æ•° + 1)*/</span></span><br><span class="line">	FGameplayTagNetIndex InvalidTagNetIndex;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">PrintReplicationIndices</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** åˆå§‹åŒ–ç®¡ç†å™¨ */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">InitializeManager</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å®Œæˆè¯»å–/æ·»åŠ æœ¬åœ°æ ‡ç­¾çš„å›è°ƒ */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> FSimpleMulticastDelegate&amp; <span class="title">OnDoneAddingNativeTagsDelegate</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Tag Manager å•ä¾‹*/</span></span><br><span class="line">	<span class="keyword">static</span> UGameplayTagsManager* SingletonManager;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">FGameplayTagTest</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">FGameplayEffectsTest</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">FGameplayTagsModule</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">FGameplayTagsEditorModule</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">UGameplayTagsSettings</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">SAddNewGameplayTagSourceWidget</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">FNativeGameplayTag</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * è¾…åŠ©å‡½æ•°ï¼Œç”¨ä»¥å‘æ ‡ç­¾èŠ‚ç‚¹æ•°ç»„ä¸­æ·»åŠ æ ‡ç­¾</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param Tag							éœ€è¦æ’å…¥çš„æ ‡ç­¾å</span></span><br><span class="line"><span class="comment">	 * @param FullTag						å®Œæ•´æ ‡ç­¾ï¼Œä¼ å…¥ä»¥æé«˜æ€§èƒ½</span></span><br><span class="line"><span class="comment">	 * @param ParentNode					æ­¤æ ‡ç­¾çš„çˆ¶èŠ‚ç‚¹(å¦‚æœæœ‰)</span></span><br><span class="line"><span class="comment">	 * @param NodeArray						ç”¨äºæ’å…¥æ–°èŠ‚ç‚¹çš„èŠ‚ç‚¹æ•°ç»„(å¦‚æœæ­¤æ ‡ç­¾å·²å­˜åœ¨ï¼Œåˆ™ä¸ä¼šè¿›è¡Œæ’å…¥)</span></span><br><span class="line"><span class="comment">	 * @param SourceName					æ–‡ä»¶æ ‡ç­¾æº</span></span><br><span class="line"><span class="comment">	 * @param DevComment					å…³äºæ­¤æ ‡ç­¾çš„å¼€å‘è€…å‘½ä»¤</span></span><br><span class="line"><span class="comment">	 * @param bIsExplicitTag				æ­¤æ ‡ç­¾æ˜¯å¦æ˜¾å¼å®šä¹‰æˆ–é€šè¿‡å­˜åœ¨çš„å­æ ‡ç­¾éšå¼å®šä¹‰</span></span><br><span class="line"><span class="comment">	 * @param bIsRestrictedTag				æ­¤æ ‡ç­¾ä¸ºé™å®šæ ‡ç­¾è¿˜æ˜¯å¸¸è§„æ ‡ç­¾</span></span><br><span class="line"><span class="comment">	 * @param bAllowNonRestrictedChildren	å¦‚æœæ­¤æ ‡ç­¾ä¸ºé™å®šæ ‡ç­¾ï¼Œå…¶å­æ ‡ç­¾æ˜¯å¦å¯ä»¥ä¸ºå¸¸è§„æ ‡ç­¾</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @return æ­¤ Tag èŠ‚ç‚¹çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">int32 <span class="title">InsertTagIntoNodeArray</span><span class="params">(FName Tag, FName FullTag, TSharedPtr&lt;FGameplayTagNode&gt; ParentNode, TArray&lt; TSharedPtr&lt;FGameplayTagNode&gt; &gt;&amp; NodeArray, FName SourceName, <span class="keyword">const</span> FString&amp; DevComment, <span class="keyword">bool</span> bIsExplicitTag, <span class="keyword">bool</span> bIsRestrictedTag, <span class="keyword">bool</span> bAllowNonRestrictedChildren)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¾…åŠ©å‡½æ•°ï¼Œç”¨ä»¥ä»æ¯ä¸ªè¡¨ä¸­å¡«å……æ ‡è®°æ•° */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">PopulateTreeFromDataTable</span><span class="params">(class UDataTable* Table)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddTagTableRow</span><span class="params">(<span class="keyword">const</span> FGameplayTagTableRow&amp; TagRow, FName SourceName, <span class="keyword">bool</span> bIsRestrictedTag = <span class="literal">false</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddChildrenTags</span><span class="params">(FGameplayTagContainer&amp; TagContainer, TSharedPtr&lt;FGameplayTagNode&gt; GameplayTagNode, <span class="keyword">bool</span> RecurseAll=<span class="literal">true</span>, <span class="keyword">bool</span> OnlyIncludeDictionaryTags=<span class="literal">false</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddRestrictedGameplayTagSource</span><span class="params">(<span class="keyword">const</span> FString&amp; FileName)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddTagsFromAdditionalLooseIniFiles</span><span class="params">(<span class="keyword">const</span> TArray&lt;FString&gt;&amp; IniFileList)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * GameplayTagMatch çš„è¾…åŠ©å‡½æ•°ï¼Œç”¨äºåšçˆ¶æ ‡ç­¾åŒ¹é…æ—¶è·å–æ‰€æœ‰çˆ¶æ ‡ç­¾</span></span><br><span class="line"><span class="comment">	 * æ³¨æ„: æ°¸è¿œä¸åº”è¯¥å°†å…¶è®¾ä¸ºå…¬å¼€ï¼Œå› ä¸ºå…¶ä½¿ç”¨ FNameï¼ŒFNameæ°¸è¿œä¸åº”è¯¥è¢«æš´éœ²</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * @param NameList		ç”¨äºè·å–æ‰€æœ‰çˆ¶èŠ‚ç‚¹åç§°çš„åˆ—è¡¨</span></span><br><span class="line"><span class="comment">	 * @param GameplayTag	éœ€è¦è·å–çˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">GetAllParentNodeNames</span><span class="params">(TSet&lt;FName&gt;&amp; NamesList, TSharedPtr&lt;FGameplayTagNode&gt; GameplayTag)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¿”å›ç»™å®šæ ‡ç­¾æºåç§°çš„æ ‡ç­¾æºï¼Œæ‰¾ä¸åˆ°è¿”å›ç©º */</span></span><br><span class="line">	<span class="function">FGameplayTagSource* <span class="title">FindOrAddTagSource</span><span class="params">(FName TagSourceName, EGameplayTagSourceType SourceType, <span class="keyword">const</span> FString&amp; RootDirToUse = FString())</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ä¸ºæ¯ä¸ªæ ‡ç­¾æ„é€ ç½‘ç»œä¸‹æ ‡ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ConstructNetIndex</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ ‡è®°æ‰€æœ‰ä» CurNode ä¸­æ´¾ç”Ÿå‡ºæ¥çš„èŠ‚ç‚¹æ‹¥æœ‰åŒä¸€ä¸ªç¥–å…ˆèŠ‚ç‚¹ */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">MarkChildrenOfNodeConflict</span><span class="params">(TSharedPtr&lt;FGameplayTagNode&gt; CurNode)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">VerifyNetworkIndex</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (bNetworkIndexInvalidated)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">const_cast</span>&lt;UGameplayTagsManager*&gt;(<span class="keyword">this</span>)-&gt;<span class="built_in">ConstructNetIndex</span>();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">InvalidateNetworkIndex</span><span class="params">()</span> </span>&#123; bNetworkIndexInvalidated = <span class="literal">true</span>; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Tag Sources æ ‡ç­¾æº</span></span><br><span class="line">	<span class="comment">///////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æœ¬åœ°æ—§æ ‡ç­¾ï¼Œç”¨äºæŠµåˆ¶æ²¡æœ‰ç‰¹å®šç«™ç‚¹/æ‰€æœ‰æƒçš„å‡½æ•°è°ƒç”¨ */</span></span><br><span class="line">	TSet&lt;FName&gt; LegacyNativeTags;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ä»ä¸­åŠ è½½ Tag é…ç½®æ–‡ä»¶çš„æ‰€æœ‰é…ç½®ç›®å½•çš„æ˜ å°„ */</span></span><br><span class="line">	TMap&lt;FString, FGameplayTagSearchPathInfo&gt; RegisteredSearchPaths;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** GameplayTag çš„æ ¹èŠ‚ç‚¹ */</span></span><br><span class="line">	TSharedPtr&lt;FGameplayTagNode&gt; GameplayRootTag;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Tags åˆ° Nodes çš„æ˜ å°„ - ä»…é™å†…éƒ¨ä½¿ç”¨ã€‚FGameplayTag åœ¨èŠ‚ç‚¹ç»“æ„ä½“å†…ï¼Œä¸è¦ä½¿ç”¨ FindKey */</span></span><br><span class="line">	TMap&lt;FGameplayTag, TSharedPtr&lt;FGameplayTagNode&gt;&gt; GameplayTagNodeMap;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** èšåˆæ’åºåˆ—è¡¨ï¼Œé€šå¸¸ç”¨äºå¤åˆ¶æ ‡ç­¾ */</span></span><br><span class="line">	TArray&lt;FGameplayTag&gt; CommonlyReplicatedTags;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ ‡ç­¾æºåç§°åˆ°æºå¯¹è±¡çš„æ˜ å°„ */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TMap&lt;FName, FGameplayTagSource&gt; TagSources;</span><br><span class="line"></span><br><span class="line">	TSet&lt;FName&gt; RestrictedGameplayTagSourceNames;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span> bIsConstructingGameplayTagTree = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ç¼“å­˜çš„è¿è¡Œæ—¶å€¼ï¼Œæ ‡è®°æ˜¯å¦ä½¿ç”¨å¿«é€Ÿå¤åˆ¶ã€‚ä»é…ç½®è®¾ç½®ä¸­åˆå§‹åŒ– */</span></span><br><span class="line">	<span class="keyword">bool</span> bUseFastReplication;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ç¼“å­˜çš„è¿è¡Œæ—¶å€¼ï¼ŒåŠ è½½æ— æ•ˆæ ‡è®°æ—¶æ˜¯å¦å‘ç”Ÿè­¦å‘Š */</span></span><br><span class="line">	<span class="keyword">bool</span> bShouldWarnOnInvalidTags;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** ç¼“å­˜çš„è¿è¡Œæ—¶å€¼ï¼Œè¯»å–æ— æ•ˆæ ‡ç­¾æ—¶æ˜¯å¦æ¸…é™¤ */</span></span><br><span class="line">	<span class="keyword">bool</span> bShouldClearInvalidTags;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ‰€æœ‰æœ¬åœ°æ ‡ç­¾éƒ½å·²è¢«æ·»åŠ æˆ–åˆ·æ–°æ—¶ä¸ºçœŸ */</span></span><br><span class="line">	<span class="keyword">bool</span> bDoneAddingNativeTags;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å®šä¹‰ æ ‡è®°ä¸­ä¸åº”è¯¥å­˜åœ¨çš„æ‰€æœ‰éæ³•å­—ç¬¦ çš„å­—ç¬¦ä¸² */</span></span><br><span class="line">	FString InvalidTagCharacters;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** å·²æ’åºçš„èŠ‚ç‚¹åˆ—è¡¨ï¼Œç”¨äºç½‘ç»œå¤åˆ¶ */</span></span><br><span class="line">	TArray&lt;TSharedPtr&lt;FGameplayTagNode&gt;&gt; NetworkGameplayTagNodeIndex;</span><br><span class="line"></span><br><span class="line">	uint32 NetworkGameplayTagNodeIndexHash;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span> bNetworkIndexInvalidated = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æŒæœ‰æ‰€æœ‰æœ‰æ•ˆï¼Œä¸”å¯åº”ç”¨äºèµ„äº§çš„ gameplay-related æ ‡ç­¾*/</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TArray&lt;UDataTable*&gt; GameplayTagTables;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">static</span> FName NAME_Categories;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">static</span> FName NAME_GameplayTagFilter;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>&quot;TagManager&quot; ä¸­æ¶‰åŠåˆ°çš„ç±»æ¯”è¾ƒå¤šï¼Œä½†éƒ½æ˜¯æ“ä½œ &quot;Tag&quot; çš„ã€‚å¦‚ï¼š</p><ul><li>&quot;FGameplayTagNode&quot; å®é™…ä¸Šå°±æ˜¯ &quot;Tag&quot; åœ¨ &quot;TagNodeTree&quot; ä¸­çš„èŠ‚ç‚¹ï¼Œ&quot;TagNodeTree&quot; å±•ç°äº†æ‰€æœ‰ &quot;Tag&quot; çš„çˆ¶å­å…³ç³»ã€‚</li><li>&quot;FGameplayTagSource&quot; åˆ™å®šä¹‰äº† GameplayTags åŠ è½½ / ä¿å­˜çš„ä½ç½®ã€‚</li><li>&quot;FGameplayTagSearchPathInfo&quot; åˆ™æ˜¯æè¿°å¯»æ‰¾é…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®çš„è·¯å¾„çš„ç»“æ„ä½“</li><li>........</li></ul><p>&quot;TagManager&quot; è´Ÿè´£çš„å·¥ä½œéå¸¸å¤šï¼Œä¸Šå±‚åŒ…æ‹¬å¯¹ &quot;Tag&quot;, &quot;Container&quot;, &quot;TagNode&quot; çš„åˆ›å»ºç­‰ï¼Œä¸‹å±‚åŒ…æ‹¬ &quot;Tag&quot; åœ¨ç£ç›˜ä¸­çš„åŠ è½½ä¸æ¸…é™¤ï¼ŒTag çš„ç½‘ç»œåŒæ­¥ç­‰ã€‚è€Œ &quot;TagManager&quot; çš„å±æ€§å…¶å®ä¹Ÿéƒ½æ˜¯å®Œæˆè¿™äº›å·¥ä½œæ‰€éœ€çš„ã€‚è™½ç„¶æˆ‘ä»¬å¹³æ—¶å¼€å‘çœŸæ­£æ¥è§¦åˆ° &quot;TagManager&quot; çš„æœºä¼šå¹¶ä¸å¤šï¼Œä½†è¿˜æ˜¯å¯ä»¥äº†è§£ä»¥ä¸‹å®ƒéƒ½ä¸ºæˆ‘ä»¬åšäº†ä»€ä¹ˆï¼Œè‡³äºå…¶é‡Œé¢çš„å‡½æ•°å®ç°ï¼Œå…¶å®å°±æ˜¯ä¸€äº›å­—ç¬¦ä¸²çš„åˆ†æå’Œ Tag çš„ä¿å­˜ å¤åˆ¶ æŸ¥è¯¢ç­‰ï¼Œä¸æ˜¯å¾ˆéš¾ã€‚</p><hr><p>æœ€åçš„æœ€åï¼Œå†æä¸€ä¸‹ &quot;AbilitySystemComponent&quot;ï¼Œè¿™ä¸ªç»„ä»¶å°†æˆ‘ä»¬å¼€å‘æ—¶å¸¸ç”¨çš„æ¥å£éƒ½é›†åˆåœ¨ä¸€èµ·äº†ã€‚åŒ…æ‹¬ï¼šAttributeSetï¼ŒGameplayAbilityï¼ŒGameplayEffectï¼ŒGameplayCue çš„ç›¸å…³æ“ä½œã€‚è€Œä¸”è¿˜ç»§æ‰¿äº† &quot;GameplayTasksComponent&quot;ï¼Œè¿™å¯ä»¥è®©æˆ‘ä»¬æ›´æ–¹ä¾¿åœ°ç”¨ &quot;AbilityTask&quot; å®šä¹‰é‡Šæ”¾æŠ€èƒ½æ—¶çš„è¡Œä¸º (å¯ä»¥ç†è§£å¤šä¸ªå°çš„ AbilityTask)ã€‚&quot;AbilitySystemComponent&quot; çš„ API å®ç°éƒ½æ˜¯åŸºäºå…¶ä»–ç±»çš„ï¼Œå› ä¸ºæˆ‘ä»¬æœ¬ç¯‡ä¸»è¦æ˜¯åˆ†æ &quot;GAS&quot; çš„æºç å®ç°ï¼Œä¸æ˜¯ä»‹ç»å…¶ä½¿ç”¨ï¼Œæ‰€ä»¥ &quot;AbilitySystemComponent&quot; çš„ä»‹ç»ç›¸å¯¹æ¯”è¾ƒå°‘ã€‚å¦‚æœæœ‰éœ€è¦ï¼Œå’±å†æ›´ä¸€æœŸ &quot;GAS&quot; çš„ä½¿ç”¨ç¯‡ï¼Œä¾›è¯»è€…å‚è€ƒ ğŸ˜ƒ</p><p>å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï½ï½ï½</p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-01-02 14:50:56" itemprop="dateModified" datetime="2022-01-02T14:50:56+08:00">2022-01-02</time> </span><span id="2021/12/17/UE4/UE4CPP/Unreal GAS æºç è§£æ/" class="item leancloud_visitors" data-flag-title="Unreal GAS æºç è§£æ" title="é˜…è¯»æ¬¡æ•°"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">é˜…è¯»æ¬¡æ•°</span> <span class="leancloud-visitors-count"></span> <span class="text">æ¬¡</span></span></div><div id="copyright"><ul><li class="author"><strong>æœ¬æ–‡ä½œè€…ï¼š </strong>-YIFEI- <i class="ic i-at"><em>@</em></i>ä¸€ä¸ªå¹´è½»äººå¥”å‘æ¢¦æƒ³çš„è¶³è¿¹</li><li class="link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong> <a href="https://kotori_suki.github.io/2021/12/17/UE4/UE4CPP/Unreal%20GAS%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" title="Unreal GAS æºç è§£æ">https://kotori_suki.github.io/2021/12/17/UE4/UE4CPP/Unreal GAS æºç è§£æ/</a></li><li class="license"><strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬ç«™æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/12/15/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20USavegame%20&%20UPlayer/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipexe4oykj20zk0m87ji.jpg" title="Gameplay â€”â€” USavegame &amp; UPlayer"><span class="type">ä¸Šä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i> Gameplay</span><h3>Gameplay â€”â€” USavegame & UPlayer</h3></a></div><div class="item right"><a href="/2021/12/28/UE4/UE4CPP/CustomItemModule/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipetv6p75j20zk0m8x6p.jpg" title="Custom Item Module"><span class="type">ä¸‹ä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i> ModuleDesign</span><h3>Custom Item Module</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="æ–‡ç« ç›®å½•"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#unreal-gas-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">Unreal GAS æºç è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#gas-%E6%80%BB%E8%A7%88"><span class="toc-number">1.1.</span> <span class="toc-text">GAS æ€»è§ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#attributes%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.</span> <span class="toc-text">Attributes çš„å®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gameplayability"><span class="toc-number">1.3.</span> <span class="toc-text">GameplayAbility</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E9%94%AE%E5%A4%84%E7%90%86"><span class="toc-number">1.3.1.</span> <span class="toc-text">æŒ‰é”®å¤„ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tryactivateability"><span class="toc-number">1.3.2.</span> <span class="toc-text">TryActivateAbility</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#internaltryactivateability"><span class="toc-number">1.3.3.</span> <span class="toc-text">InternalTryActivateAbility</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gameplayeffect"><span class="toc-number">1.4.</span> <span class="toc-text">GameplayEffect</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#applygameplayeffecttotarget"><span class="toc-number">1.4.1.</span> <span class="toc-text">ApplyGameplayEffectToTarget</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gameplaycue"><span class="toc-number">1.5.</span> <span class="toc-text">GameplayCue</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#routegameplaycue"><span class="toc-number">1.5.1.</span> <span class="toc-text">RouteGameplayCue</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cueinterfacehandlegameplaycue"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">CueInterface.HandleGameplayCue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ugameplaycuesethandlegameplaycue"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">UGameplayCueSet.HandleGameplayCue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#handlegameplaycuenotify_internal"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">HandleGameplayCueNotify_Internal</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gameplaytag"><span class="toc-number">1.6.</span> <span class="toc-text">GameplayTag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fgameplaytag"><span class="toc-number">1.6.1.</span> <span class="toc-text">FGameplayTag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fgameplaytagcontainer"><span class="toc-number">1.6.2.</span> <span class="toc-text">FGameplayTagContainer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ugameplaytagmanager"><span class="toc-number">1.6.3.</span> <span class="toc-text">UGameplayTagManager</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="ç³»åˆ—æ–‡ç« "><ul><li><a href="/2021/10/25/UE4/UE4CPP/API%E4%B8%8D%E6%AD%A3%E5%B8%B8%E5%B7%A5%E4%BD%9C-%E4%B9%8B-GetGameMode/" rel="bookmark" title="APIä¸æ­£å¸¸å·¥ä½œ ä¹‹ GetGameMode">APIä¸æ­£å¸¸å·¥ä½œ ä¹‹ GetGameMode</a></li><li><a href="/2021/10/25/UE4/UE4CPP/API%E4%B8%8D%E6%AD%A3%E5%B8%B8%E5%B7%A5%E4%BD%9C-%E4%B9%8B-GetPlayerController/" rel="bookmark" title="APIä¸æ­£å¸¸å·¥ä½œ ä¹‹ GetPlayerController">APIä¸æ­£å¸¸å·¥ä½œ ä¹‹ GetPlayerController</a></li><li><a href="/2021/10/25/UE4/UE4CPP/unreal%20%E5%BC%95%E6%93%8E%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/" rel="bookmark" title="unrealå¼•æ“å¯åŠ¨æµç¨‹">unrealå¼•æ“å¯åŠ¨æµç¨‹</a></li><li><a href="/2021/10/26/UE4/UE4CPP/%E4%BB%8ESVG%E6%96%87%E4%BB%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E6%97%85%E7%A8%8B/" rel="bookmark" title="ä»SVGæ–‡ä»¶å¼€å§‹çš„æ—…ç¨‹~~~">ä»SVGæ–‡ä»¶å¼€å§‹çš„æ—…ç¨‹~~~</a></li><li><a href="/2021/10/29/UE4/UE4CPP/%E5%8F%8D%E5%B0%84%E7%B3%BB%E7%BB%9F%20API/" rel="bookmark" title="åå°„ç³»ç»ŸAPI  è§£æå’Œä½¿ç”¨">åå°„ç³»ç»ŸAPI è§£æå’Œä½¿ç”¨</a></li><li><a href="/2021/10/31/UE4/UE4CPP/Session%E7%9A%84%E4%BD%BF%E7%94%A8%20C++%E7%AF%87/" rel="bookmark" title="Sessionçš„ä½¿ç”¨ C++ç¯‡">Sessionçš„ä½¿ç”¨ C++ç¯‡</a></li><li><a href="/2021/11/02/UE4/UE4CPP/Unreal%20%E5%BA%8F%E5%88%97%E5%8C%96/" rel="bookmark" title="Unreal åºåˆ—åŒ–~~~">Unreal åºåˆ—åŒ–~~~</a></li><li><a href="/2021/11/06/UE4/UE4CPP/Unreal%20GC%E8%BF%87%E7%A8%8B/" rel="bookmark" title="Unreal GCè¿‡ç¨‹">Unreal GCè¿‡ç¨‹</a></li><li><a href="/2021/11/08/UE4/UE4CPP/UClass%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E6%88%90%E9%95%BF/" rel="bookmark" title="UClassçš„è¯ç”Ÿä¸æˆé•¿">UClassçš„è¯ç”Ÿä¸æˆé•¿</a></li><li><a href="/2021/11/11/UE4/UE4CPP/UE4%E4%BB%A3%E7%90%86%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E7%94%A8%E6%B3%95/" rel="bookmark" title="UE4ä»£ç†çš„å®ç°ä¸ç”¨æ³•">UE4ä»£ç†çš„å®ç°ä¸ç”¨æ³•</a></li><li><a href="/2021/11/15/UE4/UE4CPP/FProperty%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E6%80%BB%E7%BB%93/" rel="bookmark" title="FPropertyçš„åˆ†æä¸æ€»ç»“">FPropertyçš„åˆ†æä¸æ€»ç»“</a></li><li><a href="/2021/11/22/UE4/UE4CPP/Unreal%20%E5%A4%9A%E7%A7%8D%E6%8C%87%E9%92%88%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" rel="bookmark" title="Unreal å¤šç§æŒ‡é’ˆå®ç°åŸç†">Unreal å¤šç§æŒ‡é’ˆå®ç°åŸç†</a></li><li><a href="/2021/11/26/UE4/UE4CPP/Unreal%20Slate/" rel="bookmark" title="Unreal Slate">Unreal Slate</a></li><li><a href="/2021/12/01/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20%E6%80%BB%E8%A7%88%20&%20UEngine%20&%20UGameInstance/" rel="bookmark" title="Gameplay â€”â€” æ€»è§ˆ & UEngine & UGameInstance">Gameplay â€”â€” æ€»è§ˆ & UEngine & UGameInstance</a></li><li><a href="/2021/12/03/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20FWorldContext%20&%20UWorld%20&%20ULevel/" rel="bookmark" title="Gameplay â€”â€” FWorldContext & UWorld & ULevel">Gameplay â€”â€” FWorldContext & UWorld & ULevel</a></li><li><a href="/2021/12/06/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AActor%20&%20UActorComponent/" rel="bookmark" title="Gameplay â€”â€” AActor & UActorComponent">Gameplay â€”â€” AActor & UActorComponent</a></li><li><a href="/2021/12/09/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20APawn%20&%20AController%20&%20APlayerController/" rel="bookmark" title="Gameplay â€”â€” APawn & AController & APlayerController">Gameplay â€”â€” APawn & AController & APlayerController</a></li><li><a href="/2021/12/12/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AGameMode%20&%20AGameState%20&%20APlayerState/" rel="bookmark" title="Gameplay â€”â€” AGameMode & AGameState & APlayerState">Gameplay â€”â€” AGameMode & AGameState & APlayerState</a></li><li><a href="/2021/12/15/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20USavegame%20&%20UPlayer/" rel="bookmark" title="Gameplay â€”â€” USavegame & UPlayer">Gameplay â€”â€” USavegame & UPlayer</a></li><li class="active"><a href="/2021/12/17/UE4/UE4CPP/Unreal%20GAS%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" rel="bookmark" title="Unreal GAS æºç è§£æ">Unreal GAS æºç è§£æ</a></li><li><a href="/2021/12/28/UE4/UE4CPP/CustomItemModule/" rel="bookmark" title="Custom Item Module">Custom Item Module</a></li><li><a href="/2021/12/30/UE4/UE4CPP/Unreal%20%E5%BC%82%E6%AD%A5%E4%B8%8E%E5%B9%B6%E8%A1%8C%E7%BC%96%E7%A8%8B/" rel="bookmark" title="Unreal å¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹">Unreal å¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹</a></li><li><a href="/2022/01/03/UE4/UE4CPP/Unreal%20MovementComponent%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" rel="bookmark" title="Unreal MovementComponent æºç è§£æ">Unreal MovementComponent æºç è§£æ</a></li><li><a href="/2022/01/08/UE4/UE4CPP/Unreal%20%E8%93%9D%E5%9B%BE%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6/" rel="bookmark" title="Unreal è“å›¾åº•å±‚å®ç°æœºåˆ¶">Unreal è“å›¾åº•å±‚å®ç°æœºåˆ¶</a></li><li><a href="/2022/02/12/UE4/UE4CPP/Unreal%20%E5%8A%A8%E7%94%BB%E7%9B%B8%E5%85%B3/" rel="bookmark" title="Unreal MotionMatching">Unreal MotionMatching</a></li><li><a href="/2022/03/15/UE4/UE4CPP/Unreal%20%E5%B8%B8%E7%94%A8%E6%8E%A5%E5%8F%A3%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20%E4%B9%8B%E4%B8%80/" rel="bookmark" title="Unreal å¸¸ç”¨æ¥å£æºç åˆ†æ ä¹‹ä¸€">Unreal å¸¸ç”¨æ¥å£æºç åˆ†æ ä¹‹ä¸€</a></li></ul></div><div class="overview panel" data-title="ç«™ç‚¹æ¦‚è§ˆ"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="-YIFEI-" data-src="/images/avatar.jpg"><p class="name" itemprop="name">-YIFEI-</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">57</span> <span class="name">æ–‡ç« </span></a></div><div class="item categories"><a href="/categories/"><span class="count">15</span> <span class="name">åˆ†ç±»</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0tvdG9yaS1TdWtp" title="https:&#x2F;&#x2F;github.com&#x2F;Kotori-Suki"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS90dnQtNjA=" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;tvt-60"><i class="ic i-zhihu"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>é¦–é¡µ</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>æ–‡ç« </a><ul class="submenu"><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>åˆ†ç±»</a></li></ul></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>æ ‡ç­¾</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/12/15/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20USavegame%20&%20UPlayer/" rel="prev" title="ä¸Šä¸€ç¯‡"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/12/28/UE4/UE4CPP/CustomItemModule/" rel="next" title="ä¸‹ä¸€ç¯‡"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>éšæœºæ–‡ç« </h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="åˆ†ç±»äº C++åŸºç¡€">C++åŸºç¡€</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="åˆ†ç±»äº è®¾è®¡æ¨¡å¼">è®¾è®¡æ¨¡å¼</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/" title="åˆ†ç±»äº åˆ›å»ºå‹æ¨¡å¼">åˆ›å»ºå‹æ¨¡å¼</a></div><span><a href="/2021/08/17/CPPBase/DesignPattern/AbstractFactory/" title="æŠ½è±¡å·¥å‚æ¨¡å¼">æŠ½è±¡å·¥å‚æ¨¡å¼</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="åˆ†ç±»äº UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="åˆ†ç±»äº UE4_C++">UE4_C++</a></div><span><a href="/2021/11/22/UE4/UE4CPP/Unreal%20%E5%A4%9A%E7%A7%8D%E6%8C%87%E9%92%88%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" title="Unreal å¤šç§æŒ‡é’ˆå®ç°åŸç†">Unreal å¤šç§æŒ‡é’ˆå®ç°åŸç†</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="åˆ†ç±»äº C++åŸºç¡€">C++åŸºç¡€</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="åˆ†ç±»äº è®¾è®¡æ¨¡å¼">è®¾è®¡æ¨¡å¼</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/" title="åˆ†ç±»äº åˆ›å»ºå‹æ¨¡å¼">åˆ›å»ºå‹æ¨¡å¼</a></div><span><a href="/2021/08/17/CPPBase/DesignPattern/SimpleFactory/" title="ç®€å•å·¥å‚æ¨¡å¼">ç®€å•å·¥å‚æ¨¡å¼</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="åˆ†ç±»äº UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="åˆ†ç±»äº UE4_C++">UE4_C++</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/Gameplay/" title="åˆ†ç±»äº Gameplay">Gameplay</a></div><span><a href="/2021/12/01/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20%E6%80%BB%E8%A7%88%20&%20UEngine%20&%20UGameInstance/" title="Gameplay â€”â€” æ€»è§ˆ &amp; UEngine &amp; UGameInstance">Gameplay â€”â€” æ€»è§ˆ & UEngine & UGameInstance</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="åˆ†ç±»äº UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="åˆ†ç±»äº UE4_C++">UE4_C++</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/Gameplay/" title="åˆ†ç±»äº Gameplay">Gameplay</a></div><span><a href="/2021/12/06/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AActor%20&%20UActorComponent/" title="Gameplay â€”â€” AActor &amp; UActorComponent">Gameplay â€”â€” AActor & UActorComponent</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="åˆ†ç±»äº C++åŸºç¡€">C++åŸºç¡€</a></div><span><a href="/2021/08/20/CPPBase/%E5%85%B3%E9%94%AE%E8%AF%8D%E8%A7%A3%E6%9E%90/" title="C++å…³é”®è¯è§£æ">C++å…³é”®è¯è§£æ</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="åˆ†ç±»äº UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="åˆ†ç±»äº UE4_C++">UE4_C++</a></div><span><a href="/2021/10/31/UE4/UE4CPP/Session%E7%9A%84%E4%BD%BF%E7%94%A8%20C++%E7%AF%87/" title="Sessionçš„ä½¿ç”¨ C++ç¯‡">Sessionçš„ä½¿ç”¨ C++ç¯‡</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ComputerBase/" title="åˆ†ç±»äº è®¡ç®—æœºåŸºç¡€">è®¡ç®—æœºåŸºç¡€</a> <i class="ic i-angle-right"></i> <a href="/categories/ComputerBase/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="åˆ†ç±»äº è®¡ç®—æœºç½‘ç»œ">è®¡ç®—æœºç½‘ç»œ</a></div><span><a href="/2021/08/16/ComputerBase/ComputerNetworks/TCPUDP%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE/" title="TCP&#x2F;UDPä¼ è¾“å±‚åè®®">TCP/UDPä¼ è¾“å±‚åè®®</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="åˆ†ç±»äº UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="åˆ†ç±»äº UE4_C++">UE4_C++</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/Gameplay/" title="åˆ†ç±»äº Gameplay">Gameplay</a></div><span><a href="/2021/12/15/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20USavegame%20&%20UPlayer/" title="Gameplay â€”â€” USavegame &amp; UPlayer">Gameplay â€”â€” USavegame & UPlayer</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="åˆ†ç±»äº C++åŸºç¡€">C++åŸºç¡€</a></div><span><a href="/2021/08/23/CPPBase/%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98/" title="è¿­ä»£å™¨å¤±æ•ˆé—®é¢˜">è¿­ä»£å™¨å¤±æ•ˆé—®é¢˜</a></span></li></ul></div><div><h2>æœ€æ–°è¯„è®º</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2021 â€“ <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">-YIFEI- @ Afei's Blog</span></div><div class="powered-by">åŸºäº <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/12/17/UE4/UE4CPP/Unreal GAS æºç è§£æ/",favicon:{show:"ï¼ˆâ—Â´3ï½€â—ï¼‰ã‚„ã‚Œã‚„ã‚Œã ãœ",hide:"(Â´Ğ”ï½€)å¤§å¤‰ã ï¼"},search:{placeholder:"æ–‡ç« æœç´¢",empty:"å…³äº ã€Œ ${query} ã€ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœåˆ°",stats:"${time} ms å†…æ‰¾åˆ° ${hits} æ¡ç»“æœ"},valine:!0,fancybox:!0,copyright:'å¤åˆ¶æˆåŠŸï¼Œè½¬è½½è¯·éµå®ˆ <i class="ic i-creative-commons"></i>BY-NC-SA åè®®ã€‚',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>