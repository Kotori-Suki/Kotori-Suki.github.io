<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="ä¸€ä¸ªå¹´è½»äººå¥”å‘æ¢¦æƒ³çš„è¶³è¿¹" href="https://kotori_suki.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="ä¸€ä¸ªå¹´è½»äººå¥”å‘æ¢¦æƒ³çš„è¶³è¿¹" href="https://kotori_suki.github.io/atom.xml"><link rel="alternate" type="application/json" title="ä¸€ä¸ªå¹´è½»äººå¥”å‘æ¢¦æƒ³çš„è¶³è¿¹" href="https://kotori_suki.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="https://kotori_suki.github.io/2021/12/30/UE4/UE4CPP/Unreal%20%E5%BC%82%E6%AD%A5%E4%B8%8E%E5%B9%B6%E8%A1%8C%E7%BC%96%E7%A8%8B/"><title>Unreal å¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹ - UE4_C++ - UE4 | Afei's Blog = ä¸€ä¸ªå¹´è½»äººå¥”å‘æ¢¦æƒ³çš„è¶³è¿¹ = Welcome to my blog !</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Unreal å¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹</h1><div class="meta"><span class="item" title="åˆ›å»ºæ—¶é—´ï¼š2021-12-30 10:12:48"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">å‘è¡¨äº</span> <time itemprop="dateCreated datePublished" datetime="2021-12-30T10:12:48+08:00">2021-12-30</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="åˆ‡æ¢å¯¼èˆªæ "><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Afei's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclg5ms2rj20zk0m8u0x.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giciryrr3rj20zk0m8nhk.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipeybxm1pj20zk0m8niv.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclfdu6exj20zk0m87hw.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipesrnqv3j20zk0m8ava.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclj61ylzj20zk0m8b29.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">é¦–é¡µ</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/UE4/" itemprop="item" rel="index" title="åˆ†ç±»äº UE4"><span itemprop="name">UE4</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/UE4/UE4CPP/" itemprop="item" rel="index" title="åˆ†ç±»äº UE4_C++"><span itemprop="name">UE4_C++</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://kotori_suki.github.io/2021/12/30/UE4/UE4CPP/Unreal%20%E5%BC%82%E6%AD%A5%E4%B8%8E%E5%B9%B6%E8%A1%8C%E7%BC%96%E7%A8%8B/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="-YIFEI-"><meta itemprop="description" content="Welcome to my blog !, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ä¸€ä¸ªå¹´è½»äººå¥”å‘æ¢¦æƒ³çš„è¶³è¿¹"></span><div class="body md" itemprop="articleBody"><h1 id="unreal-å¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹"><a class="anchor" href="#unreal-å¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹">#</a> Unreal å¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹</h1><p>ç®€ä»‹ï¼š** å¼‚æ­¥å’Œå¹¶è¡Œç¼–ç¨‹å¯ä»¥åœ¨æ¸¸æˆè¿è¡Œé‡åˆ°è¾ƒä¸ºç¹é‡çš„ä»»åŠ¡æ—¶ (å¦‚ï¼šGC)ï¼Œå°†å…¶åˆ†è§£æˆ–å¼‚æ­¥å¤„ç†ï¼Œä»è€Œä½¿æ¸¸æˆä¿æŒè‰¯å¥½çš„å¸§ç‡ã€‚**Unreal çš„åº•å±‚è¯­è¨€æ˜¯ C++ï¼ŒUE4 å’Œ C++ æä¾›çš„å¼‚æ­¥å’Œå¹¶è¡Œç¼–ç¨‹çš„æ¥å£ä¹Ÿå¤§ä½“ç›¸åŒã€‚ä½† UE4 æä¾›çš„åŠŸèƒ½æ›´å¤šï¼Œè¦æ±‚ç¨‹åºå‘˜æŒæ¡ / å®ç°çš„å‡½æ•°ä¹Ÿæ›´å¤šä¸€äº›ã€‚** æœ¬ç¯‡å°†ä»¥ C++ / UE4 å¯¹æ¯”çš„æ–¹å¼ï¼Œä»‹ç»ä¸å¼‚æ­¥å’Œå¹¶è¡Œç¼–ç¨‹ç›¸å…³çš„ç±»ä¸å‡½æ•°ï¼Œå¹¶åˆ†æè¿™äº›å‡½æ•°åœ¨ UE4 ä¸­çš„åº•å±‚å®ç°æœºåˆ¶ã€‚** æœ¬ç¯‡è§£æçš„ç»“æ„åŒ…æ‹¬ï¼š&quot;TPromise&lt;T&gt;&quot; , &quot;TFuture&lt;T&gt;&quot; , &quot;FPlatformAtomics&quot; , &quot;FRunableThread&quot; , &quot;FAsyncTask&quot; , &quot;FTaskGraph&quot; , &quot;ParallelFor&quot;, &quot;FCriticalSection&quot; , &quot;FScopeLock&quot; ç­‰ã€‚æœ¬ç¯‡ä»»åŠ¡æ¯”è¾ƒç¹é‡ ( ç„¶è€Œå†™è€…çš„è„‘å­åšä¸åˆ°å¹¶è¡Œå¤„ç† ğŸ˜¦ )ï¼Œèµ¶ç´§å¼€å§‹å§ï½ï½ï½</p><p>å¼‚æ­¥å¤„ç†å’Œå¯¹æ¸¸æˆå¸§ç‡çš„å½±å“å®æµ‹å‚è€ƒï¼š</p><ul><li>[<span class="exturl" data-url="aHR0cDovL2hpc3RvcmlhLmNvLmpwL2FyY2hpdmVzLzYwMTQ=">UE4] éåŒæœŸå‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ | historia Inc - æ ªå¼ä¼šç¤¾ãƒ’ã‚¹ãƒˆãƒªã‚¢</span></li></ul><h2 id="tpromiset-stdpromiset"><a class="anchor" href="#tpromiset-stdpromiset">#</a> TPromise&lt;T&gt; &amp; std::promise&lt;T&gt;</h2><p><code>std::promise&lt;T&gt;</code> æ˜¯ C++11 ä¸­çš„æ¨¡æ¿ç±»ï¼Œé€šå¸¸ä¸ <code>std::future&lt;T&gt;</code> ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ä¿è¯å¹¶è¡Œç¼–ç¨‹æ—¶æ•°æ®è·å–çš„æ­£ç¡®æ€§ã€‚å…¶ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><p></p><figure class="highlight c++"><figcaption><span>TPromise</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cpp_promise</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::promise&lt;<span class="keyword">int</span>&gt; p;</span><br><span class="line">    <span class="keyword">auto</span> f = p.<span class="built_in">get_future</span>();	<span class="comment">// auto = std::future&lt;int&gt;</span></span><br><span class="line">    p.<span class="built_in">set_value</span>(<span class="number">2333</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UE4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Async/Future.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ue4_promise</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TPromise&lt;<span class="keyword">int</span>&gt; p;</span><br><span class="line">    <span class="keyword">auto</span> f = p.<span class="built_in">GetFuture</span>();		<span class="comment">// auto = TFuture&lt;int&gt;</span></span><br><span class="line">    p.<span class="built_in">SetValue</span>(<span class="number">2333</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä½¿ç”¨æ–¹æ³•å‡ ä¹ä¸€è‡´ã€‚åº•å±‚å®ç°ä»£ç ç•™åˆ° <code>TFuture&lt;T&gt;</code> ä¸­ä¸€èµ·åˆ†æ</p><h2 id="tfuturet-stdfuturet"><a class="anchor" href="#tfuturet-stdfuturet">#</a> TFuture&lt;T&gt; &amp; std::future&lt;T&gt;</h2><p><code>std::future&lt;T&gt;</code> è¡¨ç¤ºæœªæ¥å°†åœ¨å…¶ä»–çº¿ç¨‹ä¸­è·å–çš„å€¼ã€‚å…¶å¯¹è±¡ä¸­åŒ…å«ä¸€ä¸ªå¸ƒå°”å˜é‡ï¼Œè®°å½•å½“å‰å¯¹è±¡æ˜¯å¦å·²è·å–ï¼Œä½¿ç”¨ <code>future&lt;T&gt;</code> å†…çš„æ•°æ®æ—¶åº”åˆ¤æ–­å…¶æ˜¯å¦æœ‰æ•ˆã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><p></p><figure class="highlight c++"><figcaption><span>TFuture</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cpp_future</span><span class="params">(std::future&lt;<span class="keyword">int</span>&gt; &amp;f)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ä¸é˜»å¡çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">if</span>(f.<span class="built_in">wait_for</span> (std::chrono::<span class="built_in">seconds</span>(<span class="number">0</span>)) == std::future_status::ready)</span><br><span class="line">        <span class="keyword">auto</span> result = f.<span class="built_in">get</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UE4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Async/Future.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ue4_future</span><span class="params">(TFuture&lt;<span class="keyword">int</span>&gt; &amp;f)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ä¸é˜»å¡çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">if</span>(f.<span class="built_in">IsReady</span>())</span><br><span class="line">        <span class="keyword">auto</span> result = f.<span class="built_in">Get</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä»¥ä¸Šæ–¹æ³•éƒ½æ˜¯ä¸é˜»å¡çº¿ç¨‹çš„ï¼Œä¸èƒ½ä¿è¯è¿è¡Œå if ç¨‹åºä½“å¿…å®šæ‰§è¡Œã€‚å¯ä»¥å°†æ­¤å‡½æ•°æ·»åŠ åˆ° &quot;FutureState&quot; çš„å›è°ƒä¸­ç¡®ä¿å…¶æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨æ­¤å‡½æ•°å¤–å±‚é˜»å¡çº¿ç¨‹ï¼Œäº¦æˆ–æ˜¯ä½œä¸º &quot;TaskGraph&quot; çš„å‰ç½®ä»»åŠ¡ç­‰æ–¹å¼å®ç°ã€‚æ¥ä¸‹æ¥çœ‹çœ‹ï¼Œ <code>TPromise&lt;T&gt;</code> ä¸ <code>TFuture&lt;T&gt;</code> åœ¨ UE4 ä¸­çš„åº•å±‚å®ç°æœºåˆ¶ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p><p><img data-src="TPromise&amp;TFuture%E7%B1%BB%E5%9B%BE.png" alt="FPromise&amp;FFutureç±»å›¾"></p><p><code>TPromise&lt;T&gt;</code> å’Œ <code>TFuture&lt;T&gt;</code> ä¸­çš„ <code>TFutureState* State</code> å®é™…ä¸ŠæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚åœ¨ <code>TPromise&lt;T&gt;</code> è°ƒç”¨äº† <code>SetValue</code> åï¼Œ <code>State</code> å°†è¢«èµ‹å€¼ï¼Œè€Œ <code>State</code> ä¸­çš„ <code>Complete</code> åŸå­å¸ƒå°”å€¼ä¹Ÿå°†è¢«è®¾ç½®ä¸º trueï¼Œæ­¤å <code>State</code> çš„å€¼å°†ä¸å†å…è®¸è¢«æ”¹å˜ï¼Œ <code>TFuture&lt;T&gt;</code> ä¹Ÿå¯ä»¥è·å–åˆ° <code>State</code> ä¸­çš„å€¼ï¼Œä»è€Œå®ç°å¤šçº¿ç¨‹ä½¿ç”¨æ•°æ®çš„å®‰å…¨ã€‚å¦å¤–ï¼Œ <code>State</code> å¯ä»¥åœ¨ <code>TFuture&lt;T&gt;</code> ä¸­è°ƒç”¨ <code>Reset</code> é‡ç½®ã€‚</p><h2 id="fplatformatomics"><a class="anchor" href="#fplatformatomics">#</a> FPlatformAtomics</h2><p>&quot;FPlatformAtomics&quot; ä¸ºå¹³å°é€šç”¨çš„åŸå­æ“ä½œå‡½æ•°åº“ï¼Œå®šä¹‰äº†å„ç§å¯¹æ™®é€šå˜é‡çš„åŸå­æ“ä½œå‡½æ•°ã€‚å¦‚ï¼š <code>InterlockedIncrement</code> , <code>InterlockedExchange</code> ç­‰ã€‚å…¶å­ç±»åˆ†åˆ«å®ç°ä¸åŒå¹³å°å¯¹åº”çš„åŸå­æ“ä½œå‡½æ•°ï¼Œä»¥ä¸‹æ˜¯ GCC/Clang å¯¹åŸå­æ“ä½œç³»ç»Ÿå‡½æ•°çš„å®ç°ã€‚</p><p></p><figure class="highlight c++"><figcaption><span>FClangPlatformAtomics</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * GCC/Clang implementation of the Atomics OS functions</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CORE_API</span> <span class="title">FClangPlatformAtomics</span> :</span> <span class="keyword">public</span> FGenericPlatformAtomics</span><br><span class="line">&#123;</span><br><span class="line"> 	<span class="function"><span class="keyword">static</span> FORCEINLINE int32 <span class="title">InterlockedIncrement</span><span class="params">(<span class="keyword">volatile</span> int32* Value)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> __atomic_fetch_add(Value, <span class="number">1</span>, __ATOMIC_SEQ_CST) + <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> FORCEINLINE int32 <span class="title">InterlockedExchange</span><span class="params">(<span class="keyword">volatile</span> int32* Value, int32 Exchange)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> __atomic_exchange_n(Value, Exchange, __ATOMIC_SEQ_CST);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// .........</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç†Ÿæ‚‰ GCC/Clang çš„æœ‹å‹åº”è¯¥å¯¹ä¸Šé¢çš„å‡½æ•°æ¯”è¾ƒäº†è§£ã€‚ <code>__atomic_fetch_add</code> å®é™…ä¸Šå°±æ˜¯ GCC/Clang ä¸­åŠ è¿ç®—ç¬¦çš„åŸå­æ“ä½œå‡½æ•°ï¼Œè€Œ <code>__ATOMIC_SEQ_CST</code> è¡¨ç¤ºåŒå‘å®Œå…¨å±éšœçš„å†…å­˜æ¨¡å‹ï¼Œä¸æ‰€æœ‰çº¿ç¨‹ä¸­çš„è·å–åŠ è½½å’Œé‡Šæ”¾å­˜å‚¨åŒæ­¥ã€‚</p><p>å¯¹äºå…¶ä»–å¹³å°è¯­è¨€ä¹Ÿä¼šç”±ç›¸å…³çš„å®ç°ï¼Œä¸å†å±•å¼€ã€‚</p><h2 id="frunnablethread-stdthread"><a class="anchor" href="#frunnablethread-stdthread">#</a> FRunnableThread &amp; std::thread</h2><p><code>std::thread</code> æ˜¯ C++11 ä¸­ä½¿ç”¨å¤šçº¿ç¨‹æœ€åŸå§‹çš„çº¿ç¨‹ç±»ã€‚Unreal ä¸­å¯¹åº”å®ç°ä¸º <code>FRunnableThread</code> ç±»ã€‚è™½è¯´æ˜¯å¤åˆ»ï¼Œä½†å®é™…ä¸Šè¿˜æ˜¯æœ‰è®¸å¤šä¸åŒçš„åœ°æ–¹ã€‚å’±å…ˆçœ‹çœ‹ä½¿ç”¨æ–¹æ³•ä¸Šçš„åŒºåˆ«ï¼š</p><p></p><figure class="highlight c++"><figcaption><span>FRunableThread</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cpp_thread</span><span class="params">(std::promise&lt;<span class="keyword">int</span>&gt;&amp;&amp; p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> t = <span class="built_in">thread</span>([=, p = <span class="built_in">move</span>(p)]() <span class="keyword">mutable</span> &#123;</span><br><span class="line">        p.<span class="built_in">set_value</span>(<span class="number">2333</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    t.<span class="built_in">join</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UE4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;HAL/RunnableThread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Async/Future.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ue4_thread</span><span class="params">(TPromise&lt;<span class="keyword">int</span>&gt;&amp;&amp; p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">r_type</span> :</span> <span class="keyword">public</span> FRunnable</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">r_type</span>(TPromise&lt;<span class="keyword">int</span>&gt;&amp;&amp; p_) : <span class="built_in">p</span>(<span class="built_in">MoveTemp</span>(p_)) &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">Init</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123; <span class="keyword">return</span> <span class="literal">true</span>; &#125;</span><br><span class="line">        <span class="function">uint32 <span class="title">Run</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123; p.<span class="built_in">SetValue</span>(<span class="number">2333</span>); <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Stop</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Exit</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;&#125;</span><br><span class="line">        </span><br><span class="line">        TPromise&lt;<span class="keyword">int</span>&gt; p;</span><br><span class="line">    &#125; <span class="built_in">r</span>(<span class="built_in">MoveTemp</span>(p));</span><br><span class="line">    </span><br><span class="line">    EThreadPriority InThreadPri= TPri_Highest;</span><br><span class="line">    <span class="keyword">auto</span> t = FRunnableThread::<span class="built_in">Create</span>(&amp;r, <span class="built_in">TEXT</span>(<span class="string">&quot;promise-future tester&quot;</span>), <span class="number">0</span>, InThreadPri);</span><br><span class="line">    t.<span class="built_in">WaitForCompletion</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>UE4 ä¸­åˆ›å»ºåŸå§‹çº¿ç¨‹è¿œæ¯” C++ ä¸­çš„éº»çƒ¦ï¼Œä½†å…¶å®ä½¿ç”¨æ€è·¯éƒ½æ˜¯ä¸€æ ·çš„ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ç±» (åŒ…å«æ­¤çº¿ç¨‹è¿è¡Œæ‰€éœ€çš„æ•°æ®å’Œå‡½æ•°)ï¼Œç„¶åå¯ç”¨ä¸€ä¸ªçº¿ç¨‹è¿è¡Œè¯¥çº¿ç¨‹ç±»ä¸­çš„å‡½æ•°ã€‚UE4 ä¸­å£°æ˜çº¿ç¨‹ä¹‹æ‰€ä»¥ç¹çï¼Œå…¶åŸå› æ˜¯ UE4 ä¸­çš„å¼‚æ­¥ä»»åŠ¡ &quot;FAsyncTask&quot; å®é™…ä¸Šä¹Ÿæ˜¯åŸºäº &quot;FRunableThread&quot; çš„ï¼Œè€Œè¿™äº›ä»»åŠ¡éƒ½æœä» &quot;Framework&quot; çš„ç®¡ç†ï¼Œå› æ­¤éœ€è¦é¢å¤–å®ç°ä¸€äº›ç”¨äºç®¡ç†çº¿ç¨‹çš„å‡½æ•°ï¼Œå¦‚: Suspend, Kill ç­‰ã€‚</p><p>ä»¥ä¸‹æ˜¯ &quot;FRunnable&quot; ä¸ &quot;FRunnableThread&quot; åº•å±‚å®ç°æœºåˆ¶çš„åˆ†æã€‚</p><h3 id="frunnable-frunablethread"><a class="anchor" href="#frunnable-frunablethread">#</a> FRunnable &amp; FRunableThread</h3><p><code>FRunnable</code> æ˜¯ &quot;å¯æ‰§è¡Œ&quot; å¯¹è±¡çš„æ¥å£ã€‚å¯æ‰§è¡Œå¯¹è±¡æŒ‡å¯ä»¥åœ¨ä»»ä½•çº¿ç¨‹ä¸­æ‰§è¡Œçš„å¯¹è±¡ã€‚è°ƒç”¨æ–¹æ³•æ¨¡æ¿æœ‰ <code>Init()</code> , <code>Run()</code> , <code>Exit()</code> , <code>Stop()</code> . å¯æ‰§è¡Œå¯¹è±¡ä¼šæŒ‰ç…§å‡½æ•°è¯­ä¹‰åœ¨åˆé€‚çš„æ—¶å€™è°ƒç”¨é€‚å½“çš„å‡½æ•°ã€‚æ‰€æœ‰åˆå§‹åŒ–åœ¨ <code>Init()</code> ä¸­å®Œæˆï¼Œåˆå§‹åŒ–å¤±è´¥å°†è¿”å›é”™è¯¯ä»£ç ã€‚æˆåŠŸåˆ™è°ƒç”¨ <code>Run()</code> ä»¥å®Œæˆæ­¤çº¿ç¨‹çš„å·¥ä½œã€‚å®Œæˆåå°†è°ƒç”¨ <code>Exit()</code> ä»¥å…è®¸æ­£ç¡®çš„æ¸…ç†ã€‚ä»¥ä¸‹æ˜¯ &quot;FRunnable&quot; ç±»çš„ä»£ç å®ç°ï¼š</p><p></p><figure class="highlight c++"><figcaption><span>FRunnable</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Runnable.h</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CORE_API</span> <span class="title">FRunnable</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">Init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> uint32 <span class="title">Run</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Stop</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Exit</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> class FSingleThreadRunnable* <span class="title">GetSingleThreadInterface</span><span class="params">( )</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">FRunnable</span>() &#123; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p><code>FRunnable</code> å°†æˆ‘ä»¬çº¿ç¨‹æ‰€éœ€æ‰§è¡Œçš„æ‰€æœ‰å‡½æ•°åˆ†ç±»é›†æˆèµ·æ¥ï¼Œæä¾›ç»™ <code>FRunableThread</code> åœ¨ç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸæ—¶æŒ‰éœ€è°ƒç”¨ã€‚å°† <code>FRunnable</code> ç‹¬ç«‹å‡ºæ¥äº¦å¯ä»¥æ–¹ä¾¿å¼€å‘æ—¶ä½¿ç”¨ã€‚</p><p><code>FRunableThread</code> æ˜¯å¯æ‰§è¡Œçº¿ç¨‹çš„æ¥å£ï¼ŒæŒ‡å®šç”¨äºç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ã€‚ä»£ç ç»“æ„å¦‚ä¸‹ï¼š</p><p></p><figure class="highlight c++"><figcaption><span>FRunnableThread</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RunnableThread.h</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CORE_API</span> <span class="title">FRunnableThread</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="comment">// .......</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> FRunnableThread* <span class="title">Create</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        class FRunnable* InRunnable,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">const</span> TCHAR* ThreadName,</span></span></span><br><span class="line"><span class="params"><span class="function">        uint32 InStackSize = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        EThreadPriority InThreadPri = TPri_Normal,</span></span></span><br><span class="line"><span class="params"><span class="function">        uint64 InThreadAffinityMask = FPlatformAffinity::GetNoAffinityMask(),</span></span></span><br><span class="line"><span class="params"><span class="function">        EThreadCreateFlags InCreateFlags = EThreadCreateFlags::None)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SetThreadPriority</span><span class="params">( EThreadPriority NewPriority )</span> </span>= <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Suspend</span><span class="params">( <span class="keyword">bool</span> bShouldPause = <span class="literal">true</span> )</span> </span>= <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">Kill</span><span class="params">( <span class="keyword">bool</span> bShouldWait = <span class="literal">true</span> )</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">WaitForCompletion</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .......</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** çº¿ç¨‹åç§° */</span></span><br><span class="line">	FString ThreadName;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ­¤çº¿ç¨‹ä¸Šè¿è¡Œçš„å¯æ‰§è¡Œå¯¹è±¡ */</span></span><br><span class="line">	FRunnable* Runnable;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** çº¿ç¨‹åˆå§‹åŒ–åŒæ­¥äº‹ä»¶ï¼Œç¡®ä¿ Init() åœ¨å…è®¸ä¸»çº¿ç¨‹ç»§ç»­å‰å®Œæˆ */</span></span><br><span class="line">	FEvent* ThreadInitSyncEvent;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** çº¿ç¨‹äº²ç¼˜æ€§ */</span></span><br><span class="line">	uint64 ThreadAffinityMask;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** FTlsAutoCleanup æ•°ç»„ï¼Œéœ€è¦åœ¨çº¿ç¨‹ç»“æŸå‰åˆ é™¤è¿™äº›å®ä¾‹ */</span></span><br><span class="line">	TArray&lt;FTlsAutoCleanup*&gt; TlsInstances;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** çº¿ç¨‹ä¼˜å…ˆçº§ */</span></span><br><span class="line">	EThreadPriority ThreadPriority;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** åˆ›å»ºçº¿ç¨‹æ—¶è®¾å®šçš„ID */</span></span><br><span class="line">	uint32 ThreadID;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä» Unreal æä¾›ç»™æˆ‘ä»¬çš„å‡½æ•°ä¸­ä¹Ÿè®¸ä½ å·²ç»å‘ç°äº†ä½¿ç”¨ <code>FRunnableThread</code> çš„æ–¹æ³•ã€‚</p><ol><li>è°ƒç”¨ <code>FRunnableThread::Create()</code> åˆ›å»ºçº¿ç¨‹ï¼Œå¹¶ä¿ç•™å…¶è¿”å›å€¼çš„å¼•ç”¨ã€‚</li><li>è°ƒç”¨ <code>WaitForCompletion</code> ç­‰å¾…çº¿ç¨‹æ‰§è¡Œç»“æŸã€‚</li><li>æœŸé—´ï¼Œå¯ä»¥è°ƒç”¨ <code>Suspend()</code> æš‚åœ / ç»§ç»­æ­¤çº¿ç¨‹çš„æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ <code>Kill()</code> æ€æ­»çº¿ç¨‹</li><li>å¦å¤–ï¼Œè¿˜å¯ä»¥è°ƒç”¨ <code>SetThreadPriority()</code> æ¥è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§ç­‰ã€‚</li></ol><p>å…¶ä¸­ï¼Œ <code>Create()</code> å‡½æ•°å°†è°ƒç”¨å¹³å°ç‰¹å®šçš„åˆ›å»ºçº¿ç¨‹æ–¹æ³•ï¼Œå¹¶è°ƒç”¨ <code>SetupCreatedThread()</code> è®¾ç½®è¯¥çº¿ç¨‹çš„ç›¸å…³å±æ€§å’Œè°ƒç”¨ Runnable çš„ <code>Init()</code> æ–¹æ³•å°†å…¶åˆå§‹åŒ–ï¼Œæœ€åè°ƒç”¨ <code>PostCreate()</code> æ³¨å†Œçº¿ç¨‹è°ƒè¯•ä¿¡æ¯ã€‚å…¶ä»–çš„æ–¹æ³•éƒ½åŸºäºå¹³å° API è€Œä¸åŒï¼Œä¸åšå±•å¼€ã€‚</p><h2 id="fasynctask-stdasync"><a class="anchor" href="#fasynctask-stdasync">#</a> FAsyncTask &amp; std::async</h2><p><code>std::async</code> æ˜¯ C++11 åˆ›å»ºå¼‚æ­¥ä»»åŠ¡çš„æ–¹æ³•ï¼Œå…¶éšè—äº†çº¿ç¨‹åˆ›å»ºå†…éƒ¨çš„ç»†èŠ‚ï¼Œæ–¹ä¾¿å¼€å‘è€…ç›´æ¥è·å–å¼‚æ­¥æ‰§è¡Œçš„çŠ¶æ€å’Œç»“æœã€‚å¯¹åº”äº Unreal ä¸­çš„ <code>FAsyncTask</code> ç±»ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><p></p><figure class="highlight c++"><figcaption><span>FAsyncTask</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++ </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cpp_async</span><span class="params">(std::promise&lt;<span class="keyword">int</span>&gt;&amp;&amp; p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::<span class="built_in">async</span>(std::launch::async, [&amp;]()&#123; p.<span class="built_in">set_value</span>(<span class="number">2333</span>); &#125;); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UE4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Async/AsyncWork.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Async/Future.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ue4_async</span><span class="params">(TPromise&lt;<span class="keyword">int</span>&gt;&amp;&amp; p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">at_type</span> :</span> <span class="keyword">public</span> FNonAbandonableTask</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">FAutoDeleteAsyncTask</span>&lt;</span>at_type&gt;;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">at_type</span>(<span class="keyword">const</span> TFuture&lt;<span class="keyword">int</span>&gt;&amp;&amp; p_) : <span class="built_in">p</span>(<span class="built_in">MoveTemp</span>(p_)) &#123; &#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">DoWork</span><span class="params">()</span> </span>&#123; p.<span class="built_in">SetValue</span>(<span class="number">2333</span>); &#125;</span><br><span class="line"></span><br><span class="line">		<span class="function">FORCEINLINE TStatId <span class="title">GetStatId</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="built_in">RETURN_QUICK_DECLARE_CYCLE_STAT</span>(at_type, STATGROUP_ThreadPoolAsyncTasks);</span><br><span class="line">		&#125;</span><br><span class="line">        </span><br><span class="line">        TPromise&lt;<span class="keyword">int</span>&gt; p;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">new</span> FAutoDeleteAsyncTask&lt;at_type&gt;(<span class="built_in">MoveTemp</span>(p))-&gt;<span class="built_in">StartBackgroundTask</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä»¥ä¸Šç¨‹åºè¯­ä¹‰ä¸Šæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚å¦‚ä½ æ‰€è§ï¼ŒUE4 çš„å¼‚æ­¥ä»»åŠ¡åˆ›å»ºå°±æ˜¯å¦‚æ­¤éº»çƒ¦ã€‚å¼€å‘è€…é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªä»»åŠ¡ç±»ï¼Œç„¶åè°ƒç”¨ <code>FAsyncTask.StartTask()</code> å¼€å§‹æ‰§è¡Œã€‚ç›¸æ¯” C++ åªéœ€ç»™å®šå¼‚æ­¥ç­–ç•¥å’Œå¼‚æ­¥å‡½æ•°å³å¯æ‰§è¡Œçš„å¼€å‘æ¨¡å¼ï¼ŒUE4 è¦åšçš„å·¥ä½œæ˜¾ç„¶æ›´ç¹çã€‚ä¸è¿‡ä¹Ÿå¾—ç›Šäºæ­¤ï¼ŒUE4 ä¸­çš„å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œä¹Ÿæ˜¯å®Œå…¨åœ¨ Framework çš„æŒæ§ä¹‹ä¸‹çš„ã€‚æœ‰ç‚¹ &quot;å·¥ä½œé‡æ¢å–çµæ´»æ€§&quot; çš„æ„Ÿè§‰ï¼Œä¸è¿‡å†™è€…æ›´å–œæ¬¢ UE4 å¯¹å¼‚æ­¥ä»»åŠ¡å°è£… çš„å¼€å‘æ¨¡å¼ï¼Œå› ä¸ºåœ¨å¼‚æ­¥ä»»åŠ¡è¿‡å¤šæˆ–è¿‡äºå¤æ‚æ—¶ï¼Œå°è£…å¯ä»¥ä½¿æ¡ç†æ›´åŠ æ¸…æ™°ï¼Œå¯è¯»æ€§æ›´é«˜ã€‚</p><p>ä»¥ä¸‹æ˜¯å¯¹ &quot;FAsyncTask&quot; (å¼‚æ­¥ä»»åŠ¡) ç³»ç»Ÿåº•å±‚å®ç°æœºåˆ¶çš„è§£æï¼š</p><p><img data-src="AsyncTask.png" alt="AsyncTask"></p><p>ä»ç±»å›¾ä¸­å¯ä»¥å‘ç°ï¼Œå¼‚æ­¥ä»»åŠ¡æ˜¯åŸºäºçº¿ç¨‹æ± ä»»åŠ¡å’Œçº¿ç¨‹æ± çš„ã€‚è€Œçº¿ç¨‹æ± ä»»åŠ¡å®é™…ä¸Šä¹Ÿæ˜¯å¯æ‰§è¡Œå¯¹è±¡ã€‚è¿™å…¶å®è·Ÿ C++ å®ç° <code>std::async</code> çš„åˆè¡·ä¹ƒè‡³æ€è·¯éƒ½æ˜¯ä¸€æ ·çš„ã€‚ <code>FAsyncTask</code> (å¼‚æ­¥ä»»åŠ¡) çš„å­˜åœ¨å…å»äº†å¼€å‘è€…ä¸çº¿ç¨‹ç›´æ¥æ‰“äº¤é“çš„éº»çƒ¦ï¼Œå¼€å‘è€…åªéœ€ä¸“æ³¨äºåˆ¶å®šä»»åŠ¡å³å¯ï¼Œæé«˜å¤šçº¿ç¨‹ç¨‹åºå¼€å‘æ•ˆç‡ã€‚</p><p>æ¥ä¸‹æ¥ç†æ¸…å¼‚æ­¥ä»»åŠ¡ä»åˆ›å»ºåˆ°é”€æ¯çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œéƒ½æ˜¯æ€ä¹ˆä¸çº¿ç¨‹æ± äº¤äº’çš„ï¼Œçº¿ç¨‹æ± åˆæ˜¯æ€ä¹ˆæœ‰åºåœ°æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„ã€‚</p><ol><li>é¦–å…ˆæˆ‘ä»¬è°ƒç”¨ <code>FAsyncTask.Start()</code> å°†å¼‚æ­¥ä»»åŠ¡æ·»åŠ åˆ°ä¼ å…¥çš„çº¿ç¨‹æ± ä¸­ (å¼‚æ­¥ä»»åŠ¡ä¹Ÿæ˜¯çº¿ç¨‹æ± ä»»åŠ¡)ï¼›</li><li>æ¥ç€çº¿ç¨‹æ± ä¼šå°†çœ‹çœ‹è¿˜æœ‰æ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥å°†ç©ºé—²çº¿ç¨‹ä¸­è°ƒç”¨ <code>DoWork</code> æ‰§è¡Œæ­¤ä»»åŠ¡ï¼›</li><li>å¦‚æœæ²¡æœ‰ï¼Œåˆ™å°†æ­¤ä»»åŠ¡æ·»åŠ åˆ° <code>QueuedWork</code> æ•°ç»„ä¸­ï¼Œç­‰å¾…æœ‰ç©ºé—²çº¿ç¨‹æ—¶æ‰§è¡Œã€‚</li><li><code>DoWork()</code> ä¸­å…ˆç»™ <code>QueuedWork</code> èµ‹å€¼ï¼Œè°ƒç”¨å†…å­˜å±éšœ (æ›´æ–° <code>QueuedWork</code> çš„ç¼“å­˜) åï¼Œæ¿€æ´» <code>DoWorkEvent</code></li><li>æ¿€æ´» <code>DoWorkEvent</code> å¹¶ä¸æ˜¯æŒ‡ <code>FEvent</code> ä¸­å­˜ç€å¼‚æ­¥ä»»åŠ¡ï¼Œå®é™…ä¸Šæ˜¯å”¤é†’å…¶å…³è”çš„çº¿ç¨‹ï¼Œè®©çº¿ç¨‹æ‰§è¡Œç›¸å…³å¼‚æ­¥ä»»åŠ¡ã€‚</li><li>å¼‚æ­¥ä»»åŠ¡å®Œæˆåæˆ–è¢«æ„å¤–ç»ˆæ­¢æ—¶ï¼Œå°†è°ƒç”¨ <code>KillThread()</code> å…³é—­ <code>DoWorkEvent</code> å¹¶å°†å…¶è¿”å›äº‹ä»¶æ± ä¸­ï¼Œæœ€åå…³é—­å¹¶é”€æ¯çº¿ç¨‹ã€‚</li></ol><p>è¿‡ç¨‹å¤§è‡´å¦‚æ­¤ï¼Œå¦‚æœæƒ³äº†è§£æ›´å¤šç»†èŠ‚ï¼Œè¯·è‡ªè¡Œç¿»çœ‹æºç ã€‚</p><h2 id="parallelfor-stdfor_each"><a class="anchor" href="#parallelfor-stdfor_each">#</a> ParallelFor &amp; std::for_each</h2><p><code>std::for_each</code> æ˜¯ C++17 ä¸­å¼•å…¥çš„å¹¶è¡Œå¤„ç†å¤šä»»åŠ¡çš„å‡½æ•°ï¼Œå¯¹åº” UE4 ä¸­çš„ <code>ParallelFor</code> ã€‚å…¶ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><p></p><figure class="highlight c++"><figcaption><span>ParallelFor</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++ </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;execution&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cpp_for_each</span><span class="params">(<span class="keyword">const</span> vector&lt;<span class="keyword">int</span>&gt;&amp; v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::for_each(std::execution::par, v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), [=](<span class="keyword">const</span> <span class="keyword">int</span> i)&#123;</span><br><span class="line">        std::cout &lt;&lt; i * i &lt;&lt; endl;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UE4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Async/ParallelFor.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ue4_ParallelFor</span><span class="params">(<span class="keyword">const</span> TArray&lt;<span class="keyword">int</span>&gt;&amp; v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">ParallelFor</span>( v.<span class="built_in">size</span>(), [=](int32 i)&#123;</span><br><span class="line">        std::cout &lt;&lt; v[i] * v[i] &lt;&lt; endl;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>&quot;ParallelFor&quot; å‡½æ•°å…¶å®å¹¶ä¸åªæ˜¯ C++ å’Œ UE4 æ‰æœ‰ï¼Œå¾ˆå¤šå…¶ä»–è¯­è¨€å…¶å®ä¹Ÿéƒ½æœ‰å¯¹åº”çš„å®ç°ã€‚ <strong>&quot;ParallelFor&quot; åŸè¯‘ä¸ºå¹¶è¡Œéå†ï¼Œæ˜¯ä¸ä¾èµ–çº¿ç¨‹æ±  æ”¹ç”¨ä»»åŠ¡å›¾è¡¨çš„ å¦ä¸€ç§å¹¶è¡Œç¼–ç¨‹ç­–ç•¥ï¼Œä¸»è¦ç”¨äºå¤„ç†æŸäº›é€»è¾‘å•ä¸€ä½†å´æä¸ºç¹é‡çš„ä»»åŠ¡</strong>ï¼Œå¦‚: GC æ—¶å¯¹æ¯ä¸€ä¸ª UObject å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æã€‚æˆ‘ä»¬å¯ä»¥å°†éœ€è¦åˆ†æçš„å¯¹è±¡æŒ‰å½“å‰ç©ºé—²çº¿ç¨‹æ•°å¹³å‡åˆ†å †ï¼Œç„¶åæ¯ä¸ªçº¿ç¨‹è´Ÿè´£å…¶ä¸­ä¸€å †å¯¹è±¡çš„å¤„ç†ã€‚è¿™æ—¶å€™ä½ ä¼šå‘ç°ï¼Œå…¶å®æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯åˆ†æçš„å¯¹è±¡ä¸åŒã€‚&quot;ParallelFor&quot; å°¤å…¶æ“…é•¿å¤„ç†æ­¤ç±»äº‹åŠ¡ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œè®©å’±çœ‹çœ‹ UE4 æ˜¯æ€ä¹ˆå®ç° &quot;ParallelFor&quot; çš„ ğŸ˜ƒ</p><p></p><figure class="highlight c++"><figcaption><span>ParallelForInternal</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ParallelFor.h</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> FunctionType&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">ParallelForInternal</span><span class="params">(int32 Num, FunctionType Body, EParallelForFlags Flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">SCOPE_CYCLE_COUNTER</span>(STAT_ParallelFor);</span><br><span class="line">    <span class="built_in">check</span>(Num &gt;= <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &quot;AnyThreadTasks&quot; è¡¨ç¤ºå¯ç”¨äºæ‰§è¡Œæ­¤ä»»åŠ¡çš„çº¿ç¨‹æ•°</span></span><br><span class="line">    int32 AnyThreadTasks = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">bool</span> bIsMultithread = FApp::<span class="built_in">ShouldUseThreadingForPerformance</span>() || FForkProcessHelper::<span class="built_in">IsForkedMultithreadInstance</span>();</span><br><span class="line">    <span class="keyword">if</span> (Num &gt; <span class="number">1</span> &amp;&amp; (Flags &amp; EParallelForFlags::ForceSingleThread) == EParallelForFlags::None &amp;&amp; bIsMultithread)</span><br><span class="line">    &#123;</span><br><span class="line">        AnyThreadTasks = FMath::Min&lt;int32&gt;(FTaskGraphInterface::<span class="built_in">Get</span>().<span class="built_in">GetNumWorkerThreads</span>(), Num - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!AnyThreadTasks)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ²¡æœ‰çº¿ç¨‹åˆ™ç›´æ¥æ‰§è¡Œåè¿”å›</span></span><br><span class="line">        <span class="keyword">for</span> (int32 Index = <span class="number">0</span>; Index &lt; Num; Index++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">Body</span>(Index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">bool</span> bPumpRenderingThread         = (Flags &amp; EParallelForFlags::PumpRenderingThread) != EParallelForFlags::None;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">bool</span> bBackgroundPriority          = (Flags &amp; EParallelForFlags::BackgroundPriority) != EParallelForFlags::None;</span><br><span class="line">    <span class="keyword">const</span> ENamedThreads::Type DesiredThread = bBackgroundPriority ? ENamedThreads::AnyBackgroundThreadNormalTask : ENamedThreads::AnyHiPriThreadHiPriTask;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ å¹¶è¡Œå¤„ç†æ•°æ®</span></span><br><span class="line">    TParallelForData&lt;FunctionType&gt;* DataPtr = <span class="keyword">new</span> TParallelForData&lt;FunctionType&gt;(Num, AnyThreadTasks + <span class="number">1</span>, (Num &gt; AnyThreadTasks + <span class="number">1</span>) &amp;&amp; bPumpRenderingThread, Body, Flags);</span><br><span class="line">    TSharedRef&lt;TParallelForData&lt;FunctionType&gt;, ESPMode::ThreadSafe&gt; Data = <span class="built_in">MakeShareable</span>(DataPtr);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºå›¾è¡¨ä»»åŠ¡ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°å¯¹åº”çº¿ç¨‹ä¸­ç­‰å¾…å‰ç½®ä»»åŠ¡æ‰§è¡Œå®Œæˆ(ParallelForå‡½æ•°æ²¡æœ‰å‰ç½®ä»»åŠ¡)</span></span><br><span class="line">    TGraphTask&lt;TParallelForTask&lt;FunctionType&gt;&gt;::<span class="built_in">CreateTask</span>().<span class="built_in">ConstructAndDispatchWhenReady</span>(Data, DesiredThread, AnyThreadTasks - <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®©æ­¤çº¿ç¨‹ä¹Ÿæ‰§è¡Œ &quot;TParallelForTask&quot; ä¸­çš„ä»»åŠ¡ï¼Œè¿™å¯¹äºé˜²æ­¢é€’å½’æ­»é”å¾ˆé‡è¦</span></span><br><span class="line">    <span class="keyword">if</span> (!Data-&gt;<span class="built_in">Process</span>(<span class="number">0</span>, Data, DesiredThread, <span class="literal">true</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (bPumpRenderingThread &amp;&amp; <span class="built_in">IsInActualRenderingThread</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span> (!Data-&gt;Event-&gt;<span class="built_in">Wait</span>(<span class="number">1</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                FTaskGraphInterface::<span class="built_in">Get</span>().<span class="built_in">ProcessThreadUntilIdle</span>(ENamedThreads::<span class="built_in">GetRenderThread_Local</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Data-&gt;Event-&gt;<span class="built_in">Wait</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">check</span>(Data-&gt;bTriggered);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">check</span>(!Data-&gt;bTriggered);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">check</span>(Data-&gt;NumCompleted.<span class="built_in">GetValue</span>() == Data-&gt;Num);</span><br><span class="line">    Data-&gt;bExited = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// DoneEvent åœ¨æ­¤ç­‰å¾…ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹å®Œæˆäº†æœ€åä¸€ä¸ªä»»åŠ¡</span></span><br><span class="line">    <span class="comment">// æ•°æ®å¿…é¡»è¢«ä¿ç•™ï¼Œç›´è‡³æ‰€æœ‰ä»»åŠ¡è¢«æ¸…é™¤ã€‚å¯èƒ½æ˜¯åœ¨é€€å‡ºæ­¤å‡½æ•°å¾ˆä¹…ä»¥å</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦ &quot;ParallelFor&quot; å‡½æ•°ï¼Œç†è§£ä¸Šé¢ä»£ç æµç¨‹å¯èƒ½ç›¸å¯¹åƒåŠ›ã€‚ä½†æ²¡å…³ç³»ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹çœ‹è¿™å¼ ç±»å›¾ï¼š</p><p><img data-src="GraphTask.png" alt="GraphTask"></p><p>ç±»å›¾æ¡†æ¶çœ‹èµ·æ¥å¾ˆæ˜¯å¤æ‚ï¼Œä½†å…¶å®åªæ˜¯ä¸€å±‚å±‚çš„å°è£…ã€‚ä¸»è¦çš„ç±»åŠå…¶ä»‹ç»å¦‚ä¸‹ï¼š</p><ul><li><code>FTaskGraphImplementation</code> (ä»»åŠ¡æ‰§è¡Œå™¨) æ˜¯å•ä¾‹ç±»ï¼Œæ˜¯åŒ…å«ç®¡ç†å›¾è¡¨ä»»åŠ¡çš„ç›¸å…³å‡½æ•° (æ·»åŠ ä»»åŠ¡åˆ°ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ‰§è¡Œä»»åŠ¡ï¼Œç­‰å¾…ä»»åŠ¡å®Œæˆï¼Œè§¦å‘å›è°ƒç­‰) çš„æ§åˆ¶ç±»ã€‚</li><li><code>FWorkerThread</code> (å·¥ä½œçº¿ç¨‹ç±»)ï¼Œåªæ˜¯å¯¹å¤šä¸ª <code>FRunnable</code> (å¯æ‰§è¡Œå¯¹è±¡) å’Œ <code>FRunnableThread</code> (ç®¡ç†å¯æ‰§è¡Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ç±») çš„ç®€å•å°è£…ã€‚</li><li><code>FTaskThreadBase</code> (ä»»åŠ¡çº¿ç¨‹ç±»)ï¼ŒåŒ…å«æ­¤çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨åŠ ç®¡ç†æ‰§è¡Œæ­¤çº¿ç¨‹ä¸­çš„ä»»åŠ¡çš„ç›¸å…³å‡½æ•°</li><li><code>FBaseGraphTask</code> (å›¾è¡¨ä»»åŠ¡ç±»)ï¼Œå°è£…æ‰§è¡Œå•ä¸ªä»»åŠ¡æ‰€éœ€çš„ç›¸å…³æ•°æ®å’Œå‡½æ•°</li><li><code>TParallelForTask&lt;FuncType&gt;</code> (å¹¶è¡Œéå†ä»»åŠ¡ç±»)ï¼Œæ­¤ç±»ä½œä¸º <code>TGraghTask&lt;Task&gt;</code> çš„æ¨¡æ¿ç±»ï¼Œè´Ÿè´£ä¿å­˜æ‰§è¡Œ &quot;ParallelFor&quot; å‡½æ•°æ‰€éœ€çš„ç›¸å…³æ•°æ®ã€‚</li><li><code>FGenericTask</code> (é€šå¸¸ä»»åŠ¡ç±»)ï¼ŒåŸç ä¸­å¯¹ä»»åŠ¡æ¨¡æ¿ç±»çš„ä¸¾ä¾‹ã€‚ä¸ä½¿ç”¨ <code>ParallelFor</code> ä½†æƒ³ç”¨ä»»åŠ¡å›¾è¡¨ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰çš„ä»»åŠ¡ç±»ã€‚å…¶ä¸­åŒ…å« <code>GetDesiredThread</code> ï¼Œ <code>DoTask</code> ç­‰å¿…é¡»å®šä¹‰çš„å‡½æ•°æ¥å£ã€‚(å…·ä½“å¯ä»¥æŸ¥çœ‹ï¼šEngine/Source/Runtime/Core/Public/Async/TaskGraphInterfaces.h ä¸‹ï¼Œç¬¬ 734 è¡Œä»£ç )</li></ul><p>å¥½çš„ï¼Œè®©å’±å›åˆ° <code>ParallelFor</code> å‡½æ•°æ‰§è¡Œè¿‡ç¨‹çš„åˆ†æ (åŒ…å«äº†ä»»åŠ¡å›¾è¡¨ç³»ç»Ÿçš„æ•´ä¸ªæ·»åŠ æ‰§è¡Œé”€æ¯æµç¨‹)</p><ol><li>æ‰§è¡Œ <code>ParallelFor</code> æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¼ å…¥ä»»åŠ¡æ€»æ•° (Num)ï¼Œå’Œä»»åŠ¡å‡½æ•° (å‡½æ•°ç±»å‹ä¸º &lt; void (int32&gt;)ï¼Œåç»­æ‰§è¡Œä»»åŠ¡å‡½æ•°æ—¶å°†ä» 0 åˆ° Num ä¾æ¬¡åšä¸ºå‚æ•°è¿è¡Œä»»åŠ¡å‡½æ•° (åœ¨ä¸åŒçº¿ç¨‹ä¸­)ã€‚</li><li>åˆ¤æ–­æ˜¯å¦å¯ç”¨å¤šçº¿ç¨‹ï¼Œä¸å¯ç”¨åˆ™ç›´æ¥å•çº¿ç¨‹éå†æ‰§è¡Œåè¿”å›ã€‚å¦‚æœå¯ç”¨åˆ™æ„é€ å¹¶è¡Œéå†æ•°æ® ( <code>TParallelForData&lt;FuncType&gt;</code> )ï¼Œå¹¶ç”¨å…¶åˆ›å»ºå¹¶è¡Œå›¾è¡¨ä»»åŠ¡ ( <code>TGraphTask&lt;TParallelForTask&lt;FuncType&gt;&gt;</code> )ï¼Œå¹¶å°†æ­¤ä»»åŠ¡çŠ¶æ€è®¾ä¸º &quot;Ready&quot;<ol><li>åˆ›å»ºä»»åŠ¡å°†è°ƒç”¨ <code>TGraphTask&lt;...&gt;::CreateTask</code> ï¼Œåˆ›å»ºå¹¶è¿”å›ä»»åŠ¡æ„é€ å™¨ ( <code>FConstructor</code> )</li><li>ä»»åŠ¡æ„é€ å™¨çš„åˆ›å»ºï¼Œå°†è®¾ç½®æ­¤ä»»åŠ¡çš„å‰ç½®ä»»åŠ¡åŠå…¶æ‹¥æœ‰è€…ç­‰ä¿¡æ¯ã€‚</li><li>æœ€åè°ƒç”¨ä»»åŠ¡æ„é€ å™¨çš„ <code>ConstructAndDispatchWhenReady</code> å‡½æ•°ï¼Œæ„æˆæ­¤ä»»åŠ¡åˆ°å¯¹åº”çº¿ç¨‹ä¸­ï¼Œå¹¶å°†å…¶çŠ¶æ€è®¾ä¸º &quot;Ready&quot;<ol><li>è°ƒç”¨ <code>TParallelForTask</code> çš„æ„é€ å‡½æ•°ï¼Œå¹¶åˆå§‹åŒ–å…¶å‰ç½®ä»»åŠ¡ï¼Œè®¾ç½®æ­¤ä»»åŠ¡çš„æ‰§è¡Œçº¿ç¨‹</li><li>è°ƒç”¨ <code>TGraphTask</code> çš„ <code>PrerequisitesComplete</code> å‡½æ•°ï¼Œå°†æ­¤ä»»åŠ¡æ·»åŠ åˆ°å¯¹åº”çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œåˆ—è¡¨ä¸­ (è°ƒç”¨ <code>TGraphTask::QueueTask</code> )<ol><li>è·å–ä»»åŠ¡æ‰§è¡Œå™¨å•ä¾‹ï¼Œè°ƒç”¨å…¶ <code>QueueTask</code> å‡½æ•°</li><li>å¦‚æœæ­¤ä»»åŠ¡å¯ä»¥åœ¨ä»»æ„çº¿ç¨‹è¿è¡Œï¼Œå°†å…¶æ·»åŠ åˆ° &quot;ä»»åŠ¡æ‰§è¡Œå™¨çš„ä»»æ„çº¿ç¨‹ä»»åŠ¡çš„å¯¹åº”ä¼˜å…ˆçº§é˜Ÿåˆ—&quot; ( <code>FTaskGraphImplementation::IncomingAnyThreadTasks[Prority]</code> ) ä¸­ï¼Œå¼€å¯è¯¥ä»»åŠ¡çº¿ç¨‹æ‰§è¡Œæ­¤ä»»åŠ¡ (è°ƒç”¨ <code>WakeUp</code> )ã€‚å¦åˆ™å°†å…¶è¿è¡Œçº¿ç¨‹è®¾ç½®ä¸ºæ¸¸æˆçº¿ç¨‹</li><li>æœ€åè°ƒç”¨ <code>FTaskThreadBase::EnqueueFromThread</code> å°†æ­¤ä»»åŠ¡æ·»åŠ åˆ° &quot;å¯¹åº”çº¿ç¨‹æ‰§è¡Œå¯¹è±¡çš„ä»»åŠ¡åˆ—è¡¨&quot; ä¸­ ( <code>FNameTaskThread</code> å­ç±»å°†æ·»åŠ åˆ°ä¸“ç”¨ä¼˜å…ˆçº§ä»»åŠ¡åˆ—è¡¨ä¸­)</li></ol></li></ol></li></ol></li><li>çº¿ç¨‹ <code>WakeUp</code> åä¾æ¬¡æ‰§è¡Œä»»åŠ¡ï¼Œ <code>ParallelFor</code> ä¸­çš„ä»»åŠ¡æ˜¯æ·»åŠ åˆ°ä»»æ„çº¿ç¨‹é˜Ÿåˆ—ä¸­çš„ã€‚æ‰€ä»¥å°†è°ƒç”¨ç©ºé—²çº¿ç¨‹çš„ <code>ProcessTasksUntilQuit</code> å‡½æ•°ï¼Œè¿›è€Œè°ƒç”¨ <code>ProcessTasks</code> å¤„ç†ä»»åŠ¡ç›´è‡³æ‰€æœ‰ä»»åŠ¡å®Œæˆã€‚</li><li><code>ProcessTasks</code> å‡½æ•°åˆ™ç›´æ¥æ­»å¾ªç¯è°ƒç”¨æ‰€æœ‰ä»»åŠ¡ ( <code>TGraphTask</code> ) çš„ <code>Execute</code> å‡½æ•°ï¼Œç›´è‡³å…¨éƒ¨å®Œæˆ</li><li><code>Execute</code> å‡½æ•°å°†è°ƒç”¨ <code>TParallelForTask::DoTask</code> å‡½æ•°ï¼Œè®©æ­¤çº¿ç¨‹å¼€å§‹å¤„ç†ä»»åŠ¡å‡½æ•°ã€‚ä¸æ­¤åŒæ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿå°†è¢« WakeUpï¼Œæ¥å¤„ç†æ­¤ä»»åŠ¡å‡½æ•°ã€‚å¹¶è¡Œå¤„ç†ä»»åŠ¡å‡½æ•°ï¼Œå…¶å‡½æ•°å‚æ•°å°†é€šè¿‡åŸå­æ“ä½œå¢åŠ ï¼Œä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚å½“å‚æ•°å¤§äºä¼ å…¥ Num æ—¶ï¼Œå®Œæˆæ­¤æ¬¡ <code>ParallelFor</code> è°ƒç”¨</li><li>å¦å¤– <code>Execute</code> å‡½æ•°åœ¨è°ƒç”¨å®Œ <code>DoTask</code> åå°†é”€æ¯è‡ªèº«ï¼ŒåŒæ—¶é”€æ¯å…¶åŒ…å«çš„ Task ä»»åŠ¡ã€‚</li></ol><p>åˆ°æ­¤ï¼Œ &quot;ParallelFor&quot; å‡½æ•°çš„æ‰§è¡Œæµç¨‹ ä¸ &quot;TaskGraph&quot; å¹¶è¡Œç¼–ç¨‹çš„æ¶æ„ å·²ç»å®Œå…¨åˆ†æå®Œäº†ã€‚å¦‚æœè¯»è€…æ²¡æœ‰å®Œå…¨ç†è§£ï¼Œå»ºè®®ä¾ç…§ç±»å›¾ç¿»ç¿»æºç ï¼Œè‡ªå·±èµ°ä¸€éä»»åŠ¡åˆ›å»ºæ‰§è¡Œåˆ°é”€æ¯çš„æ•´ä¸ªæµç¨‹å°±æ‡‚äº† ğŸ˜ƒ</p><p>å‚è€ƒï¼š</p><ul><li><span class="exturl" data-url="aHR0cDovL3VzYWdpLmhhdGVuYWJsb2cuanAvZW50cnkvMjAxNy8wNi8xMC8xMjI3MjA=">C++ æ¨™æº–ã® promise /future/thread ã«å¯¾å¿œã™ã‚‹ UE4 æ¨™æº–ã® TPromise / TFuture / FRunnableThread ã®ä½¿ã„æ–¹ - C++ ã¨ãã©ã ã”ã¯ã‚“ã€ã‚ã‚Šã¨ã¦ãƒãƒ¼ã¶ã‚Œã„ãâ˜†</span></li><li><span class="exturl" data-url="aHR0cHM6Ly9jcHByZWZqcC5naXRodWIuaW8vcmVmZXJlbmNlL2Z1dHVyZS5odG1s">future - cpprefjp C++ æ—¥æœ¬èªãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</span></li><li><span class="exturl" data-url="aHR0cHM6Ly9jcHByZWZqcC5naXRodWIuaW8vcmVmZXJlbmNlL3RocmVhZC5odG1s">thread - cpprefjp C++ æ—¥æœ¬èªãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</span></li><li><span class="exturl" data-url="aHR0cHM6Ly93aWtpLnVucmVhbGVuZ2luZS5jb20vVXNpbmdfQXN5bmNUYXNrcw==">Using AsyncTasks - Epic Wiki</span></li></ul><h2 id="fcriticalsection-stdmutex"><a class="anchor" href="#fcriticalsection-stdmutex">#</a> FCriticalSection &amp; std::mutex</h2><p>å¹¶è¡Œç¼–ç¨‹è‡ªç„¶å°‘ä¸äº†ä¸´ç•ŒåŒºçš„æ•°æ®è®¿é—®ã€‚ç›¸å¯¹äº C++11 ä¸­çš„ <code>std::mutex</code> ï¼Œè™šå¹»ä¸­ä½¿ç”¨åˆ™æ˜¯ <code>FCriticalSection</code> ï¼Œå…ˆçœ‹çœ‹ç”¨æ³•ä¸Šçš„åŒºåˆ«å§ï½ï½ï½</p><p></p><figure class="highlight c++"><figcaption><span>FCriticalSection</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line">&#123;</span><br><span class="line">    std::mutex m;</span><br><span class="line">    <span class="comment">// ä½œç”¨åŸŸé”ï¼ŒC++17åå¯ä»¥çœç•¥æ¨¡æ¿ç±»å‹</span></span><br><span class="line">    &#123; <span class="function">std::lock_guard&lt; <span class="title">decltype</span><span class="params">(m)</span> &gt; <span class="title">lock</span><span class="params">(m)</span></span>; &#125;</span><br><span class="line">    <span class="comment">// æ‰‹åŠ¨æ“ä½œ</span></span><br><span class="line">    m.<span class="built_in">lock</span>();</span><br><span class="line">    m.<span class="built_in">unlock</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UE4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Misc/ScopeLock.h&quot;</span></span></span><br><span class="line">&#123;</span><br><span class="line">    FCriticalSection m;</span><br><span class="line">    <span class="comment">// ä½œç”¨åŸŸé”</span></span><br><span class="line">    &#123; <span class="function">FScopeLock <span class="title">lock</span><span class="params">(&amp;m)</span></span>; &#125;</span><br><span class="line">    <span class="comment">// æ‰‹åŠ¨æ“ä½œ</span></span><br><span class="line">    m.<span class="built_in">Lock</span>();</span><br><span class="line">    m.<span class="built_in">Unlock</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿™å°±æ˜¯æ‰€è°“çš„ &quot;åŸºå› é—ä¼ &quot; å—ï¼Ÿ(å®åœ¨æ˜¯å¤ªåƒäº†...)ã€‚å¦å¤–ï¼ŒUE4 åŒæ—¶è¿˜æ”¯æŒ std ç‰ˆçš„ lock_guard , adopt_lock , unique_lock ç­‰ã€‚å¦‚æ— ç‰¹æ®Šæƒ…å†µï¼Œåœ¨ UE4/C++ ä¸­ä½¿ç”¨ std ç‰ˆä¹Ÿæ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ã€‚</p><h2 id="frwlock-stdshared_mutex"><a class="anchor" href="#frwlock-stdshared_mutex">#</a> FRWLock &amp; std::shared_mutex</h2><p>std::shared_mutex æ˜¯ C++17 ä¸­æ”¯æŒçš„è¯»å†™é”ï¼Œå¯¹åº”åˆ° UE4 æ˜¯ FRWLock ç±»ã€‚å³ å¤šçº¿ç¨‹å¯åŒæ—¶å¯¹åŒä¸€å¯¹è±¡ä¸Šè¯»é”ï¼Œè€Œå†™é”åˆ™éœ€å•ç‹¬å æœ‰æ­¤ä¸´ç•ŒåŒºèµ„æºã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><p></p><figure class="highlight c++"><figcaption><span>FRWLock</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++17</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line">&#123;</span><br><span class="line">    std::shared_mutex m;</span><br><span class="line">    &#123; <span class="function">std::shared_lock&lt; <span class="title">decltype</span><span class="params">(m)</span> &gt; <span class="title">read_lock</span><span class="params">(m)</span></span>; &#125;</span><br><span class="line">    &#123; <span class="function">std::lock_guard&lt; <span class="title">decltype</span><span class="params">(m)</span> &gt; <span class="title">write_lock</span><span class="params">(m)</span></span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// C++14</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line">&#123;</span><br><span class="line">    std::shared_timed_mutex m;</span><br><span class="line">    &#123; <span class="function">std::shared_lock&lt; <span class="title">decltype</span><span class="params">(m)</span> &gt; <span class="title">read_lock</span><span class="params">(m)</span></span>; &#125;</span><br><span class="line">    &#123; <span class="function">std::lock_guard&lt; <span class="title">decltype</span><span class="params">(m)</span> &gt; <span class="title">write_lock</span><span class="params">(m)</span></span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UE4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Misc/ScopeRWLock.h&quot;</span></span></span><br><span class="line">&#123;</span><br><span class="line">    FRWLock m;</span><br><span class="line">    <span class="comment">// ä½œç”¨åŸŸé”</span></span><br><span class="line">    &#123; <span class="function">FRWScopeLock <span class="title">read_lock</span><span class="params">(m, FRWScopeLockType::SLT_ReadOnly)</span></span>; &#125;</span><br><span class="line">    &#123; <span class="function">FRWScopeLock <span class="title">write_lock</span><span class="params">(m, FRWScopeLockType::SLT_Write)</span></span>; &#125;</span><br><span class="line">    <span class="comment">// æ‰‹åŠ¨æ“ä½œ</span></span><br><span class="line">    m.<span class="built_in">ReadLock</span>();</span><br><span class="line">    m.<span class="built_in">ReadUnLock</span>();</span><br><span class="line">    m.<span class="built_in">WriteLock</span>();</span><br><span class="line">    m.<span class="built_in">WriteUnLock</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>é”çš„è¡Œä¸ºæ ¹æ®å¹³å°ä¸åŒè€Œä¸åŒï¼Œä¸è¿‡åŸç†éƒ½æ˜¯å·®ä¸å¤šçš„ã€‚å’±å°±ä¸åšå’±å¼€äº†ã€‚</p><p>å‚è€ƒï¼š</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9jcHByZWZqcC5naXRodWIuaW8vcmVmZXJlbmNlL3NoYXJlZF9tdXRleC9zaGFyZWRfbXV0ZXguaHRtbA==">shared_mutex - cpprefjp C++ æ—¥æœ¬èªãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</span></li><li><span class="exturl" data-url="aHR0cHM6Ly9jcHByZWZqcC5naXRodWIuaW8vcmVmZXJlbmNlL3NoYXJlZF9tdXRleC9zaGFyZWRfdGltZWRfbXV0ZXguaHRtbA==">shared_timed_mutex - cpprefjp C++ æ—¥æœ¬èªãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</span></li><li><span class="exturl" data-url="aHR0cHM6Ly9jcHByZWZqcC5naXRodWIuaW8vcmVmZXJlbmNlL3NoYXJlZF9tdXRleC9zaGFyZWRfbG9jay5odG1s">shared_lock - cpprefjp C++ æ—¥æœ¬èªãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</span></li><li><span class="exturl" data-url="aHR0cHM6Ly9jcHByZWZqcC5naXRodWIuaW8vcmVmZXJlbmNlL211dGV4L2xvY2tfZ3VhcmQuaHRtbA==">lock_guard - cpprefjp C++ æ—¥æœ¬èªãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</span></li><li><a target="_blank" rel="noopener" href="https://qiita.com/usagi/items/4f4ee0df34688fa5c503">C<ins>17, C</ins>14, C++11 ã«ä½µã›ãŸ std::shared_mutex, std::shared_timed_mutex, std::mutex ã‹ã‚‰ mutex_type, read_lock_type, write_lock_type ã‚’æ‰±ã†ä¾‹ - Qiita</a></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0VwaWNHYW1lcy9VbnJlYWxFbmdpbmUvYmxvYi80LjE4L0VuZ2luZS9Tb3VyY2UvUnVudGltZS9Db3JlL1B1YmxpYy9XaW5kb3dzL1dpbmRvd3NDcml0aWNhbFNlY3Rpb24uaCNMMTE0">https://github.com/EpicGames/UnrealEngine/blob/4.18/Engine/Source/Runtime/Core/Public/Windows/WindowsCriticalSection.h#L114</span></li></ul><h2 id="æ€»ç»“ä¸ç»“è¯­"><a class="anchor" href="#æ€»ç»“ä¸ç»“è¯­">#</a> æ€»ç»“ä¸ç»“è¯­ï¼š</h2><p>æœ¬ç¯‡ä» C++ / UE4 å…³äºå¼‚æ­¥çš„ API ä½¿ç”¨æ–¹æ³•å…¥æ‰‹ï¼Œä»‹ç»äº† UE4 ä¸ C++ å¯¹äºå¹¶è¡Œç¨‹åºç¼–ç¨‹ä¹‹é—´çš„å¼‚åŒã€‚å¯¹äºæ¯ç§åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿéƒ½åˆ†æäº†å…¶åœ¨ UE4 ä¸­çš„åº•å±‚å®ç°æœºåˆ¶ (å¦‚ï¼šçº¿ç¨‹æ± ï¼Œä»»åŠ¡å›¾è¡¨ç­‰)ã€‚æœ€åè¿˜å¯¹æ¯”äº† C++ ä¸ UE4 ä¸­å¯¹äºé”çš„æ”¯æŒï¼ŒåŠå…¶ä½¿ç”¨æ–¹å¼çš„å·®å¼‚ã€‚å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï½ï½ï½</p><p>è™½ç„¶å¹¶è¡Œç¼–ç¨‹å¯¹äºå®¢æˆ·ç«¯å¼€å‘æ¥è¯´æ¥è§¦å¾—å¯èƒ½ä¸æ˜¯å¾ˆå¤šï¼Œä½†ä¸ªäººè§‰å¾—å¾ˆæœ‰å­¦ä¹ çš„å¿…è¦ã€‚æ¯•ç«Ÿæ¸¸æˆè¿è¡Œæ˜¯éå¸¸æ¶ˆè€—ç¡¬ä»¶æ€§èƒ½çš„ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥åœ¨é€‚å½“çš„åœ°æ–¹å¼•å…¥å¹¶è¡Œå¤„ç†æ–¹æ³•è¿›è¡Œä¼˜åŒ–ã€‚å°†å¤æ‚çš„ä»»åŠ¡åˆ†é…ç»™å¤šä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œå¦‚æ­¤æé«˜ç¨‹åºå¯¹äºå¤æ‚ä»»åŠ¡çš„å¤„ç†èƒ½åŠ›çš„åŒæ—¶ï¼Œè¿˜å¯ä»¥è®©æ¸¸æˆä¿æŒä¸€ä¸ªä¸é”™çš„å¸§ç‡ï¼Œä¿è¯è‰¯å¥½çš„æ¸¸æˆä½“éªŒ (æ‰å¸§å¯å°±å¤ªéš¾å—äº†å•Š...)</p><p>æœ€åé¢„ç¥è¯»è€…ä»¬å…ƒæ—¦å¿«ä¹ ğŸ˜ƒ</p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-01-02 15:46:00" itemprop="dateModified" datetime="2022-01-02T15:46:00+08:00">2022-01-02</time> </span><span id="2021/12/30/UE4/UE4CPP/Unreal å¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹/" class="item leancloud_visitors" data-flag-title="Unreal å¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹" title="é˜…è¯»æ¬¡æ•°"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">é˜…è¯»æ¬¡æ•°</span> <span class="leancloud-visitors-count"></span> <span class="text">æ¬¡</span></span></div><div id="copyright"><ul><li class="author"><strong>æœ¬æ–‡ä½œè€…ï¼š </strong>-YIFEI- <i class="ic i-at"><em>@</em></i>ä¸€ä¸ªå¹´è½»äººå¥”å‘æ¢¦æƒ³çš„è¶³è¿¹</li><li class="link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong> <a href="https://kotori_suki.github.io/2021/12/30/UE4/UE4CPP/Unreal%20%E5%BC%82%E6%AD%A5%E4%B8%8E%E5%B9%B6%E8%A1%8C%E7%BC%96%E7%A8%8B/" title="Unreal å¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹">https://kotori_suki.github.io/2021/12/30/UE4/UE4CPP/Unreal å¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹/</a></li><li class="license"><strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬ç«™æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/12/28/UE4/UE4CPP/CustomItemModule/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclfb3vzhj20zk0m8wny.jpg" title="Custom Item Module"><span class="type">ä¸Šä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i> ModuleDesign</span><h3>Custom Item Module</h3></a></div><div class="item right"><a href="/2022/01/03/UE4/UE4CPP/Unreal%20MovementComponent%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipexbei4hj20zk0m8npd.jpg" title="Unreal MovementComponent æºç è§£æ"><span class="type">ä¸‹ä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i> UE4_C++</span><h3>Unreal MovementComponent æºç è§£æ</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="æ–‡ç« ç›®å½•"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#unreal-%E5%BC%82%E6%AD%A5%E4%B8%8E%E5%B9%B6%E8%A1%8C%E7%BC%96%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">Unreal å¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#tpromiset-stdpromiset"><span class="toc-number">1.1.</span> <span class="toc-text">TPromise&lt;T&gt; &amp; std::promise&lt;T&gt;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tfuturet-stdfuturet"><span class="toc-number">1.2.</span> <span class="toc-text">TFuture&lt;T&gt; &amp; std::future&lt;T&gt;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fplatformatomics"><span class="toc-number">1.3.</span> <span class="toc-text">FPlatformAtomics</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#frunnablethread-stdthread"><span class="toc-number">1.4.</span> <span class="toc-text">FRunnableThread &amp; std::thread</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#frunnable-frunablethread"><span class="toc-number">1.4.1.</span> <span class="toc-text">FRunnable &amp; FRunableThread</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fasynctask-stdasync"><span class="toc-number">1.5.</span> <span class="toc-text">FAsyncTask &amp; std::async</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#parallelfor-stdfor_each"><span class="toc-number">1.6.</span> <span class="toc-text">ParallelFor &amp; std::for_each</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fcriticalsection-stdmutex"><span class="toc-number">1.7.</span> <span class="toc-text">FCriticalSection &amp; std::mutex</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#frwlock-stdshared_mutex"><span class="toc-number">1.8.</span> <span class="toc-text">FRWLock &amp; std::shared_mutex</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E7%BB%93%E8%AF%AD"><span class="toc-number">1.9.</span> <span class="toc-text">æ€»ç»“ä¸ç»“è¯­ï¼š</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="ç³»åˆ—æ–‡ç« "><ul><li><a href="/2021/10/25/UE4/UE4CPP/API%E4%B8%8D%E6%AD%A3%E5%B8%B8%E5%B7%A5%E4%BD%9C-%E4%B9%8B-GetPlayerController/" rel="bookmark" title="APIä¸æ­£å¸¸å·¥ä½œ ä¹‹ GetPlayerController">APIä¸æ­£å¸¸å·¥ä½œ ä¹‹ GetPlayerController</a></li><li><a href="/2021/10/25/UE4/UE4CPP/API%E4%B8%8D%E6%AD%A3%E5%B8%B8%E5%B7%A5%E4%BD%9C-%E4%B9%8B-GetGameMode/" rel="bookmark" title="APIä¸æ­£å¸¸å·¥ä½œ ä¹‹ GetGameMode">APIä¸æ­£å¸¸å·¥ä½œ ä¹‹ GetGameMode</a></li><li><a href="/2021/10/25/UE4/UE4CPP/unreal%20%E5%BC%95%E6%93%8E%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/" rel="bookmark" title="unrealå¼•æ“å¯åŠ¨æµç¨‹">unrealå¼•æ“å¯åŠ¨æµç¨‹</a></li><li><a href="/2021/10/26/UE4/UE4CPP/%E4%BB%8ESVG%E6%96%87%E4%BB%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E6%97%85%E7%A8%8B/" rel="bookmark" title="ä»SVGæ–‡ä»¶å¼€å§‹çš„æ—…ç¨‹~~~">ä»SVGæ–‡ä»¶å¼€å§‹çš„æ—…ç¨‹~~~</a></li><li><a href="/2021/10/29/UE4/UE4CPP/%E5%8F%8D%E5%B0%84%E7%B3%BB%E7%BB%9F%20API/" rel="bookmark" title="åå°„ç³»ç»ŸAPI  è§£æå’Œä½¿ç”¨">åå°„ç³»ç»ŸAPI è§£æå’Œä½¿ç”¨</a></li><li><a href="/2021/10/31/UE4/UE4CPP/Session%E7%9A%84%E4%BD%BF%E7%94%A8%20C++%E7%AF%87/" rel="bookmark" title="Sessionçš„ä½¿ç”¨ C++ç¯‡">Sessionçš„ä½¿ç”¨ C++ç¯‡</a></li><li><a href="/2021/11/02/UE4/UE4CPP/Unreal%20%E5%BA%8F%E5%88%97%E5%8C%96/" rel="bookmark" title="Unreal åºåˆ—åŒ–~~~">Unreal åºåˆ—åŒ–~~~</a></li><li><a href="/2021/11/06/UE4/UE4CPP/Unreal%20GC%E8%BF%87%E7%A8%8B/" rel="bookmark" title="Unreal GCè¿‡ç¨‹">Unreal GCè¿‡ç¨‹</a></li><li><a href="/2021/11/08/UE4/UE4CPP/UClass%E7%9A%84%E8%AF%9E%E7%94%9F%E4%B8%8E%E6%88%90%E9%95%BF/" rel="bookmark" title="UClassçš„è¯ç”Ÿä¸æˆé•¿">UClassçš„è¯ç”Ÿä¸æˆé•¿</a></li><li><a href="/2021/11/11/UE4/UE4CPP/UE4%E4%BB%A3%E7%90%86%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E7%94%A8%E6%B3%95/" rel="bookmark" title="UE4ä»£ç†çš„å®ç°ä¸ç”¨æ³•">UE4ä»£ç†çš„å®ç°ä¸ç”¨æ³•</a></li><li><a href="/2021/11/15/UE4/UE4CPP/FProperty%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E6%80%BB%E7%BB%93/" rel="bookmark" title="FPropertyçš„åˆ†æä¸æ€»ç»“">FPropertyçš„åˆ†æä¸æ€»ç»“</a></li><li><a href="/2021/11/22/UE4/UE4CPP/Unreal%20%E5%A4%9A%E7%A7%8D%E6%8C%87%E9%92%88%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" rel="bookmark" title="Unreal å¤šç§æŒ‡é’ˆå®ç°åŸç†">Unreal å¤šç§æŒ‡é’ˆå®ç°åŸç†</a></li><li><a href="/2021/11/26/UE4/UE4CPP/Unreal%20Slate/" rel="bookmark" title="Unreal Slate">Unreal Slate</a></li><li><a href="/2021/12/01/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20%E6%80%BB%E8%A7%88%20&%20UEngine%20&%20UGameInstance/" rel="bookmark" title="Gameplay â€”â€” æ€»è§ˆ & UEngine & UGameInstance">Gameplay â€”â€” æ€»è§ˆ & UEngine & UGameInstance</a></li><li><a href="/2021/12/03/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20FWorldContext%20&%20UWorld%20&%20ULevel/" rel="bookmark" title="Gameplay â€”â€” FWorldContext & UWorld & ULevel">Gameplay â€”â€” FWorldContext & UWorld & ULevel</a></li><li><a href="/2021/12/06/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AActor%20&%20UActorComponent/" rel="bookmark" title="Gameplay â€”â€” AActor & UActorComponent">Gameplay â€”â€” AActor & UActorComponent</a></li><li><a href="/2021/12/09/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20APawn%20&%20AController%20&%20APlayerController/" rel="bookmark" title="Gameplay â€”â€” APawn & AController & APlayerController">Gameplay â€”â€” APawn & AController & APlayerController</a></li><li><a href="/2021/12/12/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AGameMode%20&%20AGameState%20&%20APlayerState/" rel="bookmark" title="Gameplay â€”â€” AGameMode & AGameState & APlayerState">Gameplay â€”â€” AGameMode & AGameState & APlayerState</a></li><li><a href="/2021/12/15/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20USavegame%20&%20UPlayer/" rel="bookmark" title="Gameplay â€”â€” USavegame & UPlayer">Gameplay â€”â€” USavegame & UPlayer</a></li><li><a href="/2021/12/17/UE4/UE4CPP/Unreal%20GAS%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" rel="bookmark" title="Unreal GAS æºç è§£æ">Unreal GAS æºç è§£æ</a></li><li><a href="/2021/12/28/UE4/UE4CPP/CustomItemModule/" rel="bookmark" title="Custom Item Module">Custom Item Module</a></li><li class="active"><a href="/2021/12/30/UE4/UE4CPP/Unreal%20%E5%BC%82%E6%AD%A5%E4%B8%8E%E5%B9%B6%E8%A1%8C%E7%BC%96%E7%A8%8B/" rel="bookmark" title="Unreal å¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹">Unreal å¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹</a></li><li><a href="/2022/01/03/UE4/UE4CPP/Unreal%20MovementComponent%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" rel="bookmark" title="Unreal MovementComponent æºç è§£æ">Unreal MovementComponent æºç è§£æ</a></li><li><a href="/2022/01/08/UE4/UE4CPP/Unreal%20%E8%93%9D%E5%9B%BE%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6/" rel="bookmark" title="Unreal è“å›¾åº•å±‚å®ç°æœºåˆ¶">Unreal è“å›¾åº•å±‚å®ç°æœºåˆ¶</a></li><li><a href="/2022/02/12/UE4/UE4CPP/Unreal%20%E5%8A%A8%E7%94%BB%E7%9B%B8%E5%85%B3/" rel="bookmark" title="Unreal MotionMatching">Unreal MotionMatching</a></li><li><a href="/2022/03/15/UE4/UE4CPP/Unreal%20%E5%B8%B8%E7%94%A8%E6%8E%A5%E5%8F%A3%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20%E4%B9%8B%E4%B8%80/" rel="bookmark" title="Unreal å¸¸ç”¨æ¥å£æºç åˆ†æ ä¹‹ä¸€">Unreal å¸¸ç”¨æ¥å£æºç åˆ†æ ä¹‹ä¸€</a></li></ul></div><div class="overview panel" data-title="ç«™ç‚¹æ¦‚è§ˆ"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="-YIFEI-" data-src="/images/avatar.jpg"><p class="name" itemprop="name">-YIFEI-</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">57</span> <span class="name">æ–‡ç« </span></a></div><div class="item categories"><a href="/categories/"><span class="count">15</span> <span class="name">åˆ†ç±»</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0tvdG9yaS1TdWtp" title="https:&#x2F;&#x2F;github.com&#x2F;Kotori-Suki"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS90dnQtNjA=" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;tvt-60"><i class="ic i-zhihu"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>é¦–é¡µ</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>æ–‡ç« </a><ul class="submenu"><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>åˆ†ç±»</a></li></ul></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>æ ‡ç­¾</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/12/28/UE4/UE4CPP/CustomItemModule/" rel="prev" title="ä¸Šä¸€ç¯‡"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/01/03/UE4/UE4CPP/Unreal%20MovementComponent%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" rel="next" title="ä¸‹ä¸€ç¯‡"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>éšæœºæ–‡ç« </h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="åˆ†ç±»äº C++åŸºç¡€">C++åŸºç¡€</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="åˆ†ç±»äº è®¾è®¡æ¨¡å¼">è®¾è®¡æ¨¡å¼</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/" title="åˆ†ç±»äº åˆ›å»ºå‹æ¨¡å¼">åˆ›å»ºå‹æ¨¡å¼</a></div><span><a href="/2021/08/17/CPPBase/DesignPattern/ProtoType/" title="åŸå‹æ¨¡å¼">åŸå‹æ¨¡å¼</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="åˆ†ç±»äº UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="åˆ†ç±»äº UE4_C++">UE4_C++</a></div><span><a href="/2021/10/25/UE4/UE4CPP/API%E4%B8%8D%E6%AD%A3%E5%B8%B8%E5%B7%A5%E4%BD%9C-%E4%B9%8B-GetGameMode/" title="APIä¸æ­£å¸¸å·¥ä½œ ä¹‹ GetGameMode">APIä¸æ­£å¸¸å·¥ä½œ ä¹‹ GetGameMode</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="åˆ†ç±»äº UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="åˆ†ç±»äº UE4_C++">UE4_C++</a></div><span><a href="/2021/11/15/UE4/UE4CPP/FProperty%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E6%80%BB%E7%BB%93/" title="FPropertyçš„åˆ†æä¸æ€»ç»“">FPropertyçš„åˆ†æä¸æ€»ç»“</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ComputerBase/" title="åˆ†ç±»äº è®¡ç®—æœºåŸºç¡€">è®¡ç®—æœºåŸºç¡€</a> <i class="ic i-angle-right"></i> <a href="/categories/ComputerBase/%E7%AE%97%E6%B3%95/" title="åˆ†ç±»äº ç®—æ³•">ç®—æ³•</a></div><span><a href="/2021/08/16/ComputerBase/Algorithm/%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93%EF%BC%9A%E5%8F%8C%E6%8C%87%E9%92%88/" title="åŒæŒ‡é’ˆ">åŒæŒ‡é’ˆ</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="åˆ†ç±»äº UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="åˆ†ç±»äº UE4_C++">UE4_C++</a></div><span><a href="/2021/10/31/UE4/UE4CPP/Session%E7%9A%84%E4%BD%BF%E7%94%A8%20C++%E7%AF%87/" title="Sessionçš„ä½¿ç”¨ C++ç¯‡">Sessionçš„ä½¿ç”¨ C++ç¯‡</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="åˆ†ç±»äº UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="åˆ†ç±»äº UE4_C++">UE4_C++</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/Gameplay/" title="åˆ†ç±»äº Gameplay">Gameplay</a></div><span><a href="/2021/12/03/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20FWorldContext%20&%20UWorld%20&%20ULevel/" title="Gameplay â€”â€” FWorldContext &amp; UWorld &amp; ULevel">Gameplay â€”â€” FWorldContext & UWorld & ULevel</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="åˆ†ç±»äº C++åŸºç¡€">C++åŸºç¡€</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="åˆ†ç±»äº è®¾è®¡æ¨¡å¼">è®¾è®¡æ¨¡å¼</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/" title="åˆ†ç±»äº ç»“æ„å‹æ¨¡å¼">ç»“æ„å‹æ¨¡å¼</a></div><span><a href="/2021/08/18/CPPBase/DesignPattern/Proxy/" title="ä»£ç†æ¨¡å¼">ä»£ç†æ¨¡å¼</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="åˆ†ç±»äº UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="åˆ†ç±»äº UE4_C++">UE4_C++</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/Gameplay/" title="åˆ†ç±»äº Gameplay">Gameplay</a></div><span><a href="/2021/12/09/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20APawn%20&%20AController%20&%20APlayerController/" title="Gameplay â€”â€” APawn &amp; AController &amp; APlayerController">Gameplay â€”â€” APawn & AController & APlayerController</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="åˆ†ç±»äº C++åŸºç¡€">C++åŸºç¡€</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="åˆ†ç±»äº è®¾è®¡æ¨¡å¼">è®¾è®¡æ¨¡å¼</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/" title="åˆ†ç±»äº è¡Œä¸ºå‹æ¨¡å¼">è¡Œä¸ºå‹æ¨¡å¼</a></div><span><a href="/2021/08/19/CPPBase/DesignPattern/TemplateMethod/" title="æ¨¡æ¿æ¨¡å¼">æ¨¡æ¿æ¨¡å¼</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="åˆ†ç±»äº C++åŸºç¡€">C++åŸºç¡€</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="åˆ†ç±»äº è®¾è®¡æ¨¡å¼">è®¾è®¡æ¨¡å¼</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/" title="åˆ†ç±»äº åˆ›å»ºå‹æ¨¡å¼">åˆ›å»ºå‹æ¨¡å¼</a></div><span><a href="/2021/08/17/CPPBase/DesignPattern/Builder/" title="å»ºé€ è€…æ¨¡å¼">å»ºé€ è€…æ¨¡å¼</a></span></li></ul></div><div><h2>æœ€æ–°è¯„è®º</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2021 â€“ <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">-YIFEI- @ Afei's Blog</span></div><div class="powered-by">åŸºäº <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/12/30/UE4/UE4CPP/Unreal å¼‚æ­¥ä¸å¹¶è¡Œç¼–ç¨‹/",favicon:{show:"ï¼ˆâ—Â´3ï½€â—ï¼‰ã‚„ã‚Œã‚„ã‚Œã ãœ",hide:"(Â´Ğ”ï½€)å¤§å¤‰ã ï¼"},search:{placeholder:"æ–‡ç« æœç´¢",empty:"å…³äº ã€Œ ${query} ã€ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœåˆ°",stats:"${time} ms å†…æ‰¾åˆ° ${hits} æ¡ç»“æœ"},valine:!0,fancybox:!0,copyright:'å¤åˆ¶æˆåŠŸï¼Œè½¬è½½è¯·éµå®ˆ <i class="ic i-creative-commons"></i>BY-NC-SA åè®®ã€‚',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>