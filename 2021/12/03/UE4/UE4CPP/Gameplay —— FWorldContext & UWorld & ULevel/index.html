<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="一个年轻人奔向梦想的足迹" href="https://kotori_suki.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="一个年轻人奔向梦想的足迹" href="https://kotori_suki.github.io/atom.xml"><link rel="alternate" type="application/json" title="一个年轻人奔向梦想的足迹" href="https://kotori_suki.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="https://kotori_suki.github.io/2021/12/03/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20FWorldContext%20&%20UWorld%20&%20ULevel/"><title>Gameplay —— FWorldContext & UWorld & ULevel - Gameplay - UE4_C++ - UE4 | Afei's Blog = 一个年轻人奔向梦想的足迹 = Welcome to my blog !</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Gameplay —— FWorldContext & UWorld & ULevel</h1><div class="meta"><span class="item" title="创建时间：2021-12-03 11:43:15"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-12-03T11:43:15+08:00">2021-12-03</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Afei's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclhtuo6nj20zk0m8ttm.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclize41wj20zk0m87gk.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclffsa1cj20zk0m811l.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipeu7txpzj20zk0m81kx.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclx29mstj20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclhpw3lwj20zk0m8gvw.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/UE4/" itemprop="item" rel="index" title="分类于 UE4"><span itemprop="name">UE4</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/UE4/UE4CPP/" itemprop="item" rel="index" title="分类于 UE4_C++"><span itemprop="name">UE4_C++</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/UE4/UE4CPP/Gameplay/" itemprop="item" rel="index" title="分类于 Gameplay"><span itemprop="name">Gameplay</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://kotori_suki.github.io/2021/12/03/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20FWorldContext%20&%20UWorld%20&%20ULevel/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="-YIFEI-"><meta itemprop="description" content="Welcome to my blog !, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="一个年轻人奔向梦想的足迹"></span><div class="body md" itemprop="articleBody"><h2 id="gameplay-fworldcontext-uworld-ulevel"><a class="anchor" href="#gameplay-fworldcontext-uworld-ulevel">#</a> Gameplay —— FWorldContext &amp; UWorld &amp; ULevel</h2><p>简介：游戏作为虚拟次元，我们首先要这个次元创造一个容纳万物的世界。在虚幻的世界观中，&quot;UWorld&quot; 即是容纳万物的世界，而 &quot;ULevel&quot; 可以理解为将 &quot;UWorld&quot; 划分为多个国家。我们可以在国家之间旅游，也可以进行跨世界的旅游 (火星一日游？)，&quot;FWorldContext&quot; 是描述 &quot;UWorld&quot; 信息的结构。以上提到的类即是本篇的主题 —— 虚幻在生成世界中都用到了哪些函数，以及我们开发时又有哪些实用的 API (不分析具体 API 的实现，太多了)</p><h3 id="fworldcontext"><a class="anchor" href="#fworldcontext">#</a> FWorldContext</h3><p>FWorldContext (世界上下文类) 是用于引擎层面处理 UWorld 的上下文信息，其中包括：URL，WorldType，ObjectReferences 等。&quot;GameEngine&quot; 中通常只有一个世界上下文，而 &quot;EditorEngine&quot; 中则有一个编辑器世界和一个 PIE 世界。以下是其源码分析：</p><p></p><figure class="highlight c++"><figcaption><span>FWorldContext</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Engine.h</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">USTRUCT</span>()</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FWorldContext</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="built_in">GENERATED_USTRUCT_BODY</span>()</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**************************************************************/</span></span><br><span class="line">	</span><br><span class="line">	TEnumAsByte&lt;EWorldType::Type&gt;	WorldType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 流关卡处理器</span></span><br><span class="line">	FSeamlessTravelHandler SeamlessTravelHandler;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上下文处理器</span></span><br><span class="line">	FName ContextHandle;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 提供给挂起客户端连接的URL</span></span><br><span class="line">    FString TravelURL;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 提供给挂起客户端连接的连接类型</span></span><br><span class="line">    uint8 TravelType;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 上一次连接的URL */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">FURL</span> <span class="title">LastURL</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 上一次连接的服务器(用于 &quot;reconnect&quot; 命令) */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">FURL</span> <span class="title">LastRemoteURL</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	UPendingNetGame * PendingNetGame;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 标签/数组对列表，用于完全加载带有DLC的地图/游戏可能需要的包(LoadMap时)，但我们不能使用 &quot;DynamicLoadObject&quot; 从包中加载 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TArray&lt;<span class="class"><span class="keyword">struct</span> <span class="title">FFullyLoadedPackagesInfo</span>&gt;</span> PackagesToFullyLoad;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 包/关卡名称 数组，需要在挂起地图更改时被读取。</span></span><br><span class="line"><span class="comment">	 * 数组里的第一个关卡将被作为假持久关卡存在 &quot;ULevelStreamingPersistent&quot; 中</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	TArray&lt;FName&gt; LevelsToLoadForPendingMapChange;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 已加载的关卡的数组。排序是任意的，取决于已加载的内容 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TArray&lt;<span class="class"><span class="keyword">class</span> <span class="title">ULevel</span>*&gt;</span> LoadedLevelsForPendingMapChange;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在地图更改发生错误时的错误信息字符串，没有错误则为空 */</span></span><br><span class="line">	FString PendingMapChangeFailureDescription;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 是否在下一帧提交地图更改 */</span></span><br><span class="line">	uint32 bShouldCommitPendingMapChange:<span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 对象引用的句柄，用于引擎保护对象不被GC */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TArray&lt;<span class="class"><span class="keyword">class</span> <span class="title">UObjectReferencer</span>*&gt;</span> ObjectReferencers;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TArray&lt;<span class="class"><span class="keyword">struct</span> <span class="title">FLevelStreamingStatus</span>&gt;</span> PendingLevelStreamingStatusUpdates;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UGameViewportClient</span>* <span class="title">GameViewport</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UGameInstance</span>* <span class="title">OwningGameInstance</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当前活跃的网络驱动列表 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(transient)</span><br><span class="line">	TArray&lt;FNamedNetDriver&gt; ActiveNetDrivers;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 该世界的PIE实例，默认值为-1 */</span></span><br><span class="line">	int32	PIEInstance;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** PIE关卡名称的前缀，默认值为空 */</span></span><br><span class="line">	FString	PIEPrefix;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** PIE世界应用的功能关卡 */</span></span><br><span class="line">	ERHIFeatureLevel::Type PIEWorldFeatureLevel;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 是否在独立服务器中运行 */</span></span><br><span class="line">	<span class="keyword">bool</span>	RunAsDedicated;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 该世界上下文是否正在等待在线登录完成 */</span></span><br><span class="line">	<span class="keyword">bool</span>	bWaitingOnOnlineSubsystem;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 该世界上下文的音频设备句柄 */</span></span><br><span class="line">	uint32 AudioDeviceID;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 显示在蓝图debugger UI 上的自定义描述 */</span></span><br><span class="line">	FString CustomDescription;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如果大于0，在PIE中以一定的速率每帧更新此世界</span></span><br><span class="line">	<span class="keyword">float</span> PIEFixedTickSeconds  = <span class="number">0.f</span>;</span><br><span class="line">	<span class="keyword">float</span> PIEAccumulatedTickSeconds = <span class="number">0.f</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**************************************************************/</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 指向当前世界的外部指针，如果当前世界发生变化，这些指针也应同步变化  */</span></span><br><span class="line">	TArray&lt;UWorld**&gt; ExternalReferences;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 添加一个额外的引用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddRef</span><span class="params">(UWorld*&amp; WorldPtr)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		WorldPtr = ThisCurrentWorld;</span><br><span class="line">		ExternalReferences.<span class="built_in">AddUnique</span>(&amp;WorldPtr);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 移除一个额外的引用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RemoveRef</span><span class="params">(UWorld*&amp; WorldPtr)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		ExternalReferences.<span class="built_in">Remove</span>(&amp;WorldPtr);</span><br><span class="line">		WorldPtr = <span class="literal">nullptr</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 设置 CurrentWorld 并更新额外的引用指针*/</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">SetCurrentWorld</span><span class="params">(UWorld *World)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 收集 FWorldContext 的引用(用于GC) */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddReferencedObjects</span><span class="params">(FReferenceCollector&amp; Collector, <span class="keyword">const</span> UObject* ReferencingObject)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">FORCEINLINE UWorld* <span class="title">World</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> ThisCurrentWorld;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    	<span class="built_in">FWorldContext</span>()</span><br><span class="line">		: <span class="built_in">WorldType</span>(EWorldType::None)</span><br><span class="line">		, <span class="built_in">ContextHandle</span>(NAME_None)</span><br><span class="line">		, <span class="built_in">TravelURL</span>()</span><br><span class="line">		, <span class="built_in">TravelType</span>(<span class="number">0</span>)</span><br><span class="line">		, <span class="built_in">PendingNetGame</span>(<span class="literal">nullptr</span>)</span><br><span class="line">		, <span class="built_in">bShouldCommitPendingMapChange</span>(<span class="number">0</span>)</span><br><span class="line">		, <span class="built_in">GameViewport</span>(<span class="literal">nullptr</span>)</span><br><span class="line">		, <span class="built_in">OwningGameInstance</span>(<span class="literal">nullptr</span>)</span><br><span class="line">		, <span class="built_in">PIEInstance</span>(INDEX_NONE)</span><br><span class="line">		, <span class="built_in">PIEWorldFeatureLevel</span>(ERHIFeatureLevel::Num)</span><br><span class="line">		, <span class="built_in">RunAsDedicated</span>(<span class="literal">false</span>)</span><br><span class="line">		, <span class="built_in">bWaitingOnOnlineSubsystem</span>(<span class="literal">false</span>)</span><br><span class="line">		, <span class="built_in">AudioDeviceID</span>(INDEX_NONE)</span><br><span class="line">		, <span class="built_in">ThisCurrentWorld</span>(<span class="literal">nullptr</span>)</span><br><span class="line">	&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">	UWorld*	ThisCurrentWorld;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>可见，该结构体主要时维护与世界相关的一些信息 (当前世界的引用，世界类型，URL，需要读取的包 / 关卡，对象引用，游戏视口，游戏实例，网络驱动，PIE 世界信息，音频设备句柄等)，并更新指向该世界的指针。</p><h3 id="uworld"><a class="anchor" href="#uworld">#</a> UWorld</h3><p>我们继续往上走。&quot;UWorld&quot; 以后开始 &quot;讲人话&quot; 了，因为这是我们开发中真实存在的，看得见摸得着的东西，也就是会被渲染出来的。而且后面有比较多我们开发中常常接触到的函数，理解起来也会相对简单。以下代码分析省略只用于编辑器模式下的代码：</p><p></p><figure class="highlight c++"><figcaption><span>UWorld</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UCLASS</span>(customConstructor, config=Engine)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ENGINE_API</span> <span class="title">UWorld</span> <span class="keyword">final</span> :</span> <span class="keyword">public</span> UObject, <span class="keyword">public</span> FNetworkNotify</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_UCLASS_BODY</span>()</span><br><span class="line"></span><br><span class="line">	~<span class="built_in">UWorld</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 包含世界信息、默认brush、在游戏过程中生成的actors的持久关卡 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">ULevel</span>*								<span class="title">PersistentLevel</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 用于客户端和服务器通信的 NAME_GameNetDriver 游戏连接 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UNetDriver</span>*							<span class="title">NetDriver</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 线条批处理程序，画出此世界的所有线条 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">ULineBatchComponent</span>*					<span class="title">LineBatcher</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 持久线条批处理程序，他们不会每帧刷新 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">ULineBatchComponent</span>*					<span class="title">PersistentLineBatcher</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 前景线条批量处理程序，这可能不是持久的  */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">ULineBatchComponent</span>*					<span class="title">ForegroundLineBatcher</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 游戏特定的此世界的网络管理器实例 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">AGameNetworkManager</span>*					<span class="title">NetworkManager</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Instance of this world&#x27;s game-specific physics collision handler */</span></span><br><span class="line">    <span class="comment">/** 游戏特定的此世界的物理碰撞处理器实例 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UPhysicsCollisionHandler</span>*				<span class="title">PhysicsCollisionHandler</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此世界额外引用的对象，以避免他们被GC */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	TArray&lt;UObject*&gt;							ExtraReferencedObjects;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 额外模组可以拥有与此世界相关的额外数据</span></span><br><span class="line"><span class="comment">	 * 此数组包含每个模组世界数据对象，他们不会被默认加载/保存</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	TArray&lt;UObject*&gt;							PerModuleDataObjects;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/** 关卡收集器，ULevel将以FName(包名)的形式被引用，以避免序列化引用。同时包含以世界单位表示的偏移 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	TArray&lt;ULevelStreaming*&gt; StreamingLevels;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 真正用于考虑切换的流关卡列表(通常是当前关卡的邻关卡)，是 &quot;StreamingLevels&quot; 的子集 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient, DuplicateTransient)</span><br><span class="line">	FStreamingLevelsToConsider StreamingLevelsToConsider;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回一个const版本的流关卡数组 */</span></span><br><span class="line">	<span class="function"><span class="keyword">const</span> TArray&lt;ULevelStreaming*&gt;&amp; <span class="title">GetStreamingLevels</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> StreamingLevels; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...... 省略流关卡的其他函数(958行)</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/** 在需要设置为可见的队列中的当前关卡的指针，如果没有挂起则为空 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">ULevel</span>*								<span class="title">CurrentLevelPendingVisibility</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在需要设置为不可见的队列中的当前关卡的指针，如果没有挂起则为空 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">ULevel</span>*								<span class="title">CurrentLevelPendingInvisibility</span>;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * UDemoNetDriver 用于模拟网络驱动，录制和回滚游戏会话</span></span><br><span class="line"><span class="comment">     * 用于捕获网络流量以录制演示网络驱动，</span></span><br><span class="line"><span class="comment">     * 4.26版本已成为私有属性，请使用 GetDemoNetDriver / SetDemoNetDriver 代替</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.26</span>, <span class="string">&quot;DemoNetDriver will be made private in a future release.  Please use GetDemoNetDriver/SetDemoNetDriver instead.&quot;</span>)</span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UDemoNetDriver</span>*						<span class="title">DemoNetDriver</span>;</span></span><br><span class="line"></span><br><span class="line">	PRAGMA_DISABLE_DEPRECATION_WARNINGS</span><br><span class="line">	<span class="comment">/** 获取此世界的演示网络驱动 */</span></span><br><span class="line">	<span class="function">UDemoNetDriver* <span class="title">GetDemoNetDriver</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> DemoNetDriver; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 设置此世界的演示网络驱动 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetDemoNetDriver</span><span class="params">(UDemoNetDriver* <span class="keyword">const</span> InDemoNetDriver)</span> </span>&#123; DemoNetDriver = InDemoNetDriver; &#125;</span><br><span class="line">	PRAGMA_ENABLE_DEPRECATION_WARNINGS</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 粒子世界管理器 **/</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">AParticleEventManager</span>*				<span class="title">MyParticleEventManager</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/** 整个游戏使用的默认物理体积 **/</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	APhysicsVolume*								DefaultPhysicsVolume;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ..... 省略一些用于函数条件判断的布尔变量</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 创建 动态源 和 静态的LevelCollection (如果不存在)*/</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ConditionallyCreateDefaultLevelCollections</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/** 此世界活跃的音频设备的句柄 */</span></span><br><span class="line">	FAudioDeviceHandle AudioDeviceHandle;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 从 DemoNetDriver 中调用，当回滚网络重播和时间线被成功清除时调用 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>()</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">HandleTimelineScrubbed</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/** 当音频设备被销毁时的代理句柄 */</span></span><br><span class="line">	FDelegateHandle AudioDeviceDestroyedHandle;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UGameInstance</span>*						<span class="title">OwningGameInstance</span>;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ..... 省略部分用于渲染的属性(1254行)</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 设置导航系统实例的指针 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetNavigationSystem</span><span class="params">(UNavigationSystemBase* InNavigationSystem)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 用于此世界的屏幕管理器的接口 */</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">FSceneInterface</span>*						<span class="title">Scene</span>;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 获取此世界的 CurrentLevel 属性值 **/</span></span><br><span class="line">	<span class="function">class ULevel* <span class="title">GetCurrentLevel</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 从包加载世界之前填充的静态地图。这是为了让 UWorld 可以在 ::PostLoad 中查找其 WorldType */</span></span><br><span class="line">	<span class="keyword">static</span> TMap&lt;FName, EWorldType::Type&gt; WorldTypePreLoadMap;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 为此世界创建一个新的 FX system */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">CreateFXSystem</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 初始化所有世界子系统 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">InitializeSubsystems</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 设置此世界是否由引擎 tick，但你必须自己对此负责 </span></span><br><span class="line"><span class="comment">     * 如果使用不当，可能会发生意外后果。</span></span><br><span class="line"><span class="comment">     * 这就是说，对于非交互式和非渲染的世界，它可以节省 tick 产生的消耗。</span></span><br><span class="line"><span class="comment">     * 这可能永远不应该用于初级游戏世界。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetShouldTick</span><span class="params">(<span class="keyword">const</span> <span class="keyword">bool</span> bInShouldTick)</span> </span>&#123; bShouldTick = bInShouldTick; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回此世界是否正在 tick，参见 SetShouldTick */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ShouldTick</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> bShouldTick; &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/** 此世界中的所有 controller 的列表 */</span></span><br><span class="line">	TArray&lt;TWeakObjectPtr&lt;<span class="class"><span class="keyword">class</span> <span class="title">AController</span>&gt;</span> &gt; ControllerList;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此世界中的所有 player controller 的列表 */</span></span><br><span class="line">	TArray&lt;TWeakObjectPtr&lt;<span class="class"><span class="keyword">class</span> <span class="title">APlayerController</span>&gt;</span> &gt; PlayerControllerList;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此世界中的所有摄像机的列表，为玩家们自动开启 */</span></span><br><span class="line">	TArray&lt;TWeakObjectPtr&lt;ACameraActor&gt; &gt; AutoCameraActorList;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此世界中的所有物理体积的列表。不包含默认物理体积 */</span></span><br><span class="line">	TArray&lt;TWeakObjectPtr&lt;APhysicsVolume&gt; &gt; NonDefaultPhysicsVolumeList;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此世界的物理场景 */</span></span><br><span class="line">	FPhysScene*									PhysicsScene;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 帧末尾更新前需要等待任务完成的组件 数组 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient, NonTransactional)</span><br><span class="line">	TSet&lt;UActorComponent*&gt; ComponentsThatNeedPreEndOfFrameSync;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 需要在帧末尾时更新的组件 数组 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient, NonTransactional)</span><br><span class="line">	TArray&lt;UActorComponent*&gt; ComponentsThatNeedEndOfFrameUpdate;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 需要在帧末尾更新游戏线程的组件 数组 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient, NonTransactional)</span><br><span class="line">	TArray&lt;UActorComponent*&gt; ComponentsThatNeedEndOfFrameUpdate_OnGameThread;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 异步跟踪的状态-抽象为自己的对象以便于引用 */</span></span><br><span class="line">	FWorldAsyncTraceState AsyncTraceState;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 生成 actor 时广播的代理 */</span></span><br><span class="line">	FOnActorSpawned OnActorSpawned;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 新生成 actor 初始化前广播的代理*/</span></span><br><span class="line">	FOnActorSpawned OnActorPreSpawnInitialization;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 重置异步跟踪缓存 **/</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ResetAsyncTrace</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 等待所有异步跟踪缓存完成 **/</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">WaitForAllAsyncTraceTasks</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 完成异步跟踪缓存 **/</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">FinishAsyncTrace</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 实用程序函数，用于确保世界具有正确的世界设置 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RepairWorldSettings</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 实用程序函数，用于清除指向无效关卡包的流关卡 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RepairStreamingLevels</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 计时器管理器 */</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">FTimerManager</span>* <span class="title">TimerManager</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 处理世界的挂起的潜在操作的管理器 */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">FLatentActionManager</span> <span class="title">LatentActionManager</span>;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 下次调用 BuildStreamingData()时的时间戳(FPlatformTime:：Seconds)，如果 bDirtyStreamingData 为 true */</span></span><br><span class="line">	<span class="keyword">double</span> BuildStreamingDataTimer;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">DECLARE_EVENT_OneParam</span>(UWorld, FOnNetTickEvent, <span class="keyword">float</span>);</span><br><span class="line">	<span class="built_in">DECLARE_EVENT</span>(UWorld, FOnTickFlushEvent);</span><br><span class="line">	<span class="comment">/** 获取所有网络驱动，并立即调用 TickDispatch */</span></span><br><span class="line">	FOnNetTickEvent TickDispatchEvent;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 获取所有网络驱动，并立即调用 PostTickDispatch */</span></span><br><span class="line">	FOnTickFlushEvent PostTickDispatchEvent;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 获取所有网络驱动，并立即调用 TickFlush */</span></span><br><span class="line">	FOnNetTickEvent TickFlushEvent;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/** 获取所有网络驱动，并立即调用 PostTickFlush */</span></span><br><span class="line">	FOnTickFlushEvent PostTickFlushEvent;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...... 省略以上代理的 broadcast 函数(1425行)</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment">/** 关卡数改变时广播 */</span></span><br><span class="line">	<span class="built_in">DECLARE_EVENT</span>(UWorld, FOnLevelsChangedEvent);</span><br><span class="line">	FOnLevelsChangedEvent LevelsChangedEvent;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** UWorld::BeginTearingDown 中广播 */</span></span><br><span class="line">	<span class="built_in">DECLARE_EVENT</span>(UWorld, FOnBeginTearingDownEvent);</span><br><span class="line">	FOnBeginTearingDownEvent BeginTearingDownEvent;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">/** 加载此世界时使用的URL */</span></span><br><span class="line">	FURL URL;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** FX系统的接口，管理此世界的例子和相关的效果 */</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">FFXSystemInterface</span>* <span class="title">FXSystem</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 用于保存与此世界关联的 tick functions 的数据结构(线条批处理器，等) **/</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">FTickTaskLevel</span>* <span class="title">TickTaskLevel</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 开启物理的 tick 函数 */</span></span><br><span class="line">	FStartPhysicsTickFunction StartPhysicsTickFunction;</span><br><span class="line">	<span class="comment">/** 关闭物理的 tick 函数 */</span></span><br><span class="line">	FEndPhysicsTickFunction EndPhysicsTickFunction;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 拥有控制器的玩家的个数 */</span></span><br><span class="line">	int32 PlayerNum;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 延迟流体积更新的帧数，如果您预加载了一系列关卡，但相机还没有加载时非常有用 */</span></span><br><span class="line">	int32 StreamingVolumeUpdateDelay;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 强制不读取流关卡</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">GetShouldForceUnloadStreamingLevels</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> bShouldForceUnloadStreamingLevels; &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetShouldForceUnloadStreamingLevels</span><span class="params">(<span class="keyword">bool</span> bInShouldForceUnloadStreamingLevels)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 强制流关卡可见</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">GetShouldForceVisibleStreamingLevels</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> bShouldForceVisibleStreamingLevels; &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetShouldForceVisibleStreamingLevels</span><span class="params">(<span class="keyword">bool</span> bInShouldForceVisibleStreamingLevels)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 当世界计算 后处理体积 对场景的贡献时调用*/</span></span><br><span class="line">    <span class="built_in">DECLARE_EVENT_TwoParams</span>(UWorld, FOnBeginPostProcessSettings, FVector, FSceneView*);</span><br><span class="line">	FOnBeginPostProcessSettings OnBeginPostProcessSettings;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 省略后处理体积的 增删操作 函数(1524行)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 后处理体积的数组，按优先级升序排列 */</span></span><br><span class="line">	TArray&lt; IInterface_PostProcessVolume * &gt; PostProcessVolumes;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 音频体积的集合  */</span></span><br><span class="line">	TArray&lt;<span class="class"><span class="keyword">class</span> <span class="title">AAudioVolume</span>*&gt;</span> AudioVolumes;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ....... 省略部分记录时间的变量(1543行)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 当前世界的起始位置 */</span></span><br><span class="line">	FIntVector OriginLocation;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 请求加载的新世界的起始位置 */</span></span><br><span class="line">	FIntVector RequestedOriginLocation;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 世界原点偏移值。原点重设基址时，仅对单个帧非零 */</span></span><br><span class="line">	FVector OriginOffsetThisFrame;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在移动到下一个地图之前等待的时间量，为客户端提供接收最终RPC 的时间*/</span></span><br><span class="line">	<span class="keyword">float</span> NextSwitchCountdown;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 构成该世界的所有关卡信息 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UWorldComposition</span>* <span class="title">WorldComposition</span>;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 刷新关卡流的类型 (None，Full，Visibility) */</span> </span><br><span class="line">	EFlushLevelStreamingType FlushLevelStreamingType;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 执行下一次服务器连接时的 TravelType (Absolute, Partial, Relatie) */</span></span><br><span class="line">	TEnumAsByte&lt;ETravelType&gt; NextTravelType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">/** 当前正在读取的流关卡的数量 */</span></span><br><span class="line">	uint16 NumStreamingLevelsBeingLoaded;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">struct</span> <span class="title">FWorldNotifyStreamingLevelLoading</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">/** 用于即将进行的服务器连接的URL */</span></span><br><span class="line">	FString NextURL;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 通过PrepareMapChange()/CommitMacChange() 加载到此地图中的关卡数组(用于通知新加入的客户端) */</span></span><br><span class="line">	TArray&lt;FName&gt; PreparingLevelNames;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 持久关卡的名称 (通过CommitMapChange()加载，StreamingLevel数组中通常不包含的关卡) (用于通知新加入的客户端) */</span></span><br><span class="line">	FName CommittedPersistentLevelName;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Experimental: 游戏中的性能跟踪</span></span><br><span class="line">	FWorldInGamePerformanceTrackers* PerfTrackers;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** UWorld 默认构造函数 */</span></span><br><span class="line">	<span class="built_in">UWorld</span>(<span class="keyword">const</span> FObjectInitializer&amp; ObjectInitializer = FObjectInitializer::<span class="built_in">Get</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 射线检测</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 使用一个特定的通道追踪一条射线，如果找到阻挡物体(符合通道要求)则返回 */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">LineTraceTestByChannel</span><span class="params">(<span class="keyword">const</span> FVector&amp; Start,<span class="keyword">const</span> FVector&amp; End,ECollisionChannel TraceChannel, <span class="keyword">const</span> FCollisionQueryParams&amp; Params = FCollisionQueryParams::DefaultQueryParam, <span class="keyword">const</span> FCollisionResponseParams&amp; ResponseParam = FCollisionResponseParams::DefaultResponseParam)</span> <span class="keyword">const</span></span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// ........ 省略其他射线型碰撞检测函数 (1663行)</span></span><br><span class="line">    <span class="comment">// ........ 省略形状型碰撞检测函数 (1761行)</span></span><br><span class="line">    <span class="comment">// ........ 省略形状型重叠检测函数 (1875行)</span></span><br><span class="line">    <span class="comment">// ........ 省略组件型碰撞检测和重叠检测 (1967行)</span></span><br><span class="line">    <span class="comment">// ........ 省略异步的碰撞检测和重叠检测 (2019行)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 查询碰撞数据，无论是否碰撞，只要执行了就会返回真。如果碰撞，OutData会返回碰撞的结果 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">QueryTraceData</span><span class="params">(<span class="keyword">const</span> FTraceHandle&amp; Handle, FTraceDatum&amp; OutData)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 查询重叠数据，无论是否重叠，只要执行了就会返回真。如果重叠，OutData会返回重叠的结果 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">QueryOverlapData</span><span class="params">(<span class="keyword">const</span> FTraceHandle&amp; Handle, FOverlapDatum&amp; OutData)</span></span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/** 检测句柄是否仍然有效 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsTraceHandleValid</span><span class="params">(<span class="keyword">const</span> FTraceHandle&amp; Handle, <span class="keyword">bool</span> bOverlapTrace)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 获取导航系统 */</span></span><br><span class="line">	<span class="function">FORCEINLINE UNavigationSystemBase* <span class="title">GetNavigationSystem</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> NavigationSystem; &#125;</span><br><span class="line">	<span class="comment">/** 获取const类型的导航系统 */</span></span><br><span class="line">	<span class="function">FORCEINLINE <span class="keyword">const</span> UNavigationSystemBase* <span class="title">GetNavigationSystem</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> NavigationSystem; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 获取AI系统，如果没找到则创建一个并返回</span></span><br><span class="line"><span class="comment">     * 注意: 结果可以为空，例如: 在客户端游戏中，或者如果没有AI模组，或者 AISystem 类尚未被指定</span></span><br><span class="line"><span class="comment">	 * 查看 UAISystemBase::AISystemClassName 和 UAISystemBase::AISystemModuleName */</span></span><br><span class="line">	<span class="function">UAISystemBase* <span class="title">CreateAISystem</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 获取 AI系统 */</span></span><br><span class="line">	<span class="function">FORCEINLINE UAISystemBase* <span class="title">GetAISystem</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> AISystem; &#125;</span><br><span class="line">	<span class="comment">/** 获取const类型的 AI系统 */</span></span><br><span class="line">	<span class="function">FORCEINLINE <span class="keyword">const</span> UAISystemBase* <span class="title">GetAISystem</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> AISystem; &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 获取碰撞回避(RVO)管理器 */</span></span><br><span class="line">	<span class="function">FORCEINLINE class UAvoidanceManager* <span class="title">GetAvoidanceManager</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> AvoidanceManager; &#125;</span><br><span class="line">	<span class="comment">/** 获取const型的碰撞回避(RVO)管理器 */</span></span><br><span class="line">	<span class="function">FORCEINLINE <span class="keyword">const</span> class UAvoidanceManager* <span class="title">GetAvoidanceManager</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> AvoidanceManager; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回 Controller 的迭代器 */</span></span><br><span class="line">	<span class="function">FConstControllerIterator <span class="title">GetControllerIterator</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回 Controller 的个数 */</span></span><br><span class="line">	<span class="function">int32 <span class="title">GetNumControllers</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 返回 Pawn 的迭代器，在4.24版本后，Pawn 迭代器是一个低效的迭代办法，请使用 TActorIterator&lt;PawnType&gt; 代替 */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.24</span>, <span class="string">&quot;The PawnIterator is an inefficient mechanism for iterating pawns. Please use TActorIterator&lt;PawnType&gt; instead.&quot;</span>)</span><br><span class="line">	<span class="function">FConstPawnIterator <span class="title">GetPawnIterator</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 返回 Pawn 的个数，4.23版本后不支持，为了版本兼容而保留的函数效率较低 */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.23</span>, <span class="string">&quot;GetNumPawns is no longer a supported function on UWorld. The version that remains for backwards compatibility is significantly more expensive to call.&quot;</span>)</span><br><span class="line">	<span class="function">int32 <span class="title">GetNumPawns</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 返回一个 PlayerController 列表的迭代器 */</span></span><br><span class="line">	<span class="function">FConstPlayerControllerIterator <span class="title">GetPlayerControllerIterator</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回 PlayerController 的个数 */</span></span><br><span class="line">	<span class="function">int32 <span class="title">GetNumPlayerControllers</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 返回第一个 PlayerController，并转换为模板类型。</span></span><br><span class="line"><span class="comment">	 * 如果没有PlayerController，或类型转换失败则返回空 </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">template</span>&lt; class T &gt;</span></span><br><span class="line"><span class="function">	T* <span class="title">GetFirstPlayerController</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Cast&lt;T&gt;(<span class="built_in">GetFirstPlayerController</span>());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 返回第一个 PlayerController，如果没有则返回空 */</span>	</span><br><span class="line">	<span class="function">APlayerController* <span class="title">GetFirstPlayerController</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通过第一个 PlayerController 获取第一个有效的本地玩家，并返回</span></span><br><span class="line"><span class="comment">	 * 动态转换为模板类型，如果没有 LocalPlayer 或者转换失败则返回空</span></span><br><span class="line"><span class="comment">	 */</span>	</span><br><span class="line">	<span class="function"><span class="keyword">template</span>&lt; class T &gt;</span></span><br><span class="line"><span class="function">	T* <span class="title">GetFirstLocalPlayerFromController</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Cast&lt;T&gt;(<span class="built_in">GetFirstLocalPlayerFromController</span>());</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 通过 PlayerController 获取第一个有效的 LocalPlayer */</span>	</span><br><span class="line">	<span class="function">ULocalPlayer* <span class="title">GetFirstLocalPlayerFromController</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 为 PlayerController 注册一个自动激活的 CameraActor */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RegisterAutoActivateCamera</span><span class="params">(ACameraActor* CameraActor, int32 PlayerIndex)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 获取一个 (为 PlayerController 自动激活的) CameraActors 列表的迭代器 */</span></span><br><span class="line">	<span class="function">FConstCameraActorIterator <span class="title">GetAutoActivateCameraIterator</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 返回一个(显示这个世界的)游戏视口的引用 */</span></span><br><span class="line">	<span class="function">UGameViewportClient* <span class="title">GetGameViewport</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回持久关卡的默认贴图</span></span><br><span class="line"><span class="comment">	 * 这通常是用于编辑器构造的 &#x27;builer brush&#x27;，在非编辑器实例中未定义，也可能是 NULL</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">ABrush* <span class="title">GetDefaultBrush</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** actors 是否已被初始化，是否准备好开始游戏 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">AreActorsInitialized</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// actors 初始化参数结构</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">FActorsInitializedParams</span></span></span><br><span class="line"><span class="class">	&#123;</span></span><br><span class="line">		<span class="built_in">FActorsInitializedParams</span>(UWorld* InWorld, <span class="keyword">bool</span> InResetTime) : <span class="built_in">World</span>(InWorld), <span class="built_in">ResetTime</span>(InResetTime) &#123;&#125;</span><br><span class="line">		UWorld* World;</span><br><span class="line">		<span class="keyword">bool</span> ResetTime;</span><br><span class="line">	&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">DECLARE_MULTICAST_DELEGATE_OneParam</span>(FOnWorldInitializedActors, <span class="keyword">const</span> FActorsInitializedParams&amp;);</span><br><span class="line">	FOnWorldInitializedActors OnActorsInitialized;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">DECLARE_MULTICAST_DELEGATE</span>(FOnWorldBeginPlay);</span><br><span class="line">	FOnWorldBeginPlay OnWorldBeginPlay;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** gameplay 是否已经开始 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">HasBegunPlay</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ....... 省略一系列获取时间的函数 (2276行)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 为此世界创建一个新的物理场景 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">CreatePhysicsScene</span><span class="params">(<span class="keyword">const</span> AWorldSettings* Settings = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回此世界的物理场景的指针 */</span></span><br><span class="line">	<span class="function">FPhysScene* <span class="title">GetPhysicsScene</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> PhysicsScene; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 设置此世界使用的物理场景 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetPhysicsScene</span><span class="params">(FPhysScene* InScene)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 返回默认物理体积，如果需要则创建一个 */</span></span><br><span class="line">	<span class="function">APhysicsVolume* <span class="title">GetDefaultPhysicsVolume</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> DefaultPhysicsVolume ? DefaultPhysicsVolume : <span class="built_in">InternalGetDefaultPhysicsVolume</span>(); &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 默认物理体积是否被创建 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">HasDefaultPhysicsVolume</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> DefaultPhysicsVolume != <span class="literal">nullptr</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 添加一个物理体积到此世界的物理体积列表中，默认物理体积不会加进去 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddPhysicsVolume</span><span class="params">(APhysicsVolume* Volume)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 从此世界的物理体积列表中移除一个物理体积 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RemovePhysicsVolume</span><span class="params">(APhysicsVolume* Volume)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 获取一个此世界的所有物理体积的迭代器，不包含默认物理体积 */</span></span><br><span class="line">	<span class="function">FConstPhysicsVolumeIterator <span class="title">GetNonDefaultPhysicsVolumeIterator</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 获取此世界的所有物理体积的个数(不包括默认物理体积) */</span></span><br><span class="line">	<span class="function">int32 <span class="title">GetNonDefaultPhysicsVolumeCount</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 获取当前关卡的关卡脚本actor</span></span><br><span class="line"><span class="comment">     * 参数 OwnerLevel 获取关卡脚本actor的关卡。必须对应于 GWorld 的 Level 数组中的一个关卡</span></span><br><span class="line"><span class="comment">	 * 因此，仅在编辑多关卡地图时适用。默认为当前正在编辑的关卡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">class ALevelScriptActor* <span class="title">GetLevelScriptActor</span><span class="params">( class ULevel* OwnerLevel=<span class="literal">NULL</span> )</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 返回 此世界的 AWorldSettings(世界设置) */</span></span><br><span class="line">    <span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=<span class="string">&quot;Utilities|World&quot;</span>, meta=(DisplayName=<span class="string">&quot;GetWorldSettings&quot;</span>, ScriptName=<span class="string">&quot;GetWorldSettings&quot;</span>))</span><br><span class="line">	<span class="function">AWorldSettings* <span class="title">K2_GetWorldSettings</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">AWorldSettings* <span class="title">GetWorldSettings</span><span class="params">( <span class="keyword">bool</span> bCheckStreamingPersistent = <span class="literal">false</span>, <span class="keyword">bool</span> bChecked = <span class="literal">true</span> )</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 获取当前关卡的 BSP模型 (整体同步并行计算模型) */</span></span><br><span class="line">    <span class="function">UModel* <span class="title">GetModel</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 返回当前世界的重力 */</span></span><br><span class="line">    <span class="function"><span class="keyword">float</span> <span class="title">GetGravityZ</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 返回默认世界的重力 */</span></span><br><span class="line">	<span class="function"><span class="keyword">float</span> <span class="title">GetDefaultGravityZ</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 返回当前地图的名称，考虑使用虚拟持久化世界，通过 PrepareMapChange 加载关卡到世界中 */</span></span><br><span class="line">    <span class="function"><span class="keyword">const</span> FString <span class="title">GetMapName</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 是否应使用HitProxies创建此世界的渲染场景 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">RequiresHitProxies</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> bRequiresHitProxies; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 添加 Controller 到 Controller 数组中，如果是 PlayerController 还会添加到 PlayerController 数组中 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">AddController</span><span class="params">( AController* Controller )</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 从 Controller 数组中移除一个 Controller (包括PlayerController) */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RemoveController</span><span class="params">( AController* Controller )</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 4.23版本已弃用，因为没有理由再往 UWorld 中添加 Pawn */</span></span><br><span class="line">    <span class="built_in">UE_DEPRECATED</span>(<span class="number">4.23</span>, <span class="string">&quot;There is no longer a reason to AddPawn to UWorld&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddPawn</span><span class="params">( APawn* Pawn )</span> </span>&#123; &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 4.23版本已弃用，因为 UWorld 不再维护 PawnList，取消绑定应调用 EndPlay 函数 */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.23</span>, <span class="string">&quot;RemovePawn has been deprecated and should no longer need to be called as PawnList is no longer maintained and Unpossess should be handled by EndPlay.&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RemovePawn</span><span class="params">( APawn* Pawn )</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 将传入的 actor 添加到特定的 network actor 列表中</span></span><br><span class="line"><span class="comment">	 * 此列表用于专门挑选与网络相关的 actor，而无需扫描大得多的列表</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddNetworkActor</span><span class="params">( AActor* Actor )</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 从特定的 network actor 列表中移除传入的 actor</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RemoveNetworkActor</span><span class="params">( AActor* Actor )</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 添加一个 OnActorSpawned 事件的监听者 */</span></span><br><span class="line">	<span class="function">FDelegateHandle <span class="title">AddOnActorSpawnedHandler</span><span class="params">( <span class="keyword">const</span> FOnActorSpawned::FDelegate&amp; InHandler )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 添加一个 OnActorSpawned 事件的监听者 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RemoveOnActorSpawnedHandler</span><span class="params">( FDelegateHandle InHandle )</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 添加一个 OnActorPreSpawnInitialization 事件的监听者 */</span></span><br><span class="line">	<span class="function">FDelegateHandle <span class="title">AddOnActorPreSpawnInitialization</span><span class="params">(<span class="keyword">const</span> FOnActorSpawned::FDelegate&amp; InHandler)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 移除一个 OnActorPreSpawnInitialization 事件的监听者 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RemoveOnActorPreSpawnInitialization</span><span class="params">(FDelegateHandle InHandle)</span></span>;	</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 传入的 actor 是否在任何已加载的关卡的 actor 数组中 */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">ContainsActor</span><span class="params">( AActor* Actor )</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 此场景是否支持音频回滚 */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">AllowAudioPlayback</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 为屏幕序列添加一个tick处理器，这些处理器会在 pre-physics 之前 tick */</span> </span><br><span class="line">	<span class="function">FDelegateHandle <span class="title">AddMovieSceneSequenceTickHandler</span><span class="params">(<span class="keyword">const</span> FOnMovieSceneSequenceTick::FDelegate&amp; InHandler)</span></span>;</span><br><span class="line">    <span class="comment">/** 移除一个屏幕序列的tick处理器 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RemoveMovieSceneSequenceTickHandler</span><span class="params">(FDelegateHandle InHandle)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// UObject 接口</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Serialize</span><span class="params">( FArchive&amp; Ar )</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">BeginDestroy</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">FinishDestroy</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PostLoad</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PreDuplicate</span><span class="params">(FObjectDuplicationParameters&amp; DupParams)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">PreSaveRoot</span><span class="params">(<span class="keyword">const</span> TCHAR* Filename)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PostSaveRoot</span><span class="params">( <span class="keyword">bool</span> bCleanupIsRequired )</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> UWorld* <span class="title">GetWorld</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> FPrimaryAssetId <span class="title">GetPrimaryAssetId</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddReferencedObjects</span><span class="params">(UObject* InThis, FReferenceCollector&amp; Collector)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PostDuplicate</span><span class="params">(<span class="keyword">bool</span> bDuplicateForPIE)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 清除所有的关卡组件和世界组件(如: 线条批处理程序) */</span></span><br><span class="line">    <span class="keyword">void</span> ClearWorldComponents;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 更新世界组件和所有关卡组件 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">UpdateWorldComponents</span><span class="params">(<span class="keyword">bool</span> bRerunConstructionScripts, <span class="keyword">bool</span> bCurrentLevelOnly, FRegisterComponentContext* Context = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 更新指定组件，指定 Actor 或所有 Actor 的消隐距离体积 </span></span><br><span class="line"><span class="comment">     * 参数 ActorToUpdate 需要测试距离的指定 Actor</span></span><br><span class="line"><span class="comment">     * 参数 ComponentToUpdate 需要测试距离的指定组件</span></span><br><span class="line"><span class="comment">     * 如果指定组件/ Actor 在距离体积内，则返回 true</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">UpdateCullDistanceVolumes</span><span class="params">(AActor* ActorToUpdate = <span class="literal">nullptr</span>, UPrimitiveComponent* ComponentToUpdate = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 清空组件，流数据和分类的其他中间数据 </span></span><br><span class="line"><span class="comment">     * 参数 bSessionEnded 是否通知视口该游戏会话已经结束</span></span><br><span class="line"><span class="comment">     * 参数 bNewWorld 可选的，这个世界被清空后加载的新世界</span></span><br><span class="line"><span class="comment">     * 指定一个新世界，以防止在地图转换期间对其及其子关卡进行GC</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CleanupWorld</span><span class="params">(<span class="keyword">bool</span> bSessionEnded = <span class="literal">true</span>, <span class="keyword">bool</span> bCleanupResources = <span class="literal">true</span>, UWorld* NewWorld = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 使 用于渲染关卡的UModel的缓存数据 无效化 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">InvalidateModelGeometry</span><span class="params">( ULevel* InLevel )</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 丢弃用于渲染关卡的UModel的缓存数据。假设面和顶点位置没有更改，仅应用了材质 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">InvalidateModelSurface</span><span class="params">(<span class="keyword">bool</span> bCurrentLevelOnly)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 提交对所有关卡的UModel所做的更改 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CommitModeSurfaces</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 清除所有天空捕获缓存的衍生数据，并强制重新渲染捕获场景数据 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">UpdateAllSkyCaptures</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 返回此世界当前使用的照明方案，如果没有则返回 NULL */</span></span><br><span class="line">	<span class="function">ULevel* <span class="title">GetActiveLightingScenario</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 将改变的照明方案应用到所有组件中 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">PropagateLightingScenarioChange</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 将传入的关卡与世界关联起来</span></span><br><span class="line"><span class="comment">     * 使关卡可见的工作分布在多个帧上，必须调用此函数，直到返回true</span></span><br><span class="line"><span class="comment">     * 关卡才能可见/与世界关联，并且不再处于不稳定状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">AddToWorld</span><span class="params">( ULevel* Level, <span class="keyword">const</span> FTransform&amp; LevelTransform = FTransform::Identity, <span class="keyword">bool</span> bConsiderTimeLimit = <span class="literal">true</span> )</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 将传入的关卡和世界断开关联，移除被阻塞*/</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">RemoveFromWorld</span><span class="params">( ULevel* Level, <span class="keyword">bool</span> bAllowIncrementalRemoval = <span class="literal">false</span> )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 使用流关卡的当前状态更新子关卡(读取/反读取/显示/隐藏) */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">UpdateLevelStreaming</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 手动释放物理场景 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ReleasePhysicsScene</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/** 以阻塞方式刷新关卡流，并在加载/可见/隐藏所有关卡时返回，因此除非状态发生更改，否则对UpdateLevelStreaming 的进一步调用不会起任何作用。基本上阻止了所有异步操作，比如更新组件 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">FlushLevelStreaming</span><span class="params">(EFlushLevelStreamingType FlushType = EFlushLevelStreamingType::Full)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 在几秒钟内 触发对 ULevel::BuildStreamingData(this, NULL, NULL) 的调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">TriggerStreamingDataRebuild</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 调用 ULevel::BuildSreamingData(this, NULL, NULL)，如果几秒前被 trigger 过 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ConditionallyBuildStreamingData</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 是否至少存在一个挂起等待显示的关卡 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsVisibilityRequestPending</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 是否所有 &#x27;always loaded&#x27; 关卡都已被加载 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">AreAlwaysLoadedLevelsLoaded</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 请求任何 &#x27;always loaded&#x27; 关卡的异步加载。用于无缝移动，以防止在第一个 &quot;UpdateLevelStreaming&quot; 中阻塞 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AsyncLoadAlwaysLoadedLevelsForSeamlessTravel</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 是否允许关卡流代码发出加载请求 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">AllowLevelLoadRequests</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 在内存中为每个参数收集器创建实例，在世界被创建时调用 */</span></span><br><span class="line">   	<span class="function"><span class="keyword">void</span> <span class="title">SetupParameterCollectionInstances</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 添加一个新的实例到给定的收集器中，或者重写一个已的实例(如果传入的收集器已存在) */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddParameterCollectionInstance</span><span class="params">(class UMaterialParameterCollection* Collection, <span class="keyword">bool</span> bUpdateScene)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 为给定收集器获取此世界实例 */</span></span><br><span class="line">	<span class="function">UMaterialParameterCollectionInstance* <span class="title">GetParameterCollectionInstance</span><span class="params">(<span class="keyword">const</span> UMaterialParameterCollection* Collection)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 用实例列表更新此世界屏幕，并选择性更新每个实例的统一缓存 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">UpdateParameterCollectionInstances</span><span class="params">(<span class="keyword">bool</span> bUpdateInstanceUniformBuffers, <span class="keyword">bool</span> bRecreateUniformBuffer)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 获取要渲染到渲染目标的画布对象。如果需要，我们将分配一个 */</span></span><br><span class="line">	<span class="function">UCanvas* <span class="title">GetCanvasForRenderingToTarget</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">UCanvas* <span class="title">GetCanvasForDrawMaterialToRenderTarget</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 包含一个世界初始化的可选参数的结构体 */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">InitializationValues</span></span></span><br><span class="line"><span class="class">	&#123;</span></span><br><span class="line">		<span class="built_in">InitializationValues</span>()</span><br><span class="line">			: <span class="built_in">bInitializeScenes</span>(<span class="literal">true</span>)</span><br><span class="line">			, <span class="built_in">bAllowAudioPlayback</span>(<span class="literal">true</span>)</span><br><span class="line">			, <span class="built_in">bRequiresHitProxies</span>(<span class="literal">true</span>)</span><br><span class="line">			, <span class="built_in">bCreatePhysicsScene</span>(<span class="literal">true</span>)</span><br><span class="line">			, <span class="built_in">bCreateNavigation</span>(<span class="literal">true</span>)</span><br><span class="line">			, <span class="built_in">bCreateAISystem</span>(<span class="literal">true</span>)</span><br><span class="line">			, <span class="built_in">bShouldSimulatePhysics</span>(<span class="literal">true</span>)</span><br><span class="line">			, <span class="built_in">bEnableTraceCollision</span>(<span class="literal">false</span>)</span><br><span class="line">			, <span class="built_in">bTransactional</span>(<span class="literal">true</span>)</span><br><span class="line">			, <span class="built_in">bCreateFXSystem</span>(<span class="literal">true</span>)</span><br><span class="line">		&#123;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 是否应该创建场景(物理，渲染) */</span></span><br><span class="line">		uint32 bInitializeScenes:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 此世界是否允许生成声音 */</span></span><br><span class="line">		uint32 bAllowAudioPlayback:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 渲染场景是否应该创建碰撞代理 */</span></span><br><span class="line">		uint32 bRequiresHitProxies:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 物理场景是否应该被创建。只有 bInitializeScenes 为 true 的时候会考虑此属性 */</span></span><br><span class="line">		uint32 bCreatePhysicsScene:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 此世界是否应该创建导航系统 */</span></span><br><span class="line">		uint32 bCreateNavigation:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 此世界是否应该创建 AI 系统 */</span></span><br><span class="line">		uint32 bCreateAISystem:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/** 此世界是否模拟物理 */</span></span><br><span class="line">		uint32 bShouldSimulatePhysics:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 碰撞检测调用是否在此世界中有效 */</span></span><br><span class="line">		uint32 bEnableTraceCollision:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 对这个世界中的对象执行的操作是否应保存到临时缓冲区中。 */</span></span><br><span class="line">		uint32 bTransactional:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 此世界是否应该生成 FX 系统 (粒子和特效) */</span></span><br><span class="line">		uint32 bCreateFXSystem:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		TSubclassOf&lt;<span class="class"><span class="keyword">class</span> <span class="title">AGameModeBase</span>&gt;</span> DefaultGameMode;</span><br><span class="line"></span><br><span class="line">		<span class="function">InitializationValues&amp; <span class="title">InitializeScenes</span><span class="params">(<span class="keyword">const</span> <span class="keyword">bool</span> bInitialize)</span> </span>&#123; bInitializeScenes = bInitialize; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">		<span class="function">InitializationValues&amp; <span class="title">AllowAudioPlayback</span><span class="params">(<span class="keyword">const</span> <span class="keyword">bool</span> bAllow)</span> </span>&#123; bAllowAudioPlayback = bAllow; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">		<span class="function">InitializationValues&amp; <span class="title">RequiresHitProxies</span><span class="params">(<span class="keyword">const</span> <span class="keyword">bool</span> bRequires)</span> </span>&#123; bRequiresHitProxies = bRequires; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">		<span class="function">InitializationValues&amp; <span class="title">CreatePhysicsScene</span><span class="params">(<span class="keyword">const</span> <span class="keyword">bool</span> bCreate)</span> </span>&#123; bCreatePhysicsScene = bCreate; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">		<span class="function">InitializationValues&amp; <span class="title">CreateNavigation</span><span class="params">(<span class="keyword">const</span> <span class="keyword">bool</span> bCreate)</span> </span>&#123; bCreateNavigation = bCreate; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">		<span class="function">InitializationValues&amp; <span class="title">CreateAISystem</span><span class="params">(<span class="keyword">const</span> <span class="keyword">bool</span> bCreate)</span> </span>&#123; bCreateAISystem = bCreate; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">		<span class="function">InitializationValues&amp; <span class="title">ShouldSimulatePhysics</span><span class="params">(<span class="keyword">const</span> <span class="keyword">bool</span> bInShouldSimulatePhysics)</span> </span>&#123; bShouldSimulatePhysics = bInShouldSimulatePhysics; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">		<span class="function">InitializationValues&amp; <span class="title">EnableTraceCollision</span><span class="params">(<span class="keyword">const</span> <span class="keyword">bool</span> bInEnableTraceCollision)</span> </span>&#123; bEnableTraceCollision = bInEnableTraceCollision; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">		<span class="function">InitializationValues&amp; <span class="title">SetTransactional</span><span class="params">(<span class="keyword">const</span> <span class="keyword">bool</span> bInTransactional)</span> </span>&#123; bTransactional = bInTransactional; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">		<span class="function">InitializationValues&amp; <span class="title">CreateFXSystem</span><span class="params">(<span class="keyword">const</span> <span class="keyword">bool</span> bCreate)</span> </span>&#123; bCreateFXSystem = bCreate; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">		<span class="function">InitializationValues&amp; <span class="title">SetDefaultGameMode</span><span class="params">(TSubclassOf&lt;class AGameModeBase&gt; GameMode)</span> </span>&#123; DefaultGameMode = GameMode; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">	&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 初始化世界，关联持久关卡并设置适当的区域 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">InitWorld</span><span class="params">(<span class="keyword">const</span> InitializationValues IVS = InitializationValues())</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 初始化一个新创建的世界 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">InitializeNewWorld</span><span class="params">(<span class="keyword">const</span> InitializationValues IVS = InitializationValues())</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 创建新世界并返回其指针的静态函数 */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> UWorld* <span class="title">CreateWorld</span><span class="params">( <span class="keyword">const</span> EWorldType::Type InWorldType, <span class="keyword">bool</span> bInformEngineOfWorld, FName WorldName = NAME_None, UPackage* InWorldPackage = <span class="literal">NULL</span>, <span class="keyword">bool</span> bAddToRoot = <span class="literal">true</span>, ERHIFeatureLevel::Type InFeatureLevel = ERHIFeatureLevel::Num )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 销毁该世界实例。如果销毁世界是为了加载不同的世界，请在此处提供，以避免新世界或其子关卡被GC */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">DestroyWorld</span><span class="params">( <span class="keyword">bool</span> bInformEngineOfWorld, UWorld* NewWorld = <span class="literal">nullptr</span> )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 标记此世界和其中的所有对象为 挂起销毁 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">MarkObjectsPendingKill</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ........ 省略一些已弃用的GC函数</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 从 actor 列表中移除空项。只有在动态 actor 中应用该函数。理论上静态 actor 不应在游戏时被销毁 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CleanupActors</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 网络 tick 事件 */</span></span><br><span class="line">	<span class="function">FOnNetTickEvent&amp; <span class="title">OnTickDispatch</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> TickDispatchEvent; &#125;</span><br><span class="line">	<span class="function">FOnTickFlushEvent&amp; <span class="title">OnPostTickDispatch</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> PostTickDispatchEvent; &#125;	</span><br><span class="line">	<span class="function">FOnNetTickEvent&amp; <span class="title">OnTickFlush</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> TickFlushEvent; &#125;</span><br><span class="line">	<span class="function">FOnTickFlushEvent&amp; <span class="title">OnPostTickFlush</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> PostTickFlushEvent; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 每经过一段时间(DeltaSeconds)，更新关卡</span></span><br><span class="line"><span class="comment">	 * 所有子 actors 都会在他们的拥有者 tick 完之后 tick</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Tick</span><span class="params">( ELevelTick TickType, <span class="keyword">float</span> DeltaSeconds )</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 设置物理tick函数 (如果尚未设置) */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetupPhysicsTickFunctions</span><span class="params">(<span class="keyword">float</span> DeltaSeconds)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 运行一个 tick 组，tick 所有的 actors 和 组件 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">RunTickGroup</span><span class="params">(ETickingGroup Group, <span class="keyword">bool</span> bBlockTillComplete)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 将组件标记为需要在帧末尾更新 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">MarkActorComponentForNeededEndOfFrameUpdate</span><span class="params">(UActorComponent* Component, <span class="keyword">bool</span> bForceGameThread)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 清除组件的帧末尾更新需求 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ClearActorComponentEndOfFrameUpdate</span><span class="params">(UActorComponent* Component)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 用于指示 &quot;UMaterialParameterCollectionInstance&quot; 需要延迟更新 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetMaterialParameterCollectionInstanceNeedsUpdate</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 是否有任何帧末尾的延迟更新 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">HasEndOfFrameUpdates</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 将所有渲染发送到渲染线程 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SendAllEndOfFrameUpdates</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 将 所有挂起参数收集器更新 刷新到渲染线程 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">FlushDeferredParameterCollectionInstanceUpdates</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 执行与网络驱动相关的每帧 tick 行为 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">TickNetClient</span><span class="params">( <span class="keyword">float</span> DeltaSeconds )</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 基于本地玩家是否存在关卡流体积中，发出 加载/卸载 关卡流的请求 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ProcessLevelStreamingVolumes</span><span class="params">(FVector* OverrideViewLocation=<span class="literal">NULL</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 处理指定关卡的事务 -- 修改关卡的正确方法，而不是调用 Level-&gt;Modify */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ModifyLevel</span><span class="params">(ULevel* Level)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 确保完全构建碰撞检测树。这应该在关卡完全重新加载后调用，以确保第一个轨迹不会非常慢 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">EnsureCollisionTreeIsBuilt</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 返回关卡列表的迭代器 */</span></span><br><span class="line">	<span class="function">FConstLevelIterator	<span class="title">GetLevelIterator</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回给定索引的关卡 */</span></span><br><span class="line">	<span class="function">ULevel* <span class="title">GetLevel</span><span class="params">( int32 InLevelIndex )</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ....... 省略关卡列表的获取，增删，查找函数 (2890行)</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment">/** 返回给定 InType 的 FLevelCollection。如果不存在则创建一个 */</span></span><br><span class="line">	<span class="function">FLevelCollection&amp; <span class="title">FindOrAddCollectionByType</span><span class="params">(<span class="keyword">const</span> ELevelCollectionType InType)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ........ 省略 FLevelCollection 的其他查找函数，ActiveLevelCollection 的读写函数 (2913行)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在 &quot;DynamicSourceLevels&quot; 中通过复制关卡来创建一个新的关卡收集器，类型为 DynamicDuplicatedLevels，只应在引擎中调用</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">	 * @参数 MapName 源地图的名字，用作 UEngine::Experimental_ShouldPreDuplicateMap 的一个参数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">DuplicateRequestedLevels</span><span class="params">(<span class="keyword">const</span> FName MapName)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 将世界标记为将被拆毁 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">BeginTearingDown</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ....... 省略一些私有的处理命令的函数(如: HandleDemoRecordCommand)(2964行)</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 销毁当前演示网络驱动</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">DestroyDemoNetDriver</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 开始重播时，移除指向挂起的演示网络驱动的内部引用，但不销毁它</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ClearDemoNetDriver</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 移除所有指向该网络驱动的内部引用，但不销毁它。引擎在销毁驱动时调用</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ClearNetDriver</span><span class="params">(UNetDriver* Driver)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 我们当前是否正在重播 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsPlayingReplay</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 我们当前是否正在录制重播 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsRecordingReplay</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 开始监听连接</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">Listen</span><span class="params">( FURL&amp; InURL )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此关卡是否是客户端 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsClient</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此关卡是否是服务端 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsServer</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 此世界是否处于暂停状态 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsPaused</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 摄像机是否处于可移动状态 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsCameraMoveable</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** DestroyActor() 的包装函数，用于编辑器模式 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">EditorDestroyActor</span><span class="params">( AActor* Actor, <span class="keyword">bool</span> bShouldModifyLevel )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 从关卡 actor 列表中移除 actor，并通常清除引擎内部状态</span></span><br><span class="line"><span class="comment">	 * 此函数不会从其他 actors 中移除该 actor 的引用，并杀死 actor 的资源，但这些会由GC来代替处理</span></span><br><span class="line"><span class="comment">	 * 设置此函数时，即使在递归堆栈中销毁了 actor，也不会出现任何问题</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">DestroyActor</span><span class="params">( AActor* Actor, <span class="keyword">bool</span> bNetForce=<span class="literal">false</span>, <span class="keyword">bool</span> bShouldModifyLevel=<span class="literal">true</span> )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 从 actor 列表中移除传进来的 actor</span></span><br><span class="line"><span class="comment">	 * 请注意，代码实际上并没有实际删除索引，而是将其清除，以便其他索引仍然有效，</span></span><br><span class="line"><span class="comment">	 * actors 数组大小不会更改</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RemoveActor</span><span class="params">( AActor* Actor, <span class="keyword">bool</span> bShouldModifyLevel )</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 生成 actor，通过给定的变换和生成参数</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * @param	Class					生成的类</span></span><br><span class="line"><span class="comment">	 * @param	Location				生成的位置</span></span><br><span class="line"><span class="comment">	 * @param	Rotation				生成的旋转值</span></span><br><span class="line"><span class="comment">	 * @param	SpawnParameters			生成参数</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @return	生成的 actor</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">AActor* <span class="title">SpawnActor</span><span class="params">( UClass* InClass, FVector <span class="keyword">const</span>* Location=<span class="literal">NULL</span>, FRotator <span class="keyword">const</span>* Rotation=<span class="literal">NULL</span>, <span class="keyword">const</span> FActorSpawnParameters&amp; SpawnParameters = FActorSpawnParameters() )</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 与 SpawnActor 一样，但 AbsoluteTransform 是绝对的世界变换 */</span></span><br><span class="line">    <span class="function">AActor* <span class="title">SpawnActorAbsolute</span><span class="params">( UClass* Class, FTransform <span class="keyword">const</span>&amp; AbsoluteTransform, <span class="keyword">const</span> FActorSpawnParameters&amp; SpawnParameters = FActorSpawnParameters())</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ........ 省略其他生成 actor 的模板函数 (3085行)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 返回当前的游戏模式实例并动态转换为对应模板类型</span></span><br><span class="line"><span class="comment">     * 只有在服务端且转换正确时返回对应值，其情况皆为 null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt; class T &gt;</span></span><br><span class="line"><span class="function">	T* <span class="title">GetAuthGameMode</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Cast&lt;T&gt;(AuthorityGameMode);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 返回当前的游戏状态实例并动态转换为对应模板类型 */</span></span><br><span class="line">	<span class="function"><span class="keyword">template</span>&lt; class T &gt;</span></span><br><span class="line"><span class="function">	T* <span class="title">GetGameState</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Cast&lt;T&gt;(GameState);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ....... 省略获取，设置，拷贝游戏状态的函数 (3191行)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 在世界中生成一个 Brush Actor */</span></span><br><span class="line">	<span class="function">ABrush*	<span class="title">SpawnBrush</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 生成一个 PlayerController，并以特定的 RemoteRole 和 options 将其绑定给传进来的Player */</span></span><br><span class="line">	<span class="function">APlayerController* <span class="title">SpawnPlayActor</span><span class="params">(class UPlayer* Player, ENetRole RemoteRole, <span class="keyword">const</span> FURL&amp; InURL, <span class="keyword">const</span> TSharedPtr&lt;<span class="keyword">const</span> FUniqueNetId&gt;&amp; UniqueId, FString&amp; Error, uint8 InNetPlayerIndex = <span class="number">0</span>)</span></span>;</span><br><span class="line">	<span class="function">APlayerController* <span class="title">SpawnPlayActor</span><span class="params">(class UPlayer* Player, ENetRole RemoteRole, <span class="keyword">const</span> FURL&amp; InURL, <span class="keyword">const</span> FUniqueNetIdRepl&amp; UniqueId, FString&amp; Error, uint8 InNetPlayerIndex = <span class="number">0</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 尝试找到一个可接受的非冲突位置，将 TestActor 放置在尽可能靠近 PlaceLocation 的位置。要求PlaceLocation是关卡内的有效位置 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">FindTeleportSpot</span><span class="params">( <span class="keyword">const</span> AActor* TestActor, FVector&amp; PlaceLocation, FRotator PlaceRotation )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果 Actor 被阻挡则返回真，并尝试返回一个不被阻挡的合适方案到 ProposedAdjectment中 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">EncroachingBlockingGeometry</span><span class="params">( <span class="keyword">const</span> AActor* TestActor, FVector TestLocation, FRotator TestRotation, FVector* ProposedAdjustment = <span class="literal">NULL</span> )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 开始物理模拟 */</span> </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">StartPhysicsSim</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 等待物理场景完成处理 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">FinishPhysicsSim</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 为关卡生成一个 GameMode */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">SetGameMode</span><span class="params">(<span class="keyword">const</span> FURL&amp; InURL)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 初始化所有 actors 并 准备调用他们的 BeginPlay 函数</span></span><br><span class="line"><span class="comment">	 * @param InURL 命令行URL</span></span><br><span class="line"><span class="comment">	 * @param bResetTime (optional) WorldSettings中的 TimeSeconds 是否应重置为0</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">InitializeActorsForPlay</span><span class="params">(<span class="keyword">const</span> FURL&amp; InURL, <span class="keyword">bool</span> bResetTime = <span class="literal">true</span>, FRegisterComponentContext* Context = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 开始游戏。这会让 GameMode 转换到正确的模式，并调用所有的 Actors 中的 BeginPlay 函数 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">BeginPlay</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 寻找给定 NetConnection 的 PlayerController，如果找到，则将其销毁</span></span><br><span class="line"><span class="comment">	 * (因为已完成 swap，或者连接已经断开)</span></span><br><span class="line"><span class="comment">	 * @param Connection - 执行 swap 的 connection</span></span><br><span class="line"><span class="comment">	 * @return 等待 swap 的 connection 是否被找到</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">DestroySwappedPC</span><span class="params">(UNetConnection* Connection)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// FNetworkNotify 的接口</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> EAcceptConnection::Type <span class="title">NotifyAcceptingConnection</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">NotifyAcceptedConnection</span><span class="params">( class UNetConnection* Connection )</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">NotifyAcceptingChannel</span><span class="params">( class UChannel* Channel )</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">NotifyControlMessage</span><span class="params">(UNetConnection* Connection, uint8 MessageType, class FInBunch&amp; Bunch)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/** 欢迎一个新玩家加入服务器 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">WelcomePlayer</span><span class="params">(UNetConnection* Connection)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 获取一个网络驱动对象 */</span></span><br><span class="line">	<span class="function">FORCEINLINE_DEBUGGABLE UNetDriver* <span class="title">GetNetDriver</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> NetDriver; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回此世界在什么网络模式(NM_Standalone, NM_DedicatedServer...)下跑的 */</span></span><br><span class="line">	<span class="function">ENetMode <span class="title">GetNetMode</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">    * 测试该网络模式是否是给定的模式</span></span><br><span class="line"><span class="comment">	* 在优化的非编辑器构建中，这可能比 GetNetMode() 更高效</span></span><br><span class="line"><span class="comment">	* 因为它可以检查静态构建标志，而不考虑PIE</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsNetMode</span><span class="params">(ENetMode Mode)</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 非内联的私有版本，不进行检查独立服务器建立标记(这应该已被完成) */</span></span><br><span class="line">	<span class="function">ENetMode <span class="title">InternalGetNetMode</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 尝试从 URL 中获取网络模式 */</span></span><br><span class="line">	<span class="function">ENetMode <span class="title">AttemptDeriveFromURL</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">APhysicsVolume* <span class="title">InternalGetDefaultPhysicsVolume</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 设置用于此世界的网络驱动(net driver) */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetNetDriver</span><span class="params">(UNetDriver* NewDriver)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		NetDriver = NewDriver;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 游戏网络驱动存在，且当前游戏是客户端，且演示网络驱动存在(是服务器) */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsRecordingClientReplay</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 演示网络驱动存在，且进行客户端的回放录制 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsPlayingClientReplay</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 设置延迟流体积更新的帧数，如果你预加载一堆关卡但摄像机没有跟上时，好用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">DelayStreamingVolumeUpdates</span><span class="params">(int32 InFrameDelay)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		StreamingVolumeUpdateDelay = InFrameDelay;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 将正在调试的 Kismet/Blueprint 对象集传输到尚未存在的新世界，并相应地更新蓝图 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">TransferBlueprintDebugReferences</span><span class="params">(UWorld* NewWorld)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 通知世界蓝图调试引用 */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">NotifyOfBlueprintDebuggingAssociation</span><span class="params">(class UBlueprint* Blueprint, UObject* DebugObject)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 广播关卡数量已改变 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">BroadcastLevelsChanged</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 返回关卡改变事件成员 */</span></span><br><span class="line">	<span class="function">FOnLevelsChangedEvent&amp; <span class="title">OnLevelsChanged</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> LevelsChangedEvent; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回开始拆除世界事件成员，4.26版本已被替换为 OnWorldBeginTearDown */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.26</span>, <span class="string">&quot;OnBeginTearingDown has been replaced by FWorldDelegates::OnWorldBeginTearDown&quot;</span>)</span><br><span class="line">	<span class="function">FOnBeginTearingDownEvent&amp; <span class="title">OnBeginTearingDown</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> BeginTearingDownEvent; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 放回 actor 的数量 */</span></span><br><span class="line">	<span class="function">int32 <span class="title">GetProgressDenominator</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 返回 actor 的数量 */</span></span><br><span class="line">	<span class="function">int32 <span class="title">GetActorCount</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   	 * 使用一个给定的视图位置寻找音频设置，考虑世界的默认设置和世界的音频音量</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param	ViewLocation			当前的视图位置</span></span><br><span class="line"><span class="comment">	 * @param	OutReverbSettings		[返回] 摄像机的混响设置。</span></span><br><span class="line"><span class="comment">	 * @param	OutInteriorSettings		[返回] 摄像机的内部设置</span></span><br><span class="line"><span class="comment">	 * @return	如果设置来自于音频体积，则返回该音频体积</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">class AAudioVolume* <span class="title">GetAudioSettings</span><span class="params">( <span class="keyword">const</span> FVector&amp; ViewLocation, struct FReverbSettings* OutReverbSettings, struct FInteriorSettings* OutInteriorSettings )</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ....... 省略其他音频的读写函数 (3386行)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 返回此终端的此关卡的 URL */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> FString <span class="title">GetLocalURL</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 脚本是否在编辑器模式下运行 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsPlayInEditor</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 脚本是否在预览窗口中运行 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsPlayInPreview</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 脚本是否在移动端的预览窗口中运行 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsPlayInMobilePreview</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsPlayInVulkanPreview</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此世界是否为游戏世界(包括PIE世界) */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsGameWorld</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此世界是否为编辑器世界(包括编辑器预览世界) */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsEditorWorld</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 此世界是否为预览游戏世界(编辑器或游戏) */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsPreviewWorld</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果出于渲染目的，此世界是否应显示游戏隐藏标志而不是编辑器隐藏标志 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">UsesGameHiddenFlags</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 返回此关卡的URL，可能存在远端机器上</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> FString <span class="title">GetAddressURL</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 在 GWorld 被设置后调用。</span></span><br><span class="line"><span class="comment">	 * 用于在编辑器中加载但不关联世界上的所有关卡，至少在游戏中创建链接器。</span></span><br><span class="line"><span class="comment">	 * 应仅对应于 GWorld:：PersistentLevel 的 WorldSettings 调用。</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param bForce	如果为true，则即使是commandlet也要加载关卡</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">LoadSecondaryLevels</span><span class="params">(<span class="keyword">bool</span> bForce = <span class="literal">false</span>, TSet&lt;FName&gt;* FilenamesToSkip = <span class="literal">NULL</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 用于返回由包名指定的特定子关卡的 ULevelStreaming 对象的实用程序 */</span></span><br><span class="line">	<span class="function">ULevelStreaming* <span class="title">GetLevelStreamingForPackageName</span><span class="params">(FName PackageName)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 将服务器跳转到新关卡。如果bAbsolute为真，并且我们使用无缝连接，我们将进行绝对移动 (URL将刷新)</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param URL 我们将连接到的URL</span></span><br><span class="line"><span class="comment">	 * @param bAbsolute 使用相对还是绝对的移动</span></span><br><span class="line"><span class="comment">	 * @param bShouldSkipGameNotify 是否应该通知客户端 / 游戏</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">ServerTravel</span><span class="params">(<span class="keyword">const</span> FString&amp; InURL, <span class="keyword">bool</span> bAbsolute = <span class="literal">false</span>, <span class="keyword">bool</span> bShouldSkipGameNotify = <span class="literal">false</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通过首先在后台加载入口关卡，切换到该关卡，然后加载指定关卡，无缝地移动到给定的URL。不会中断网络通信或断开客户端连接。</span></span><br><span class="line"><span class="comment">	 * 您可能需要实现</span></span><br><span class="line"><span class="comment">	 * GameModeBase::GetSeamlestRavelActorList()、</span></span><br><span class="line"><span class="comment">	 * PlayerController::GetSeamlestRavelActorList()、</span></span><br><span class="line"><span class="comment">	 * GameModeBase::PostSeamlestRavel()、</span></span><br><span class="line"><span class="comment">	 * GameModeBase::HandleSeamlestRavelPlayer() </span></span><br><span class="line"><span class="comment">	 * 来处理保留任何应维护的信息 (玩家团队等)</span></span><br><span class="line"><span class="comment">	 * 此代码路径专为使用很少或没有关卡流和游戏模式的世界而设计，其中游戏状态在转换时重置/重新加载。(如UT)</span></span><br><span class="line"><span class="comment">	 * @参数 URL - 移动到的URL，必须和当前的URL在同一个服务器中</span></span><br><span class="line"><span class="comment">	 * @参数 bAbsolute (可选) - URL是绝对的，还是相对的</span></span><br><span class="line"><span class="comment">	 * @参数 MapPackageGuid (可选) - 要传送到的地图包的GUID，该GUID用于在自动下载文件时查找该文件，因此仅客户端需要它</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SeamlessTravel</span><span class="params">(<span class="keyword">const</span> FString&amp; InURL, <span class="keyword">bool</span> bAbsolute = <span class="literal">false</span>, FGuid MapPackageGuid = FGuid())</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 返回我们当前是否处于无缝转换 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsInSeamlessTravel</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 此函数允许在无缝移动期间，在开始加载目的地之前（即在过渡关卡中）暂停无缝移动</span></span><br><span class="line"><span class="comment">	 * 这为 完成过渡前进行其他读取任务 提供了机会</span></span><br><span class="line"><span class="comment">	 * 此函数将失效，如果我们有已经开始读取的目的地(返回警告日志)</span></span><br><span class="line"><span class="comment">	 * @param bNowPaused - 过渡是否应该现在暂停</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetSeamlessTravelMidpointPause</span><span class="params">(<span class="keyword">bool</span> bNowPaused)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 返回当前细节模式，如: EDetailMode，但可以在此范围之外 */</span></span><br><span class="line">    <span class="function">int32 <span class="title">GetDetailMode</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 更新GC计时器，以便下次有机会时运行GC。4.18版本后移至 &quot;UEngine&quot; 中 */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.18</span>, <span class="string">&quot;Call GEngine-&gt;ForceGarbageCollection instead&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ForceGarbageCollection</span><span class="params">( <span class="keyword">bool</span> bFullPurge = <span class="literal">false</span> )</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 异步读取给定关卡，为流地图转换做准备</span></span><br><span class="line"><span class="comment">	 * 此代码路径专为大量使用关卡流和游戏模式的世界而设计，在这些世界中，游戏状态应该通过转换来保持</span></span><br><span class="line"><span class="comment">	 * @param LevelNames 读取的关卡包的名称。LevelName[0] 为主关卡(持久关卡)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">PrepareMapChange</span><span class="params">(<span class="keyword">const</span> TArray&lt;FName&gt;&amp; LevelNames)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 程序当前是否正在进行地图更改 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsPreparingMapChange</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 有地图更改已准备就绪，且该更改是否已经准备好提交，则返回 true */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsMapChangeReady</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 取消挂起地图更改(注意: 我们无法取消挂起的异步读取，因此这不会立刻释放内存) */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">CancelPendingMapChange</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 真正执行 PrepareMapChange()准备好的地图转换 的函数</span></span><br><span class="line"><span class="comment">     * 将在下一帧执行，已避免GC问题。</span></span><br><span class="line"><span class="comment">     * 如果地图更改正在准备中但尚未准备就绪，则转换代码将一直阻塞，直到 IsMapChangeReady() 返回true</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">CommitMapChange</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置 NumLightingUnbuiltObjects 为一个特定的值。如果值改变了，将 worldsetting 包标为脏包</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetMapNeedsLightingFullyRebuilt</span><span class="params">(int32 InNumLightingUnbuiltObjects, int32 InNumUnbuiltReflectionCaptures)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 返回此世界的计时器管理器实例 */</span></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> FTimerManager&amp; <span class="title">GetTimerManager</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (OwningGameInstance ? OwningGameInstance-&gt;<span class="built_in">GetTimerManager</span>() : *TimerManager);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回 LatentActionManager(管理世界的挂起行为的类) 实例，如果游戏实例与此实例关联，则首选游戏实例分配的实例</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * 这种模式让UWorld客户端（例如，Blueprint Editor中的preview world）不必担心替换GameInstance中的功能。</span></span><br><span class="line"><span class="comment">	 * 或者，我们可以强制他们为场景实现一个游戏实例</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> FLatentActionManager&amp; <span class="title">GetLatentActionManager</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (OwningGameInstance ? OwningGameInstance-&gt;<span class="built_in">GetLatentActionManager</span>() : LatentActionManager);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 获取特定类型的子系统 */</span></span><br><span class="line">	<span class="function">UWorldSubsystem* <span class="title">GetSubsystemBase</span><span class="params">(TSubclassOf&lt;UWorldSubsystem&gt; SubsystemClass)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> SubsystemCollection.GetSubsystem&lt;UWorldSubsystem&gt;(SubsystemClass);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ......... 省略其他 SubSystem 的获取代码(3568行)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// ......... 省略 GameInstance 的读写代码(3602行)</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment">/** 检索是否已重建此世界的所有导航的信息 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsNavigationRebuilt</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 请求在下一次 tick 时将世界原点转换到指定位置 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RequestNewWorldOrigin</span><span class="params">(FIntVector InNewOriginLocation)</span></span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/** 将世界远点转换到指定位置 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">SetNewWorldOrigin</span><span class="params">(FIntVector InNewOriginLocation)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在特定位置设置世界原点，并流设置所有相关的关卡 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">NavigateTo</span><span class="params">(FIntVector InLocation)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 获取当前关卡的所有 matinee actor */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">GetMatineeActors</span><span class="params">( TArray&lt;AMatineeActor*&gt;&amp; OutMatineeActors )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 更新所有物理约束 actor 关节位置 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">UpdateConstraintActors</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 获取与此世界相关的所有灯光贴图和阴影贴图。指定关卡，主关卡可以传入null */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">GetLightMapsAndShadowMaps</span><span class="params">(ULevel* Level, TArray&lt;UTexture2D*&gt;&amp; OutLightMapsAndShadowMaps)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">/** 为此世界重命名，使其具有给定PIE实例ID的名称前缀 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RenameToPIEWorld</span><span class="params">(int32 PIEInstanceID)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 给定一个关卡脚本actor，修改字符串，使其指向对象的正确实例。用于回放。 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">RemapCompiledScriptActor</span><span class="params">(FString&amp; Str)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 给定一个包名和一个PIE实例ID，返回当作为PIE世界运行时此包的名称 */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> FString <span class="title">ConvertToPIEPackageName</span><span class="params">(<span class="keyword">const</span> FString&amp; PackageName, int32 PIEInstanceID)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 给定 PackageName 和前缀类型，返回原始包名（即保存的地图名） */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> FString <span class="title">StripPIEPrefixFromPackageName</span><span class="params">(<span class="keyword">const</span> FString&amp; PackageName, <span class="keyword">const</span> FString&amp; Prefix)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回给定PIE实例ID的PIE包的前缀 */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> FString <span class="title">BuildPIEPackagePrefix</span><span class="params">(int32 PIEInstanceID)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 复制把编辑器世界以创建PIE世界 */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> UWorld* <span class="title">GetDuplicatedWorldForPIE</span><span class="params">(UWorld* InWorld, UPackage* InPIEackage, int32 PIEInstanceID)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 给定一个已读取的编辑器世界，复制以便在编辑器中(以OwningWorld为主关卡)开始游戏 */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> UWorld* <span class="title">DuplicateWorldForPIE</span><span class="params">(<span class="keyword">const</span> FString&amp; PackageName, UWorld* OwningWorld)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 给定一个字符串，返回移除了PIE前缀后的字符串 */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> FString <span class="title">RemovePIEPrefix</span><span class="params">(<span class="keyword">const</span> FString &amp;Source)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 给定一个包，如果存在，查找其中包含的 UWorld */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> UWorld* <span class="title">FindWorldInPackage</span><span class="params">(UPackage* Package)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果指定的包包含指向UWorld的重定向程序，则返回该UWorld。否则，将返回nullptr。 */</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> UWorld* <span class="title">FollowWorldRedirectorInPackage</span><span class="params">(UPackage* Package, UObjectRedirector** OptionalOutRedirector = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">FORCEINLINE FWorldPSCPool&amp; <span class="title">GetPSCPool</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> PSCPool; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 世界粒子系统组件池</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	FWorldPSCPool PSCPool;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 子系统收集器</span></span><br><span class="line">	FSubsystemCollection&lt;UWorldSubsystem&gt; SubsystemCollection;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>不难发现，其实大部分代码都是在处理世界和关卡之间的逻辑的，加载 URL，关卡传送，流关卡等等。其次就是处理 World 层面的网络驱动的代码，再来就是各种管理器 (如：AParticleEventManager，ATimerManager 等)。还有一些我们平时开发客户端也经常用得到函数 (射线碰撞检测，SpawnActor 等)</p><p>&quot;UWorld&quot; 的功能比较集中，基本也就是上面说得那些，咱就不另做总结了。也许可以另开一篇博客分析 流关卡 的底层源码实现？</p><h3 id="ulevel"><a class="anchor" href="#ulevel">#</a> ULevel</h3><p></p><figure class="highlight c++"><figcaption><span>ULevel</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Level.h</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">UCLASS</span>(MinimalAPI)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ULevel</span> :</span> <span class="keyword">public</span> UObject, <span class="keyword">public</span> IInterface_AssetUserData</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 和此关卡关联的 URL */</span></span><br><span class="line">	FURL					URL;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 该关卡中的所有 actors，由 FActorIteratorBas 及其派生类使用 */</span></span><br><span class="line">	TArray&lt;AActor*&gt; Actors;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此关卡中暴露给 GC 的 actors 数组，所有其他 actors 将通过 ULevelActorContainer 引用 */</span></span><br><span class="line">	TArray&lt;AActor*&gt; ActorsForGC;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在 为流关卡调用LoadPackage 之前被设置，以确保 OwningWorld 是正确的 */</span></span><br><span class="line">	ENGINE_API <span class="keyword">static</span> TMap&lt;FName, TWeakObjectPtr&lt;UWorld&gt; &gt; StreamedLevelsOwningWorld;</span><br><span class="line">		</span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 拥有此关卡所在的关卡数组的世界</span></span><br><span class="line"><span class="comment">	 * 这与 GetOuter() 不同，因为流关卡的 GetOuter() 是一个未被使用的残留世界</span></span><br><span class="line"><span class="comment">	 * 与任何其他UObject引用一样，在 BeginDestroy() 期间不应访问它，因为GC可能以任何顺序发生</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	UWorld* OwningWorld;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** BSP 模型. */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UModel</span>* <span class="title">Model</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 用于渲染的 BSP 模型组件 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TArray&lt;<span class="class"><span class="keyword">class</span> <span class="title">UModelComponent</span>*&gt;</span> ModelComponents;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient, DuplicateTransient, NonTransactional)</span><br><span class="line">	ULevelActorContainer* ActorCluster;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 未找到有效贴图流数据的组件的数量。在地图检查时更新 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(NonTransactional)</span><br><span class="line">	int32 NumTextureStreamingUnbuiltComponents;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在最后一张贴图流构建时，已改变的资源的数量。在地图检查时更新 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(NonTransactional)</span><br><span class="line">	int32 NumTextureStreamingDirtyResources;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 关卡脚本 actor，从关卡脚本蓝图中实例化创建。处理所有关卡脚本 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(NonTransactional)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">ALevelScriptActor</span>* <span class="title">LevelScriptActor</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 该关卡的导航列表的开始和结束，用于在流进/流出关卡时快速修复 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">ANavigationObjectBase</span> *<span class="title">NavListStart</span>;</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">ANavigationObjectBase</span>	*<span class="title">NavListEnd</span>;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 每个关卡储存的导航相关的信息 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TArray&lt;UNavigationDataChunk*&gt; NavDataChunks;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 用于此关卡的光照贴图的 KB 的总数 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(VisibleAnywhere, Category=Level)</span><br><span class="line">	<span class="keyword">float</span> LightmapTotalSize;</span><br><span class="line">	<span class="comment">/** 用于此关卡的光照贴图的 KB 的总数 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(VisibleAnywhere, Category=Level)</span><br><span class="line">	<span class="keyword">float</span> ShadowmapTotalSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 三角形的三个顶点 - AABB 友好过滤。如果程序运行期间需要重建导航系统以支持 BSPs 时，将其储存起来。这比运行时检索此数据要简单不少 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TArray&lt;FVector&gt; StaticNavigableGeometry;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 用于 FStreamingTextureBuildInfo::TextureLevelIndex 的每张贴图的全局唯一贴图 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TArray&lt;FGuid&gt; StreamingTextureGuids;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 持有 tick 函数的数据结构 **/</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">FTickTaskLevel</span>* <span class="title">TickTaskLevel</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	* 此关卡的预计算灯光信息</span></span><br><span class="line"><span class="comment">	* 额外的间接关卡是允许前向声明 FPrecomputedLightVolume 的</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">FPrecomputedLightVolume</span>*				<span class="title">PrecomputedLightVolume</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 此关卡的体积光照贴图 */</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">FPrecomputedVolumetricLightmap</span>*			<span class="title">PrecomputedVolumetricLightmap</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 包含此关卡的预计算可见性数据 */</span></span><br><span class="line">	FPrecomputedVisibilityHandler				PrecomputedVisibilityHandler;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Precomputed volume distance field for this level. */</span></span><br><span class="line">    <span class="comment">/** 预计算此关卡的体积距离场 */</span></span><br><span class="line">	FPrecomputedVolumeDistanceField				PrecomputedVolumeDistanceField;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 用于跟踪渲染线程何时完成对此 ULevel 资源的引用的标记 */</span></span><br><span class="line">	FRenderCommandFence							RemoveFromSceneFence;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 标识特定于此关卡的地图构建数据，如: 光照体积实例 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	FGuid LevelBuildDataId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 从地图构建中注册数据，这与关卡存储在一个单独的包中，以加快保存/自动保存。</span></span><br><span class="line"><span class="comment">	 * ReleaseRenderingResources 必须在改变引用前被调用，以更新渲染线程状态</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(NonPIEDuplicateTransient)</span><br><span class="line">	UMapBuildDataRegistry* MapBuildData;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 光照建立时的关卡偏移 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	FIntVector LightBuildLevelOffset;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ....... 省略一些布尔变量的声明(543行)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 关卡是否当前被挂起设置为可见，4.15版本后请用下面的函数代替 */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.15</span>, <span class="string">&quot;Use HasVisibilityChangeRequestPending&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">HasVisibilityRequestPending</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 关卡是否当前被挂起设置为可见或不可见 */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">bool</span> <span class="title">HasVisibilityChangeRequestPending</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关卡改变时调用的事件</span></span><br><span class="line">	<span class="built_in">DECLARE_MULTICAST_DELEGATE_OneParam</span>(FLevelTransformEvent, <span class="keyword">const</span> FTransform&amp;);</span><br><span class="line">	FLevelTransformEvent OnApplyLevelTransform;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">DECLARE_MULTICAST_DELEGATE</span>(FLevelCleanupEvent);</span><br><span class="line">	FLevelCleanupEvent OnCleanupLevel;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 定义了关卡逻辑绑定盒的 Actor */</span></span><br><span class="line">    TWeakObjectPtr&lt;ALevelBounds&gt;				LevelBoundsActor;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Foliage actor 的缓存指针 */</span></span><br><span class="line">	TWeakObjectPtr&lt;AInstancedFoliageActor&gt;		InstancedFoliageActor;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当关卡绑定的 actor 更新时调用 */</span></span><br><span class="line">	<span class="built_in">DECLARE_EVENT</span>( ULevel, FLevelBoundsActorUpdatedEvent );</span><br><span class="line">	<span class="function">FLevelBoundsActorUpdatedEvent&amp; <span class="title">LevelBoundsActorUpdated</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> LevelBoundsActorUpdatedEvent; &#125;</span><br><span class="line">	<span class="comment">/**	当关卡绑定的 actor 更新时广播 */</span> </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">BroadcastLevelBoundsActorUpdated</span><span class="params">()</span> </span>&#123; LevelBoundsActorUpdatedEvent.<span class="built_in">Broadcast</span>(); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 将 level 绑定设置为脏数据，以便重新计算 */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">MarkLevelBoundsDirty</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    </span><br><span class="line">    FLevelBoundsActorUpdatedEvent LevelBoundsActorUpdatedEvent; </span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	AWorldSettings* WorldSettings;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 缓存拥有此关卡的关卡收集器，以便更快地访问，而不是通过世界的收集器来循环 */</span></span><br><span class="line">	FLevelCollection* CachedLevelCollection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 存着资源的用户数据数组 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TArray&lt;UAssetUserData*&gt; AssetUserData;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">// 当合适的 PlayerController 被创建后，等待启用输入的 actor</span></span><br><span class="line">	TArray&lt;FPendingAutoReceiveInputActor&gt; PendingAutoReceiveInputActors;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 被销毁的静态 actors 的复制列表。用于网络驱动复制析构函数到客户端 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	TArray&lt;FReplicatedStaticActorDestructionInfo&gt; DestroyedReplicatedStaticActors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">// 内部用于确定哪些 actors 应列入世界的 NetworkActor 列表</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">IsNetActor</span><span class="params">(<span class="keyword">const</span> AActor* Actor)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 为 DestroyedReplicatedStaticActors 列表中的 actor 提供一个入口 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">CreateReplicatedDestructionInfo</span><span class="params">(AActor* <span class="keyword">const</span> Actor)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">const</span> TArray&lt;FReplicatedStaticActorDestructionInfo&gt;&amp; <span class="title">GetDestroyedReplicatedStaticActors</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 当关卡包成为脏包时调用 */</span></span><br><span class="line">	ENGINE_API <span class="keyword">static</span> FSimpleMulticastDelegate LevelDirtiedEvent;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Constructor.</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">Initialize</span><span class="params">(<span class="keyword">const</span> FURL&amp; InURL)</span></span>;</span><br><span class="line">	<span class="built_in">ULevel</span>(<span class="keyword">const</span> FObjectInitializer&amp; ObjectInitializer = FObjectInitializer::<span class="built_in">Get</span>());</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 不要使用！此构造函数时提供给内部热重载的使用的 */</span></span><br><span class="line">	<span class="built_in">ULevel</span>(FVTableHelper&amp; Helper)</span><br><span class="line">		: <span class="built_in">Super</span>(Helper)</span><br><span class="line">		, <span class="built_in">Actors</span>()</span><br><span class="line">	&#123;&#125;</span><br><span class="line"></span><br><span class="line">	~<span class="built_in">ULevel</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//~ Begin UObject Interface.</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PostInitProperties</span><span class="params">()</span> <span class="keyword">override</span></span>;	</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Serialize</span><span class="params">( FArchive&amp; Ar )</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">BeginDestroy</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">IsReadyForFinishDestroy</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">FinishDestroy</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">virtual</span> UWorld* <span class="title">GetWorld</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span> <span class="keyword">final</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PostLoad</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PreSave</span><span class="params">(<span class="keyword">const</span> class ITargetPlatform* TargetPlatform)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PreDuplicate</span><span class="params">(FObjectDuplicationParameters&amp; DupParams)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PostDuplicate</span><span class="params">(<span class="keyword">bool</span> bDuplicateForPIE)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">CanBeClusterRoot</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">CreateCluster</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddReferencedObjects</span><span class="params">(UObject* InThis, FReferenceCollector&amp; Collector)</span></span>;</span><br><span class="line">	<span class="comment">//~ End UObject Interface.</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 标记该关卡实例为待析构的</span></span><br><span class="line"><span class="comment">	 * 此函数会被 UWorld::CleanupWorld 调用，以标记关卡和其所属包为待析构的</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">CleanupLevel</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 清除所有与此关卡关联的 actor 的组件，以及 BSP 模型的组件 */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">ClearLevelComponents</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 更新所有与此关卡关联的 actor 的组件，以及 BSP 模型的组件</span></span><br><span class="line"><span class="comment">	 * @param  bRerunConstructionScripts 是否重新调用此关卡中的 actors 的构造函数脚本</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">UpdateLevelComponents</span><span class="params">(<span class="keyword">bool</span> bRerunConstructionScripts, FRegisterComponentContext* Context = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 立即更新与该关卡关联的 actors 的所有组件</span></span><br><span class="line"><span class="comment">	 * @param NumComponentsToUpdate	本次运行需要更新的组件数，0表示全部</span></span><br><span class="line"><span class="comment">	 * @param bRerunConstructionScripts	是否重新调用此关卡中的 actors 的构造函数脚本</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">IncrementalUpdateComponents</span><span class="params">( int32 NumComponentsToUpdate, <span class="keyword">bool</span> bRerunConstructionScripts, FRegisterComponentContext* Context = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	* 立即注销与该关卡关联的 actors 的所有组件</span></span><br><span class="line"><span class="comment">	* @param NumComponentsToUnregister 本次运行注销的最少组件数，0表示全部</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IncrementalUnregisterComponents</span><span class="params">(int32 NumComponentsToUnregister)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 无效化用于渲染关卡 UModel 的缓存数据 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">InvalidateModelGeometry</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 更新与此关卡关联的模型组件 */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">UpdateModelComponents</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 提交对 UModel 的次表面更改 */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">CommitModelSurfaces</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 丢弃用于渲染关卡的 UModel 的缓存数据。假设表面和顶点位置已经改变，只应用材质 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">InvalidateModelSurface</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通过网络相关性和静态行为，对 actor 列表进行分类。首先是所有非网络相关的静态 actors，</span></span><br><span class="line"><span class="comment">	 * 然后是网络相关的静态 actors，最后是其他 actors。</span></span><br><span class="line"><span class="comment">	 * 这么做是为了能让 动态actor 和 网络相关actor 的迭代器能跳过大量不需要遍历的 actors</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">SortActorList</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">IsNameStableForNetworking</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span> </span>&#123; <span class="keyword">return</span> <span class="literal">true</span>; &#125;		<span class="comment">// 现在，假设所有关卡都有稳定的网络名称</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 处理此关卡的 actors 的网络初始化 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">InitializeNetworkActors</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ClearActorsSeamlessTraveledFlag</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 初始化此关卡的渲染资源 */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">InitializeRenderingResources</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 释放此关卡的渲染资源 */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">ReleaseRenderingResources</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 路由预处理和后处理 actors 的初始化，并设置体积。</span></span><br><span class="line"><span class="comment">	 * @todo 无缝世界: 这没有正确处理多关卡情况下的体积</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RouteActorInitialize</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 为特定世界的所有关卡重建静态流数据</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * @param World	需要重建流数据的世界。为空则处理所有世界</span></span><br><span class="line"><span class="comment">	 * @param TargetLevel [可选的] 指定要处理的单一关卡，为空则处理所有关卡</span></span><br><span class="line"><span class="comment">	 * @param TargetTexture	[可选的] 指定要处理的单一纹理，为空则处理所有纹理</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">BuildStreamingData</span><span class="params">(UWorld* World, ULevel* TargetLevel=<span class="literal">NULL</span>, UTexture2D* TargetTexture=<span class="literal">NULL</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回此关卡的默认 brush(可以是image，也可以是纯色等的外观处理方案) */</span></span><br><span class="line">	<span class="function">ENGINE_API ABrush* <span class="title">GetDefaultBrush</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回此关卡所属的世界的 WorldSettings */</span></span><br><span class="line">	<span class="function">ENGINE_API AWorldSettings* <span class="title">GetWorldSettings</span><span class="params">(<span class="keyword">bool</span> bChecked = <span class="literal">true</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">SetWorldSettings</span><span class="params">(AWorldSettings* NewWorldSettings)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回与此关卡关联的关卡脚本 actor (可能为空) */</span></span><br><span class="line">	<span class="function">ENGINE_API class ALevelScriptActor* <span class="title">GetLevelScriptActor</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回缓存了此关卡的关卡收集器，如果没有则返回空 */</span></span><br><span class="line">	<span class="function">FLevelCollection* <span class="title">GetCachedLevelCollection</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> CachedLevelCollection; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 设置缓存了该关卡的关卡收集器，只应该被 FLevelCollection 调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetCachedLevelCollection</span><span class="params">(FLevelCollection* <span class="keyword">const</span> InCachedLevelCollection)</span> </span>&#123; CachedLevelCollection = InCachedLevelCollection; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 寻找此关卡的 actor 列表中，某一类型的所有 actors 的实用程序 */</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">HasAnyActorsOfType</span><span class="params">(UClass *SearchType)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 重置关卡导航列表 */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">ResetNavList</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">ENGINE_API UPackage* <span class="title">CreateMapBuildDataPackage</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">ENGINE_API UMapBuildDataRegistry* <span class="title">GetOrCreateMapBuildData</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 设置此关卡是否为光照场景，并处理更改的宣传(在光照被改变时，更新所有组件的可见性) */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">SetLightingScenario</span><span class="params">(<span class="keyword">bool</span> bNewIsLightingScenario)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 从该关卡加载的所有组件中，为遗留的光照贴图创建 UMapBuildDataRegistry 项 */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">HandleLegacyMapBuildData</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** @todo 文件 */</span></span><br><span class="line">	<span class="function">ENGINE_API TArray&lt;FVector&gt; <span class="keyword">const</span>* <span class="title">GetStaticNavigableGeometry</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> &amp;StaticNavigableGeometry;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	* 是否为主关卡</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">bool</span> <span class="title">IsPersistentLevel</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此关卡是否为当前所处的关卡 */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">bool</span> <span class="title">IsCurrentLevel</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 按指定偏移量来移动关卡 actors</span></span><br><span class="line"><span class="comment">	 * 我们会把所有 actors 的位置和对应的数据结构减去此偏移向量</span></span><br><span class="line"><span class="comment">	 * @param InWorldOffset	 用于移动所有 actors 的向量</span></span><br><span class="line"><span class="comment">	 * @param bWorldShift	 此调用是否为整个世界移动的一部分</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">ENGINE_API <span class="keyword">void</span> <span class="title">ApplyWorldOffset</span><span class="params">(<span class="keyword">const</span> FVector&amp; InWorldOffset, <span class="keyword">bool</span> bWorldShift)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 注册一个actor用于自动接收输入，当他们被创建时，应该被添加到玩家的输入堆栈中 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RegisterActorForAutoReceiveInput</span><span class="params">(AActor* Actor, <span class="keyword">const</span> int32 PlayerIndex)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 将任何挂起自动接收输入 actor 的输入组件 压入 玩家控制器输入堆栈中 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">PushPendingAutoReceiveInput</span><span class="params">(APlayerController* PC)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// IInterface_AssetUserData 接口</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">AddAssetUserData</span><span class="params">(UAssetUserData* InUserData)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">RemoveUserDataOfClass</span><span class="params">(TSubclassOf&lt;UAssetUserData&gt; InUserDataClass)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> UAssetUserData* <span class="title">GetAssetUserDataOfClass</span><span class="params">(TSubclassOf&lt;UAssetUserData&gt; InUserDataClass)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>通过阅读源码，很容易发现，其实 ULevel 就是将 World 和 Actors 连接起来的中间者，当然还有一些处理关卡渲染和网络相关的函数。</p><p>重点是提问：** 可不可以不要 ULevel，直接把 Actors 建立在 World 中？** 实现上是完全没有问题的，<strong>那为什么要将 World 分为多个 Level ？</strong></p><p>道理其实很简单。试想一下，如果我们偌大一个中国不分出多个省份多个城市，我们要怎么管理，要去什么地方旅游的时候又怎么描述？虚幻也是如此，我们需要分级管理，需要 &quot;城市&quot; 的概念，这不仅方便我们管理 Level 中的 Actors，同时也能避免加载过大的地图 (我就在广州，你没必要把整个中国的数据都缓存，这是非常浪费性能的)</p><hr><p>下一篇：Gameplay —— AActor &amp; UActorComponent</p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-01-02 15:37:46" itemprop="dateModified" datetime="2022-01-02T15:37:46+08:00">2022-01-02</time> </span><span id="2021/12/03/UE4/UE4CPP/Gameplay —— FWorldContext & UWorld & ULevel/" class="item leancloud_visitors" data-flag-title="Gameplay —— FWorldContext & UWorld & ULevel" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>-YIFEI- <i class="ic i-at"><em>@</em></i>一个年轻人奔向梦想的足迹</li><li class="link"><strong>本文链接：</strong> <a href="https://kotori_suki.github.io/2021/12/03/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20FWorldContext%20&%20UWorld%20&%20ULevel/" title="Gameplay —— FWorldContext &amp; UWorld &amp; ULevel">https://kotori_suki.github.io/2021/12/03/UE4/UE4CPP/Gameplay —— FWorldContext & UWorld & ULevel/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/12/01/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20%E6%80%BB%E8%A7%88%20&%20UEngine%20&%20UGameInstance/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gicitht3xtj20zk0m8k5v.jpg" title="Gameplay —— 总览 &amp; UEngine &amp; UGameInstance"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Gameplay</span><h3>Gameplay —— 总览 & UEngine & UGameInstance</h3></a></div><div class="item right"><a href="/2021/12/06/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AActor%20&%20UActorComponent/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclgi503lj20zk0m8hdt.jpg" title="Gameplay —— AActor &amp; UActorComponent"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Gameplay</span><h3>Gameplay —— AActor & UActorComponent</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#gameplay-fworldcontext-uworld-ulevel"><span class="toc-number">1.</span> <span class="toc-text">Gameplay —— FWorldContext &amp; UWorld &amp; ULevel</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fworldcontext"><span class="toc-number">1.1.</span> <span class="toc-text">FWorldContext</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uworld"><span class="toc-number">1.2.</span> <span class="toc-text">UWorld</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ulevel"><span class="toc-number">1.3.</span> <span class="toc-text">ULevel</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2021/12/01/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20%E6%80%BB%E8%A7%88%20&%20UEngine%20&%20UGameInstance/" rel="bookmark" title="Gameplay —— 总览 & UEngine & UGameInstance">Gameplay —— 总览 & UEngine & UGameInstance</a></li><li class="active"><a href="/2021/12/03/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20FWorldContext%20&%20UWorld%20&%20ULevel/" rel="bookmark" title="Gameplay —— FWorldContext & UWorld & ULevel">Gameplay —— FWorldContext & UWorld & ULevel</a></li><li><a href="/2021/12/06/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AActor%20&%20UActorComponent/" rel="bookmark" title="Gameplay —— AActor & UActorComponent">Gameplay —— AActor & UActorComponent</a></li><li><a href="/2021/12/09/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20APawn%20&%20AController%20&%20APlayerController/" rel="bookmark" title="Gameplay —— APawn & AController & APlayerController">Gameplay —— APawn & AController & APlayerController</a></li><li><a href="/2021/12/12/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AGameMode%20&%20AGameState%20&%20APlayerState/" rel="bookmark" title="Gameplay —— AGameMode & AGameState & APlayerState">Gameplay —— AGameMode & AGameState & APlayerState</a></li><li><a href="/2021/12/15/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20USavegame%20&%20UPlayer/" rel="bookmark" title="Gameplay —— USavegame & UPlayer">Gameplay —— USavegame & UPlayer</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="-YIFEI-" data-src="/images/avatar.jpg"><p class="name" itemprop="name">-YIFEI-</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">57</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">15</span> <span class="name">分类</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0tvdG9yaS1TdWtp" title="https:&#x2F;&#x2F;github.com&#x2F;Kotori-Suki"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS90dnQtNjA=" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;tvt-60"><i class="ic i-zhihu"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li></ul></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/12/01/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20%E6%80%BB%E8%A7%88%20&%20UEngine%20&%20UGameInstance/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/12/06/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AActor%20&%20UActorComponent/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="分类于 UE4_C++">UE4_C++</a></div><span><a href="/2021/12/17/UE4/UE4CPP/Unreal%20GAS%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" title="Unreal GAS 源码解析">Unreal GAS 源码解析</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="分类于 UE4_C++">UE4_C++</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/Gameplay/" title="分类于 Gameplay">Gameplay</a></div><span><a href="/2021/12/01/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20%E6%80%BB%E8%A7%88%20&%20UEngine%20&%20UGameInstance/" title="Gameplay —— 总览 &amp; UEngine &amp; UGameInstance">Gameplay —— 总览 & UEngine & UGameInstance</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="分类于 C++基础">C++基础</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="分类于 设计模式">设计模式</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/" title="分类于 结构型模式">结构型模式</a></div><span><a href="/2021/08/18/CPPBase/DesignPattern/Adapter/" title="适配器模式">适配器模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="分类于 C++基础">C++基础</a></div><span><a href="/2021/08/25/CPPBase/%E7%AE%80%E5%8D%95%E8%BF%AD%E4%BB%A3%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0/" title="简单迭代器的实现">简单迭代器的实现</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="分类于 C++基础">C++基础</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="分类于 设计模式">设计模式</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/" title="分类于 创建型模式">创建型模式</a></div><span><a href="/2021/08/21/CPPBase/DesignPattern/Decorater/" title="装饰器模式">装饰器模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="分类于 C++基础">C++基础</a></div><span><a href="/2021/08/16/CPPBase/C++%E6%8C%87%E9%92%88/" title="C++指针">C++指针</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ComputerBase/" title="分类于 计算机基础">计算机基础</a> <i class="ic i-angle-right"></i> <a href="/categories/ComputerBase/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a></div><span><a href="/2021/08/16/ComputerBase/Algorithm/%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93%EF%BC%9A%E5%8F%8C%E6%8C%87%E9%92%88/" title="双指针">双指针</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="分类于 UE4_C++">UE4_C++</a></div><span><a href="/2022/03/15/UE4/UE4CPP/Unreal%20%E5%B8%B8%E7%94%A8%E6%8E%A5%E5%8F%A3%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20%E4%B9%8B%E4%B8%80/" title="Unreal 常用接口源码分析 之一">Unreal 常用接口源码分析 之一</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="分类于 C++基础">C++基础</a></div><span><a href="/2021/08/23/CPPBase/%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98/" title="迭代器失效问题">迭代器失效问题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ComputerBase/" title="分类于 计算机基础">计算机基础</a> <i class="ic i-angle-right"></i> <a href="/categories/ComputerBase/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="分类于 计算机网络">计算机网络</a></div><span><a href="/2021/08/16/ComputerBase/ComputerNetworks/TCPUDP%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE/" title="TCP&#x2F;UDP传输层协议">TCP/UDP传输层协议</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2021 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">-YIFEI- @ Afei's Blog</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/12/03/UE4/UE4CPP/Gameplay —— FWorldContext & UWorld & ULevel/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>