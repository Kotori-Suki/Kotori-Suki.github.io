<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="一个年轻人奔向梦想的足迹" href="https://kotori_suki.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="一个年轻人奔向梦想的足迹" href="https://kotori_suki.github.io/atom.xml"><link rel="alternate" type="application/json" title="一个年轻人奔向梦想的足迹" href="https://kotori_suki.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="https://kotori_suki.github.io/2021/12/12/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AGameMode%20&%20AGameState%20&%20APlayerState/"><title>Gameplay —— AGameMode & AGameState & APlayerState - Gameplay - UE4_C++ - UE4 | Afei's Blog = 一个年轻人奔向梦想的足迹 = Welcome to my blog !</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Gameplay —— AGameMode & AGameState & APlayerState</h1><div class="meta"><span class="item" title="创建时间：2021-12-12 15:01:45"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-12-12T15:01:45+08:00">2021-12-12</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Afei's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclxfdlttj20zk0m8npd.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giph4fomxoj20zk0m8axp.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclimtf7dj20zk0m8qav.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclx29mstj20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipetfk5zwj20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclfw2t96j20zk0m8x6p.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/UE4/" itemprop="item" rel="index" title="分类于 UE4"><span itemprop="name">UE4</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/UE4/UE4CPP/" itemprop="item" rel="index" title="分类于 UE4_C++"><span itemprop="name">UE4_C++</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/UE4/UE4CPP/Gameplay/" itemprop="item" rel="index" title="分类于 Gameplay"><span itemprop="name">Gameplay</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://kotori_suki.github.io/2021/12/12/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AGameMode%20&%20AGameState%20&%20APlayerState/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="-YIFEI-"><meta itemprop="description" content="Welcome to my blog !, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="一个年轻人奔向梦想的足迹"></span><div class="body md" itemprop="articleBody"><h2 id="gameplay-agamemode-agamestate-aplayerstate"><a class="anchor" href="#gameplay-agamemode-agamestate-aplayerstate">#</a> Gameplay —— AGameMode &amp; AGameState &amp; APlayerState</h2><p>简介：为什么这仨要放到一起呢？因为都继承于 &quot;AInfo&quot; 呀。所以咱当然要从 &quot;AInfo&quot; 开始介绍的。那 &quot;AInfo&quot; 有什么用，为什么要继承自 &quot;AActor&quot;..... 诸多疑问，不必猜测，咱直接到源码一探究竟。&quot;AInfo&quot; 直接开冲～～～</p><h3 id="ainfo"><a class="anchor" href="#ainfo">#</a> AInfo</h3><p>&quot;AInfo&quot; 的实现非常简单，咱直接看源码：</p><p></p><figure class="highlight c++"><figcaption><span>AInfo</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Info.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Info is the base class of an Actor that isn&#x27;t meant to have a physical representation in the world, used primarily</span></span><br><span class="line"><span class="comment"> * for &quot;manager&quot; type classes that hold settings data about the world, but might need to be an Actor for replication purposes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">UCLASS</span>(abstract, hidecategories=(Input, Movement, Collision, Rendering, <span class="string">&quot;Utilities|Transformation&quot;</span>), showcategories=(<span class="string">&quot;Input|MouseInput&quot;</span>, <span class="string">&quot;Input|TouchInput&quot;</span>), MinimalAPI, NotBlueprintable)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AInfo</span> :</span> <span class="keyword">public</span> AActor</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_UCLASS_BODY</span>()</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WITH_EDITORONLY_DATA</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 在编辑器中显示的 Billboard Component</span></span><br><span class="line"><span class="comment">	 * 其实就是一张 2d 的贴图，用于显示不能显示的物体，如: 平行光 等 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UBillboardComponent</span>* <span class="title">SpriteComponent</span>;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 表明此 actor 不参与关卡边界计算 (没有实体的数据类 当然不需要) */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">IsLevelBoundsRelevant</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span> </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WITH_EDITORONLY_DATA</span></span><br><span class="line">	<span class="comment">/** 返回 SpriteComponent 子对象 **/</span></span><br><span class="line">	<span class="function">ENGINE_API class UBillboardComponent* <span class="title">GetSpriteComponent</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>代码寥寥几行，却能将保存世界设置数据的类给完全划分出来。从虚幻给我们的注释中可以知道，&quot;AInfo&quot; 类继承于 &quot;AActor&quot; 类主要是为了复制方便。且 &quot;AInfo&quot; 是用于保存数据的类，所以自然不需要物理、渲染等功能。在编辑器模式下会有一个用于显示的 &quot;UBillboardComponent&quot; 实例，运行时代码甚至只有一行：此 &quot;Actor&quot; 不参与关卡边界计算，因为这是一个没有实体的数据类。</p><h3 id="agamemodebase"><a class="anchor" href="#agamemodebase">#</a> AGameModeBase</h3><p>相信读者们对这个类都不陌生了。毕竟 &quot;GameMode&quot; 可是掌控着世界规则的上帝，每个游戏都会有自己的规则，自然免不了要开发其子类。使用频率如此高的一个类，我们必然是得好好研究一番的 (虽然代码并不长)。话不多说，让咱看看虚幻都给我们准备了什么好东西。</p><p></p><figure class="highlight c++"><figcaption><span>GameModeBase</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameModeBase.h</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">UCLASS</span>(config = Game, notplaceable, BlueprintType, Blueprintable, Transient, hideCategories = (Info, Rendering, MovementReplication, Replication, Actor), meta = (ShortTooltip = <span class="string">&quot;Game Mode Base defines the game being played, its rules, scoring, and other facets of the game type.&quot;</span>))</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ENGINE_API</span> <span class="title">AGameModeBase</span> :</span> <span class="keyword">public</span> AInfo</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_UCLASS_BODY</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">//~=============================================================================</span></span><br><span class="line">	<span class="comment">// Initializing the game (初始化游戏)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 初始化游戏</span></span><br><span class="line"><span class="comment">	 * GameMode&#x27;s InitGame() 事件在其他函数之前调用(包括 PreInitializeComponents() )</span></span><br><span class="line"><span class="comment">	 * 且 GameMode 用来初始化参数和生成器辅助类</span></span><br><span class="line"><span class="comment">	 * @warning: 此函数在 actors&#x27; PreInitializeComponents 之前调用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">InitGame</span><span class="params">(<span class="keyword">const</span> FString&amp; MapName, <span class="keyword">const</span> FString&amp; Options, FString&amp; ErrorMessage)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通过默认设置，初始化 GameState actor</span></span><br><span class="line"><span class="comment">	 * 在 GameMode.PreInitializeComponents() 期间，在 GameState 生成后，以及在 Reset() 期间 调用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">InitGameState</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 保存选项字符串并在需要时解析它 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadOnly, Category=GameMode)</span><br><span class="line">	FString OptionsString;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//~=============================================================================</span></span><br><span class="line">	<span class="comment">// Accessors for classes spawned by game (游戏产生的类的访问器)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回此游戏使用的 GameSession 类 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> TSubclassOf&lt;AGameSession&gt; <span class="title">GetGameSessionClass</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回给定 Controller 的默认 Pawn 类 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, BlueprintNativeEvent, Category=Classes)</span><br><span class="line">	<span class="function">UClass* <span class="title">GetDefaultPawnClassForController</span><span class="params">(AController* InController)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** GameSession类，用于处理登录批准和在线游戏接口 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadWrite, Category=Classes)</span><br><span class="line">	TSubclassOf&lt;AGameSession&gt; GameSessionClass;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 与此 GameMode 关联的 GameState 类 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, NoClear, BlueprintReadOnly, Category=Classes)</span><br><span class="line">	TSubclassOf&lt;AGameStateBase&gt; GameStateClass;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 为登录的玩家生成的 PlayerController 类 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, NoClear, BlueprintReadOnly, Category=Classes)</span><br><span class="line">	TSubclassOf&lt;APlayerController&gt; PlayerControllerClass;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 与此 GameMode 关联的 PlayerState 类。PlayerState 将与每个玩家关联，以将相关玩家信息复制到所有客户端中 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, NoClear, BlueprintReadOnly, Category=Classes)</span><br><span class="line">	TSubclassOf&lt;APlayerState&gt; PlayerStateClass;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此游戏使用的 HUD 类 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadWrite, Category=Classes, meta = (DisplayName = <span class="string">&quot;HUD Class&quot;</span>))</span><br><span class="line">	TSubclassOf&lt;AHUD&gt; HUDClass;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 玩家使用的默认 pawn 类 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadWrite, Category=Classes)</span><br><span class="line">	TSubclassOf&lt;APawn&gt; DefaultPawnClass;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 旁观模式时，玩家的 PlayerController 使用的 Pawn 类 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, NoClear, BlueprintReadOnly, Category=Classes)</span><br><span class="line">	TSubclassOf&lt;ASpectatorPawn&gt; SpectatorClass;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 查看网络重播时使用的 PlayerController 类 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, NoClear, BlueprintReadOnly, Category=Classes)</span><br><span class="line">	TSubclassOf&lt;APlayerController&gt; ReplaySpectatorPlayerControllerClass;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, NoClear, BlueprintReadOnly, Category = Classes)</span><br><span class="line">	TSubclassOf&lt;AServerStatReplicator&gt; ServerStatReplicatorClass;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//~=============================================================================</span></span><br><span class="line">	<span class="comment">// Accessors for current state</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 游戏会话实例，处理登录批准，仲裁，在线游戏接口 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	AGameSession* GameSession;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** GameState 用于复制游戏状态相关的属性到所有客户端 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	AGameStateBase* GameState;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回当前的 GameState 实例，并动态转换为模板类型，不存在或转换失败返回 nullptr */</span></span><br><span class="line">	<span class="function"><span class="keyword">template</span>&lt; class T &gt;</span></span><br><span class="line"><span class="function">	T* <span class="title">GetGameState</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Cast&lt;T&gt;(GameState);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	AServerStatReplicator* ServerStatReplicator;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回活跃玩家数，不包含旁观者 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> int32 <span class="title">GetNumPlayers</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回当前旁观玩家数 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> int32 <span class="title">GetNumSpectators</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//~=============================================================================</span></span><br><span class="line">	<span class="comment">// Starting/pausing/resetting the game(开始/解析/重置游戏)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 过渡到调用 actors 的 BeginPlay 函数 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">StartPlay</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果匹配开始回调已被调用，则返回真 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HasMatchStarted</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果匹配可以结束，则返回真 */</span><span class="function">Returns <span class="literal">true</span> <span class="keyword">if</span> the match can be considered ended</span></span><br><span class="line"><span class="function">	<span class="title">UFUNCTION</span><span class="params">(BlueprintCallable, Category=Game)</span></span></span><br><span class="line"><span class="function">	<span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HasMatchEnded</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 如果玩家控制器有权暂停游戏，添加代理到列表中。</span></span><br><span class="line"><span class="comment">	 * 调用代理以查看是否可以重新开始游戏，如: 游戏暂停的原因被清除</span></span><br><span class="line"><span class="comment">	 * @param PC 用于检查管理员权限的 PlayerController</span></span><br><span class="line"><span class="comment">	 * @param CanUnpauseDelegate 检查重新开始游戏时要查询的代理</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">SetPause</span><span class="params">(APlayerController* PC, FCanUnpause CanUnpauseDelegate = FCanUnpause())</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 检查代理列表以确认暂停是否可以被清除。如果代理表示可以取消暂停，则将该代理从列表中移除，并检查剩下的代理。当列表为空时，游戏被视为未暂停</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">ClearPause</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 从暂停器列表中强制移除一个对象的 CanUnPause 代理。</span></span><br><span class="line"><span class="comment">	 * 如果列表中有任何对象的 CanUnPause 代理处理程序，则触发对 ClearPause() 的调用。</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * 在销毁玩家控制器时调用，以防止在取消暂停游戏之前销毁暂停游戏的PC时游戏陷入暂停状态</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ForceClearUnpauseDelegates</span><span class="params">(AActor* PauseActor)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果玩家被允许暂停游戏 则返回真 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">AllowPausing</span><span class="params">(APlayerController* PC = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果游戏被暂停，返回真 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">IsPaused</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 可重写函数，用于确认当游戏对传入 Actor 调用 Reset 时，该 Actor 是否应该被调用 Reset </span></span><br><span class="line"><span class="comment">	 * 默认实现返回真</span></span><br><span class="line"><span class="comment">	 * @param ActorToReset 需要确认的 Actor</span></span><br><span class="line"><span class="comment">	 * @return 如果 ActorToReset 在重启游戏时，应被调用 Reset()，则返回 true，如果此 GameMode 将手动重置它，或如果该 actor 不需要被重置，则返回 false</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintNativeEvent, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ShouldReset</span><span class="params">(AActor* ActorToReset)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 可重写函数，在重置关卡时调用。此函数用于重置游戏状态，同时保持在同一地图上</span></span><br><span class="line"><span class="comment">	 * 默认实现调用除 GameMode 与 Controllers 外的所有 actors 的 Reset() </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ResetLevel</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回主菜单，并断开所有玩家的连接 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ReturnToMainMenuHost</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果允许服务器地图切换，则返回真 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">CanServerTravel</span><span class="params">(<span class="keyword">const</span> FString&amp; URL, <span class="keyword">bool</span> bAbsolute)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 为服务器处理请求，以带着所有玩家一起传送到新的 URL 中 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ProcessServerTravel</span><span class="params">(<span class="keyword">const</span> FString&amp; URL, <span class="keyword">bool</span> bAbsolute = <span class="literal">false</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 在无缝关卡过渡期间，由服务端调用，以获取应被移动到新关卡中的 Actors 列表</span></span><br><span class="line"><span class="comment">	 * 玩家控制器，Role &lt; ROLE_Authority Actors，和 在列表中的Actor内的所有非Actors (即: Object.Outer == 列表中的Actor) 都会自动移动，无论他们是否包含在这</span></span><br><span class="line"><span class="comment">	 * 只有主关卡中的动态 Actor 可以移动(这包括在游戏过程中产生的所有 Actor)</span></span><br><span class="line"><span class="comment">	 * 此函数在过渡的两个部分都会调用，因为 actors 可能在中间改变(如: 玩家可以加入或离开游戏) </span></span><br><span class="line"><span class="comment">	 * @see also PlayerController::GetSeamlessTravelActorList() (在客户端调用的函数)</span></span><br><span class="line"><span class="comment">	 * @param bToTransition 如果我们正在从旧关卡转到过渡地图，则为 true; 如果我们正在从过渡关卡转到新关卡，则为 false </span></span><br><span class="line"><span class="comment">	 * @param ActorList (out) 保留的 actors 列表</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">GetSeamlessTravelActorList</span><span class="params">(<span class="keyword">bool</span> bToTransition, TArray&lt;AActor*&gt;&amp; ActorList)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用于在无缝关卡切换时，交换 视口/连接的PlayerControllers，</span></span><br><span class="line"><span class="comment">	 并且新的 GameMode 的控制器类与之前的不同，包括网络处理</span></span><br><span class="line"><span class="comment">	 * @param OldPC - 应该丢弃的旧的 PC</span></span><br><span class="line"><span class="comment">	 * @param NewPC - 应该用于玩家上的新的 PC</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SwapPlayerControllers</span><span class="params">(APlayerController* OldPC, APlayerController* NewPC)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取在无缝关卡切换时，应该用于生成玩家控制器的类</span></span><br><span class="line"><span class="comment">	 * @param PreviousPlayerController 之前关卡的玩家控制器</span></span><br><span class="line"><span class="comment">	 * @return 用于生成玩家控制器的类</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> TSubclassOf&lt;APlayerController&gt; <span class="title">GetPlayerControllerClassToSpawnForSeamlessTravel</span><span class="params">(APlayerController* PreviousPlayerController)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 处理应在无缝关卡转换时保留的玩家的重初始化</span></span><br><span class="line"><span class="comment">	 * 从 C++ 中调用，为服务器完成加载后的玩家调用</span></span><br><span class="line"><span class="comment">	 * @param C 需要处理的控制器</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleSeamlessTravelPlayer</span><span class="params">(AController*&amp; C)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 在无缝关卡切换完成后，在新的 GameMode 中调用</span></span><br><span class="line"><span class="comment">	 * 用于重初始化已经在游戏中的玩家，因为他们不会被调用 *Login()</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PostSeamlessTravel</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 开始传送出当前地图。在无缝关卡切换开始时，或在硬切换的地图更改前调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">StartToLeaveMap</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//~=============================================================================</span></span><br><span class="line">	<span class="comment">// Player joining and leaving (玩家加入和离开)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 允许游戏发送网络消息，通过NMT_GameSpecific向加入游戏的客户端提供更多消息(如: 所需的 DLC)</span></span><br><span class="line"><span class="comment">	 * 如果只需要一个普通的 URL，返回字符串 RedirectURL 内置并自动发送</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">GameWelcomePlayer</span><span class="params">(UNetConnection* Connection, FString&amp; RedirectURL)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 接受或拒绝一个尝试加入服务器的玩家。如果你将 ErrorMessage 设置为非空字符串，则登录失败</span></span><br><span class="line"><span class="comment">	 * PreLogin 在 Login 之前调用。 在调用 Login 之前，重要的游戏时间可能会过去</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param	Options					玩家传入的 URL 选项 (e.g. name/spectator)</span></span><br><span class="line"><span class="comment">	 * @param	Address					玩家的网络地址</span></span><br><span class="line"><span class="comment">	 * @param	UniqueId				玩家传入服务器中的唯一id</span></span><br><span class="line"><span class="comment">	 * @param	ErrorMessage			当设置为非空值时，将使用错误消息集拒绝玩家 </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PreLogin</span><span class="params">(<span class="keyword">const</span> FString&amp; Options, <span class="keyword">const</span> FString&amp; Address, <span class="keyword">const</span> FUniqueNetIdRepl&amp; UniqueId, FString&amp; ErrorMessage)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 调用以登录新玩家，通过创建一个玩家控制器登录。此函数可被游戏重写</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * 设置此玩家的基础属性(名称，唯一id，在后端注册等)，且不应用于执行更复杂的游戏逻辑。</span></span><br><span class="line"><span class="comment">	 * 就网络而言，此函数中的玩家控制器没有完全初始化</span></span><br><span class="line"><span class="comment">	 * 为 之后不久就会调用的PostLogin 保存 &quot;game login&quot;</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param NewPlayer 代表此玩家的 UPlayer 对象的指针(本地或远端)</span></span><br><span class="line"><span class="comment">	 * @param RemoteRole 此控制器拥有的 RemoteRole</span></span><br><span class="line"><span class="comment">	 * @param Portal 客户端指定的所需门户位置</span></span><br><span class="line"><span class="comment">	 * @param Options 客户端在登录时传入的游戏选项</span></span><br><span class="line"><span class="comment">	 * @param UniqueId 登录玩家的平台特定的唯一标识符</span></span><br><span class="line"><span class="comment">	 * @param ErrorMessage [输出] 错误信息，如果有，为什么此连接会失败</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * 如果成功登录，返回与当前玩家关联的新 PlayerController。如果设置了 ErrorMessage 字符串，则登陆失败</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @return 返回登录玩家的玩家控制器，登录失败则返回 nullptr</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> APlayerController* <span class="title">Login</span><span class="params">(UPlayer* NewPlayer, ENetRole InRemoteRole, <span class="keyword">const</span> FString&amp; Portal, <span class="keyword">const</span> FString&amp; Options, <span class="keyword">const</span> FUniqueNetIdRepl&amp; UniqueId, FString&amp; ErrorMessage)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在登录成功时调用。这是第一个可以安全调用 PlayerController 上的函数的地方 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PostLogin</span><span class="params">(APlayerController* NewPlayer)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 玩家已成功登录，并已获得玩家控制器的通知 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintImplementableEvent, Category=Game, meta = (DisplayName = <span class="string">&quot;OnPostLogin&quot;</span>, ScriptName = <span class="string">&quot;OnPostLogin&quot;</span>))</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">K2_PostLogin</span><span class="params">(APlayerController* NewPlayer)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当 Controller 通过 PlayerState 离开游戏或被销毁时调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Logout</span><span class="params">(AController* Exiting)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 可实现事件，当 Controller 通过 PlayerState 离开游戏时调用 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintImplementableEvent, Category=Game, meta = (DisplayName = <span class="string">&quot;OnLogout&quot;</span>, ScriptName = <span class="string">&quot;OnLogout&quot;</span>))</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">K2_OnLogout</span><span class="params">(AController* ExitingController)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 为给定选项生成合适的 PlayerController; 将其从 Login() 中分离出来以便重写</span></span><br><span class="line"><span class="comment">	 * 如: 重写此函数可以条件性地生成特定的 PlayerController</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param RemoteRole 此控制器的 RemoteRole(远端角色)</span></span><br><span class="line"><span class="comment">	 * @param Options 新玩家的 URL 中的选项字符串</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @return 返回玩家的 PlayerController。如果出于某种原因，该玩家不存在或由于某些错误，则返回空</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> APlayerController* <span class="title">SpawnPlayerController</span><span class="params">(ENetRole InRemoteRole, <span class="keyword">const</span> FString&amp; Options)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.20</span>, <span class="string">&quot;SpawnPlayerController with Location and Rotation is deprecated, call or override the version that takes an Option string instead&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> APlayerController* <span class="title">SpawnPlayerController</span><span class="params">(ENetRole InRemoteRole, FVector <span class="keyword">const</span>&amp; SpawnLocation, FRotator <span class="keyword">const</span>&amp; SpawnRotation)</span></span>;</span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.20</span>, <span class="string">&quot;SpawnReplayPlayerController is deprecated, replay controller spawning is handled inside the new version of the SpawnPlayerController function&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> APlayerController* <span class="title">SpawnReplayPlayerController</span><span class="params">(ENetRole InRemoteRole, FVector <span class="keyword">const</span>&amp; SpawnLocation, FRotator <span class="keyword">const</span>&amp; SpawnRotation)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 表示玩家已准备好进入游戏，这可能会启动游戏 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintNativeEvent, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">HandleStartingNewPlayer</span><span class="params">(APlayerController* NewPlayer)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果 NewPlayerController 只能作为观察者加入服务器，则返回 true */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintNativeEvent, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">MustSpectate</span><span class="params">(APlayerController* NewPlayerController)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回 Viewer(可以是正常游戏的PC，也可以是观察者的PC) 是否被允许从 ViewTarget 的视点进行观察 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintNativeEvent, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">CanSpectate</span><span class="params">(APlayerController* Viewer, APlayerState* ViewTarget)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 默认玩家名称，指定到加入时没有名称的玩家 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, Category=Game)</span><br><span class="line">	FText DefaultPlayerName;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 设置 控制器的名称</span></span><br><span class="line"><span class="comment">	 * @param Controller	需要改名的玩家的控制器</span></span><br><span class="line"><span class="comment">	 * @param NewName		要设置玩家的名称</span></span><br><span class="line"><span class="comment">	 * @param bNameChange	名称是否之前已被改过</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ChangeName</span><span class="params">(AController* Controller, <span class="keyword">const</span> FString&amp; NewName, <span class="keyword">bool</span> bNameChange)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 与 ChangeName 一致，可重写的GameMode蓝图事件，用以响应更改名称的调用 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintImplementableEvent,Category=Game,meta=(DisplayName=<span class="string">&quot;OnChangeName&quot;</span>, ScriptName=<span class="string">&quot;OnChangeName&quot;</span>))</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">K2_OnChangeName</span><span class="params">(AController* Other, <span class="keyword">const</span> FString&amp; NewName, <span class="keyword">bool</span> bNameChange)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//~=============================================================================</span></span><br><span class="line">	<span class="comment">// Spawning the player&#x27;s pawn (生成玩家的Pawn)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回生成此玩家的 &quot;最好的&quot; 玩家起始点</span></span><br><span class="line"><span class="comment">	 * 默认实现寻找一个随机未占用的点</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * @param Player 需要选择的玩家的控制器</span></span><br><span class="line"><span class="comment">	 * @returns AActor 被选的玩家起始点 (通常时 PlayerStart)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintNativeEvent, Category=Game)</span><br><span class="line">	<span class="function">AActor* <span class="title">ChoosePlayerStart</span><span class="params">(AController* Player)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回特定的玩家起始点，其应用于下一个生成的玩家</span></span><br><span class="line"><span class="comment">	 * 这将使用预储存的 startactor，或调用 ChoosePlayerStart</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * @param Player 我们正在为其选择玩家起始点的控制器</span></span><br><span class="line"><span class="comment">	 * @param IncomingName 指定玩家起始点使用的标记</span></span><br><span class="line"><span class="comment">	 * @returns Actor 被选的玩家起始点 (通常时 PlayerStart)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintNativeEvent, Category=Game)</span><br><span class="line">	<span class="function">AActor* <span class="title">FindPlayerStart</span><span class="params">(AController* Player, <span class="keyword">const</span> FString&amp; IncomingName = TEXT(<span class="string">&quot;&quot;</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 与 FindPlayerStart 一致，用于蓝图调用*/</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintPure, Category=Game, meta = (DisplayName = <span class="string">&quot;FindPlayerStart&quot;</span>))</span><br><span class="line">	<span class="function">AActor* <span class="title">K2_FindPlayerStart</span><span class="params">(AController* Player, <span class="keyword">const</span> FString&amp; IncomingName = TEXT(<span class="string">&quot;&quot;</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果调用 RestartPlayer 有效，则返回真。默认调用 Player-&gt;CanRestartPlayer */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, BlueprintNativeEvent, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">PlayerCanRestart</span><span class="params">(APlayerController* Player)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 尝试生成 player 的 pawn，在 FindPlayerStart 返回的地方生成 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">RestartPlayer</span><span class="params">(AController* NewPlayer)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在特定位置尝试生成 player 的 pawn */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">RestartPlayerAtPlayerStart</span><span class="params">(AController* NewPlayer, AActor* StartSpot)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 以特定变换尝试生成 player 的 pawn */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">RestartPlayerAtTransform</span><span class="params">(AController* NewPlayer, <span class="keyword">const</span> FTransform&amp; SpawnTransform)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 在 RestartPlayer 期间调用，以在使用起始点时，实际生成玩家的 pawn</span></span><br><span class="line"><span class="comment">	 * @param	NewPlayer - 为此传入控制器生成 pawn</span></span><br><span class="line"><span class="comment">	 * @param	StartSpot - 在此传入 Actor 中生成 pawn</span></span><br><span class="line"><span class="comment">	 * @return	返回一个默认 pawn 类的实例</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintNativeEvent, Category=Game)</span><br><span class="line">	<span class="function">APawn* <span class="title">SpawnDefaultPawnFor</span><span class="params">(AController* NewPlayer, AActor* StartSpot)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 与 SpawnDefaultPawnFor 类似，在给定变换中生成一个默认的 pawn 实例，并将其返回*/</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintNativeEvent, Category=Game)</span><br><span class="line">	<span class="function">APawn* <span class="title">SpawnDefaultPawnAtTransform</span><span class="params">(AController* NewPlayer, <span class="keyword">const</span> FTransform&amp; SpawnTransform)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 从 RestartPlayerAtPlayerStart 中调用，可用于初始化 起始点actor */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintNativeEvent, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">InitStartSpot</span><span class="params">(AActor* StartSpot, AController* NewPlayer)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 可蓝图实现事件，在 RestartPlayer 的末尾处调用 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintImplementableEvent, Category=Game, meta = (DisplayName = <span class="string">&quot;OnRestartPlayer&quot;</span>, ScriptName = <span class="string">&quot;OnRestartPlayer&quot;</span>))</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">K2_OnRestartPlayer</span><span class="params">(AController* NewPlayer)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 将玩家 pawn 初始化回起始值，在 RestartPlayer 中调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SetPlayerDefaults</span><span class="params">(APawn* PlayerPawn)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//~=============================================================================</span></span><br><span class="line">	<span class="comment">// Engine hooks (引擎挂钩)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果允许玩家作弊返回真 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">AllowCheats</span><span class="params">(APlayerController* P)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果重播在 gameplay 开始/停止期间，跟随其开始/停止，则返回真 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">IsHandlingReplays</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在编辑器中使用，用于在游戏已开始后生成 PIE 玩家 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">SpawnPlayerFromSimulate</span><span class="params">(<span class="keyword">const</span> FVector&amp; NewLocation, <span class="keyword">const</span> FRotator&amp; NewRotation)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//~ Begin AActor Interface</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PreInitializeComponents</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Reset</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="comment">//~ End AActor Interface</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *	检查我们是否应该以电影模式开始游戏</span></span><br><span class="line"><span class="comment">	 * 	@param	OutHidePlayer		是否隐藏玩家</span></span><br><span class="line"><span class="comment">	 *	@param	OutHideHud			是否隐藏 HUD</span></span><br><span class="line"><span class="comment">	 *	@param	OutDisableMovement	是否允许移动</span></span><br><span class="line"><span class="comment">	 * 	@param	OutDisableTurning	是否允许转向</span></span><br><span class="line"><span class="comment">	 *	@return	bool			如果我们应该开启电影模式则返回真，否则返回假</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">ShouldStartInCinematicMode</span><span class="params">(APlayerController* Player, <span class="keyword">bool</span>&amp; OutHidePlayer, <span class="keyword">bool</span>&amp; OutHideHud, <span class="keyword">bool</span>&amp; OutDisableMovement, <span class="keyword">bool</span>&amp; OutDisableTurning)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用于通知游戏类型，现在可以更新玩家特定于游戏的静音信息。</span></span><br><span class="line"><span class="comment">	 * 此玩家控制器需要其可以静音时通知服务器更新静音信息，</span></span><br><span class="line"><span class="comment">	 * 否则唯一网络 id 将不正确，静音也将无法工作</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param aPlayer 准备好更新的玩家控制器</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">UpdateGameplayMuteList</span><span class="params">(APlayerController* aPlayer)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据 URL 选项，自定义传入的玩家</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param NewPlayerController 登录的玩家</span></span><br><span class="line"><span class="comment">	 * @param UniqueId 此玩家的唯一id</span></span><br><span class="line"><span class="comment">	 * @param Options 在登陆时传入的 URL 选项</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> FString <span class="title">InitNewPlayer</span><span class="params">(APlayerController* NewPlayerController, <span class="keyword">const</span> FUniqueNetIdRepl&amp; UniqueId, <span class="keyword">const</span> FString&amp; Options, <span class="keyword">const</span> FString&amp; Portal = TEXT(<span class="string">&quot;&quot;</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 初始化传入玩家的 AHUD 对象。游戏可以重写此函数以执行不同的逻辑 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintNativeEvent, Category=Game)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">InitializeHUDForPlayer</span><span class="params">(APlayerController* NewPlayer)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 处理所有玩家的初始化，与切换关卡方法共享</span></span><br><span class="line"><span class="comment">	 * (即 从 Post() 和 HandleSeamlessTravelPlayer() 中调用)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">GenericPlayerInitialization</span><span class="params">(AController* C)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 复制当前关卡流信息到给定 PlayerController 中 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ReplicateStreamingStatus</span><span class="params">(APlayerController* PC)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果 FindPlayerStart 应使用存在 Player 中的 StartSpot 代替调用 ChoosePlayerStart，则返回真 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">ShouldSpawnAtStartSpot</span><span class="params">(AController* Player)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 处理 RestartPlayer 的下半部分 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">FinishRestartPlayer</span><span class="params">(AController* NewPlayer, <span class="keyword">const</span> FRotator&amp; StartRotation)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通知所有客户端移动到指定的 URL 中</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param	URL				包含要传送到的地图名称(或IP地址)以及选项键/值对的字符串</span></span><br><span class="line"><span class="comment">	 * @param	NextMapGuid		下个地图的服务器版本的 GUID</span></span><br><span class="line"><span class="comment">	 * @param	bSeamless		指示切换是否为无缝的</span></span><br><span class="line"><span class="comment">	 * @param	bAbsolute		指示服务器将进行哪种切换(即 TRAVEL_Relative 或 TRAVEL_Absolute)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> APlayerController* <span class="title">ProcessClientTravel</span><span class="params">(FString&amp; URL, FGuid NextMapGuid, <span class="keyword">bool</span> bSeamless, <span class="keyword">bool</span> bAbsolute)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 处理无缝地图切换玩家的初始化，处理逻辑和 InitNewPlayer 相似 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">InitSeamlessTravelPlayer</span><span class="params">(AController* NewController)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在无缝地图切换期间，当 PlayerController 更换为新控制器时调用 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintImplementableEvent, Category=Game, meta=(DisplayName=<span class="string">&quot;OnSwapPlayerControllers&quot;</span>, ScriptName=<span class="string">&quot;OnSwapPlayerControllers&quot;</span>))</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">K2_OnSwapPlayerControllers</span><span class="params">(APlayerController* OldPC, APlayerController* NewPC)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 做一些 以给定变换 生成给定类的玩家控制器的工作 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> APlayerController* <span class="title">SpawnPlayerControllerCommon</span><span class="params">(ENetRole InRemoteRole, FVector <span class="keyword">const</span>&amp; SpawnLocation, FRotator <span class="keyword">const</span>&amp; SpawnRotation, TSubclassOf&lt;APlayerController&gt; InPlayerControllerClass)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">/** 游戏是否使用 SeamlessTravel() 执行地图切换，该函数在后台加载，且不断开与客户端的连接 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadWrite, Category=GameMode)</span><br><span class="line">	uint32 bUseSeamlessTravel : <span class="number">1</span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 玩家在登陆时是否应该立即生成，或是在手动生成以前一直作为观众存在 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category=GameMode)</span><br><span class="line">	uint32 bStartPlayersAsSpectators : <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 游戏是否可以停止 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadWrite, Category=GameMode)</span><br><span class="line">	uint32 bPauseable : <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在游戏取消暂停前检查的代理列表 */</span></span><br><span class="line">	TArray&lt;FCanUnpause&gt; Pausers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">// 隐藏函数</span></span><br><span class="line">	<span class="built_in">HIDE_ACTOR_TRANSFORM_FUNCTIONS</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>可以看出，&quot;GameModeBase&quot; 的代码主要分为几大块：<strong>初始化游戏</strong>，由游戏生成的类的访问器，当前状态的访问器，<strong>开始 / 解析 / 重置游戏</strong>，<strong>玩家加入和离开相关</strong>，<strong>生成玩家的 pawn</strong>，引擎挂钩。另外，&quot;GameMode&quot; 实例只在服务器中生成，且关卡唯一。</p><h3 id="agamemode"><a class="anchor" href="#agamemode">#</a> AGameMode</h3><p>&quot;AGameMode&quot; 作为 &quot;AGameModeBase&quot; 最为常用的子类。我们不妨也来看看其扩展了什么功能 😃</p><p>![AGameMode](D:\blog\source_posts\UE4\UE4CPP\Gameplay —— AGameMode &amp; AGameState &amp; APlayerState\AGameMode.png)</p><p>虚幻说，&quot;AGameMode&quot; 其实就是用于多人匹配游戏的 &quot;AGameModeBase&quot; 的子类。拥有拾取生成点和匹配状态的默认行为。如果只是开发的是单人游戏，可以直接继承 &quot;AGameModeBase&quot;。</p><p>那咱在来看看 &quot;AGameMode&quot; 都给我们提供了什么多人游戏的接口。</p><p></p><figure class="highlight c++"><figcaption><span>AGameMode</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameMode.h</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">UCLASS</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ENGINE_API</span> <span class="title">AGameMode</span> :</span> <span class="keyword">public</span> AGameModeBase</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_UCLASS_BODY</span>()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 处理匹配状态机的代码</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回当前匹配状态，访问器以保护状态机流 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=<span class="string">&quot;Game&quot;</span>)</span><br><span class="line">	<span class="function">FName <span class="title">GetMatchState</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> MatchState; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果匹配状态时 &quot;InProress&quot; 或其他gameplay状态，则返回真 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=<span class="string">&quot;Game&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">IsMatchInProgress</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 从 WaitingToStart 转换到 InProgress。你可以手动调用此函数，如果 ReadyToStartMatch 返回真，也将调用该函数 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=<span class="string">&quot;Game&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">StartMatch</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 从 InProgress 转换到 WaitingPostMatch。你可以手动调用此函数，如果 ReadyToEndMatch 返回真，也将调用该函数 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=<span class="string">&quot;Game&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">EndMatch</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 重新开始此游戏，通过默认 travel 到当前地图 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=<span class="string">&quot;Game&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">RestartGame</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 报告由于不可恢复的错误导致匹配失败 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=<span class="string">&quot;Game&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">AbortMatch</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 我们当前出于的匹配状态 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	FName MatchState;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 更新匹配状态，并调用适当的转换函数 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SetMatchState</span><span class="params">(FName NewState)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 可重写的虚函数，用于在 GameState 和 Blueprints 获取 SetMatchState 调用之前，调用适当的转换函数 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnMatchStateSet</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 蓝图可实现事件，用于对匹配状态改变做出反应 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintImplementableEvent, Category=<span class="string">&quot;Game&quot;</span>, meta=(DisplayName=<span class="string">&quot;OnSetMatchState&quot;</span>, ScriptName=<span class="string">&quot;OnSetMatchState&quot;</span>))</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">K2_OnSetMatchState</span><span class="params">(FName NewState)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 游戏应重写这些函数，以处理其特定于游戏的逻辑</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在状态转换为 WaitingToStart 时调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleMatchIsWaitingToStart</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果已准备好 StartMatch，则返回真。游戏应重写此函数 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintNativeEvent, Category=<span class="string">&quot;Game&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ReadyToStartMatch</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当状态改变为 InProgress 时调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleMatchHasStarted</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果已准备好 EndMatch，则返回真。游戏应重写此函数 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintNativeEvent, Category=<span class="string">&quot;Game&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">ReadyToEndMatch</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当地图转换为 WaitingPostMatch 时调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleMatchHasEnded</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当匹配转换为 LeavingMap 时调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleLeavingMap</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当匹配转换为 Aborted 时调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleMatchAborted</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当第一个玩家登录时，游戏是否应该马上开始。影响 ReadyToStartMatch 的默认行为 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category=<span class="string">&quot;GameMode&quot;</span>)</span><br><span class="line">	uint32 bDelayedStart : <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 旁观者的当前数量 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadOnly, Category=GameMode)</span><br><span class="line">	int32 NumSpectators;    </span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当前人类玩家数 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadOnly, Category=GameMode)</span><br><span class="line">	int32 NumPlayers;    </span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 非人类玩家数(AI控制但作为玩家参与游戏) */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadOnly, Category=GameMode)</span><br><span class="line">	int32 NumBots;    </span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在玩家死后可以重生的最小时间 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category=GameMode, meta=(DisplayName=<span class="string">&quot;Minimum Respawn Delay&quot;</span>))</span><br><span class="line">	<span class="keyword">float</span> MinRespawnDelay;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 玩家数量，他们从上一张地图中传送过来 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadOnly, Category=GameMode)</span><br><span class="line">	int32 NumTravellingPlayers;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 包含描述本地化游戏不可知消息的字符串 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TSubclassOf&lt;<span class="class"><span class="keyword">class</span> <span class="title">ULocalMessage</span>&gt;</span> EngineMessageClass;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 与服务器断开连接的玩家的 PlayerStates (保存以便重新连接) */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TArray&lt;<span class="class"><span class="keyword">class</span> <span class="title">APlayerState</span>*&gt;</span> InactivePlayerArray;    </span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 玩家登出后，PlayerState 将停留在非活动状态的时间 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, Category=GameMode)</span><br><span class="line">	<span class="keyword">float</span> InactivePlayerStateLifeSpan;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在我们提出最老的玩家之前，非活跃状态玩家的最大数量 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, Category = GameMode)</span><br><span class="line">	int32 MaxInactivePlayers;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果为真，独立服务器将在 HandleMatchHasStarted/HandleMatchHasStopped 被调用时录制重播 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(config)</span><br><span class="line">	<span class="keyword">bool</span> bHandleDedicatedServerReplays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 获取本地地址 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> FString <span class="title">GetNetworkNumber</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 将从正确的计数中移除控制器，然后将其添加到观众数量中 **/</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">PlayerSwitchedToSpectatorOnly</span><span class="params">(APlayerController* PC)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 从 player/spectator/tranistioning 的正确计数中移除传入的玩家控制器 **/</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">RemovePlayerControllerFromPlayerCount</span><span class="params">(APlayerController* PC)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.14</span>, <span class="string">&quot;Deprecated in favor of PreloadContentForURL on GameInstance&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> FString <span class="title">GetDefaultGameClassPath</span><span class="params">(<span class="keyword">const</span> FString&amp; MapName, <span class="keyword">const</span> FString&amp; Options, <span class="keyword">const</span> FString&amp; Portal)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.14</span>, <span class="string">&quot;Deprecated in favor of OverrideGameModeClass on GameInstance&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> TSubclassOf&lt;AGameMode&gt; <span class="title">GetGameModeClass</span><span class="params">(<span class="keyword">const</span> FString&amp; MapName, <span class="keyword">const</span> FString&amp; Options, <span class="keyword">const</span> FString&amp; Portal)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.14</span>, <span class="string">&quot;Deprecated in favor of GetGameModeForName on GameMapsSettings&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">static</span> FString <span class="title">StaticGetFullGameClassName</span><span class="params">(FString <span class="keyword">const</span>&amp; Str)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果我们想 travel_absolute 则返回真，默认由 RestartGame 使用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">GetTravelType</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.14</span>, <span class="string">&quot;SendPlayer is not in use, call ClientTravel directly instead&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SendPlayer</span><span class="params">( APlayerController* aPlayer, <span class="keyword">const</span> FString&amp; URL )</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.14</span>, <span class="string">&quot;StartNewPlayer has been split into InitializeHUDForPlayer and HandleStartingNewPlayer&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">StartNewPlayer</span><span class="params">(APlayerController* NewPlayer)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 执行命令，向所有玩家广播一个字符串 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(Exec, BlueprintCallable, Category = AI)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Say</span><span class="params">(<span class="keyword">const</span> FString&amp; Msg)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 更改运行游戏的综合带宽限制。4.17版本后，AsyncIOBandwidthLimit 不再可配置*/</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.17</span>, <span class="string">&quot;AsyncIOBandwidthLimit is no longer configurable&quot;</span>)</span><br><span class="line">	<span class="built_in">UFUNCTION</span>(exec)	</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SetBandwidthLimit</span><span class="params">(<span class="keyword">float</span> AsyncIOBandwidthLimit)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 向所有玩家广播一个字符串 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Broadcast</span><span class="params">( AActor* Sender, <span class="keyword">const</span> FString&amp; Msg, FName Type = NAME_None )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 向所有玩家广播一个本地化消息</span></span><br><span class="line"><span class="comment">	 * 大多数消息处理 0 到 2 个相关的 PlayerStates</span></span><br><span class="line"><span class="comment">	 * LocalMessage 类定义如何使用 PlayerState 和可选的 actor</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">BroadcastLocalized</span><span class="params">( AActor* Sender, TSubclassOf&lt;ULocalMessage&gt; Message, int32 Switch = <span class="number">0</span>, APlayerState* RelatedPlayerState_1 = <span class="literal">NULL</span>, APlayerState* RelatedPlayerState_2 = <span class="literal">NULL</span>, UObject* OptionalObject = <span class="literal">NULL</span> )</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 添加 PlayerState 到非活跃列表中，并从活跃列表中移除 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">AddInactivePlayer</span><span class="params">(APlayerState* PlayerState, APlayerController* PC)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 尝试寻找一个非活跃的 PlayerStateAttempt，并将其关联到传入 PC 中，成功则返回真 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">FindInactivePlayer</span><span class="params">(APlayerController* PC)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 作为非活跃玩家处理的一部分，通过 OldPlayerState 中的值，重写 PC 的 PlayerState */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OverridePlayerState</span><span class="params">(APlayerController* PC, APlayerState* OldPlayerState)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在服务器改变时，调用传入玩家控制器的 SetViewTarget */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SetSeamlessTravelViewTarget</span><span class="params">(APlayerController* PC)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当此 PC 出于电影模式时，且其 matinee 被用户取消时调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">MatineeCancelled</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 卸载上一个关卡前，从 CommitMapChange 中调用。用于异步关卡流</span></span><br><span class="line"><span class="comment">	 * @param PreviousMapName - 上一个主关卡的名称</span></span><br><span class="line"><span class="comment">	 * @param NextMapName - 要流加载的主关卡名称</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PreCommitMapChange</span><span class="params">(<span class="keyword">const</span> FString&amp; PreviousMapName, <span class="keyword">const</span> FString&amp; NextMapName)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在卸载上一个关卡且读取新关卡与子关卡后，从 CommitMapChange 中调用。用于异步加载关卡流 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PostCommitMapChange</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 调用 PostLogin() 前，连接关闭时调用 </span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param ConnectionUniqueId 连接的唯一id，如果已知 (可能很早就知道了)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">NotifyPendingConnectionLost</span><span class="params">(<span class="keyword">const</span> FUniqueNetIdRepl&amp; ConnectionUniqueId)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在会话断开连接前，处理玩家断开连接 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleDisconnect</span><span class="params">(UWorld* InWorld, UNetDriver* NetDriver)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//~ Begin AActor Interface</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Tick</span><span class="params">(<span class="keyword">float</span> DeltaSeconds)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="comment">//~ End AActor Interface</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//~ Begin AGameModeBase Interface</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">InitGame</span><span class="params">(<span class="keyword">const</span> FString&amp; MapName, <span class="keyword">const</span> FString&amp; Options, FString&amp; ErrorMessage)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">StartPlay</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HasMatchStarted</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="comment">/** Returns true if the match state is WaitingPostMatch or later */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HasMatchEnded</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PostLogin</span><span class="params">(APlayerController* NewPlayer)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Logout</span><span class="params">(AController* Exiting)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> int32 <span class="title">GetNumPlayers</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> int32 <span class="title">GetNumSpectators</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">IsHandlingReplays</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleStartingNewPlayer_Implementation</span><span class="params">(APlayerController* NewPlayer)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">PlayerCanRestart_Implementation</span><span class="params">(APlayerController* Player)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PostSeamlessTravel</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleSeamlessTravelPlayer</span><span class="params">(AController*&amp; C)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">InitSeamlessTravelPlayer</span><span class="params">(AController* NewController)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">CanServerTravel</span><span class="params">(<span class="keyword">const</span> FString&amp; URL, <span class="keyword">bool</span> bAbsolute)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">StartToLeaveMap</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">SpawnPlayerFromSimulate</span><span class="params">(<span class="keyword">const</span> FVector&amp; NewLocation, <span class="keyword">const</span> FRotator&amp; NewRotation)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="comment">//~ End AGameModeBase Interface</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>不难发现，&quot;AGameMode&quot; 主要就是在处理 &quot;GameSession&quot; 服务器匹配，玩家登入登出等逻辑。 &quot;AGameMode&quot; 中的函数作用，我们上面的源码分析基本都写了。至于函数的调用顺序，虚幻借助了 &quot;MatchState&quot; 状态机来完成，调用过程如下：</p><p>![GameMode 流程图](D:\blog\source_posts\UE4\UE4CPP\Gameplay —— AGameMode &amp; AGameState &amp; APlayerState\GameMode 流程图.png)</p><h3 id="agamestatebase"><a class="anchor" href="#agamestatebase">#</a> AGameStateBase</h3><p>&quot;GameState&quot; 是用来描述游戏状态的，由 &quot;GameModeBase&quot; 生成，管理游戏的全局状态，存在客户端和服务器中，且完全复制。如：服务器时间等。我们直接看源码：</p><p></p><figure class="highlight c++"><figcaption><span>AGameStateBase</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameStateBase.h</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">UCLASS</span>(config=Game, notplaceable, BlueprintType, Blueprintable)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ENGINE_API</span> <span class="title">AGameStateBase</span> :</span> <span class="keyword">public</span> AInfo</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_UCLASS_BODY</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">//~=============================================================================</span></span><br><span class="line">	<span class="comment">// General accessors and variables (通常访问器与变量)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 服务器游戏模式类，由 GameModeBase 访问 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient, BlueprintReadOnly, Category=GameState, ReplicatedUsing=OnRep_GameModeClass)</span><br><span class="line">	TSubclassOf&lt;AGameModeBase&gt;  GameModeClass;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当前游戏模式实例，只存在于服务器。非权威的客户端为空 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient, BlueprintReadOnly, Category=GameState)</span><br><span class="line">	AGameModeBase* AuthorityGameMode;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 用于旁观者的类，由 GameModeBase 访问 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient, BlueprintReadOnly, Category=GameState, ReplicatedUsing=OnRep_SpectatorClass)</span><br><span class="line">	TSubclassOf&lt;ASpectatorPawn&gt; SpectatorClass;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 所有 PlayerStates 的数组，存在于服务器和客户端中 ( PlayerStates 始终相关) */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient, BlueprintReadOnly, Category=GameState)</span><br><span class="line">	TArray&lt;APlayerState*&gt; PlayerArray;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 允许 game states 对异步读取的资产包做出反应 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">AsyncPackageLoaded</span><span class="params">(UObject* Package)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 辅助函数，返回 对应于此 GameState 的 GameModeBase 类的默认对象(CDO)。编辑此对象是不安全的 */</span></span><br><span class="line">	<span class="function"><span class="keyword">const</span> AGameModeBase* <span class="title">GetDefaultGameMode</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 辅助模板，返回 GameModeBase 的默认对象，并转换为特定的类型，转换失败返回 nullptr */</span></span><br><span class="line">	<span class="function"><span class="keyword">template</span>&lt; class T &gt;</span></span><br><span class="line"><span class="function">	<span class="keyword">const</span> T* <span class="title">GetDefaultGameMode</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Cast&lt;T&gt;(<span class="built_in">GetDefaultGameMode</span>());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回服务器的模拟 TimeSeconds，将在服务器和客户端中同步 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=GameState)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">float</span> <span class="title">GetServerWorldTimeSeconds</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果世界已开始游戏(已调用 actors 的 Beginplay 函数)，返回真 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=GameState)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HasBegunPlay</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果世界已开始匹配(已调用 MatchStarted 回调) */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=GameState)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HasMatchStarted</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果匹配可以停止返回真，默认为 false */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category = Game)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HasMatchEnded</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回玩家开始所需的时间 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=GameState)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">float</span> <span class="title">GetPlayerStartTime</span><span class="params">(AController* Controller)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回玩家重生所需的时间 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=GameState)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">float</span> <span class="title">GetPlayerRespawnDelay</span><span class="params">(AController* Controller)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">GetLifetimeReplicatedProps</span><span class="params">(TArray&lt; FLifetimeProperty &gt; &amp;OutLifetimeProps)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回特定唯一玩家 id 的 PlayerState */</span></span><br><span class="line">	<span class="function">APlayerState* <span class="title">GetPlayerStateFromUniqueNetId</span><span class="params">(<span class="keyword">const</span> FUniqueNetIdWrapper&amp; InPlayerId)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//~=============================================================================</span></span><br><span class="line">	<span class="comment">// Interaction with GameModeBase (与 GameModeBase 的交互)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在 GameClass 属性被设置时调用 (在服务器启动时，在客户端中被复制变量之后) */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ReceivedGameModeClass</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在 SpectatorClass 属性被设置时调用 (在服务器启动时，在客户端中被复制变量之后) */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ReceivedSpectatorClass</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在无缝关卡切换期间调用两次(加载过渡地图时调用一次，加载目标地图时调用一次) */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SeamlessTravelTransitionCheckpoint</span><span class="params">(<span class="keyword">bool</span> bToTransitionMap)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 添加 PlayerState 到 玩家数组(PlayerArray) */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">AddPlayerState</span><span class="params">(APlayerState* PlayerState)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 从玩家数组(PlayerArray)中移除 PlayerState */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">RemovePlayerState</span><span class="params">(APlayerState* PlayerState)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 由游戏模式调用，以设置开始游戏的标记 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleBeginPlay</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//~ Begin AActor Interface</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PostInitializeComponents</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="comment">//~ End AActor Interface</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** GameModeClass 的通知回调 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>()</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnRep_GameModeClass</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当我们接收旁观者类时的回调 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>()</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnRep_SpectatorClass</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 默认调用 BeginPlay 和 StartMatch */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>()</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnRep_ReplicatedHasBegunPlay</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当 GameModeBase-&gt;StartPlay 被调用时复制，所以客户端也将开始游戏 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient, ReplicatedUsing = OnRep_ReplicatedHasBegunPlay)</span><br><span class="line">	<span class="keyword">bool</span> bReplicatedHasBegunPlay;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 定期调用以更新 ReplicatedWorldTimeSeconds */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">UpdateServerTimeSeconds</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 允许客户端计算 ServerWorldTimeSecondsDelta */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>()</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnRep_ReplicatedWorldTimeSeconds</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 服务器时间(单位为秒，从关卡开始游戏时计时，暂停游戏时也会跟着暂停)，用于同步动画和 gameplay */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient, ReplicatedUsing=OnRep_ReplicatedWorldTimeSeconds)</span><br><span class="line">	<span class="keyword">float</span> ReplicatedWorldTimeSeconds;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 本地世界的时间与服务器时间的差值 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Transient)</span><br><span class="line">	<span class="keyword">float</span> ServerWorldTimeSecondsDelta;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 服务器从世界中更新复制时间的频率，设置为 0，以禁用周期性更新 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditDefaultsOnly, Category=GameState)</span><br><span class="line">	<span class="keyword">float</span> ServerWorldTimeSecondsUpdateFrequency;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 用于高效管理 UpdateServerTimeSeconds 计时器的句柄 */</span></span><br><span class="line">	FTimerHandle TimerHandle_UpdateServerTimeSeconds;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 用于平滑平均的 已计算的服务器世界时间增量的 累计和 */</span></span><br><span class="line">	<span class="keyword">double</span> SumServerWorldTimeSecondsDelta;</span><br><span class="line">	<span class="comment">/** 累积 SumServerWorldTimeSecondsDelta 中的，服务器世界时间增量的数量。用于计算平均值 */</span></span><br><span class="line">	uint32 NumServerWorldTimeSecondsDeltas;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">// 隐藏函数</span></span><br><span class="line">	<span class="built_in">HIDE_ACTOR_TRANSFORM_FUNCTIONS</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">UDemoNetDriver</span>;</span></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">FReplayHelper</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>&quot;AGameStateBase&quot; 的结构非常简单，基本都是 &quot;Transient&quot; 临时数据 (不保存)，其中包括：GameMode，SpectatorPawn，PlayerState 的描述或实例，游戏开始标记，服务器时间以更新时间的变量。&quot;GameState&quot; 的作用就是<strong>与 &quot;GameMode&quot; 交互</strong>，并将一些<strong>游戏运行时必须从服务器中同步到客户端的全局状态</strong>。</p><h3 id="agamestate"><a class="anchor" href="#agamestate">#</a> AGameState</h3><p>&quot;AGameState&quot; 是 &quot;AGameStateBase&quot; 的子类，用于多人匹配游戏。主要是配合 &quot;AGameMode&quot; 使用。</p><p></p><figure class="highlight c++"><figcaption><span>AGameState</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameState.h</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">UCLASS</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ENGINE_API</span> <span class="title">AGameState</span> :</span> <span class="keyword">public</span> AGameStateBase</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_UCLASS_BODY</span>()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 处理 MatchState 状态机的代码</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回当前匹配状态，此函数作为保护状态机流的访问器 */</span></span><br><span class="line">	<span class="function">FName <span class="title">GetMatchState</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> MatchState; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 是否出于 InProgress 状态(正在游戏中) */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">IsMatchInProgress</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 更新匹配状态，并调用合适的转换函数，只存在于服务器 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetMatchState</span><span class="params">(FName NewState)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 我们当前处于什么匹配状态 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(ReplicatedUsing=OnRep_MatchState, BlueprintReadOnly, VisibleInstanceOnly, Category = GameState)</span><br><span class="line">	FName MatchState;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 上一个匹配状态，用于处理每帧是否发生多次转换 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadOnly, VisibleInstanceOnly, Category = GameState)</span><br><span class="line">	FName PreviousMatchState;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当状态转换到 WaitingToStart 时调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleMatchIsWaitingToStart</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当状态转换到 InProgress 时调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleMatchHasStarted</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当状态转换到 WaitingPostMatch 时调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleMatchHasEnded</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当状态转换到 LeavingMap 时调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleLeavingMap</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 匹配开始后已经过的时间Elapsed game time since match has started. */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(replicatedUsing=OnRep_ElapsedTime, BlueprintReadOnly, Category = GameState)</span><br><span class="line">	int32 ElapsedTime;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 匹配状态改变的回调 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>()</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnRep_MatchState</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在时间更新时，让客户端有机会执行一些逻辑 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>()</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnRep_ElapsedTime</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 定时调用，在子类中重写 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">DefaultTimer</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.14</span>, <span class="string">&quot;ShouldShowGore is deprecated, it is not supported by newer assets&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">ShouldShowGore</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//~ Begin AActor Interface</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PostInitializeComponents</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="comment">//~ End AActor Interface</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//~ Begin AGameStateBase Interface</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ReceivedGameModeClass</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HasMatchStarted</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="comment">/** 如果匹配状态是 WaitPostMatch 或之后的状态，则返回真 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HasMatchEnded</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleBeginPlay</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">float</span> <span class="title">GetPlayerStartTime</span><span class="params">(class AController* Controller)</span> <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">float</span> <span class="title">GetPlayerRespawnDelay</span><span class="params">(class AController* Controller)</span> <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="comment">//~ End AGameStateBase Interface</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 用于高效处理 DefaultTimer 的计时器句柄 */</span></span><br><span class="line">	FTimerHandle TimerHandle_DefaultTimer;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>流程跟 &quot;AGameMode&quot; 一致，主要是在状态机发生变化时做出对应的反应。难的不是源码，是我们要针对不同游戏，设计满足需求的 &quot;GameState&quot; 的子类。但理解源码绝对是基础中的基础。接下来看看 &quot;APlayerState&quot; 吧</p><h3 id="aplayerstate"><a class="anchor" href="#aplayerstate">#</a> APlayerState</h3><p>&quot;PlayerState&quot; 在服务器 (或独立游戏) 中为每个玩家创建一个 (即: 5 个玩家将有 5 个 PlayerState)。将所有玩家的 PlayerState 复制到所有客户端中，包含所有玩家的网络游戏相关信息，如：玩家名称，分数等。以下是源码解析：</p><p></p><figure class="highlight c++"><figcaption><span>APlayerState</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UCLASS</span>(BlueprintType, Blueprintable, notplaceable)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ENGINE_API</span> <span class="title">APlayerState</span> :</span> <span class="keyword">public</span> AInfo</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_UCLASS_BODY</span>()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 用于处理属性弃用的析构函数，请在所有弃用属性消失后移除</span></span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">APlayerState</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 玩家的当前分数 */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.25</span>, <span class="string">&quot;This member will be made private. Use GetScore or SetScore instead.&quot;</span>)</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(ReplicatedUsing=OnRep_Score, BlueprintReadOnly, Category=PlayerState)</span><br><span class="line">	<span class="keyword">float</span> Score;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 玩家的唯一网络id，实际值因当前在线子系统而异 */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.25</span>, <span class="string">&quot;This member will be made private. Use GetPlayerId or SetPlayerId instead.&quot;</span>)</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(ReplicatedUsing=OnRep_PlayerId, BlueprintReadOnly, Category=PlayerState)</span><br><span class="line">	int32 PlayerId;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 复制此玩家的压缩 ping (以毫秒为单位，保留 ping 除以 4) */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.25</span>, <span class="string">&quot;This member will be made private. Use GetPing or SetPing instead.&quot;</span>)</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Replicated, BlueprintReadOnly, Category=PlayerState)</span><br><span class="line">	uint8 Ping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">/** 当前的正在填充的 PingBucket(每秒一个桶，纪录当前秒的ping，只保存4秒的ping数据) 索引 */</span></span><br><span class="line">	uint8			CurPingBucket;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 此玩家的复制 ping 值是否自动更新</span></span><br><span class="line"><span class="comment">	 * PlayerState 默认情况下始终是网络相关的，因此在有许多玩家正在复制的情况下，</span></span><br><span class="line"><span class="comment">	 * 如果客户端不需要 ping 值，则复制 ping 值可能会在服务器上造成额外的不必要开销</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditDefaultsOnly, Category=PlayerState)</span><br><span class="line">	uint8 bShouldUpdateReplicatedPing:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">/** 此玩家是否为旁观者 */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.25</span>, <span class="string">&quot;This member will be made private. Use IsSpectator or SetIsSpectator instead.&quot;</span>)</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Replicated, BlueprintReadOnly, Category=PlayerState)</span><br><span class="line">	uint8 bIsSpectator:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此玩家是否只可以是旁观者 */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.25</span>, <span class="string">&quot;This member will be made private. Use IsOnlyASpectator or SetIsOnlyASpectator instead.&quot;</span>)</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Replicated)</span><br><span class="line">	uint8 bOnlySpectator:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此 PlayerState 是否与 AIController 关联 */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.25</span>, <span class="string">&quot;This member will be made private. Use IsABot or SetIsABot instead.&quot;</span>)</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Replicated, BlueprintReadOnly, Category=PlayerState)</span><br><span class="line">	uint8 bIsABot:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 客户端标志，此玩家是否已经被欢迎(玩家进入消息) */</span></span><br><span class="line">	uint8 bHasBeenWelcomed:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此 PlayerState 是否来自于 GameMode 的 InacivePlayerArray */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.25</span>, <span class="string">&quot;This member will be made private. Use IsInactive or SetIsInactive instead.&quot;</span>)</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(ReplicatedUsing=OnRep_bIsInactive)</span><br><span class="line">	uint8 bIsInactive:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 表明此 PlayerState 来自于上一个无缝切换的关卡，等待玩家完成转换后再创建新的</span></span><br><span class="line"><span class="comment">	 * 这是用来避免在玩家离开时，仍在 InactivePlayerArray 中保留 PlayerState</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.25</span>, <span class="string">&quot;This member will be made private. Use IsFromPreviousLevel or SetIsFromPreviousLevel instead.&quot;</span>)</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Replicated)</span><br><span class="line">	uint8 bFromPreviousLevel:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 如果为真，GetPlayerName() 将调用虚函数 GetPlayerNameCustom() 以允许自定义访问</span></span><br><span class="line"><span class="comment">	uint8 bUseCustomPlayerNames : 1;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	/** 首次创建此 PlayerState 后，服务器已经过的时间。  */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.25</span>, <span class="string">&quot;This member will be made private. Use GetStartTime or SetStartTime instead.&quot;</span>)</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(Replicated)</span><br><span class="line">	int32 StartTime;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 用于发送可本地化的游戏不可知消息 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	TSubclassOf&lt;<span class="class"><span class="keyword">class</span> <span class="title">ULocalMessage</span>&gt;</span> EngineMessageClass;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** float 型的精确 ping 值 (在复制的ping中会被舍入和压缩) */</span></span><br><span class="line">	<span class="keyword">float</span> ExactPing;</span><br><span class="line">	<span class="keyword">float</span> ExactPingV2;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 用于将 InactivePlayerState 匹配到重写加入的 PlayerController */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>()</span><br><span class="line">	FString SavedNetworkAddress;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 提供给网络使用的id，唯一标识一个玩家</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">NOTE:</span> 此属性的内部不应该暴露给玩家，因为它是临时且不透明的(即.它可能是某些东西加上 日期/时间)</span></span><br><span class="line"><span class="comment">	 * 不过，可以使用并传递此属性</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="built_in">UE_DEPRECATED</span>(<span class="number">4.25</span>, <span class="string">&quot;This member will be made private. Use GetUniqueId or SetUniqueId instead.&quot;</span>)</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(ReplicatedUsing=OnRep_UniqueId)</span><br><span class="line">	FUniqueNetIdRepl UniqueId; </span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 玩家创建/离开时，需要加入/删除的会话 */</span></span><br><span class="line">	FName SessionName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">	<span class="keyword">friend</span> <span class="class"><span class="keyword">struct</span> <span class="title">FSetPlayerStatePawn</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此 PlayerState 控制的 pawn */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintReadOnly, Category=PlayerState, meta=(AllowPrivateAccess=<span class="string">&quot;true&quot;</span>))</span><br><span class="line">	APawn* PawnPrivate;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 保存最后 4 秒的 ping 数据(每个 &#x27;bucket&#x27; 一秒)</span></span><br><span class="line"><span class="comment">	 * 以这种方式储存，以便在不占用大量空间的情况下计算移动平均值，同时还能接受 ping 更新频率的变化</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	PingAvgData		PingBucket[<span class="number">4</span>];</span><br><span class="line">	PingAvgDataV2	PingBucketV2[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当前 PingBucket 开始填充的时间戳 */</span></span><br><span class="line">	<span class="keyword">float</span>			CurPingBucketTimestamp;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 玩家名称，如果没有则为空 */</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(ReplicatedUsing = OnRep_PlayerName)</span><br><span class="line">	FString PlayerNamePrivate;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 上一个玩家名称，保存在客户端中以检测玩家名称更改 */</span></span><br><span class="line">	FString OldNamePrivate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">/** 复制通知回调 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>()</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnRep_Score</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UFUNCTION</span>()</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnRep_PlayerName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UFUNCTION</span>()</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnRep_bIsInactive</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UFUNCTION</span>()</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnRep_PlayerId</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UFUNCTION</span>()</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnRep_UniqueId</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//~ Begin AActor Interface</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PostInitializeComponents</span><span class="params">()</span> <span class="keyword">override</span></span>; </span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Destroyed</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Reset</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> FString <span class="title">GetHumanReadableName</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="comment">//~ End AActor Interface</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回此 PlayerState 控制的 pawn */</span></span><br><span class="line">	<span class="function">APawn* <span class="title">GetPawn</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> PawnPrivate; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 辅助函数，返回模板类型的 Pawn，转换失败返回 nullptr */</span></span><br><span class="line">	<span class="function"><span class="keyword">template</span>&lt;class T&gt;</span></span><br><span class="line"><span class="function">	T* <span class="title">GetPawn</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> Cast&lt;T&gt;(PawnPrivate); &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 第一次复制控制器的 PlayerState 时，由控制器调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ClientInitialize</span><span class="params">(class AController* C)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 从网络驱动中接收客户端(客户端和服务端)的 ping 更新</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">NOTE:</span> 这会更频繁地在客户端更新，因此客户端 ping 经常与服务器中显示的不一样</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">UpdatePing</span><span class="params">(<span class="keyword">float</span> InPing)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 基于收集的 ping 数据，每秒重写计算一次复制的 ping 值(客户端和服务端) */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">RecalculateAvgPing</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回是否应该广播玩家欢迎/离开消息</span></span><br><span class="line"><span class="comment">	 * 当前条件: 必须是人类玩家且是网络游戏</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">ShouldBroadCastWelcomeMessage</span><span class="params">(<span class="keyword">bool</span> bExiting = <span class="literal">false</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 设置玩家名称为 S */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SetPlayerName</span><span class="params">(<span class="keyword">const</span> FString&amp; S)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 本地设置玩家名称为 S，不激活网络更新 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SetPlayerNameInternal</span><span class="params">(<span class="keyword">const</span> FString&amp; S)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回当前玩家名称 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintPure, Category = PlayerState)</span><br><span class="line">	<span class="function">FString <span class="title">GetPlayerName</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 自定义访问玩家名称，只有在 bUseCustomPlayerNames 为真时调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> FString <span class="title">GetPlayerNameCustom</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 返回之前的玩家名称 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> FString <span class="title">GetOldPlayerName</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 设置玩家名称为 S*/</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SetOldPlayerName</span><span class="params">(<span class="keyword">const</span> FString&amp; S)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 将 传入的网络唯一id 与 此玩家关联 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SetUniqueId</span><span class="params">(<span class="keyword">const</span> TSharedPtr&lt;<span class="keyword">const</span> FUniqueNetId&gt;&amp; InUniqueId)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * 通过网络子系统注册一个玩家</span></span><br><span class="line"><span class="comment">	 * @param bWasFromInvite 此玩家是否直接被激活</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">RegisterPlayerWithSession</span><span class="params">(<span class="keyword">bool</span> bWasFromInvite)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 通过网络子系统注销一个玩家 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">UnregisterPlayerWithSession</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 创建复制 PlayerStateCreate (用于保存非活跃 PlayerState)	*/</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> class APlayerState* <span class="title">Duplicate</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当所属玩家断开连接时，在服务器中调用。默认情况下，此函数销毁此 PlayerState */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnDeactivated</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当所属玩家重新连接，且该玩家在活跃玩家数组中时，在服务器中调用。 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnReactivated</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 当在另一端初始化玩家时，在 SeamlessTravel 中调用，复制应该保存的属性到新的 PlayerState 中 called by seamless travel when initializing a player on the other side - copy properties to the new PlayerState that should persist */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SeamlessTravelTo</span><span class="params">(class APlayerState* NewPlayerState)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 此 PlayerState 是否为主玩家(即.非分屏玩家) */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">IsPrimaryPlayer</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">GetLifetimeReplicatedProps</span><span class="params">(TArray&lt; FLifetimeProperty &gt; &amp; OutLifetimeProps)</span> <span class="keyword">const</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 调用 OverrideWith 并触发 OnOverrideWith，以便蓝图拓展 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">DispatchOverrideWith</span><span class="params">(APlayerState* PlayerState)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">DispatchCopyProperties</span><span class="params">(APlayerState* PlayerState)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OverrideWith</span><span class="params">(APlayerState* PlayerState)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 拷贝需要保存在非活跃 PlayerState 中的属性 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">CopyProperties</span><span class="params">(APlayerState* PlayerState)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 可在蓝图子类中实现，以便重连时从旧的 PlayerState 中移动更多属性到新的 PlayerState 中 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintImplementableEvent, Category = PlayerState, meta = (DisplayName = <span class="string">&quot;OverrideWith&quot;</span>))</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ReceiveOverrideWith</span><span class="params">(APlayerState* OldPlayerState)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 可在蓝图子类中实现，以便切换到新关卡时从旧的 PlayerState 中移动更多属性到新的 PlayerState 中 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintImplementableEvent, Category = PlayerState, meta = (DisplayName = <span class="string">&quot;CopyProperties&quot;</span>))</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ReceiveCopyProperties</span><span class="params">(APlayerState* NewPlayerState)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 设置 复制 ping 值是否自动更新 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetShouldUpdateReplicatedPing</span><span class="params">(<span class="keyword">bool</span> bInShouldUpdateReplicatedPing)</span> </span>&#123; bShouldUpdateReplicatedPing = bInShouldUpdateReplicatedPing; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 在接收玩家名称后调用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">HandleWelcomeMessage</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">// 隐藏函数</span></span><br><span class="line">	<span class="built_in">HIDE_ACTOR_TRANSFORM_FUNCTIONS</span>();</span><br><span class="line"></span><br><span class="line">PRAGMA_DISABLE_DEPRECATION_WARNINGS	<span class="comment">// 禁用 DEPRECATION(弃用) 提醒</span></span><br><span class="line">	<span class="comment">//~ Begin Methods for Replicated Members (读写复制成员的方法)</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 获取分数文本值 */</span></span><br><span class="line">	<span class="function"><span class="keyword">float</span> <span class="title">GetScore</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Score;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 设置 Score 的值，不引起此实例的其他副作用 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetScore</span><span class="params">(<span class="keyword">const</span> <span class="keyword">float</span> NewScore)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ..... 与 Score 类似，省略 PlayerId，Ping，bIsSpectator，bOnlySpectator，bIsABot，bIsInactive，bFromPreviousLevel，StartTime，UniqueId 的读写函数 (340行)</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment">//~ End Methods for Replicated Members.</span></span><br><span class="line">PRAGMA_ENABLE_DEPRECATION_WARNINGS	<span class="comment">// 启用 DEPRECATION(弃用) 提醒</span></span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>可以看出，&quot;APlayerState&quot; 中的数据基本就是游戏运行中会产生的，关于某个玩家的状态的数据。如：某个玩家的得分，唯一网络 id，ping 值，是否为旁观者等，这些信息会被复制到所有客户端中。可能又会有同学问了：我这些不能直接定义在 PlayerController 上吗？就好比 Score，我定义在 PlayerController 中也一样可以复制给所有玩家啊，有问题吗？</p><p>没有任何问题。因为 &quot;APlayerState&quot; 实际上也只是一个普普通通的 &quot;AActor&quot;，他只是 &quot;AController&quot; 中的一个可复制的属性。所以将属性定义在 &quot;APlayerState&quot; 还是直接定义在 &quot;APlayerController&quot; 中 实际上是没有任何区别的。但为什么呢？为什么虚幻要这么做？</p><p>对虚幻的 gameplay 结构清晰的读者应该会有自己的一些理解。我说说自己的理解吧。我认为是为了将 控制和数据管理的职责分离。简单来说就是 MVC 三层架构。如：GameMode 负责控制游戏规则的执行，而 GameState 则负责储存必要的全局游戏状态。对于 PlayerController，我们需要他处理很多控制逻辑，包括玩家的各种输入，对相机和 pawn 的各种调整，以及属性的网络复制等等。我们不想再让他处理控制以外的逻辑，比如：玩家得分，玩家名称等数据的复制。如此就能实现控制和数据的解耦，单一职责，这可以提高程序的健壮性。</p><hr><p>下一篇：Gameplay —— USavegame &amp; UPlayer</p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-01-02 15:38:32" itemprop="dateModified" datetime="2022-01-02T15:38:32+08:00">2022-01-02</time> </span><span id="2021/12/12/UE4/UE4CPP/Gameplay —— AGameMode & AGameState & APlayerState/" class="item leancloud_visitors" data-flag-title="Gameplay —— AGameMode & AGameState & APlayerState" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>-YIFEI- <i class="ic i-at"><em>@</em></i>一个年轻人奔向梦想的足迹</li><li class="link"><strong>本文链接：</strong> <a href="https://kotori_suki.github.io/2021/12/12/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AGameMode%20&%20AGameState%20&%20APlayerState/" title="Gameplay —— AGameMode &amp; AGameState &amp; APlayerState">https://kotori_suki.github.io/2021/12/12/UE4/UE4CPP/Gameplay —— AGameMode & AGameState & APlayerState/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/12/09/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20APawn%20&%20AController%20&%20APlayerController/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gicliwyw55j20zk0m8hdt.jpg" title="Gameplay —— APawn &amp; AController &amp; APlayerController"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Gameplay</span><h3>Gameplay —— APawn & AController & APlayerController</h3></a></div><div class="item right"><a href="/2021/12/15/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20USavegame%20&%20UPlayer/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclx6phq6j20zk0m8e36.jpg" title="Gameplay —— USavegame &amp; UPlayer"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Gameplay</span><h3>Gameplay —— USavegame & UPlayer</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#gameplay-agamemode-agamestate-aplayerstate"><span class="toc-number">1.</span> <span class="toc-text">Gameplay —— AGameMode &amp; AGameState &amp; APlayerState</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ainfo"><span class="toc-number">1.1.</span> <span class="toc-text">AInfo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#agamemodebase"><span class="toc-number">1.2.</span> <span class="toc-text">AGameModeBase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#agamemode"><span class="toc-number">1.3.</span> <span class="toc-text">AGameMode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#agamestatebase"><span class="toc-number">1.4.</span> <span class="toc-text">AGameStateBase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#agamestate"><span class="toc-number">1.5.</span> <span class="toc-text">AGameState</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aplayerstate"><span class="toc-number">1.6.</span> <span class="toc-text">APlayerState</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2021/12/01/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20%E6%80%BB%E8%A7%88%20&%20UEngine%20&%20UGameInstance/" rel="bookmark" title="Gameplay —— 总览 & UEngine & UGameInstance">Gameplay —— 总览 & UEngine & UGameInstance</a></li><li><a href="/2021/12/03/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20FWorldContext%20&%20UWorld%20&%20ULevel/" rel="bookmark" title="Gameplay —— FWorldContext & UWorld & ULevel">Gameplay —— FWorldContext & UWorld & ULevel</a></li><li><a href="/2021/12/06/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AActor%20&%20UActorComponent/" rel="bookmark" title="Gameplay —— AActor & UActorComponent">Gameplay —— AActor & UActorComponent</a></li><li><a href="/2021/12/09/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20APawn%20&%20AController%20&%20APlayerController/" rel="bookmark" title="Gameplay —— APawn & AController & APlayerController">Gameplay —— APawn & AController & APlayerController</a></li><li class="active"><a href="/2021/12/12/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AGameMode%20&%20AGameState%20&%20APlayerState/" rel="bookmark" title="Gameplay —— AGameMode & AGameState & APlayerState">Gameplay —— AGameMode & AGameState & APlayerState</a></li><li><a href="/2021/12/15/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20USavegame%20&%20UPlayer/" rel="bookmark" title="Gameplay —— USavegame & UPlayer">Gameplay —— USavegame & UPlayer</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="-YIFEI-" data-src="/images/avatar.jpg"><p class="name" itemprop="name">-YIFEI-</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">56</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">15</span> <span class="name">分类</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0tvdG9yaS1TdWtp" title="https:&#x2F;&#x2F;github.com&#x2F;Kotori-Suki"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS90dnQtNjA=" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;tvt-60"><i class="ic i-zhihu"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li></ul></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/12/09/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20APawn%20&%20AController%20&%20APlayerController/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/12/15/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20USavegame%20&%20UPlayer/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="分类于 C++基础">C++基础</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="分类于 设计模式">设计模式</a> <i class="ic i-angle-right"></i> <a href="/categories/CPPBase/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/" title="分类于 行为型模式">行为型模式</a></div><span><a href="/2021/08/21/CPPBase/DesignPattern/State/" title="状态模式">状态模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="分类于 UE4_C++">UE4_C++</a></div><span><a href="/2021/11/15/UE4/UE4CPP/FProperty%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E6%80%BB%E7%BB%93/" title="FProperty的分析与总结">FProperty的分析与总结</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPPBase/" title="分类于 C++基础">C++基础</a></div><span><a href="/2021/08/25/CPPBase/%E7%AE%80%E5%8D%95%E8%BF%AD%E4%BB%A3%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0/" title="简单迭代器的实现">简单迭代器的实现</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="分类于 UE4_C++">UE4_C++</a></div><span><a href="/2021/11/22/UE4/UE4CPP/Unreal%20%E5%A4%9A%E7%A7%8D%E6%8C%87%E9%92%88%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" title="Unreal 多种指针实现原理">Unreal 多种指针实现原理</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="分类于 UE4_C++">UE4_C++</a></div><span><a href="/2021/10/25/UE4/UE4CPP/API%E4%B8%8D%E6%AD%A3%E5%B8%B8%E5%B7%A5%E4%BD%9C-%E4%B9%8B-GetPlayerController/" title="API不正常工作 之 GetPlayerController">API不正常工作 之 GetPlayerController</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="分类于 UE4_C++">UE4_C++</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/Gameplay/" title="分类于 Gameplay">Gameplay</a></div><span><a href="/2021/12/06/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AActor%20&%20UActorComponent/" title="Gameplay —— AActor &amp; UActorComponent">Gameplay —— AActor & UActorComponent</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ComputerBase/" title="分类于 计算机基础">计算机基础</a> <i class="ic i-angle-right"></i> <a href="/categories/ComputerBase/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" title="分类于 操作系统">操作系统</a></div><span><a href="/2021/08/16/ComputerBase/OperatingSystem/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" title="进程 线程 多线程">进程 线程 多线程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="分类于 UE4_C++">UE4_C++</a></div><span><a href="/2021/11/06/UE4/UE4CPP/Unreal%20GC%E8%BF%87%E7%A8%8B/" title="Unreal GC过程">Unreal GC过程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="分类于 UE4_C++">UE4_C++</a></div><span><a href="/2022/01/08/UE4/UE4CPP/Unreal%20%E8%93%9D%E5%9B%BE%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6/" title="Unreal 蓝图底层实现机制">Unreal 蓝图底层实现机制</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/UE4/" title="分类于 UE4">UE4</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/" title="分类于 UE4_C++">UE4_C++</a> <i class="ic i-angle-right"></i> <a href="/categories/UE4/UE4CPP/Gameplay/" title="分类于 Gameplay">Gameplay</a></div><span><a href="/2021/12/12/UE4/UE4CPP/Gameplay%20%E2%80%94%E2%80%94%20AGameMode%20&%20AGameState%20&%20APlayerState/" title="Gameplay —— AGameMode &amp; AGameState &amp; APlayerState">Gameplay —— AGameMode & AGameState & APlayerState</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2021 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">-YIFEI- @ Afei's Blog</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/12/12/UE4/UE4CPP/Gameplay —— AGameMode & AGameState & APlayerState/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>